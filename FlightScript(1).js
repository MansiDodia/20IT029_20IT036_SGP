app.controller("FlightSearchCtrl",["$scope","$routeParams","$rootScope","$http","$window","$timeout","$q","$document","$sce","UUID","$location","Data","$interval","PDFMaker","$filter",function(n,t,r,u,f,e,o,s,h,c,a,v,y){var ut,ft,d,g,b;if(localStorage.getItem("PreviousCtrl")=="payment"){localStorage.setItem("PreviousCtrl","search");r.LoadPage("home");return}jQuery.fn.scrollCenter=function(n,t){try{var r=jQuery(this).find(n),u=r.width()/2,i=r.position().left+u,f=jQuery(this).scrollLeft(),e=jQuery(this).width();return i=i+f-e/2,jQuery(this).animate({scrollLeft:i},t==undefined?1e3:t),this}catch(o){}};n.Bannercheck=!1;n.BannerImageArray=[];n.GetSearchBanner=function(){try{var t=u({method:"POST",url:Config.Api+"Trading/GetSearchBanner",dataType:"json",data:n.GetHeader(n.ProcessID),headers:{"Content-Type":"application/json","Content-Encoding":"gzip"}});t.then(function(t){var r,u,f,i;try{if(r=0,u=t.data,u.Status=="1")for(f=JSON.parse(u.Data),n.BannerData=f.Table1,i=0;i<n.BannerData.length;i++){r=i+1;var e=r+1,o=r+2,s=e*o,h=s/2,c=h-1;n.BannerImageArray.push({Image:n.BannerData[i].ImagePath,BannerIndex:c})}}catch(c){}},function(){})}catch(r){}};n.BindBannerImage=function(t){try{for(var i=0;i<n.BannerImageArray.length;i++)if(n.BannerImageArray[i].BannerIndex===t)return n.BannerImageArray[i].Image}catch(r){}};n.GetSearchBanner();n.GetSearchBannerIndex=function(t){try{for(var i=0;i<n.BannerImageArray.length;i++)if(n.BannerImageArray[i].BannerIndex===t)return!0}catch(r){}};n.SwipeArrayDate=[];r.ShowBack="";n.BuildCalendarLink=function(t){var s,o,a,r,u,f,h,c,i;try{for(n.SwipeArrayDate=[],s=t.split("~"),o=0;o<s.length-1;o++){a="";r="";r=s[o];r=r.split("|");u=r[4];f=s[o];f=f.split("!");var e=f[1],v=f[2],y=f[3],l=0;if(l=parseInt(r[2]),h=new Date,n.FormatDate(e,"MM","MM")==moment().format("MM")?(h=moment().format("DD"),c=parseInt(h)):c=1,r[0]=="1")for(i=c;i<=l;i++)n.LTravelDate=i+"/"+e+"/"+v,n.LTravelDate=n.FormatDate(n.LTravelDate,"DD/MM/YYYY","DD/MM/YYYY"),u!=""?u.split("@")[i]!=null?u.split("@")[i].split("$")[1]!=null&&(u.split("@")[i].split("$")[1].split(".")[0]!=""?n.SwipeArrayDate.push({OngoingDate:n.FormatDate(n.LTravelDate,"DD/MM/YYYY","DD/MM/YYYY"),RowIndex:n.FormatDate(n.LTravelDate,"DD/MM/YYYY","DD")+"D"+n.FormatDate(e,"MM","MM"),Fare:u.split("@")[i].split("$")[1].split(".")[0]}):n.SwipeArrayDate.push({OngoingDate:n.FormatDate(n.LTravelDate,"DD/MM/YYYY","DD/MM/YYYY"),RowIndex:n.FormatDate(n.LTravelDate,"DD/MM/YYYY","DD")+"D"+n.FormatDate(e,"MM","MM"),Fare:"-"})):n.SwipeArrayDate.push({OngoingDate:n.FormatDate(n.LTravelDate,"DD/MM/YYYY","DD/MM/YYYY"),RowIndex:n.FormatDate(n.LTravelDate,"DD/MM/YYYY","DD")+"D"+n.FormatDate(e,"MM","MM"),Fare:"-"}):n.SwipeArrayDate.push({OngoingDate:n.FormatDate(n.LTravelDate,"DD/MM/YYYY","DD/MM/YYYY"),RowIndex:n.FormatDate(n.LTravelDate,"DD/MM/YYYY","DD")+"D"+n.FormatDate(e,"MM","MM"),Fare:"-"})}}catch(p){}};n.ProcessID=c.Get();n.FareSummary=function(t){try{t==1?(n.Air_TotalFees=!n.Air_TotalFees,n.TaxesFeesOnVisible=n.Air_TotalFees==!0?!0:!1):t==3?n.AddONDetailsVisible=n.AddONDetailsVisible==!0?!1:!0:(n.FareSummaryDetails=!n.FareSummaryDetails,n.FareSummaryDetails==!0?(n.Adult_BaseFare>0&&(n.AdultDetails=!0),n.Child_BaseFare>0&&(n.ChildDetails=!0),n.Infant_BaseFare>0&&(n.InfantDetails=!0)):(n.AdultDetails=!1,n.ChildDetails=!1,n.InfantDetails=!1))}catch(i){}};n.BookingType="ONE_WAY";n.RB_BookingType="ONE_WAY";n.SearchType="NORMAL";n.RequestErrorDesc="";n.RequestInnerException="";n.RequestInnerExceptionVisible=!1;n.BookingButtonValue="Book";n.Thread_Count=0;n.Completed_Thread_Count=0;n.MultiTotalFare=0;n.GrossCommission=0;n.Selected_Trip=0;n.FlightBooking={};n.OnwardTrips=[];n.ReturnTrips=[];n.MultiTrips=[];n.AirlineName=[];n.PromoDescList=[];n.CurrentFares=[];n.InstaReschedule=!1;n.RescheduleFlag=!1;n.RescheduleModel={};n.RescheduleModel.RescheduleReason="";n.RedEyeStarts=Config.Airline.RedEyeStarts;n.RedEyeEnds=Config.Airline.RedEyeEnds;n.ShortLayOver=Config.Airline.ShortLayOver;n.LongLayOver=Config.Airline.LongLayOver;localStorage.setItem("PreviousCtrl","search");n.ShowXsTrip=function(t){try{n.Adult_Count>0&&(n.adCharValue=n.Adult_Count+" ADT");n.Child_Count>0&&(n.cdCharValue=", "+n.Child_Count+" CHD");n.Infant_Count>0&&(n.itCharValue=", "+n.Infant_Count+" INF");(n.Child_Count==0||n.Child_Count==null)&&(n.cdCharValue="");(n.Infant_Count==0||n.Infant_Count==null)&&(n.itCharValue="");n.selectedTrip=t;t==1?localStorage.getItem("RescheduleFlightObject")!=""&&localStorage.getItem("RescheduleFlightObject")!="undefined"&&localStorage.getItem("RescheduleFlightObject")!=undefined&&localStorage.getItem("RescheduleFlightObject")!="null"&&localStorage.getItem("RescheduleFlightObject")!=null?($("#tabOnward").show(),$("#tabReturn").hide()):($("#ModuleName").html("<span><span>"+n.From.originalObject.Name.split("(")[0]+" - "+n.To.originalObject.Name.split("(")[0]+"<\/span><\/br><span class='lbl-small'> "+n.FormatDate(n.OngoingDate,"DD/MM/YYYY","ddd, DD MMM YYYY")+", "+n.adCharValue+n.cdCharValue+n.itCharValue+"<\/span><\/span>"),$("#tabOnward").show(),$("#tabReturn").hide()):t==2?localStorage.getItem("RescheduleFlightObject")!=""&&localStorage.getItem("RescheduleFlightObject")!="undefined"&&localStorage.getItem("RescheduleFlightObject")!=undefined&&localStorage.getItem("RescheduleFlightObject")!="null"&&localStorage.getItem("RescheduleFlightObject")!=null?($("#tabOnward").hide(),$("#tabReturn").show()):($("#ModuleName").html("<span><span>"+n.To.originalObject.Name.split("(")[0]+" - "+n.From.originalObject.Name.split("(")[0]+"<\/span><\/br><span class='lbl-small'> "+n.FormatDate(n.ReturnDate,"DD/MM/YYYY","ddd, DD MMM YYYY")+", "+n.adCharValue+n.cdCharValue+n.itCharValue+"<\/span><\/span>"),$("#tabOnward").hide(),$("#tabReturn").show()):($("#tabOnward").show(),$("#tabReturn").show())}catch(i){}};n.checkResponsive=function(){try{var t=parseInt($(window).width());t<400?(n.AirFilterHeaderVisible=!1,n.ShowXsTrip(1)):e(function(){n.AirFilterHeaderVisible=!0;n.ShowXsTrip(0)},500)}catch(i){}};n.RecentSearch=function(){var h,e,t;try{var f="",u=new Date,o=u.getMonth()+1,s=u.getFullYear(),i=u.getDate()-1;i.toString().length==1&&(i="0"+i);f=i+"/0"+o+"/"+s;n.RecentAirSearchList=[];n.AirSearchList=[];h=0;e=r.GetCookie("FlightPastSearch");try{for(n.AirSearchList=JSON.parse(e),t=0;t<n.AirSearchList.length;t++)f!=n.AirSearchList[t].Search[0].OngoingDate&&n.RecentAirSearchList.length<=2&&n.RecentAirSearchList.push(n.AirSearchList[t]);localStorage.setItem("RecentSearch",JSON.stringify(n.RecentAirSearchList))}catch(c){}}catch(c){r.SetCookie("FlightPastSearch","")}};n.DefenceTracking=function(){var t,i;try{t=JSON.parse(localStorage.getItem("DefenceTrack"));n.defenceDetails={Header:n.GetHeader(n.ProcessID),DefenceCategory:t.Category,DefenceId:t.ServiceNumber};i=u({method:"POST",url:Config.Api+"Trading/DefenceTrack",dataType:"json",data:n.defenceDetails,headers:{"Content-Type":"application/json"}});i.then(function(n){var t=n.data;t.Status=="1"},function(){})}catch(f){}};n.checkResponsive();n.HostSearch=!1;n.SearchBoxIsVisible=!1;n.ResultIsVisible=!0;n.ResultHeaderVisible=!0;n.SearchDummyIsVisible=!0;n.ReturnContainerVisible=!1;n.ReturnBookButtonVisible=!1;n.RoundTripBarVisible=!1;n.FilterCollapse=!1;n.ModifySearch=!0;n.ShowTopPackageList=!0;n.MultiCity_Fare=!1;n.AirlineSearchIsVisible=!0;n.FooterSearchBoxIsVisible=!1;n.LowestCache=!1;n.LowestCache_Return=!1;n.Closetabs=function(){try{n.TravellerDropClose();n.DateOnShow=!1;n.DateRetShow=!1}catch(t){}};var w=new Date,nt=String(w.getDate()).padStart(2,"0"),tt=String(w.getMonth()+1).padStart(2,"0"),it=w.getFullYear();n.OngoingDate=nt+"/"+tt+"/"+it;n.ReturnDate="";n.RBL_BookingType=function(t){try{n.Closetabs();Config.ChannelId=="3"?n.BookingType=t:n.BookingType1=t;n.TripList=[];var i=new Date,r=String(i.getDate()).padStart(2,"0"),u=String(i.getMonth()+1).padStart(2,"0"),f=i.getFullYear();n.OngoingDate=r+"/"+u+"/"+f;t=="ONE_WAY"?(n.ReturnDate="",n.RoundTrip_Fare=!1):t=="ROUNDTRIP"?(n.ReturnDate=n.OngoingDate,n.InputList=[]):t=="SPECIALROUNDTRIP"?(n.ReturnDate=n.OngoingDate,n.RoundTrip_Fare=!0,n.RB_BookingType="ROUNDTRIP"):t=="MULTICITY"&&(n.To=undefined,n.DestinationID="",n.ReturnContainerVisible=!1,n.BtnAddFirstCity=!0,n.AddSecondCity=!1,n.AddThridCity=!1,n.AddFourthCity=!1,n.FirstOriginID="",n.FirstDestinationID="",n.SecondOriginID="",n.SecondDestinationID="",n.ThridOriginID="",n.ThridDestinationID="",n.FourthOriginID="",n.FourthDestinationID="",n.MultiCityOngoingDate=r+"/"+u+"/"+f,n.MultiDateFormat=getDayNameMonth(n.MultiCityOngoingDate),n.FirstOngoingDate=moment(n.MultiDateFormat).add(1,"days").format("DD/MM/YYYY"));setTimeout(function(){$(".orgin").find("input").focus()},500)}catch(e){}};n.ClearResults=function(){try{n.FilterHeaderVisible=!1;n.FilterVisible=!1;n.OnwardVisible=!1;n.ReturnVisible=!1;n.ResultHeaderVisible=!1;n.SearchBoxIsVisible=!0;n.ShowTopPackageList=!0;n.AirlineSearchIsVisible=!0}catch(t){}};n.AdultIsVisible=!0;n.FilterCheck=!0;n.OnwardVisible=!1;n.ReturnVisible=!1;n.ShareOneWay=!0;n.LoaderData=function(n){return new Array(n)};n.FilterVisible=!1;n.FilterHeaderVisible=!1;n.ShowCommission=!1;n.ShowNetFare=!1;n.ShowFullFare=!1;n.Shownonstop=!1;n.Show1stop=!1;n.Show1change=!1;n.Shownmorechange=!1;n.CodeNotValid=!1;n.FareLogic=!1;n.FilterDetails=function(){var r,a,t,v,p,nt,o,w,d,u;try{n.Airlines_Trips=n.ShowOnwardTrips;var s=[],f=[],h=[],c=[],g=[],b=[],y=[],k=[];for(n.FightCount=0,n.FightCount_Onward=0,n.FightCount_Return=0,n.LowestPrice=0,n.LowestPrice_Return=0,n.LowestPriceAirLine="",n.LowestPriceAirLine_Return="",n.minimumPrice=0,n.maximumPrice=0,n.minimumPrice_Return=0,n.maximumPrice_Return=0,n.minimumAirPrice=0,n.maximumAirPrice=0,n.FightCount_Onward=n.Airlines_Trips.length,n.BookingType=="ROUNDTRIP"&&(n.Airlines_ReturnTrips=n.ReturnTrips,n.FightCount_Return=n.Airlines_Trips.length),n.FightCount=n.FightCount_Onward+n.FightCount_Return,i=0;i<n.Airlines_Trips.length;i++)if(n.lobjFlightName=n.Airlines_Trips[i],n.lobjFlightName.isHide==!1){for(s.indexOf(n.lobjFlightName.Airline_Code)===-1&&s.push(n.lobjFlightName.Airline_Code),t=0;t<n.lobjFlightName.Segments.length;t++)y.push(n.lobjFlightName.Segments[t].Flight_Number);if(n.BookingType=="SPECIALROUNDTRIP")for(n.onwardSegments=0,n.ReturnSegments=0,r=0;r<n.lobjFlightName.Segments.length;r++)r+1<=n.lobjFlightName.Segments.length&&(n.lobjFlightName.Segments[r].Return_Flight==!1&&(n.onwardSegments+=1,n.onwardSegmentstop=n.lobjFlightName.Segments[r].Stop_Over,n.onwardSegments-1>1&&(n.OSegments_Length="1+ Changes"),n.onwardSegments-1==0&&(n.lobjFlightName.Segments[r].Stop_Over==null?n.OSegments_Length="Non-Stop":n.lobjFlightName.Segments[r].Stop_Over.length==0&&(n.OSegments_Length="Non-Stop")),n.onwardSegments-1==0&&n.lobjFlightName.Segments[r].Stop_Over!=null?n.lobjFlightName.Segments[r].Stop_Over.length>0&&(n.OSegments_Length="1 Stop"):n.onwardSegments-1==1&&(n.OSegments_Length="1 Change")),n.lobjFlightName.Segments[r].Return_Flight==!0&&(n.ReturnSegments+=1,n.ReturnSegmentstop=n.lobjFlightName.Segments[r].Stop_Over,n.ReturnSegments-1>1&&(n.RSegments_Length="1+ Changes"),n.ReturnSegments-1==0&&(n.lobjFlightName.Segments[r].Stop_Over==null?n.RSegments_Length="Non-Stop":n.lobjFlightName.Segments[r].Stop_Over.length==0&&(n.RSegments_Length="Non-Stop")),n.ReturnSegments-1==0&&n.lobjFlightName.Segments[r].Stop_Over!=null?n.lobjFlightName.Segments[r].Stop_Over.length>0&&(n.RSegments_Length="1 Stop"):n.ReturnSegments-1==1&&(n.RSegments_Length="1 Change")));else for(n.lobjFlightName.Segments.length-1>1&&(n.Segments_Length="1+ Changes"),n.lobjFlightName.Segments.length-1==0&&(n.lobjFlightName.Segments[0].Stop_Over==null?n.Segments_Length="Non-Stop":n.lobjFlightName.Segments[0].Stop_Over.length==0&&(n.Segments_Length="Non-Stop")),n.lobjFlightName.Segments.length-1==0&&n.lobjFlightName.Segments[0].Stop_Over!=null&&n.lobjFlightName.Segments[0].Stop_Over.length>0&&(n.Segments_Length="1 Stop"),n.lobjFlightName.Segments.length-1==1&&(n.Segments_Length="1 Change"),a=0;a<n.lobjFlightName.Segments.length;a++)n.lobjFlightName.Segments[a].Stop_Over!=null&&(n.lobjFlightName.Segments[a].Stop_Over.length==1&&(n.Segments_Length="1 Stop"),n.lobjFlightName.Segments[a].Stop_Over.length>1&&(n.Segments_Length="1+ Stops"));for(n.BookingType=="SPECIALROUNDTRIP"?(n.lobjFlightName.OSegments_Stops=n.OSegments_Length,f.indexOf(n.OSegments_Length)===-1&&f.push(n.OSegments_Length),n.lobjFlightName.RSegments_Stops=n.RSegments_Length,f.indexOf(n.RSegments_Length)===-1&&f.push(n.RSegments_Length)):(n.lobjFlightName.Segments_Stops=n.Segments_Length,f.indexOf(n.Segments_Length)===-1&&f.push(n.Segments_Length)),t=0;t<n.lobjFlightName.Fares.length;t++)n.lobjFlightPrice=n.lobjFlightName.Fares[t],n.lobjFlightPrice==null||n.lobjFlightPrice.Hide_Fare||(n.minimumPrice==0&&n.maximumPrice==0?(n.LowestPriceAirLine=n.lobjFlightName.Airline_Code,n.LowestCache=n.lobjFlightName.Cached,n.LowestPrice=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)-Math.floor(n.lobjFlightPrice.FareDetails[0].Trade_Markup_Amount),n.minimumPrice=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount),n.maximumPrice=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount),n.minimumAirPrice=n.minimumPrice,n.maximumAirPrice=n.maximumPrice):(n.LowestPrice>Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)-Math.floor(n.lobjFlightPrice.FareDetails[0].Trade_Markup_Amount)&&(n.LowestPrice=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)-Math.floor(n.lobjFlightPrice.FareDetails[0].Trade_Markup_Amount),n.LowestPriceAirLine=n.lobjFlightName.Airline_Code,n.LowestCache=n.lobjFlightName.Cached),n.minimumPrice>Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)?(n.minimumPrice=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount),n.minimumAirPrice=n.minimumPrice):n.maximumPrice<Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)&&(n.maximumPrice=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount),n.maximumAirPrice=n.maximumPrice))),n.lobjFlightPrice.Refundable==!0?n.lobjFlight_Refundable="Refundable":n.lobjFlightPrice.Refundable==!1&&(n.lobjFlight_Refundable="Non Refundable"),n.lobjFlightName.Flight_Refundable=n.lobjFlight_Refundable,h.indexOf(n.lobjFlight_Refundable)===-1&&h.push(n.lobjFlight_Refundable),n.lobjFlightPrice.FareType==0?n.lobjFlight_FareType="RetailFare":n.lobjFlightPrice.FareType==1?n.lobjFlight_FareType="CouponFare":n.lobjFlightPrice.FareType==2?n.lobjFlight_FareType="CorporateFare":n.lobjFlightPrice.FareType==3?n.lobjFlight_FareType="SMEFare":n.lobjFlightPrice.FareType==4&&(n.lobjFlight_FareType="RTSPLFare"),n.lobjFlightName.FlightOnward_FareType=n.lobjFlight_FareType,c.indexOf(n.lobjFlight_FareType)===-1&&c.push(n.lobjFlight_FareType)}if(n.BookingType=="ROUNDTRIP")for(i=0;i<n.Airlines_ReturnTrips.length;i++)if(n.lobjFlightName=n.Airlines_ReturnTrips[i],n.lobjFlightName.isHide==!1){for(s.indexOf(n.lobjFlightName.Airline_Code)===-1&&s.push(n.lobjFlightName.Airline_Code),t=0;t<n.lobjFlightName.Segments.length;t++)y.push(n.lobjFlightName.Segments[t].Flight_Number);for(n.lobjFlightName.Segments.length-1>1&&(n.Segments_Length="1+ Changes"),n.lobjFlightName.Segments.length-1==0&&n.lobjFlightName.Segments[0].Stop_Over==null&&(n.Segments_Length="Non-Stop"),n.lobjFlightName.Segments.length-1==0&&n.lobjFlightName.Segments[0].Stop_Over!=null?n.lobjFlightName.Segments[0].Stop_Over.length>0&&(n.Segments_Length="1 Stop"):n.lobjFlightName.Segments.length-1==1&&(n.Segments_Length="1 Change"),n.lobjFlightName.Segments_Stops=n.Segments_Length,f.indexOf(n.Segments_Length)===-1&&f.push(n.Segments_Length),t=0;t<n.lobjFlightName.Fares.length;t++)n.lobjFlightPrice=n.lobjFlightName.Fares[t],n.lobjFlightPrice==null||n.lobjFlightPrice.Hide_Fare||(n.minimumPrice==0&&n.maximumPrice==0?(n.LowestPriceAirLine_Return=n.lobjFlightName.Airline_Code,n.LowestPrice_Return=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)-Math.floor(n.lobjFlightPrice.FareDetails[0].Trade_Markup_Amount),n.LowestCache_Return=n.lobjFlightName.Cached,n.minimumPrice=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount),n.maximumPrice=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount),n.minimumAirPrice=n.minimumPrice,n.maximumAirPrice=n.maximumPrice):(n.LowestPrice_Return>Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)-Math.floor(n.lobjFlightPrice.FareDetails[0].Trade_Markup_Amount)&&(n.LowestPrice_Return=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)-Math.floor(n.lobjFlightPrice.FareDetails[0].Trade_Markup_Amount),n.LowestPriceAirLine_Return=n.lobjFlightName.Airline_Code,n.LowestCache_Return=n.lobjFlightName.Cached),n.minimumPrice>Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)?(n.minimumPrice=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount),n.minimumAirPrice=n.minimumPrice):n.maximumPrice<Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)&&(n.maximumPrice=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount),n.maximumAirPrice=n.maximumPrice)),n.minimumPrice_Return==0&&n.maximumPrice_Return==0?(n.LowestCache_Return=n.lobjFlightName.Cached,n.LowestPriceAirLine_Return=n.lobjFlightName.Airline_Code,n.LowestPrice_Return=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)-Math.floor(n.lobjFlightPrice.FareDetails[0].Trade_Markup_Amount),n.minimumPrice_Return=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount),n.maximumPrice_Return=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)):(n.LowestPrice_Return>Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)-Math.floor(n.lobjFlightPrice.FareDetails[0].Trade_Markup_Amount)&&(n.LowestPrice_Return=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)-Math.floor(n.lobjFlightPrice.FareDetails[0].Trade_Markup_Amount),n.LowestPriceAirLine_Return=n.lobjFlightName.Airline_Code,n.LowestCache_Return=n.lobjFlightName.Cached),n.minimumPrice_Return>Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)&&(n.minimumPrice_Return=Math.floor(n.lobjFlightPrice.FareDetails[0].Total_Amount)))),n.lobjFlightPrice.Refundable==!0?n.lobjFlight_Refundable="Refundable":n.lobjFlightPrice.Refundable==!1&&(n.lobjFlight_Refundable="Non Refundable"),n.lobjFlightName.Refundable_Return=n.lobjFlight_Refundable,h.indexOf(n.lobjFlight_Refundable)==-1&&h.push(n.lobjFlight_Refundable),n.lobjFlightPrice.FareType==0?n.lobjFlight_FareType="RetailFare":n.lobjFlightPrice.FareType==1?n.lobjFlight_FareType="CouponFare":n.lobjFlightPrice.FareType==2?n.lobjFlight_FareType="CorporateFare":n.lobjFlightPrice.FareType==3?n.lobjFlight_FareType="SMEFare":n.lobjFlightPrice.FareType==4&&(n.lobjFlight_FareType="RTSPLFare"),n.lobjFlightName.FlightReturn_FareType=n.lobjFlight_FareType,c.indexOf(n.lobjFlight_FareType)===-1&&c.push(n.lobjFlight_FareType)}for(i=0;i<s.length;i++){for(v=s[i],u=0,j=0;j<n.Airlines_Trips.length;j++)v==n.Airlines_Trips[j].Airline_Code&&u++;if(n.BookingType=="ROUNDTRIP")for(t=0;t<n.Airlines_ReturnTrips.length;t++)v==n.Airlines_ReturnTrips[t].Airline_Code&&u++;g.push({Airline:v,Airline_count:u})}for(p=[],i=0;i<y.length;i++){for(nt=y[i],u=0,j=0;j<n.Airlines_Trips.length;j++)v==n.Airlines_Trips[j].Airline_Code&&u++;if(n.BookingType=="ROUNDTRIP")for(t=0;t<n.Airlines_ReturnTrips.length;t++)v==n.Airlines_ReturnTrips[t].Airline_Code&&u++;p.push({AirlineNumber:nt,Airline_count:u})}for(l=0;l<f.length;l++){for(o=f[l],w=0,j=0;j<n.Airlines_Trips.length;j++)n.Airlines_Trips[j].Segments.length-1>1&&(n.Segments_Length="1+ Changes"),n.Airlines_Trips[j].Segments.length-1==0&&(n.Airlines_Trips[j].Segments[0].Stop_Over==null?n.Segments_Length="Non-Stop":n.Airlines_Trips[j].Segments[0].Stop_Over.length==0&&(n.Segments_Length="Non-Stop")),n.Airlines_Trips[j].Segments.length-1==0&&n.Airlines_Trips[j].Segments[0].Stop_Over!=null&&n.Airlines_Trips[j].Segments[0].Stop_Over.length>0&&(n.Segments_Length="1 Stop"),n.Airlines_Trips[j].Segments.length-1==1&&(n.Segments_Length="1 Change"),o==n.Segments_Length&&w++;if(n.BookingType=="ROUNDTRIP")for(t=0;t<n.Airlines_ReturnTrips.length;t++)n.Airlines_ReturnTrips[t].Segments.length-1>1&&(n.Segments_Length="1+ Changes"),n.Airlines_ReturnTrips[t].Segments.length-1==0&&(n.Airlines_ReturnTrips[t].Segments[0].Stop_Over==null?n.Segments_Length="Non-Stop":n.Airlines_ReturnTrips[t].Segments[0].Stop_Over.length==0&&(n.Segments_Length="Non-Stop")),n.Airlines_ReturnTrips[t].Segments.length-1==0&&n.Airlines_ReturnTrips[t].Segments[0].Stop_Over!=null?n.Airlines_ReturnTrips[t].Segments[0].Stop_Over.length>0&&(n.Segments_Length="1 Stop"):n.Airlines_ReturnTrips[t].Segments.length-1==1&&(n.Segments_Length="1 Change"),n.Airlines_ReturnTrips[t].Segments_Stops=n.Segments_Length,o==n.Segments_Length&&w++;o=="Non-Stop"?n.Shownonstop=!0:o=="1 Stop"?n.Show1stop=!0:o=="1 Change"?n.Show1change=!0:n.Shownmorechange=!0;b.push({Stop_Name:o,Stop_count:w})}n.AirlineType=g;n.AirlineNumbers=p;try{for(i=0;i<n.AirlineType.length;i++)for(d=n.AirlineType[i].Airline,u=n.AirlineType[i].Airline_count,j=0;j<n.AirlineList.length;j++)d==n.AirlineList[j].Value&&n.Travel_Type==n.AirlineList[j].Type&&k.push({Airline_Name:n.AirlineList[j].Name,Airline:d,Airline_count:u})}catch(tt){}n.AirlineType=k;n.AirlineStop=b;n.AirlineRefundable=h;n.AirlineFareType=c;n.FilterAirlineTypes=n.CreateCheckboxes(k);n.FilterAirlineNumber=n.CreateCheckboxes(p);n.FilterAirlineStops=n.CreateCheckboxes(b);n.FilterAirlineRefundable=n.CreateCheckboxes(h);n.FilterAirlineFareType=n.CreateCheckboxes(c);n.PriceRange={options:{floor:n.minimumPrice,ceil:n.maximumPrice,onStart:function(){},onChange:function(){},onEnd:function(){n.Filter()}}};e(function(){n.$broadcast("rzSliderForceRender")},1e3)}catch(tt){}};n.minDate=moment().subtract(1,"days").format("x");n.maxDate=moment().add(12,"M").format("x");n.LoadDefautlImage=GetPath()+"Content/Images/no_img_hotel.jpg";n.TopPackageDefaultImage=GetPath()+"Images/pkg_sld_def_img.png";n.Origin=[];n.Destination=[];n.Travel_Type="DOMESTIC";n.ImageURL=GetPath()+"Content/Images/AirlineLogo/";n.TotalPax_Count=0;n.FliterAirlineList=function(){try{var t=n.GetTravelType();n.Travel_Type=t;n.SelectedAirlineName=[];t==undefined&&(t="DOMESTIC",n.AirlineFlag=1);n.ClearResults();n.AirlineRestriction=fnGetRetailerData(52);angular.forEach(n.AirlineList,function(i){var r=!1;for(j=0;j<n.AirlineRestriction.split(",").length-1;j++)n.AirlineRestrictTravelType=n.AirlineRestriction.split(",")[j].split("~")[1]==13?"DOMESTIC":"INTERNATIONAL",i.Value==n.AirlineRestriction.split(",")[j].split("~")[0]&&n.AirlineRestrictTravelType==t&&(r=!0);i.Type==t&&r==!1&&n.SelectedAirlineName.push(i)});n.AirlineName=n.SelectedAirlineName;Config.ChannelId=="4"||Config.ChannelId=="5"?t=="INTERNATIONAL"&&n.BookingType1=="ROUNDTRIP"?n.RoundTrip_Fare=!1:t=="DOMESTIC"&&n.BookingType1=="ROUNDTRIP"?n.RoundTrip_Fare=!1:t=="INTERNATIONAL"&&n.BookingType1=="SPECIALROUNDTRIP"?n.RoundTrip_Fare=!0:t=="DOMESTIC"&&n.BookingType1=="SPECIALROUNDTRIP"&&(n.RoundTrip_Fare=!0):t=="INTERNATIONAL"&&n.BookingType=="ROUNDTRIP"?n.RoundTrip_Fare=!1:t=="DOMESTIC"&&n.BookingType=="ROUNDTRIP"?n.RoundTrip_Fare=!1:t=="INTERNATIONAL"&&n.BookingType=="SPECIALROUNDTRIP"?n.RoundTrip_Fare=!0:t=="DOMESTIC"&&n.BookingType=="SPECIALROUNDTRIP"&&(n.RoundTrip_Fare=!0)}catch(i){}};n.FilterAirport=function(n,t){var i;try{if(i=lobjAirportList.filter(function(i){return t==1?i.Value.toUpperCase()==n.toUpperCase():i.Name.toUpperCase().indexOf(n.toUpperCase())>-1?i:void 0}),i.length>0)return i[0];var f=n,e=Config.Api+Config.FlightCitySearchURL+f,o=u.get(e);o.then(function(n){var u=n.data.Data,t=u.filter(function(n){return n.Value==f});return t.length<=0&&r.LoadPage("home"),i=t,i[0]})}catch(h){}};n.GetTravelType=function(){try{return n.AirlineFlag="",n.From.originalObject.Type=="H"&&n.To.originalObject.Type=="H"?(n.AirlineFlag=1,"DOMESTIC"):(n.AirlineFlag=0,"INTERNATIONAL")}catch(t){}};n.Adult_Count=1;n.Child_Count=0;n.Infant_Count=0;var et=n.Adult_Count+8,ot=n.Adult_Count,st=n.Infant_Count,rt=n.Infant_Count,ht=n.Child_Count+9,ct=n.Child_Count,p;n.AdultIncrement=function(t){try{t||(t=1);n.Adult_Count=parseInt(t);n.Infant_Count=0;n.Child_Count=0;n.TravellerDropdown("undefined");n.CloseChangePaxonResult()}catch(i){}};n.ChildIncrement=function(t){try{n.Child_Count=parseInt(t);n.TravellerDropdown("undefined");n.CloseChangePaxonResult()}catch(i){}};n.InfantIncrement=function(t){try{n.Infant_Count=parseInt(t);n.TravellerDropdown("undefined");n.CloseChangePaxonResult()}catch(i){}};n.InfantDecrement=function(){try{if(n.Infant_Count<=rt)return;n.Infant_Count--;n.TravellerDropdown("undefined");n.CloseChangePaxonResult()}catch(t){}};n.Travel_Class="ECONOMY";n.SearchErrorVisible=!1;n.TravelClass=function(t){try{t==1?(n.clicked=1,n.Travel_Class="ECONOMY"):t==2?(n.clicked=2,n.Travel_Class="BUSINESS"):t==3?(n.clicked=3,n.Travel_Class="PREMIUM"):t==4&&(n.clicked=4,n.Travel_Class="FIRST");n.CloseChangePaxonResult();n.TravellerDropdown("undefined")}catch(i){}};n.CloseChangePaxonResult=function(){n.ResultHeaderVisible&&(n.SearchBoxIsVisible=!0,n.ResultHeaderVisible=!1,n.ShowTopPackageList=!0)};n.PushAirNameInfo=function(){var t,r;try{if(t=[],n.SelectedAirName!=undefined){if(n.SelectedAirName.length!=0){for(i=0;i<n.SelectedAirName.length;i++)r={},r.Airline_Code=n.SelectedAirName[i].Value,t.push(r);return t}return[{Airline_Code:""}]}return[{Airline_Code:""}]}catch(u){}};n.PushTripInfo=function(t,i){var f,e,u,r;try{if(f=[],n.BookingType=="MULTICITY")if(n.MultiCity_Fare==!0)for(e=0;e<t.length;e++)u=t[e],r={},r.Origin=u.OriginID.split("(")[1].split(")")[0],r.Destination=u.DestinationID.split("(")[1].split(")")[0],r.OriginID=u.OriginID,r.DestinationID=u.DestinationID,r.TravelDate=moment(u.OngoingDate,"DD/MM/YYYY").format("MM/DD/YYYY"),r.Trip_Id=u.Index+1,f.push(r);else u=t[i],r={},r.Origin=u.OriginID.split("(")[1].split(")")[0],r.Destination=u.DestinationID.split("(")[1].split(")")[0],r.OriginID=u.OriginID,r.DestinationID=u.DestinationID,r.TravelDate=moment(u.OngoingDate,"DD/MM/YYYY").format("MM/DD/YYYY"),r.Trip_Id=u.Index+1,f.push(r);else r={},r.Origin=n.From.originalObject.Value,r.Destination=n.To.originalObject.Value,r.TravelDate=moment(n.OngoingDate,"DD/MM/YYYY").format("MM/DD/YYYY"),r.Trip_Id=1,f.push(r);return(n.BookingType=="ROUNDTRIP"||n.BookingType=="SPECIALROUNDTRIP")&&(r={},r.Origin=n.To.originalObject.Value,r.Destination=n.From.originalObject.Value,r.TravelDate=moment(n.ReturnDate,"DD/MM/YYYY").format("MM/DD/YYYY"),r.Trip_Id=2,f.push(r)),f}catch(o){}};n.SearchLowFareForDateLink=function(t,i){var f,s,a,v;try{var e="",h="MAA",c="";if(e=n.OngoingDate,i==""&&n.BookingType!="MULTICITY"&&t=="0"){var r=parseInt(n.OngoingDate.split("/")[2]),o=moment(),l=moment(n.OngoingDate,"DD/MM/YYYY"),p=l.diff(o,"days"),w=l.diff(o,"month");if(parseInt(n.OngoingDate.split("/")[1])!=12)f=parseInt(n.OngoingDate.split("/")[1])+1,s=moment(o,"DD/MM/YYYY").format("MM")<parseInt(n.OngoingDate.split("/")[1])?parseInt(n.OngoingDate.split("/")[1])-1+"~"+r+","+parseInt(n.OngoingDate.split("/")[1])+"~"+r+","+f+"~"+r:parseInt(n.OngoingDate.split("/")[1])+"~"+r+","+f+"~"+r;else var f=1,y=r,r=r+1,s=parseInt(n.OngoingDate.split("/")[1])+"~"+y+","+f+"~"+r;n.From!=undefined&&n.To!=undefined&&(e=n.OngoingDate,h=n.From.originalObject.Value,c=n.To.originalObject.Value)}a={Header:n.GetHeader(n.ProcessID),Origin:h,Destination:c,TravelDate:e,Type:t,DoubleMonth:s};v=u({method:"POST",url:Config.Api+"FlightSearch/LowFareDatePicker",dataType:"json",data:a,headers:{"Content-Type":"application/json"}});v.then(function(t){try{var i=t.data;i.Status=="1"&&n.BuildCalendarLink(i.Data.Filler1,i.Data.Filler2)}catch(r){}},function(){})}catch(k){}};n.DefenceContinueFlag=!1;n.Search=function(){try{if(Config.ChannelId!="3"&&n.SearchLowFareForDateLink("0","",""),(Config.ChannelId=="4"||Config.ChannelId=="5")&&(n.BookingType1?n.BookingType=n.BookingType1:n.BookingType,$("#SearchFlightModal").modal("hide")),n.ThreadData=[],n.Closetabs(),(n.BookingType=="ROUNDTRIP"||n.BookingType=="SPECIALROUNDTRIP")&&(n.BookingType=n.RoundTrip_Fare==!0?"SPECIALROUNDTRIP":"ROUNDTRIP"),n.From==""||n.From=="undefined"||n.From==null)return ShowError("Please Enter Origin"),!1;if(Config.ChannelId!="3"){if(n.OriginName==""||n.OriginName=="undefined"||n.OriginName==null)return ShowError("Please Enter Origin"),!1;if(n.DestinationName==""||n.DestinationName=="undefined"||n.DestinationName==null)return ShowError("Please Enter Destination"),!1}else{if(n.OriginID==""||n.OriginID=="undefined"||n.OriginID==null)return ShowError("Please Enter Origin"),!1;if(n.DestinationID==""||n.DestinationID=="undefined"||n.DestinationID==null)return ShowError("Please Enter Destination"),!1}if(n.To==""||n.To=="undefined"||n.To==null)return ShowError("Please Enter Destination"),!1;if(n.From.originalObject.Name==n.To.originalObject.Name)return ShowError("Orign And Destination Cities Are Same. Kindly Select Different Cities"),!1;if(n.OngoingDate==""||n.OngoingDate==undefined)return ShowError("Please select onward date"),!1;if((n.BookingType=="ROUNDTRIP"||n.BookingType==undefined)&&(n.ReturnDate==""||n.ReturnDate==undefined))return ShowError("Please select return date"),!1;if(n.Defence&&!n.DefenceContinueFlag){$("#DefenceModel").modal("show");return}n.FlightBooking={};localStorage.setItem("FlightObject","");n.BookingType=="ROUNDTRIP"?(n.ReturnContainerVisible=!0,n.RoundTripBarVisible=!1,n.ReturndaynameMonth=getDayNameMonth(n.ReturnDate),n.daynameReturnMonth=getDayNameMonth(n.ReturnDate)):n.BookingType=="SPECIALROUNDTRIP"?(n.ReturndaynameMonth=getDayNameMonth(n.ReturnDate),n.daynameReturnMonth=getDayNameMonth(n.ReturnDate),n.ReturnContainerVisible=!1,n.RoundTripBarVisible=!1):(n.ReturnContainerVisible=!1,n.RoundTripBarVisible=!1);n.OriginName=n.From.originalObject.Name;n.DestinationName=n.To.originalObject.Name;n.Travel_Type=n.GetTravelType();n.GrossCommissionIsVisible=!0;n.NetFareIsVisible=!1;n.RefundableIsVisible=n.chkRefundable;n.daynameMonth=getDayNameMonth(n.OngoingDate);var i=new Date,r=n.OngoingDate,t=r.toString().split("/"),u=new Date(t[2]+"-"+t[1]+"-"+t[0]);if(n.DateDecrease=u>i?!0:!1,n.OnwardVisible=!1,n.ReturnVisible=!1,n.SearchBoxIsVisible=!1,n.ShowTopPackageList=!1,n.SearchDummyIsVisible=!0,n.ResultHeaderVisible=!0,n.SortingHeaderVisible=!1,n.FilterHeaderVisible=!0,n.chkRefundable=!0,n.FilterCollapse=!1,n.ModifySearch=!0,n.BookingType!="MULTICITY")n.FlightSearch();else if(n.MultiCityValidation(3)){n.daynameMonth=getDayNameMonth(n.MultiCityOngoingDate);var i=new Date,r=n.MultiCityOngoingDate,t=r.toString().split("/"),u=new Date(t[2]+"-"+t[1]+"-"+t[0]);n.DateDecrease=u>i?!0:!1;n.MultiCitySearch()}else return n.ShowTopPackageList=!0,n.SearchBoxIsVisible=!0,n.SearchDummyIsVisible=!1,n.ResultHeaderVisible=!1,n.FilterHeaderVisible=!1,n.chkRefundable=!1,n.FilterCollapse=!1,n.ModifySearch=!1,!1}catch(f){}};n.ModifyFlag=!1;n.SearchModify=function(){var u,i,f;try{if($("#SearchFlightModal").modal("hide"),n.ModifyFlag=!0,Config.ChannelId!="3"&&(n.BookingType=n.BookingType1),(n.BookingType=="ROUNDTRIP"||n.BookingType=="SPECIALROUNDTRIP")&&(n.BookingType=n.RoundTrip_Fare==!0?"SPECIALROUNDTRIP":"ROUNDTRIP"),n.From==""||n.From=="undefined"||n.From==null)return ShowError("Please Enter Origin"),!1;if(Config.ChannelId!="3"){if(n.OriginName==""||n.OriginName=="undefined"||n.OriginName==null)return ShowError("Please Enter Origin"),!1;if(n.DestinationName==""||n.DestinationName=="undefined"||n.DestinationName==null)return ShowError("Please Enter Destination"),!1}else{if(n.OriginID==""||n.OriginID=="undefined"||n.OriginID==null)return ShowError("Please Enter Origin"),!1;if(n.DestinationID==""||n.DestinationID=="undefined"||n.DestinationID==null)return ShowError("Please Enter Destination"),!1}if(n.To==""||n.To=="undefined"||n.To==null)return ShowError("Please Enter Destination"),!1;if(n.From.originalObject.Name==n.To.originalObject.Name)return ShowError("Orign And Destination Cities Are Same. Kindly Select Different Cities"),!1;if(n.OngoingDate==""||n.OngoingDate==undefined)return ShowError("Please select onward date"),!1;if((n.BookingType=="ROUNDTRIP"||n.BookingType==undefined)&&(n.ReturnDate==""||n.ReturnDate==undefined))return ShowError("Please select return date"),!1;if(n.Defence&&!n.DefenceContinueFlag){$("#DefenceModel").modal("show");return}n.FlightBooking={};localStorage.setItem("FlightObject","");n.BookingType=="ROUNDTRIP"?(n.ReturndaynameMonth=getDayNameMonth(n.ReturnDate),n.daynameReturnMonth=getDayNameMonth(n.ReturnDate)):n.BookingType=="SPECIALROUNDTRIP"&&(n.ReturndaynameMonth=getDayNameMonth(n.ReturnDate),n.daynameReturnMonth=getDayNameMonth(n.ReturnDate));n.OriginName=n.From.originalObject.Name;n.DestinationName=n.To.originalObject.Name;n.Travel_Type=n.GetTravelType();n.GrossCommissionIsVisible=!0;n.NetFareIsVisible=!1;n.RefundableIsVisible=n.chkRefundable;n.daynameMonth=getDayNameMonth(n.OngoingDate);var e=new Date,o=n.OngoingDate,t=o.toString().split("/"),s=new Date(t[2]+"-"+t[1]+"-"+t[0]);n.DateDecrease=s>e?!0:!1;u=n.OngoingDate.replace("/","-").replace("/","-");i="";(n.BookingType=="ROUNDTRIP"||n.BookingType=="SPECIALROUNDTRIP")&&(i=n.ReturnDate.replace("/","-").replace("/","-"));f="origin="+n.From.originalObject.Value+"&destination="+n.To.originalObject.Value+"&onward="+u+"&return="+i+"&type="+n.GetTravelType()+"&class="+n.Travel_Class+"&adult="+n.Adult_Count+"&child="+n.Child_Count+"&infant="+n.Infant_Count+"&direct="+n.DirectFlight+"&discount="+n.RoundTrip_Fare+"&nocache="+n.HostSearch+"&defence="+n.Defence+"&originName="+n.From.originalObject.Name.split("(")[0]+"&destinationName="+n.To.originalObject.Name.split("(")[0];r.LoadPage("flights/"+f)}catch(h){}};n.SearchAnimation="flight";n.StartAnimation=function(){angular.isDefined(p)||(p=y(function(){n.SearchDummyIsVisible?n.SearchAnimation=n.SearchAnimation=="flight"?"hourglass_full":n.SearchAnimation=="hourglass_full"?"security":n.SearchAnimation=="security"?"public":"flight":(n.SearchAnimation="thumb_up",n.stopAnimation(),n.SearchAnimation="flight")},1e3))};n.stopAnimation=function(){angular.isDefined(p)&&(y.cancel(p),p=undefined)};n.FlightSearch=function(){var i,t;n.Defence&&n.DefenceTracking();localStorage.setItem("FlightRescheduleObject","");n.SearchErrorVisible=!1;n.Adult_Count>0&&(n.adCharValue=n.Adult_Count+" ADT");n.Child_Count>0&&(n.cdCharValue=", "+n.Child_Count+" CHD");n.Infant_Count>0&&(n.itCharValue=", "+n.Infant_Count+" INF");(n.Child_Count==0||n.Child_Count==null)&&(n.cdCharValue="");(n.Infant_Count==0||n.Infant_Count==null)&&(n.itCharValue="");$("#ModuleName").html("<span>"+n.From.originalObject.Name.split("(")[0]+" - "+n.To.originalObject.Name.split("(")[0]+"<\/span><\/br><span class='lbl-small'> "+n.FormatDate(n.OngoingDate,"DD/MM/YYYY","ddd, DD MMM YYYY")+", "+n.adCharValue+n.cdCharValue+n.itCharValue+"<\/span>");r.ShowBack="Back";e(function(){r.ModuleID=2;r.ShowHeader=!0},1500);n.Shownonstop=!1;n.Show1stop=!1;n.Show1change=!1;n.Shownmorechange=!1;try{sessionStorage.setItem("AirlineSearchResult","");n.Travel_Class=="PREMIUM"&&(n.Travel_Class="PREMIUM_ECONOMY");n.OnwardTrips=[];n.ThreadData=[];n.ReturnTrips=[];n.RequestErrorDesc="";n.RequestRefNo="";n.RequestInnerException="";n.SearchDummyIsVisible=!0;n.ResultHeaderVisible=!0;n.SortingHeaderVisible=!1;n.FilterHeaderVisible=!0;n.ModifySearch=!0;n.MultiCity_Fare=!1;n.Thread_Count=0;n.Completed_Thread_Count=0;i="";i=Config.AirThreadList;var s=n.GetTravelType(),f=i.B2C,o=f.International;s=="DOMESTIC"&&(o=f.Domestic);t="";angular.forEach(o,function(i,f){t=f;angular.forEach(i,function(i){angular.forEach(i,function(i){var e,f,o;(t!=3||n.Defence)&&(n.Thread_Count++,n.AirSearchRequest={Header:n.GetHeader(n.ProcessID),ThreadIndex:t,Adult_Count:n.Adult_Count,Child_Count:n.Child_Count,Infant_Count:n.Infant_Count,Class_Of_Travel:n.Travel_Class,Excluded_Airline:[{Airline_Code:""}],Filtered_Airline:n.GetAirlineCode(i),Host_Search:n.HostSearch,Booking_Type:n.BookingType,Travel_Type:n.Travel_Type,Resident_of_India:1,InventoryType:t>3?t+1:t,TripInfo:n.PushTripInfo()},e=u({method:"POST",url:Config.Api+"FlightSearch/Search",dataType:"json",data:n.AirSearchRequest,headers:{"Content-Type":"application/json"}}),t==0&&(n.StartAnimation(),f=n.OngoingDate,f=f.indexOf(",")>-1?f:n.OngoingDate.split("/")[1]+"/"+n.OngoingDate.split("/")[0]+"/"+n.OngoingDate.split("/")[2],o={ProductId:"1",BillerId:n.Travel_Type=="DOMESTIC"?"13":"14",Travel_Type:n.Travel_Type,Booking_Type:n.BookingType,Class_Of_Travel:n.Travel_Class,No_Of_Adult:n.Adult_Count,No_Of_Child:n.Child_Count,No_Of_Infant:n.Infant_Count,No_Of_Rooms:"0",No_Of_Nights:"0",StarCategory:"",Operator_Code:"",Travel_Date:f,Amount:"0"},n.PushRecentSearch()),e.then(function(t){var i,u;try{r.ResultVisible=!0;n.Completed_Thread_Count++;i=t.data;i.Status=="1"?(n.SearchResult(i.Data.Filler2),i.Data.Filler3!=""&&i.Data.Filler3!=undefined&&i.Data.Filler3!=null&&(n.PromoDescList=JSON.parse(i.Data.Filler3).Table)):i.Status=="2"&&(u=JSON.parse(i.Data.Filler2),n.RequestErrorDesc=u.Error_Desc,n.RequestRefNo=u.Request_Id,n.RequestInnerException+=u.Error_InnerException,n.Completed_Thread_Count==n.Thread_Count||n.OnwardTrips.length>0?n.OnwardVisible=!0:"")}catch(f){}n.SearchStatus()},function(){n.Completed_Thread_Count=n.Thread_Count;n.SearchStatus();n.Completed_Thread_Count==n.Thread_Count||n.OnwardTrips.length>0?n.OnwardVisible=!0:"";ShowAlert("Unknown error occured please try again")}))})})})}catch(h){n.Completed_Thread_Count++;n.SearchStatus()}};n.GetAirlineCode=function(n){var t=[];return angular.forEach(n.Airline_Code,function(n){t.push({Airline_Code:n})}),t};n.SearchStatus=function(){try{if(e(function(){n.MasterHeading=!0},500),n.Thread_Count==n.Completed_Thread_Count){var t=n.OnwardTrips,i=n.ReturnTrips;t.length<1?(n.SearchDummyIsVisible=!1,n.SortingHeaderVisible=!1,n.FilterHeaderVisible=!1,n.SearchErrorVisible=!0,n.ModifySearch=!1):(n.ModifySearch=!1,n.CollapseView=-1,n.SearchDummyIsVisible=!1,n.ResultHeaderVisible=!0,n.SortingHeaderVisible=!0,n.FilterHeaderVisible=!1,setTimeout(function(){var t=!1;n.AirSearchRequest.Filtered_Airline==""?t=!0:n.AirSearchRequest.Filtered_Airline.length>1&&(t=!0);t==!0&&(n.BookingType=="ONE_WAY"&&n.LowestCache==!1&&n.Travel_Class=="ECONOMY"&&n.InsertLowFare(1),n.BookingType=="ROUNDTRIP"&&n.LowestCache_Return==!1&&n.Travel_Class=="ECONOMY"&&n.InsertLowFare(2))},500))}}catch(r){}};n.ShowInnerException=function(){try{n.RequestInnerExceptionVisible=n.RequestInnerExceptionVisible==!0?!1:!0}catch(t){}};n.PushObject=function(n,t,i){try{n=n.map(function(n){var r=Object.assign({},n);return t==0?((r.isGrouped==undefined||r.isGrouped==null)&&(r.isGrouped=!1),(r.isGroupParent==undefined||r.isGroupParent==null)&&(r.isGroupParent=!1)):t==1?(r.Flight_Id==undefined||r.Flight_Id==null)&&(r.Flight_Id=i):t==2?(r.InventoryType==undefined||r.InventoryType==null)&&(r.InventoryType=i):t==3?(r.Swap_Allowed==undefined||r.Swap_Allowed==null)&&(r.Swap_Allowed=i):t==4?(r.PromoFareDiscount==undefined||r.PromoFareDiscount==null)&&(r.FareDiff=0,r.PromoFareMessage="",r.PromoFareDiscount=0):t==5&&(r.Hide_Fare=!1),r})}catch(r){console.log(r)}return n};n.CalculateFareSplit=function(t){try{return Config.TaxSplitupShow||(t.SelectedFare.FareDetails[0].BasefareDiscount=t.SelectedFare.FareDetails[0].Gross_Commission,n.TaxDiscount=0,t.SelectedFare.FareDetails[0].Gross_Commission<=t.SelectedFare.FareDetails[0].AirportTax_Amount+t.SelectedFare.FareDetails[0].Trade_Markup_Amount+t.SelectedFare.FareDetails[0].Service_Fee_Amount&&(t.SelectedFare.FareDetails[0].BasefareDiscount=0,t.SelectedFare.FareDetails[0].TaxDiscount=t.SelectedFare.FareDetails[0].Gross_Commission),n.UserInfo&&n.UserInfo.B2BFlag&&(n.BasefareDiscount=0,n.TaxDiscount=0)),t}catch(i){}};n.BannerImageNumber=[];ut=0;n.GetTripSettings=function(t){var r,u,i;try{if(t.Fares.length>=1)try{t=n.FindLowestFare(t)}catch(f){}for(r=0,u=t.Fares,i=0;i<u.length;i++)if(u[i].Hide_Fare==!1){t.SelectedFare=u[i];r=r+1;break}return r>0?(t.isHide=!1,n.ShowSearchBox()):t.isHide=!0,t.PinnedSelect=!1,t.Total_Amount=t.SelectedFare.FareDetails[0].Total_Amount,t.Departure_DateTime=t.Segments[0].Departure_DateTime.split(" ")[1],t.Arrival_DateTime=t.Segments[t.Segments.length-1].Arrival_DateTime.split(" ")[1],t.Duration=n.Duration(t.Segments),t.DurationTime=t.Duration,n.BookingType=="ROUNDTRIP"&&(t.SelectedFare.FareDetails[0].PromoAmount=0),t}catch(f){}};n.GetSegmentSettings=function(t,i){try{var r=n.FilterSegments(t,i);return i==1?t.SplDuration=n.Duration(r):t.SplRTDuration=n.Duration(r),t.SplDurationTime=t.Duration,t.SplDeparture_DateTime=t.Segments[0].Departure_DateTime.split(" ")[1],t.SplArrival_DateTime=t.Segments[t.Segments.length-1].Arrival_DateTime.split(" ")[1],r}catch(u){}};n.FindLowestFare=function(t){var i,u,r,f,o,e;try{t.Fares=RemoveDuplicates(t.Fares.slice(0),"Fare_Id");n.BookingType=="ONE_WAY"?(i=0,u=0,t.Fares.length==1&&(t.Fares[0].DealDetails!=null&&t.Fares[0].DealDetails.length>0&&(t.Fares[0].DealDetails[0].DealValuePerTransaction>0&&t.Fares[0].DealDetails[0].DisplayInSearch&&(u=t.Fares[0].DealDetails[0].DealValuePerPax),r=t.Fares[0].DealDetails.slice(0),r=r.sort(function(n,t){return t.DealValuePerPax-n.DealValuePerPax}),r=FilterObject(r,"HiddenDealCode",!1),r.length>0&&r[0].DealValuePerTransaction>0&&(i=r[0].DealValuePerPax)),t.Fares[0].FareDetails[0].PromoAmount=u,t.Fares[0].FareDetails[0].OrderFareAmount=parseFloat(t.Fares[0].FareDetails[0].Total_Amount)-(parseFloat(t.Fares[0].FareDetails[0].Gross_Commission)+parseFloat(t.Fares[0].FareDetails[0].PromoAmount)),t.Fares[0].Hide_Fare==!1&&(i>t.Fares[0].PromoFareDiscount&&i>0&&(t.Fares[0].PromoFareDiscount=i,t.Fares[0].PromoFareMessage="₹"+i+" Instant off",t.Fares[0].FareDiff=0),t.Fares[0].PromoFareDiscount>0&&(t.Fares[0].FareDetails[0].OrderFareAmount=t.Fares[0].FareDetails[0].OrderFareAmount+t.Fares[0].FareDetails[0].PromoAmount,t.Fares[0].FareDetails[0].OrderFareAmount=t.Fares[0].FareDetails[0].OrderFareAmount-t.Fares[0].PromoFareDiscount,t.Fares[0].FareDetails[0].PromoAmount=0))),t.Fares.length>=2&&(angular.forEach(t.Fares,function(n){if(u=0,n.DealDetails!=null&&n.DealDetails.length>0){n.DealDetails[0].DealValuePerTransaction>0&&n.DealDetails[0].DisplayInSearch&&(u=n.DealDetails[0].DealValuePerPax);var t=n.DealDetails.slice(0);t=t.sort(function(n,t){return t.DealValuePerPax-n.DealValuePerPax});t=FilterObject(t,"HiddenDealCode",!1);t.length>0&&t[0].DealValuePerTransaction>0&&(i=t[0].DealValuePerPax)}n.FareDetails[0].PromoAmount=u;n.FareDetails[0].OrderFareAmount=n.FareDetails[0].Total_Amount-(parseFloat(n.FareDetails[0].Gross_Commission)+parseFloat(n.FareDetails[0].PromoAmount));n.Hide_Fare==!1&&(i>n.PromoFareDiscount&&i>0&&(n.PromoFareDiscount=i,n.PromoFareMessage="₹"+i+" Instant off",n.FareDiff=0),n.PromoFareDiscount>0&&(n.FareDetails[0].OrderFareAmount=n.FareDetails[0].OrderFareAmount+n.FareDetails[0].PromoAmount,n.FareDetails[0].OrderFareAmount=n.FareDetails[0].OrderFareAmount-n.PromoFareDiscount,n.FareDetails[0].PromoAmount=0))}),t.Fares=t.Fares.sort(function(n,t){return n.FareDetails[0].OrderFareAmount-t.FareDetails[0].OrderFareAmount}),t.FilterShowFare=t.Fares.filter(function(n){return n.Hide_Fare!=!0}))):(t.Fares.length==1&&(t.Fares[0].FareDetails[0].OrderFareAmount=parseFloat(t.Fares[0].FareDetails[0].Total_Amount)-parseFloat(t.Fares[0].FareDetails[0].Gross_Commission),t.Fares[0].FareDetails[0].OrderFareAmount=parseFloat(t.Fares[0].FareDetails[0].OrderFareAmount)-parseFloat(t.Fares[0].PromoFareDiscount)),t.Fares.length>=2&&(angular.forEach(t.Fares,function(n){n.FareDetails[0].OrderFareAmount=parseFloat(n.FareDetails[0].Total_Amount)-parseFloat(n.FareDetails[0].Gross_Commission);n.FareDetails[0].OrderFareAmount=parseFloat(n.FareDetails[0].OrderFareAmount)-parseFloat(n.PromoFareDiscount)}),t.Fares=t.Fares.sort(function(n,t){return n.FareDetails[0].OrderFareAmount-t.FareDetails[0].OrderFareAmount})));f=t.Fares.slice(0);f.sort(function(n,t){return n.FareDetails[0].OrderFareAmount-t.FareDetails[0].OrderFareAmount});t.Fares=f;o=0;try{for(e=0;e<f.length;e++)if(f[e].Hide_Fare==!1){t.SelectedFare=f[e];t.PromoFareDiscount=t.SelectedFare.PromoFareDiscount;t.FareDiff=t.SelectedFare.FareDiff;t.PromoFareMessage=t.SelectedFare.PromoFareMessage;o=o+1;break}}catch(s){}return o==0?(t.SelectedFare={},t.isHide=!0):t.isHide=!1,t}catch(s){}};n.CheckPromoMessage=function(n){var o,t,f,r,e,c,i;try{n.PromoFareDiscount=0;n.FareDiff==undefined&&(n.FareDiff=0);n.PromoFareMessage="";lobjFares=n.Fares.slice(0);var l=FilterObject(lobjConfigList,"AirlineCode",n.Airline_Code),v=FilterObject(lobjFares,"Hide_Fare",!1),u=FilterObject(lobjFares,"Hide_Fare",!0);for(o=0;o<lobjFares.length;o++)if(lobjFares[o].Hide_Fare==!1){if(t=lobjFares[o],t.PromoFareDiscount=0,t.FareDiff=0,t.PromoFareMessage="",l.length>0&&u.length>0&&v.length>0&&(f=FilterObject(l,"InventoryTypeFromId",t.InventoryType),f.length>0))for(r=0;r<u.length;r++)for(e=0;e<f.length;e++)if(t.InventoryType==f[e].InventoryTypeFromId&&u[r].InventoryType==f[e].InventoryTypeToId&&f[e].ProductClassFrom.indexOf(t.ProductClass)>-1&&f[e].ProductClassTo.indexOf(u[r].ProductClass)>-1){var a=!1,s=f[e],h=0,y=u[r].FareDetails[0].FareClasses[0].Class_Code;h=y=="PI"?t.FareDetails[0].Total_Amount-u[r].FareDetails[0].Total_Amount:t.FareDetails[0].Total_Amount-t.FareDetails[0].Service_Fee_Amount-(u[r].FareDetails[0].Total_Amount-u[r].FareDetails[0].Service_Fee_Amount);s.FareDiff<=h&&(a=!0);a==!0&&(c="",i=0,s.DiscountType=="A"?i=s.DiscountValue:(i=h*s.DiscountValue/100,i>s.MaxDiscount&&(i=s.MaxDiscount)),i>Config.MaxDiscountCap&&(i=Math.round(i/10)*10,c="₹"+i+" Instant off",h>=t.FareDiff&&(t.FareDiff=h,t.PromoFareMessage=c,t.PromoFareDiscount=i)))}lobjFares[o]=t}n.Fares=lobjFares.slice(0)}catch(p){}return n};n.FilterLowestFare=function(n){var i=[],u,r,f,e,t;try{for(u=n,t=0;t<n.Fares.length;t++)for(r=0;r<u.Fares.length;r++)n.Fares[t].ProductClass==u.Fares[r].ProductClass&&t!=r&&n.Fares[t].ProductClass!=null&&(f=n.Fares[t].FareDetails[0].OrderFareAmount,e=u.Fares[r].FareDetails[0].OrderFareAmount,n.Fares[t].InventoryType==3?f<=e?i.push(r):e<f&&i.push(t):u.Fares[t].InventoryType==3&&(e<f?i.push(t):e>=f&&i.push(r)));if(i.length>0)for(i.sort(function(n,t){return t-n}),t=0;t<i.length;t++)n.Fares.splice(i[t],1)}catch(o){}return n};n.ThreadData=[];n.CompareTrips=function(t,i,r,u){var f,o,e,s,h;try{for(f=r.slice(0),o=u.slice(0),e=0;e<f.length;e++)t==1&&(f[e].isHide=!1,f[e].Fares=n.PushObject(f[e].Fares,1,f[e].Flight_Id),f[e].Fares=n.PushObject(f[e].Fares,2,f[e].InventoryType),f[e].Fares=n.PushObject(f[e].Fares,3,f[e].Swap_Allowed),f[e].Fares=n.PushObject(f[e].Fares,4,""),n.UserInfo&&(f[e].Fares=n.PushObject(f[e].Fares,5,"")));for(s=0;s<f.length;s++){for(h=0;h<o.length;h++)o.length>0&&f[s].Flight_Numbers==o[h].Flight_Numbers&&f[s].Airline_Code==o[h].Airline_Code&&(f[s].Flight_Id!=o[h].Flight_Id?o[h].isGrouped==!1&&(Array.prototype.push.apply(f[s].Fares,o[h].Fares),f[s].isGroupParent=!0,o[h].isGrouped=!0,o[h].isGroupParent=!1):(o.splice(h,1),h=h-1));n.Completed_Thread_Count==n.Thread_Count&&f[s].isGroupParent==!0&&(f[s]=n.CheckPromoMessage(f[s]));f[s]=n.FindLowestFare(f[s])}return o.length>0&&Array.prototype.push.apply(f,o),f}catch(c){console.log(c)}};n.SetSelectedFare=function(n){var r={},i=0,t;try{for(t=0;t<n.length;t++)n[t].Hide_Fare==!1&&(r=n[t],i=i+1)}catch(u){}return i>0?r:{}};n.SearchResult=function(t){var o,s,h,f,u,i;try{if(t!=""){o=JSON.parse(t);try{n.BookingType!="MULTICITY"&&(s={},s.pstrSearchResponse=t,n.ThreadData.push(s),h=LZString.compress(JSON.stringify(n.ThreadData)),sessionStorage.setItem("AirlineSearchResult",h))}catch(c){}r.OName=n.OriginName;r.DName=n.DestinationName;n.SearchKey=o.Search_Key;i=o.TripDetails[0].Flights.slice(0);i=n.PushObject(i,0,"");i=n.CompareTrips(1,1,i,i);f=n.OnwardTrips;u=n.ReturnTrips;f=f.length>0?n.CompareTrips(2,1,f,i):i.slice(0);n.DirectFlight==!0&&(f=f.filter(function(n){return n.Segments.length==1&&n.Segments[0].Stop_Over==null}));n.Completed_Thread_Count==n.Thread_Count||n.OnwardTrips.length>0?n.OnwardVisible=!0:"";n.BookingType=="ROUNDTRIP"&&(i=o.TripDetails[1].Flights.slice(0),i=n.PushObject(i,0,""),i=n.CompareTrips(1,2,i,i),u=u.length>0?n.CompareTrips(2,2,u,i):i.slice(0),n.DirectFlight==!0&&(u=u.filter(function(n){return n.Segments.length==1&&n.Segments[0].Stop_Over==null})),n.ReturnTrips=Object.assign([],u.slice(0)),n.Completed_Thread_Count==n.Thread_Count||n.ReturnTrips.length>0?n.ReturnVisible=!0:"");n.OnwardTrips=f;n.ShowOnwardTrips=n.OnwardTrips.filter(function(n){return n.isGrouped==!1&&n.isHide==!1});n.ReturnTrips=u;n.FilterDetails();n.ShowSearchBox();Config.ChannelId!="3"&&n.ShowXsTrip(1);e(function(){try{var t=JSON.parse(localStorage.getItem("ChangeFlight_Request"));t.AirlineSearchDetails=t.ChangeFlight.AirlineSearchDetails;t.From=n.From;t.To=n.To;t.Airline_Name=n.AirlineList;t.BookingType=n.BookingType;t.DealData=r.DealData;t.DirectFlight=n.DirectFlight;t.Defence=n.Defence;localStorage.setItem("ChangeFlight_Request",JSON.stringify(t));n.Completed_Thread_Count==n.Thread_Count&&e(function(){n.orderByField="SelectedFare.FareDetails[0].OrderFareAmount";n.orderByFields="SelectedFare.FareDetails[0].OrderFareAmount";e(function(){n.SelectedDate=n.FormatDate(n.OngoingDate,"DD/MM/YYYY","DD")+"D"+n.FormatDate(n.OngoingDate,"DD/MM/YYYY","MM");localStorage.setItem("SwiperArray",JSON.stringify(n.SwipeArrayDate));e(function(){$("#viewContainer").scrollCenter(".activeDate",300)},150)},300)},300)}catch(i){}},1500)}}catch(c){n.ShowTopPackageList=!0;n.ShowSearchBox()}};n.ShowSearchBox=function(){try{n.ResultIsVisible=!0;n.SortingHeaderVisible=!0;n.reverseSort=!1;n.OnwardTrips.length>0&&(n.OnwardVisible=!0);n.ReturnTrips.length>0&&(n.ReturnVisible=!0);n.SearchDummyIsVisible==!0&&(n.SearchDummyIsVisible=!1);Config.ChannelId!="3"&&n.ShowXsTrip(1)}catch(t){}};n.PushRecentSearch=function(){var s,e,c,l,i,t,h,u,f,o,a,v;try{if(s="",n.LowestPrice=0,n.LowestPriceAirLine="",n.LowestPriceAirLine_Return="",n.TotalPax_Count=n.Adult_Count+n.Child_Count+n.Infant_Count,e={},e.AirlineSearchDetails=n.AirSearchRequest,e.From=n.From,e.To=n.To,e.Airline_Name=n.AirlineList,e.DirectFlight=n.DirectFlight,e.Defence=n.Defence,h={ChangeFlight:e,BookingType:n.BookingType,MultiCity_Fare:n.MultiCity_Fare},localStorage.setItem("ChangeFlight_Request",""),localStorage.setItem("ChangeFlight_Request",JSON.stringify(h)),c=[],l=[],n.SelectedAirName!=undefined&&(n.SelectedAirName.length!=0&&(n.LastSearchAirline_Code=n.SelectedAirName[0].Value,c.Airline=n.SelectedAirName[0].Value,c.AirlineList=n.PushAirNameInfo()),l.push(c)),n.LastSearchAirline_Code==undefined&&(n.LastSearchAirline_Code=""),i=[],n.BookingType!="MULTICITY"?(t={},t.Origin=n.OriginName,t.OriginCode=n.From.originalObject.Value,t.OriginType=n.From.originalObject.Type,t.Destination=n.DestinationName,t.DestinationCode=n.To.originalObject.Value,t.DestinationType=n.To.originalObject.Type,t.OngoingDate=n.OngoingDate,t.ReturnDate=n.ReturnDate,t.AdultCount=n.Adult_Count,t.ChildCount=n.Child_Count,t.InfantCount=n.Infant_Count,t.BookingType=n.BookingType,t.TravelType=n.Travel_Type,t.Airline=n.LastSearchAirline_Code,t.LastSearchAirline_Code=n.LastSearchAirline_Code,t.AirlineList=n.PushAirNameInfo(),t.DirectFlight=n.DirectFlight,t.Defence=n.Defence,i.push(t)):(i=[],n.OriginID!=""&&n.DestinationID!=""&&n.OngoingDate!=""&&(t={},t.Origin=n.OriginID,t.OriginCode=n.OriginID.split("(")[1].split(")")[0],t.OriginType=n.From.originalObject.Type,t.Destination=n.DestinationID,t.DestinationCode=n.DestinationID.split("(")[1].split(")")[0],t.DestinationType=n.To.originalObject.Type,t.OngoingDate=n.MultiCityOngoingDate,t.AdultCount=n.Adult_Count,t.ChildCount=n.Child_Count,t.InfantCount=n.Infant_Count,t.BookingType="MULTICITY",t.Airline="",t.AirlineList=n.PushAirNameInfo(),t.DirectFlight=n.DirectFlight,i.push(t),s=n.OriginID.split("(")[1].split(")")[0]+"->"+n.DestinationID.split("(")[1].split(")")[0]),n.FirstOriginID!=""&&n.FirstDestinationID!=""&&n.FirstOriginID!=undefined&&n.FirstDestinationID!=undefined&&n.FirstOngoingDate!=""&&(t={},t.Origin=n.FirstOriginID,t.OriginCode=n.FirstOriginID.split("(")[1].split(")")[0],t.OriginType=n.FirstFrom.originalObject.Type,t.Destination=n.FirstDestinationID,t.DestinationCode=n.FirstDestinationID.split("(")[1].split(")")[0],t.DestinationType=n.FirstTo.originalObject.Type,t.OngoingDate=n.FirstOngoingDate,t.BookingType="MULTICITY",t.Airline="",t.AirlineList=n.PushAirNameInfo(),t.DirectFlight=n.DirectFlight,i.push(t),s+="->"+n.FirstDestinationID.split("(")[1].split(")")[0]),n.AddSecondCity==!0&&(n.SecondOriginID!=""&&n.SecondDestinationID!=""&&n.SecondOriginID!=undefined&&n.SecondDestinationID!=undefined&&n.SecondOngoingDate!=""&&(t={},t.Origin=n.SecondOriginID,t.OriginCode=n.SecondOriginID.split("(")[1].split(")")[0],t.OriginType=n.SecondFrom.originalObject.Type,t.Destination=n.SecondDestinationID,t.DestinationCode=n.SecondDestinationID.split("(")[1].split(")")[0],t.DestinationType=n.SecondTo.originalObject.Type,t.OngoingDate=n.SecondOngoingDate,t.BookingType="MULTICITY",t.Airline="",t.AirlineList=n.PushAirNameInfo(),t.DirectFlight=n.DirectFlight,i.push(t)),s+="->"+n.SecondDestinationID.split("(")[1].split(")")[0]),n.AddThridCity==!0&&(n.ThridOriginID!=""&&n.ThridDestinationID!=""&&n.ThridOriginID!=undefined&&n.ThridDestinationID!=undefined&&n.ThridOngoingDate!=""&&(t={},t.Origin=n.ThridOriginID,t.OriginCode=n.ThridOriginID.split("(")[1].split(")")[0],t.OriginType="H",t.Destination=n.ThridDestinationID,t.DestinationCode=n.ThridDestinationID.split("(")[1].split(")")[0],t.DestinationType="H",t.OngoingDate=n.ThridOngoingDate,t.BookingType="MULTICITY",t.Airline="",t.AirlineList=n.PushAirNameInfo(),t.DirectFlight=n.DirectFlight,i.push(t)),s+="->"+n.ThridDestinationID.split("(")[1].split(")")[0]),n.AddFourthCity==!0&&(n.FourthOriginID!=""&&n.FourthDestinationID!=""&&n.FourthOriginID!=undefined&&n.FourthDestinationID!=undefined&&n.FourthOngoingDate!=""&&(t={},t.Origin=n.FourthOriginID,t.OriginCode=n.FourthOriginID.split("(")[1].split(")")[0],t.OriginType="H",t.Destination=n.FourthDestinationID,t.DestinationCode=n.FourthDestinationID.split("(")[1].split(")")[0],t.DestinationType="H",t.OngoingDate=n.FourthOngoingDate,t.BookingType="MULTICITY",t.Airline="",t.AirlineList=n.PushAirNameInfo(),t.DirectFlight=n.DirectFlight,i.push(t)),s+="->"+n.FourthDestinationID.split("(")[1].split(")")[0]),localStorage.setItem("ChangeFlight_Request",""),h={Airline_Name:n.AirlineList,ChangeFlight:i,BookingType:n.BookingType,MultiCity_Fare:n.MultiCity_Fare},localStorage.setItem("ChangeFlight_Request",JSON.stringify(h))),u=[],u.push({Search:i,Segment:s}),f=r.GetCookie("FlightPastSearch"),f!=""){for(f=JSON.parse(f),o=0;o<f.length;o++)a=f[o].Search[0].OriginCode+"-"+f[o].Search[0].DestinationCode+"-"+f[o].Search[0].OngoingDate+"-"+f[o].Search[0].BookingType,v=u[0].Search[0].OriginCode+"-"+u[0].Search[0].DestinationCode+"-"+u[0].Search[0].OngoingDate+"-"+u[0].Search[0].BookingType,a.trim()!=v.trim()&&u.length<=5&&u.push(f[o]);r.SetCookie("FlightPastSearch",JSON.stringify(u),2)}else r.SetCookie("FlightPastSearch",JSON.stringify(u),2);n.RecentSearch()}catch(y){}};n.FilterPinnedFlights=[];n.SelectPinnedFlight=function(t){try{if(t.PinnedSelect==!0)n.FilterPinnedFlights.push(t),n.ShowOnwardTrips=n.ShowOnwardTrips.filter(function(n){return n.PinnedSelect==!1});else{for(var i=0;i<n.FilterPinnedFlights.length;i++)n.FilterPinnedFlights[i].PinnedSelect==!1&&n.ShowOnwardTrips.push(n.FilterPinnedFlights[i]);n.ShowOnwardTrips=n.ShowOnwardTrips.filter(function(n){return n.PinnedSelect==!1});n.FilterPinnedFlights=n.FilterPinnedFlights.filter(function(n){return n.PinnedSelect==!0})}}catch(r){}};n.SelectChkPin=function(t){t.PinnedSelect=!0;n.SelectPinnedFlight(t)};n.SelectChkPinfalse=function(t){t.PinnedSelect=!1;n.SelectPinnedFlight(t)};n.CheckGroupFare=function(t){var i,u,r;try{var f=t.SelectedFare.Fare_Id,e=t.Fares,o=t.SelectedFare;for(i=0;i<t.Fares.length;i++)if(t.Fares[i].Fare_Id==f&&t.Fares[i].Flight_Id!=t.Flight_Id)return u=n.GetOriginalTrips(0),t.TripIndex==1&&(u=n.GetOriginalTrips(1)),r=u.filter(function(n){return n.Flight_Id==t.Fares[i].Flight_Id}),t.Filler=r[0].Filler,t.Filler1=r[0].Filler1,t.Flight_Id=r[0].Flight_Id,t.Flight_Key=r[0].Flight_Key,t.InventoryType=r[0].InventoryType,t.Fares=e,t.SelectedFare=o,t}catch(s){}return t};n.GetAllFlightKey=function(t){var u,o,i,s,f,r,e;try{for(u=[],o=[],i=0;i<t.Fares.length;i++)if(o.indexOf(t.Fares[i].Flight_Id)<0)for(o.push(t.Fares[i].Flight_Id),s=n.GetOriginalTrips(0),t.TripIndex==1&&(s=n.GetOriginalTrips(1)),f=s.filter(function(n){return n.Flight_Id==t.Fares[i].Flight_Id}),r=0;r<f.length;r++)e={},e.Flight_Key=f[r].Flight_Key,e.InventoryType=f[r].InventoryType,u.push(e);return u}catch(h){}return u};n.SelectFlight=function(t,i,r){try{(n.BookingType=="ONE_WAY"||n.BookingType=="SPECIALROUNDTRIP")&&fnProgstart();e(function(){var f,a,v,y,p,e,s,o;if(Config.ChannelId!="3"&&n.DetailClick)return n.DetailClick=!1,!1;i.isGroupParent==!0&&(i=n.CheckGroupFare(i));n.RescheduleFlag&&(n.BookingType=="ONE_WAY"||n.BookingType=="SPECIALROUNDTRIP")&&(n.OnwardFlight=i,n.GetReschedulePenalty(),n.CurrentFares.push(n.OnwardFlight.Fares[0]));i.OnwardSelect=!0;n.lobjRescheduleFlight=i;var c=[],u={},h={},l=!1;if(n.FlightBooking!=undefined&&(u=n.FlightBooking,n.BookingType!="ROUNDTRIP"&&n.BookingType!="MULTICITY"&&(n.FlightBooking.Trips=[]),c=u.Trips!=undefined?u.Trips:n.CreateTrips()),i.TripIndex=t,i.Search_Key=n.SearchKey,i.Pushed=!0,h=i,n.BookingType=="ROUNDTRIP"&&n.CheckChangeTerminal(h)&&(n.TerminalChangeMessage!=""||n.TerminalChangeMessage!=null)&&ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide")},n.TerminalChangeMessage,function(){$("#ConfirmationModal").modal("hide")}),u.Trips=n.PushTrips(c,h,t),u.ProcessID=n.ProcessID,u.Adult_Count=n.Adult_Count,u.Child_Count=n.Child_Count,u.Infant_Count=n.Infant_Count,u.Travel_Type=n.Travel_Type,u.BookingType=n.BookingType,u.Travel_Class=n.Travel_Class,u.OngoingDate=n.OngoingDate,u.ReturnDate=n.ReturnDate,n.RescheduleFlag||(u.OriginCode=n.From.originalObject.Value,u.DestinationCode=n.To.originalObject.Value,u.From=n.From,u.To=n.To),u.Refundable=n.lobjFlight_Refundable,u.OriginName=n.OriginName,u.DestinationName=n.DestinationName,u.Discounted_Fare=!1,u.RoundTrip_Fare=n.RoundTrip_Fare,u.DirectFlight=n.DirectFlight,u.Travel_Class=n.Travel_Class,u.HostSearch=n.HostSearch,n.BookingType=="MULTICITY"&&(u.Discounted_Fare=n.MultiCity_Fare),u.PreFilledPassengers=[],n.SearchType=="CORPORATEMETA"&&(u.PreFilledPassengers=n.CorporatePassengers),n.FlightBooking=u,Config.ChannelId!=3){if(n.ResClick)return n.ResClick=!1,!1;if(n.QuickBookClick&&r==0)return n.QuickBookClick=!1,!1}if(n.RescheduleFlag)return n.BookingType=="ROUNDTRIP"&&(n.RoundTripBarVisible=!0,u.Trips.length>1&&(n.RoundTripTotalVisible=!0,Config.ChannelId!=3&&(t==0&&n.ShowXsTrip(2),n.SelectFlight(1,TripFlights,0,0)))),!1;if(f=location.href,f.indexOf("ReSearch")<=-1)f=f.replace(GetPath(),""),f=f.split("/")[1],u.QueryString=f;else try{a=location.href.split("origin=")[1].split("&")[0].toString().trim();v=location.href.split("destination=")[1].split("&")[0].toString().trim();n.OriginID.split("(")[1].split(")")[0]==a&&n.DestinationID.split("(")[1].split(")")[0]==v?(y=JSON.parse(localStorage.getItem("FlightObject")),u.QueryString=y.QueryString):(p="origin="+n.From.originalObject.Value+"&destination="+n.To.originalObject.Value+"&onward="+n.OngoingDate+"&return="+n.ReturnDate+"&type="+n.GetTravelType()+"&class="+n.Travel_Class+"&adult="+n.Adult_Count+"&child="+n.Child_Count+"&infant="+n.Infant_Count+"&direct="+n.DirectFlight+"&discount="+n.RoundTrip_Fare+"&nocache="+n.HostSearch+"&defence="+n.Defence+"&originName="+n.From.originalObject.Name.split("(")[0]+"&destinationName="+n.To.originalObject.Name.split("(")[0],u.QueryString=p)}catch(w){}if(localStorage.setItem("FlightObject",JSON.stringify(u)),n.BookingType=="ONE_WAY"||n.BookingType=="SPECIALROUNDTRIP"||n.MultiCity_Fare==!0)l=!0;else if(n.BookingType=="ROUNDTRIP")n.RoundTripBarVisible=!0,u.Trips.length>1&&(n.RoundTripTotalVisible=!0,Config.ChannelId!=3&&(t==0&&n.ShowXsTrip(2),n.SelectFlight(1,TripFlights,0,0))),fnProgstop();else{for(n.MultiTripVisible=!0,e=n.TripList,s="",o=0;o<e.length;o++)e[o].Index==n.Selected_Trip&&n.Selected_Trip<e.length-1&&(s=e[o+1]);s!=""&&n.OpenTrip(s);fnProgstop()}l==!0&&n.GetBookingAlert(r)},300)}catch(u){}};n.GetBookingAlert=function(t){var i=JSON.parse(localStorage.getItem("FlightObject")),r,f;try{n.AlertAgree=!1;r=0;n.RePriceRequest={LowFareRequest:n.PushTripInfos(2,r),SearchKey:i.Trips[0].Search_Key,Header:n.GetHeader(n.ProcessID)};fnProgstart();f=u({method:"POST",url:Config.Api+"FlightSearch/AirlineMessage",dataType:"json",data:n.RePriceRequest,headers:{"Content-Type":"application/json"}});f.then(function(r){var u=r.data,s,f,h,e,o;if(n.BookingAlertArray=[],u.Status=="1"){u=u.Data;try{if(u.AirLowFareResponses.length>0){if(s=JSON.parse(localStorage.getItem("FlightObject")),s.Trips.length==u.AirLowFareResponses.length)for(f=0;f<s.Trips.length;f++)for(s.Trips[f].Flight_Key=u.AirLowFareResponses[f].Flight_Key,h=0;h<u.AirLowFareResponses[f].Flight.Fares.length;h++)if(u.AirLowFareResponses[f].Fare_Id==u.AirLowFareResponses[f].Flight.Fares[h].Fare_Id){s.Trips[f].SelectedFare=u.AirLowFareResponses[f].Flight.Fares[h];break}localStorage.setItem("FlightObject",JSON.stringify(s))}}catch(c){}if(u.BookingConfirmationAlerts!=null)if(u.BookingConfirmationAlerts.length>0){for(fnProgstop(),e=0;e<u.BookingConfirmationAlerts.length;e++)o={},o=u.BookingConfirmationAlerts[e].Return_Flight?u.BookingConfirmationAlerts[e]:u.BookingConfirmationAlerts[e],u.BookingConfirmationAlerts[e].Return_Flight?(n.BookingType=="ROUNDTRIP"||n.BookingType=="SPECIALROUNDTRIP")&&u.BookingConfirmationAlerts[e].Return_Flight&&(o.RetOriginName=i.DestinationName,o.RetDestinationName=i.OriginName):(o.OriginName=i.OriginName,o.DestinationName=i.DestinationName),o.QuickBookFlag=t,n.BookingAlertArray.push(o);n.ShowBookingAlertDetails(n.BookingAlertArray[0],i,t,!1)}else n.GoToBooking(t);else n.GoToBooking(t)}else n.GoToBooking(t)},function(){n.GoToBooking(t)})}catch(s){}};n.GoToBooking=function(t){$("#AirlineMessage").modal("hide");var i=JSON.parse(localStorage.getItem("FlightObject"));n.BookingAlertArray.length>0?(i.Trips[0].BookingAlertIds=n.BookingAlertArray[0].Return_Flight?"0":n.BookingAlertArray[0].AlertId,(n.BookingType=="ROUNDTRIP"||n.BookingType=="SPECIALROUNDTRIP")&&(n.BookingAlertArray[0].Return_Flight?n.BookingType=="SPECIALROUNDTRIP"?i.Trips[0].BookingAlertIds+=","+n.BookingAlertArray[0].AlertId:i.Trips[1].BookingAlertIds=n.BookingAlertArray[0].AlertId:n.BookingAlertArray.length>1?n.BookingAlertArray[1].Return_Flight?n.BookingType=="SPECIALROUNDTRIP"?i.Trips[0].BookingAlertIds+=","+n.BookingAlertArray[1].AlertId:i.Trips[1].BookingAlertIds=n.BookingAlertArray[1].AlertId:n.BookingType=="SPECIALROUNDTRIP"?i.Trips[0].BookingAlertIds+=",0":i.Trips[1].BookingAlertIds="0":n.BookingType=="SPECIALROUNDTRIP"?i.Trips[0].BookingAlertIds+=",0":i.Trips[1].BookingAlertIds="0")):(i.Trips[0].BookingAlertIds="0",(n.BookingType=="ROUNDTRIP"||n.BookingType=="SPECIALROUNDTRIP")&&(n.BookingType=="SPECIALROUNDTRIP"?i.Trips[0].BookingAlertIds+=",0":i.Trips[1].BookingAlertIds="0"));(t==undefined||t==null||t=="")&&n.BookingAlertArray.length>0&&(t=n.BookingAlertArray[0].QuickBookFlag);localStorage.setItem("FlightObject",JSON.stringify(i));t==0?n.ProceedBook():n.RePrice()};n.ShowBookingAlertDetails=function(t,i,r,u){try{n.BookingAlertMessage=h.trustAsHtml(t.AlertMessage);n.AttachmentLink1=t.Attachment1;$("#AttachmentLink1").val(t.Attachment1);$("#AttachmentLink2").val(t.Attachment2);n.AttachmentLink2=t.Attachment2;n.AttachmentLinkName1=t.AttachmentFileName1;n.AttachmentLinkName2=t.AttachmentFileName2;n.ActivateTab=u?!0:!1;$("#AirlineMessage").modal("show")}catch(f){}};n.PushTrips=function(t,i){var f,u,r;try{if(f=n.BookingType,u=!1,t.length>0)for(r=0;r<t.length;r++)t[r].TripIndex==i.TripIndex&&(t[r]=i,u=!0);u==!1&&t.push(i)}catch(e){}return t};window.downloadPDF=function(t){n.AttachmentLinkName=t=="1"?n.AttachmentLinkName1:n.AttachmentLinkName2;var r=t=="1"?document.getElementById("AttachmentLink1").value:document.getElementById("AttachmentLink2").value,i=document.getElementById("dwnldLnk");i.href=r;i.download=n.AttachmentLinkName!=""?n.AttachmentLinkName:"Attachment";i.click()};n.CreateTrips=function(){var r,u,t,i;try{for(r=[],u=0,u=n.BookingType=="ONE_WAY"||n.BookingType=="SPECIALROUNDTRIP"||n.Travel_Type=="INTERNATIONAL"||n.MultiCity_Fare==!0?1:n.BookingType=="ROUNDTRIP"?2:n.TripList.length,t=0;t<u;t++)i={},i.TripIndex=t,i.Pushed=!1,r.push(i);return r}catch(f){}};n.TimeDifference=function(n,t){try{var i=(n.getTime()-t.getTime())/1e3;return i/=60,Math.abs(Math.round(i))}catch(r){}};n.BookSelectedFare=function(){var i,t;try{if($("#TravelClassDetails").modal("hide"),n.BookingType=="ONE_WAY"||n.BookingType=="SPECIALROUNDTRIP")n.HeaderTripFlights[0]=n.CheckGroupFare(n.HeaderTripFlights[0]),n.SelectFlight(0,n.HeaderTripFlights[0],0,0);else{for(i=0;i<n.HeaderTripFlights.length;i++)n.HeaderTripFlights[i]=n.CheckGroupFare(n.HeaderTripFlights[i]),n.CurrentFares.push(n.HeaderTripFlights[i].Fares[0]);if(t={},t.Trips=n.HeaderTripFlights,n.BookingType=="ROUNDTRIP"){if(n.OngoingDate==n.ReturnDate){var r=n.FlightBooking.Trips[0].Segments[n.FlightBooking.Trips[0].Segments.length-1].Arrival_DateTime,u=n.FlightBooking.Trips[1].Segments[0].Departure_DateTime,f=new Date(r),e=new Date(u),o=n.TimeDifference(f,e);if(o<180)return ShowAlert("Selected return flight departs before the arrival of onward flight . Please select some other flight"),!1}if(t=n.FlightBooking,t.Trips[0].Fares[0].RoundTripSpecialFare==!0&&t.Trips[1].Fares[0].RoundTripSpecialFare==!1)return ShowError("Your onward flight have roundtrip special discount . Please select return flight with round trip discount to avail the discount"),!1;if(t.Trips[0].Fares[0].RoundTripSpecialFare==!1&&t.Trips[1].Fares[0].RoundTripSpecialFare==!0)return ShowError("Your return flight have roundtrip special discount . Please select onward flight with round trip discount to avail the discount"),!1;if(t.Trips[0].API_Id==18&&t.Trips[1].API_Id!=18)return ShowError("Your onward flight have special fare discount . Please select return flight with special fare discount to avail the discount"),!1;if(t.Trips[0].API_Id!=18&&t.Trips[1].API_Id==18)return ShowError("Your return flight have special fare discount . Please select onward flight with special fare discount to avail the discount"),!1}t.ProcessID=n.ProcessID;t.Adult_Count=n.Adult_Count;t.Child_Count=n.Child_Count;t.Infant_Count=n.Infant_Count;t.Travel_Type=n.Travel_Type;t.BookingType=n.BookingType;t.Travel_Class=n.Travel_Class;t.OngoingDate=n.OngoingDate;t.ReturnDate=n.ReturnDate;t.OriginCode=n.From.originalObject.Value;t.DestinationCode=n.To.originalObject.Value;t.Refundable=n.lobjFlight_Refundable;t.OriginName=n.OriginName;t.DestinationName=n.DestinationName;t.Discounted_Fare=!1;t.PreFilledPassengers=[];n.SearchType=="CORPORATEMETA"&&(t.PreFilledPassengers=n.CorporatePassengers);n.FlightBooking=t;localStorage.setItem("FlightObject",JSON.stringify(t));n.RescheduleFlag?n.GetReschedulePenalty():n.GetBookingAlert(0)}}catch(s){}};n.SelectRoundTrip=function(t){try{fnProgstart();e(function(){var i,r;if(fnProgstop(),n.OngoingDate==n.ReturnDate){var u=n.FlightBooking.Trips[0].Segments[n.FlightBooking.Trips[0].Segments.length-1].Arrival_DateTime,f=n.FlightBooking.Trips[1].Segments[0].Departure_DateTime,o=new Date(u),s=new Date(f),h=n.TimeDifference(o,s);if(h<180)return ShowAlert("Selected return flight departs before the arrival of onward flight . Please select some other flight"),!1;var c=moment(u,"MM/DD/YYYY hh:mm"),l=moment(f,"MM/DD/YYYY hh:mm"),e=l.diff(c,"minutes");if(e<0||e<180)return ShowAlert("Selected return flight departs before the arrival of onward flight . Please select some other flight"),!1}if(i=n.FlightBooking,i.Trips[0].Fares[0].RoundTripSpecialFare==!0&&i.Trips[1].Fares[0].RoundTripSpecialFare==!1)return ShowError("Your onward flight have roundtrip special discount . Please select return flight with round trip discount to avail the discount"),!1;if(i.Trips[0].Fares[0].RoundTripSpecialFare==!1&&i.Trips[1].Fares[0].RoundTripSpecialFare==!0)return ShowError("Your return flight have roundtrip special discount . Please select onward flight with round trip discount to avail the discount"),!1;if(i.Trips[0].API_Id==18&&i.Trips[1].API_Id!=18)return ShowError("Your onward flight have special fare discount . Please select return flight with special fare discount to avail the discount"),!1;if(i.Trips[0].API_Id!=18&&i.Trips[1].API_Id==18)return ShowError("Your return flight have special fare discount . Please select onward flight with special fare discount to avail the discount"),!1;for(r=0;r<n.FlightBooking.Trips.length;r++)n.FlightBooking.Trips[r]=n.CheckGroupFare(n.FlightBooking.Trips[r]),n.CurrentFares.push(n.FlightBooking.Trips[r].Fares[0]);localStorage.setItem("FlightObject",JSON.stringify(n.FlightBooking));n.RescheduleFlag?n.GetReschedulePenalty():n.GetBookingAlert(t)},100)}catch(i){}};n.SelectMultiTrip=function(t){var u,i;try{for(u=0,i=0;i<n.FlightBooking.Trips.length;i++)n.FlightBooking.Trips[i].Pushed==!0&&u++;if(u==n.TripList.length)t==0?r.LoadPage("FlightBooking"):n.RePrice();else return ShowError("Please select flight for all trips to continue"),!1}catch(f){}};n.CheckValidString=function(n){try{return n==null||n==undefined||n==""?"":n}catch(t){}};n.ProceedBook=function(){var t=n.FlightBooking;n.TerminalChangeMessage="";try{n.BookingType=="ROUNDTRIP"?n.CheckValidString(t.Trips[0].Fares[0].PromptMessage)!=""||n.CheckValidString(t.Trips[1].Fares[0].PromptMessage)!=""?n.CheckValidString(t.Trips[0].Fares[0].PromptMessage)!=""?(fnProgstop(),ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");PushEventMessage(3,t);r.LoadPage("FlightBooking")},t.Trips[0].Fares[0].PromptMessage,function(){$("#ConfirmationModal").modal("hide")})):n.CheckValidString(t.Trips[1].Fares[0].PromptMessage)!=""&&(fnProgstop(),ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");PushEventMessage(3,t);r.LoadPage("FlightBooking")},t.Trips[1].Fares[0].PromptMessage,function(){$("#ConfirmationModal").modal("hide")})):e(function(){PushEventMessage(3,t);r.LoadPage("FlightBooking")},500):(n.CheckValidString(t.Trips[0].Fares[0].PromptMessage)!=""&&(fnProgstop(),ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");e(function(){PushEventMessage(3,t);r.LoadPage("FlightBooking")},500)},t.Trips[0].Fares[0].PromptMessage,function(){$("#ConfirmationModal").modal("hide")})),n.BookingType=="ONE_WAY"?n.CheckChangeTerminal(t.Trips[0])&&(n.TerminalChangeMessage!=""||n.TerminalChangeMessage!=null)&&(fnProgstop(),ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");e(function(){PushEventMessage(3,t);r.LoadPage("FlightBooking")},500)},n.TerminalChangeMessage,function(){$("#ConfirmationModal").modal("hide")})):n.BookingType=="SPECIALROUNDTRIP"?n.CheckChangeTerminal(t.Trips[0])&&(n.TerminalChangeMessage!=""||n.TerminalChangeMessage!=null)&&(fnProgstop(),ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");e(function(){PushEventMessage(3,t);r.LoadPage("FlightBooking")},500)},n.TerminalChangeMessage,function(){$("#ConfirmationModal").modal("hide")})):n.CheckChangeTerminal(t.Trips[0])&&(n.TerminalChangeMessage!=""||n.TerminalChangeMessage!=null)&&(fnProgstop(),ShowConfirmationModal(function(){e(function(){$("#ConfirmationModal").modal("hide")},500)},n.TerminalChangeMessage,function(){$("#ConfirmationModal").modal("hide")})),(n.TerminalChangeMessage==""||n.TerminalChangeMessage==null)&&(t.Trips[0].Fares[0].PromptMessage==""||t.Trips[0].Fares[0].PromptMessage==null)&&e(function(){PushEventMessage(3,t);r.LoadPage("FlightBooking")},500))}catch(i){}};n.CheckChangeTerminal=function(t){try{if(n.Segment=t.Segments,n.Segment.length==2)if(n.Segment[1].Origin_Terminal!=""&&n.Segment[0].Destination_Terminal!=""&&n.Segment[1].Origin_Terminal!=null&&n.Segment[0].Destination_Terminal!=null){if(n.Segment[1].Origin_Terminal!=n.Segment[0].Destination_Terminal)return n.TerminalChangeMessage="You are booking a connecting flight with a change of terminal at the connecting station. Please plan your travel accordingly",!0}else return!1;else if(n.Segment.length==3){if(n.Segment[1].Origin_Terminal!=""&&n.Segment[0].Destination_Terminal!=""&&n.Segment[1].Origin_Terminal!=null&&n.Segment[0].Destination_Terminal!=null&&n.Segment[1].Origin_Terminal!=n.Segment[0].Destination_Terminal)return n.TerminalChangeMessage="You are booking a connecting flight with a change of terminal at the connecting station. Please plan your travel accordingly",!0;if(n.Segment[2].Origin_Terminal!=""&&n.Segment[1].Destination_Terminal!=""&&n.Segment[2].Origin_Terminal!=null&&n.Segment[1].Destination_Terminal!=null){if(n.Segment[2].Origin_Terminal!=n.Segment[1].Destination_Terminal)return n.TerminalChangeMessage="You are booking a connecting flight with a change of terminal at the connecting station. Please plan your travel accordingly",!0}else return!1}else return!1}catch(i){}};n.CalculateLayOver=function(n,t){var i,f;try{var e=new Date(n),o=new Date(t),r=Math.abs(e-o),u=Math.floor(r/36e5);return u<10&&(u="0"+u),r-=u*36e5,i=Math.floor(r/6e4),i<10&&(i="0"+i),r-=i*6e4,f=Math.floor(r/1e3),f<10&&(f="0"+f),u+"h : "+i+"m "}catch(s){}};n.Duration=function(t){var f,e,u,r,i;try{for(f=[],i=0;i<t.length;i++)f.push(t[i].Duration),t.length>1&&i<t.length-1&&(e=n.CalculateLayOver(t[i].Arrival_DateTime,t[i+1].Departure_DateTime),e=e.replace("h, ",":"),e=e.replace("m ",""),f.push(e));for(u=0,r=0,i=0;i<f.length;i++)u+=parseInt(f[i].split(":")[0]),r+=parseInt(f[i].split(":")[1]);return parseInt(r/60)>0&&(u+=parseInt(r/60)),r=parseInt(r%60),u<10&&(u="0"+u),r<10&&(r="0"+r),u+"h : "+r+"m "}catch(o){}};n.Filter=function(){var c,e,nt,d,tt,f,l,a,g,v,y,p,w,r,t,b,u;try{for(c=[],selected=!1,r=0;r<n.Airlines_Trips.length;r++){t=n.Airlines_Trips[r];for(i in n.FilterAirlineTypes)if(n.FilterAirlineTypes[i]&&(selected=!0,i==t.Airline_Code)){c.push(t);break}}for(selected||(c=n.Airlines_Trips),e=[],selected=!1,r=0;r<c.length;r++)for(t=c[r],i=0;i<n.selection_Oneway.length;i++)if(n.selection_Oneway[i]){var o=n.selection_Oneway[i].split(" - ")[0]+":00",s=n.selection_Oneway[i].split(" - ")[1]+":00",h=t.Segments[0].Departure_DateTime.split(" ")[1];if(n.BookingType=="SPECIALROUNDTRIP"){for(nt=[],d=1;d<t.Segments.length;d++)t.Segments[d].Return_Flight==!0&&nt.push(t.Segments[d]);if(nt.length>0&&(tt=nt[0].Departure_DateTime.split(" ")[1],selected=!0,h>=o&&h<=s&&tt>=o&&tt<=s)){e.push(t);break}}else if(selected=!0,h>=o&&h<=s){e.push(t);break}}for(selected||(e=c),f=[],selected=!1,r=0;r<e.length;r++)if(n.BookingType=="SPECIALROUNDTRIP"){t=e[r];for(i in n.FilterAirlineStops)if(n.FilterAirlineStops[i]&&(selected=!0,i==t.OSegments_Stops&&i==t.RSegments_Stops)){f.push(t);break}}else{t=e[r];for(i in n.FilterAirlineStops)if(n.FilterAirlineStops[i]){if(selected=!0,i=="1 Change"&&(t.Segments_Stops=="1 Stop"||t.Segments_Stops=="1+ Stops")&&t.Segments.length==2){f.push(t);break}if(i=="1+ Changes"&&(t.Segments_Stops=="1 Stop"||t.Segments_Stops=="1+ Stops")&&t.Segments.length>2){f.push(t);break}if(i==t.Segments_Stops){f.push(t);break}}}for(selected||(f=e),l=[],r=0;r<f.length;r++)t=f[r],n.minimumAirPrice==n.minimumPrice&&n.maximumAirPrice==n.maximumPrice?l=f:parseFloat(t.Total_Amount)>=parseFloat(n.minimumAirPrice)&&parseFloat(t.Total_Amount)<=parseFloat(n.maximumAirPrice)&&l.push(t);for(a=[],selected=!1,r=0;r<l.length;r++){t=l[r];for(i in n.FilterAirlineRefundable)if(n.FilterAirlineRefundable[i]&&(selected=!0,i==t.Flight_Refundable)){a.push(t);break}}for(selected||(a=l),u=[],selected=!1,r=0;r<a.length;r++)if(t=a[r],n.AirNumber)for(selected=!0,k=0;k<t.Segments.length;k++)if(n.AirNumber==t.Segments[k].Flight_Number.trim()){u.push(t);break}for(selected||(u=a),g=[],selected=!1,r=0;r<u.length;r++)for(t=u[r],i=0;i<n.selection_Arrival.length;i++)if(n.selection_Arrival[i]){var o=n.selection_Arrival[i].split(" - ")[0]+":00",s=n.selection_Arrival[i].split(" - ")[1]+":00",it=t.Segments[t.Segments.length-1].Arrival_DateTime.split(" ")[1];if(selected=!0,it>=o&&it<=s){g.push(t);break}}if(selected||(g=u),n.OnwardTrips=[],n.OnwardTrips=g,n.ShowfOnwardTrips=[],n.ShowOnwardTrips=g,n.BookingType=="ROUNDTRIP"){for(v=[],selected=!1,r=0;r<n.Airlines_ReturnTrips.length;r++){t=n.Airlines_ReturnTrips[r];for(i in n.FilterAirlineTypes)if(n.FilterAirlineTypes[i]&&(selected=!0,i==t.Airline_Code)){v.push(t);break}}for(selected||(v=n.Airlines_ReturnTrips),y=[],selected=!1,r=0;r<v.length;r++)for(t=v[r],i=0;i<n.selection_Twoway.length;i++)if(n.selection_Twoway[i]){var o=n.selection_Twoway[i].split(" - ")[0]+":00",s=n.selection_Twoway[i].split(" - ")[1]+":00",h=t.Segments[0].Departure_DateTime.split(" ")[1];if(selected=!0,h>=o&&h<=s){y.push(t);break}}for(selected||(y=v),p=[],selected=!1,r=0;r<y.length;r++){t=y[r];for(i in n.FilterAirlineStops)if(n.FilterAirlineStops[i]&&(selected=!0,i==t.Segments_Stops)){p.push(t);break}}for(selected||(p=y),w=[],r=0;r<p.length;r++)t=p[r],n.minimumAirPrice==n.minimumPrice&&n.maximumAirPrice==n.maximumPrice?w=p:parseFloat(t.Total_Amount)>=parseFloat(n.minimumAirPrice)&&parseFloat(t.Total_Amount)<=parseFloat(n.maximumAirPrice)&&w.push(t);for(b=[],selected=!1,r=0;r<w.length;r++){t=w[r];for(i in n.FilterAirlineRefundable)if(n.FilterAirlineRefundable[i]&&(selected=!0,i==t.Refundable_Return)){b.push(t);break}}for(selected||(b=w),u=[],selected=!1,r=0;r<b.length;r++)if(t=b[r],n.AirNumber&&(selected=!0,n.AirNumber==t.Segments[0].Flight_Number)){u.push(t);break}selected||(u=b);n.ReturnTrips=[];n.ReturnTrips=u;n.ReturnVisible=!0}n.OnwardVisible=!0;n.SearchDummyIsVisible=!1;n.GrossCommissionIsVisible=!0;n.NetFareIsVisible=!1;n.RefundableIsVisible=n.chkRefundable}catch(rt){}};n.ResetAll=function(){try{n.selection_Oneway=[];n.selection_Twoway=[];e(function(){var t;for(t in n.FilterAirlineTypes)n.FilterAirlineTypes[t]=!1;for(t in n.FilterAirlineStops)n.FilterAirlineStops[t]=!1;for(t in n.FilterAirlineRefundable)n.FilterAirlineRefundable[t]=!1;for(t in n.FiltersAirlineNumber)n.FiltersAirlineNumber[t]=!1;n.value=n.minimumPrice;n.toggle_Oneway();n.toggle_Twoway();n.minimumAirPrice=n.minimumPrice;n.maximumAirPrice=n.maximumPrice;n.AirNumber="";n.Filter()},1500);Config.ChannelId!=3&&fncloseModal("AirlineFilter")}catch(t){}};n.EmptyField=function(){(n.AirNumber==""||n.AirNumber==null)&&n.Filter()};n.CreateCheckboxes=function(n){try{var t={};return angular.forEach(n,function(n){t[n]=!1}),t}catch(i){}};angular.element(document).ready(function(){try{String.prototype.padStart||(String.prototype.padStart=function(n,t){return n=n>>0,t=String(typeof t!="undefined"?t:" "),this.length>n?String(this):(n=n-this.length,n>t.length&&(t+=t.repeat(n/t.length)),t.slice(0,n)+String(this))});var t=new Date,i=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),u=t.getFullYear();n.MultiCityOngoingDate=i+"/"+r+"/"+u;n.MultiDateFormat=getDayNameMonth(n.MultiCityOngoingDate);n.FirstOngoingDate=moment(n.MultiDateFormat).add(1,"days").format("DD/MM/YYYY");n.ShowTopPackageList=!0;n.AirlineSearchIsVisible=!0;n.AdultIsVisible=!0;n.FilterCheck=!0;n.ResultIsVisible=!1;n.ResultHeaderVisible=!1;n.FilterHeaderVisible=!1;n.OnwardVisible=!1;n.ReturnVisible=!1;n.ReturnContainerVisible=!1;n.RoundTripBarVisible=!1;n.ReturnBookButtonVisible=!1;n.SearchDummyIsVisible=!1;n.BookingType="ONE_WAY";n.enableMe=!0;n.Filter()}catch(e){}});n.RescheduleSearch=function(){var t,u,i;try{n.TransType="R";localStorage.getItem("RescheduleFlightObject")!=""&&localStorage.getItem("RescheduleFlightObject")!="undefined"&&localStorage.getItem("RescheduleFlightObject")!=undefined&&localStorage.getItem("RescheduleFlightObject")!="null"&&localStorage.getItem("RescheduleFlightObject")!=null&&(t=JSON.parse(localStorage.getItem("RescheduleFlightObject")),t.BookingType==undefined?(n.BookingType="ONE_WAY",n.OngoingDate=t.TripDetails[0].Flights[0].TravelDate,n.OriginName=t.TripDetails[0].Flights[0].Segments[0].Origin_City,n.OriginID=t.TripDetails[0].Flights[0].Segments[0].Origin_City,n.DestinationName=t.TripDetails[0].Flights[0].Segments[t.TripDetails[0].Flights[0].Segments.length-1].Destination_City,n.DestinationID=t.TripDetails[0].Flights[0].Segments[t.TripDetails[0].Flights[0].Segments.length-1].Destination_City):n.BookingType=t.BookingType,t.TripDetails.length>1&&n.BookingType!="SPECIALROUNDTRIP"&&(n.BookingType="ROUNDTRIP",n.ReturnContainerVisible=!0,n.ReturnVisible=!0,n.ReturnDate=t.TripDetails[1].Flights[0].TravelDate,n.OriginName=t.TripDetails[0].Flights[0].Segments[0].Origin_City,n.OriginID=t.TripDetails[0].Flights[0].Segments[0].Origin_City,n.DestinationName=t.TripDetails[0].Flights[0].Segments[t.TripDetails[0].Flights[0].Segments.length-1].Destination_City,n.DestinationID=t.TripDetails[0].Flights[0].Segments[t.TripDetails[0].Flights[0].Segments.length-1].Destination_City),n.RescheduleRequestKey=t.AirTicketRescheduleReqKey,n.RescheduleResponseKey=t.AirTicketRescheduleResKey,n.SearchKey=t.SearchKey,n.InstaReschedule=t.InstaReschedule,n.RescheduleDate=t.RescheduleDate,n.SelectedPassengerList=t.SelectedPaxList,n.RescheduleRefNo=t.RefNo,u="",i={},i.Search_Key=t.SearchKey,i.TripDetails=t.TripDetails,u=JSON.stringify(i),n.SearchResult(u),n.BookingRefNo=t.RefNo,n.OriginName=n.OnwardTrips[0].Segments[0].Origin_City,n.DestinationName=n.OnwardTrips[0].Segments[n.OnwardTrips[0].Segments.length-1].Destination_City,n.RescheduleProcessId=t.ProcessID,n.RescheduleFlag=!0,n.BookingButtonValue="Select",n.ResultIsVisible=!0,n.SortingHeaderVisible=!0,n.ResultHeaderVisible=!0,n.RescheduleAirPNR=t.AirlinePNR,n.RescheduleBtnValue="CONFIRM",n.OfflineMessage="",r.ShowBack="Back",$("#ModuleName").html("<br><span >Reschedule Flight<\/span>"));r.Biller_Id=t.TripDetails[0].Flights[0].Biller_Id;r.SupplierId=t.TripDetails[0].Flights[0].Supplier_Id;r.SubbillerCode=t.TripDetails[0].Flights[0].Airline_Code;n.RescheduleRetailerId=t.RetailerId;n.RescheduleSubRetailerId=t.SubRetailerId;n.InitPG(t.RetailerId,t.SubRetailerId)}catch(f){}};n.SubmitOfflineReschedule=function(){n.InstaReschedule=!1;n.SendOfflineRescheduleRequest=!0;n.GetReschedulePenalty()};n.PushRescheduleTripInfo=function(t,i){var f,r,u;try{for(f=[],r={},u=0;u<n.FlightBooking.Trips.length;u++)n.BookingType=="MULTICITY"&&n.FlightBooking.Discounted_Fare==!1?u==i&&n.FlightBooking.Trips[u].Pushed==!0&&(r={},t==1?r.Fare_Key=n.FlightBooking.Trips[u].Fares[0].Fare_Key:t==2&&(r.Fare_Id=n.FlightBooking.Trips[u].Fares[0].Fare_Id),r.Flight_Key=n.FlightBooking.Trips[u].Flight_Key,f.push(r)):(r={},t==1?r.Fare_Key=n.FlightBooking.Trips[u].Fares[0].Fare_Key:t==2&&(r.Fare_Id=n.FlightBooking.Trips[u].Fares[0].Fare_Id),r.Flight_Key=n.FlightBooking.Trips[u].Flight_Key,f.push(r));return f}catch(e){}};n.SendOfflineRescheduleRequest=!1;n.GetReschedulePenalty=function(){var t,i,f;try{t=[];n.BookingType=="ONE_WAY"||n.BookingType=="SPECIALROUNDTRIP"?(i={},i.Flight_Key=n.OnwardFlight.Flight_Key,i.Fare_Id=n.OnwardFlight.SelectedFare.Fare_Id,t.push(i)):n.BookingType=="ROUNDTRIP"&&(t=n.PushRescheduleTripInfo(2,0));n.InstaReschedule||(n.SendOfflineRescheduleRequest=!0);n.lobjTicketRescheduleGetPenaltyRequest={Header:n.GetHeader(n.RescheduleProcessId),lobjAirTicketRescheduleGetPenalty:{AirRepriceRequests:t,AirTicketRescheduleResponse_Key:n.RescheduleResponseKey,ForceOfflineReschedule:n.SendOfflineRescheduleRequest,AirlinePNR:n.RescheduleAirPNR}};n.lobjTicketRescheduleGetPenaltyRequest.Header.RetailerId=n.RescheduleRetailerId;n.lobjTicketRescheduleGetPenaltyRequest.Header.SubRetailerId=n.RescheduleSubRetailerId;fnProgstart();f=u({method:"POST",url:Config.Api+"FlightHistory/AirTicketReschedulePenalty",dataType:"json",data:n.lobjTicketRescheduleGetPenaltyRequest,headers:{Authorization:n.GetBearerToken(),"Content-Type":"application/json"}});f.then(function(t){var i,f,e,u,o;try{if(fnProgstop(),i=t.data,i.Status=="1"){if(n.OfflineMessage="",n.Airline_PNR=i.Data.Airline_PNR,n.RescheduleFlights=i.Data.Flights,n.RescheduleFlights[0].SelectedFare=n.FlightBooking.Trips[0].SelectedFare,n.ChangeFee=i.Data.ChangeFee,n.ProcessingFee=i.Data.Filler.ProcessingFee,n.ReschedulePenalty=i.Data.PenaltyAmount,n.TotalPenalty=n.ChangeFee+n.ProcessingFee+n.ReschedulePenalty,n.BookingType=="ROUNDTRIP"){for(n.OnwardTripReshedule=n.RescheduleFlights[0],n.RescheduleFlights.length>1&&(n.ReturnTripReshedule=n.RescheduleFlights[1],n.RescheduleFlights[1].SelectedFare=n.FlightBooking.Trips[1].SelectedFare),f=0,e=0,u=0;u<n.OnwardTripReshedule.Fares[0].FareDetails.length;u++)f+=parseFloat(n.OnwardTripReshedule.Fares[0].FareDetails[u].Total_Amount);for(u=0;u<n.ReturnTripReshedule.Fares[0].FareDetails.length;u++)e+=parseFloat(n.ReturnTripReshedule.Fares[0].FareDetails[u].Total_Amount);n.OnwardTripReshedule.Total_Amount=f;n.ReturnTripReshedule.Total_Amount=e}else n.BookingType=="ONE_WAY"&&(n.lobjRescheduleFlight=n.RescheduleFlights[0]);n.AirTicketReschedulePenaltyResKey=i.Data.AirTicketReschedulePenaltyResponse_Key;$("#RescheduleConfirmationModal").modal("show")}else if(i.Status=="100")fnSessionTimeOut();else if(i.Status=="101")fnInvalidSession(i.StatusDesc);else return n.InstaReschedule?(n.SendOfflineRescheduleRequest=!0,o="<span style='font-weight:700'>We are unable to reschedule this ticket Online, Please send us the request offline by clicking on the button below, we will call/email you with all the details within 30 minutes.<\/span>",n.OfflineMessage=h.trustAsHtml(o),n.RescheduleBtnValue="Send Offline Reschedule Request",$("#RescheduleConfirmationModal").modal("show")):r.ShowProviderError(i.Data,"",""),!1}catch(s){}},function(n){ShowAlert(n)})}catch(o){}};n.InsertRescheduleTrack=function(){var t,i,f;try{if(t=0,n.InstaReschedule){if(i=n.ChangeFee+n.ProcessingFee+n.ReschedulePenalty,i>0){if((n.PG_Mode==null||n.PG_Mode.length<=0)&&n.PaymentMode=="Payment_Gateway")return ShowError("Please Select Payment Mode"),!1;if(n.PaymentMode==""||n.PaymentMode==undefined)return ShowError("Please Enter PaymentMode"),!1;t=n.PaymentMode=="Payment_Gateway"?1:0}}else t=1;n.InsRescheduleTrackRequest={Header:n.GetHeader(n.RescheduleProcessId),lobjAirTicketInsertRescheduleTrackRequest:{RescheduleRemarks:n.RescheduleModel.RescheduleReason,RescheduleContactNo:"",AirTicketReschedulePenaltyResponse_Key:n.AirTicketReschedulePenaltyResKey,PaymentMode:t}};n.InsRescheduleTrackRequest.Header.RetailerId=n.RescheduleRetailerId;n.InsRescheduleTrackRequest.Header.SubRetailerId=n.RescheduleSubRetailerId;fnProgstart();f=u({method:"POST",url:Config.Api+"FlightHistory/AirTicketRescheduleInsertTrack",dataType:"json",data:n.InsRescheduleTrackRequest,headers:{Authorization:n.GetBearerToken(),"Content-Type":"application/json"}});f.then(function(t){try{fnProgstop();var i=t.data;if(i.Status=="1")n.lstrProcessNo=i.Data.ProcessNo,localStorage.setItem("PGTrackProcessNo",n.lstrProcessNo),n.InstaReschedule?n.InitiateReschedulePayment():(n.ResultIsVisible=!1,n.SearchDummyIsVisible=!1,n.SortingHeaderVisible=!1,n.ResultHeaderVisible=!1,n.SearchBoxIsVisible=!0,n.ShowTopPackageList=!0,n.AirlineSearchIsVisible=!0,n.OnwardVisible=!1,n.ReturnVisible=!1,n.RoundTripBarVisible=!1,$("#RescheduleConfirmationModal").modal("hide"),Config.ChannelId!="3"?ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");r.LoadPage("home")},"Your Reissue Request has been received by us, We will get back to you soon on Email or Phone with applicable charges.",function(){r.LoadPage("home");$("#ConfirmationModal").modal("hide")}):ShowAlert("Your Reissue Request has been received by us, We will get back to you soon on Email or Phone with applicable charges."));else if(i.Status=="100")fnSessionTimeOut();else if(i.Status=="101")fnInvalidSession(i.StatusDesc);else return r.ShowProviderError(i.Data,"",""),$("#RescheduleConfirmationModal").modal("hide"),!1}catch(u){}},function(n){ShowAlert(n)})}catch(o){}};n.InitiateReschedulePayment=function(){var i,e,t,f,o,u;if(localStorage.setItem("RecheduleAirKey",n.AirTicketReschedulePenaltyResKey),n.RSAmount=n.ChangeFee+n.ProcessingFee+n.ReschedulePenalty,n.ChangeFee+n.ProcessingFee+n.ReschedulePenalty<=0)n.PaymentMode="Payment_Gateway",n.ConfirmReschedule(n.AirTicketReschedulePenaltyResKey,n.lstrProcessNo);else{if(n.RSAmount>0){if((n.PG_Mode==null||n.PG_Mode.length<=0)&&n.PaymentMode=="Payment_Gateway")return ShowError("Please Select Payment Mode"),!1;if(n.PaymentMode==""||n.PaymentMode==undefined)return ShowError("Please Enter PaymentMode"),!1}n.PaymentMode=="PrePaid_Money"?(i={},i.GatewayID="",i.GatewayName="",i.PaymentType="",i.PaymentTypeCode="",i.ChargesConversion="",i.GatewayCharges="",i.GatewayChargesMin="0.00",i.GatewayChargesMax="0.00",n.PGDetails=i,n.ConfirmReschedule(n.AirTicketReschedulePenaltyResKey,n.lstrProcessNo)):(e=n.ChangeFee+n.ProcessingFee+n.ReschedulePenalty,n.PaymentMode=="Payment_Gateway"&&(t={},t.PaymentMode=n.PaymentMode,t.PaymentStatus=0,t.PaymentData="",t.PaymentGateway=n.PG_Mode,t.Gateway_Charges=r.Gateway_Charges,t.PaymentKey=r.PaymentKey,t.PaymentBiller=r.Biller_Id+"$"+r.SupplierId+"$"+r.SubbillerCode,t.Service_AddOn=n.AddOn_Fees,t.isRedirect=n.PG_Mode.isRedirect,localStorage.setItem("PreviousCtrl","RSpayment"),f=GetPath()+"flights/Reschedule=2",Config.ChannelId=="4"&&(f="#flights/Reschedule=2"),o=n.PG_Mode,u={Header:n.GetHeader(n.ProcessID),CustomerMobile:n.CustomerMobileNumber,CustomerName:n.PassengerDetail.Title+" "+n.PassengerDetail.First_Name+" "+n.PassengerDetail.Last_Name,CustomerEmail:n.EmailID,ModuleID:1,TotalAmount:e,Gateway_Charges:r.Gateway_Charges,BookRefNo:n.RescheduleRefNo,PGInfo:n.PG_Mode,PostURL:Config.PGURL,ReturnURL:f,TransactionType:2,PaymentKey:r.PaymentKey,PaymentBiller:r.Biller_Id+"$"+r.SupplierId+"$"+r.SubbillerCode},u.PaymentDetails=t,u.Header.RetailerId=n.RescheduleRetailerId,u.Header.SubRetailerId=n.RescheduleSubRetailerId,localStorage.setItem("FlightRescheduleObject",JSON.stringify(u)),r.InitiatePayment(u)))}};n.ConfirmReschedulePGBooking=function(){var u,t,i,f;try{if(u=localStorage.getItem("FlightRescheduleObject"),u!=undefined&&u!=""){if(t=JSON.parse(u),i=t.PaymentDetails,n.RescheduleRetailerId=t.Header.RetailerId,n.RescheduleSubRetailerId=t.Header.SubRetailerId,i.isRedirect==!0){if(a.search().PAYMENTDATA==null)return ShowAlert("Unable to Get Payment Status."),n.CloseChangePaxonResult(),!1;f=JSON.parse(atob(a.search().PAYMENTDATA));n.PaymentData=JSON.stringify(f.PayUResponse)}else{if(i.PaymentStatus!=1)return ShowAlert("Unable to Get Payment Status."),n.CloseChangePaxonResult(),!1;n.PaymentData=i.PaymentData}n.AirTicketReschedulePenaltyResKey=localStorage.getItem("RecheduleAirKey");r.Gateway_Charges=i.Gateway_Charges;n.RSAmount=t.TotalAmount+parseFloat(i.Gateway_Charges);n.RescheduleRefNo=t.BookRefNo;n.RescheduleProcessId=t.Header.ProcessId;n.Payment_Mode="Payment_Gateway";n.InstaReschedule=!0;n.lstrProcessNo=localStorage.getItem("PGTrackProcessNo");n.PGDetails=t.PGInfo;n.ConfirmReschedule(n.AirTicketReschedulePenaltyResKey,n.lstrProcessNo);n.CloseChangePaxonResult()}}catch(e){}};n.ConfirmReschedule=function(t,i){try{localStorage.setItem("FlightRescheduleObject","");(n.Payment_Mode==null||n.Payment_Mode==undefined)&&n.RSAmount<=0&&(n.Payment_Mode="PrePaid_Money");n.lobjTicketRescheduleConfirmRequest={Header:n.GetHeader(n.RescheduleProcessId),lobjAirTicketRescheudleConfirmationRequest:{ProcessNo:i,AirTicketReschedulePenaltyResponse_Key:t},Payment_Mode:n.Payment_Mode,Payment_Data:n.PaymentData,PaymentGatewayFee:r.Gateway_Charges,Amount:parseFloat(r.Gateway_Charges)+parseFloat(n.RSAmount),Booking_RefNo:n.RescheduleRefNo,Payment_Gateway:n.PGDetails};setTimeout(function(){fnProgstart()},500);n.lobjTicketRescheduleConfirmRequest.Header.RetailerId=n.RescheduleRetailerId;n.lobjTicketRescheduleConfirmRequest.Header.SubRetailerId=n.RescheduleRetailerId;var f=u({method:"POST",url:Config.Api+"FlightHistory/AirTicketRescheduleConfirmation",dataType:"json",data:n.lobjTicketRescheduleConfirmRequest,headers:{Authorization:n.GetBearerToken(),"Content-Type":"application/json"}});f.then(function(t){try{fnProgstop();var i=t.data;if(localStorage.setItem("RescheduleFlightObject",""),localStorage.setItem("FlightRescheduleObject",""),$("#RescheduleConfirmationModal").modal("hide"),n.ResultIsVisible=!1,n.SearchDummyIsVisible=!1,n.SortingHeaderVisible=!1,n.ResultHeaderVisible=!1,n.SearchBoxIsVisible=!0,n.ShowTopPackageList=!0,n.AirlineSearchIsVisible=!0,n.OnwardVisible=!1,n.ReturnVisible=!1,n.RoundTripBarVisible=!1,i.Status=="1")localStorage.setItem("FlightRescheduleObject",""),Config.ChannelId!="3"?ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");r.LoadPage("home")},"Your flight has been successfully rescheduled...",function(){r.LoadPage("home");$("#ConfirmationModal").modal("hide")}):ShowAlert("Your flight has been successfully rescheduled...");else if(i.Status=="100")fnSessionTimeOut();else if(i.Status=="101")fnInvalidSession(i.StatusDesc);else return r.ShowProviderError(i.Data,"",""),!1}catch(u){}},function(n){ShowAlert(n)})}catch(o){}};n.LoadDropList=function(){try{e(function(){n.AirportDetails=lobjAirportList;n.Origin=lobjAirportList;n.Destination=lobjAirportList;var t=n.GetTravelType();n.AirlineList=lobjAirlineList;t==undefined&&(t="DOMESTIC",n.AirlineFlag=1);n.SelectedAirlineName=[];n.AirlineRestriction=fnGetRetailerData(52);angular.forEach(lobjAirlineList,function(i){var r=!1;for(j=0;j<n.AirlineRestriction.split(",").length-1;j++)n.AirlineRestrictTravelType=n.AirlineRestriction.split(",")[j].split("~")[1]==13?"DOMESTIC":"INTERNATIONAL",i.Value==n.AirlineRestriction.split(",")[j].split("~")[0]&&n.AirlineRestrictTravelType==t&&(r=!0);i.Type==t&&r==!1&&n.SelectedAirlineName.push(i)});n.AirlineName=n.SelectedAirlineName;n.MetaSearch()},100)}catch(t){}};n.MetaSearch=function(){var w,tt,rt,d,c,ot,g,i,v,y,a,l,nt,o,s,h;try{if(n.lboolisHide=!1,r.ShowBack="",t.MetaSearch!=null&&t.MetaSearch!=undefined){if(w=t.MetaSearch,w.indexOf("origin")>-1&&w.indexOf("destination")>-1&&w.toLowerCase().indexOf("research")<=-1)if(o=t.MetaSearch.split("&"),n.Travel_Type=o[4].split("=")[1],n.Adult_Count=parseInt(o[6].split("=")[1]),n.Child_Count=parseInt(o[7].split("=")[1]),n.Infant_Count=parseInt(o[8].split("=")[1]),n.DirectFlight=o[9].split("=")[1]=="true"?!0:!1,n.HostSearch=o[11].split("=")[1]=="true"?!0:!1,o.length>12&&(o[12].split("=")[1]=="true"?(n.Defence=!0,tt=JSON.parse(localStorage.getItem("DefenceTrack",n.DefenceTrack)),n.DefenceContinueFlag=!0,n.DefenceTrack={},n.DefenceTrack.Category=tt.Category,n.DefenceTrack.ServiceNumber=tt.ServiceNumber):n.Defence=!1),n.Travel_Class=o[5].split("=")[1],n.BookingType="ONE_WAY",n.BookingType1="ONE_WAY",n.Travel_Type=o[4].split("=")[1],n.OngoingDate=o[2].split("=")[1].replace("-","/").replace("-","/"),o[3].split("=")[1]!=""&&(n.ReturnDate=o[3].split("=")[1].replace("-","/").replace("-","/"),n.BookingType="ROUNDTRIP",n.BookingType1="ROUNDTRIP",n.RoundTrip_Fare=o[10].split("=")[1]=="true"?!0:!1),n.Travel_Type=="INTERNATIONAL"){var p=o[0].split("=")[1],b=Config.Api+Config.FlightCitySearchURL+p,it=u.get(b);it.then(function(t){var e=t.data.Data,i=e.filter(function(n){return n.Value==p}),f;i.length<=0&&r.LoadPage("home");i=i[0];n.OriginID=i.Name;n.OriginName=i.Name;n.From={Flag:2,title:i.Name,description:"",image:"",originalObject:{Name:i.Name,PopCity:i.PopCity,Type:i.Type,Value:i.Value},title:i.Name};p=o[1].split("=")[1];b=Config.Api+Config.FlightCitySearchURL+p;f=u.get(b);f.then(function(t){var u=t.data.Data,i=u.filter(function(n){return n.Value==p});i.length<=0&&r.LoadPage("home");i=i[0];n.DestinationID=i.Name;n.DestinationName=i.Name;n.To={Flag:2,title:i.Name,description:"",image:"",originalObject:{Name:i.Name,PopCity:i.PopCity,Type:i.Type,Value:i.Value},title:i.Name};PushEventMessage(2);n.Search()},function(){})},function(){})}else s=n.FilterAirport(o[0].split("=")[1],1),s||r.LoadPage("home"),h=n.FilterAirport(o[1].split("=")[1],1),h||r.LoadPage("home"),n.OriginID=s.Name,n.DestinationID=h.Name,n.OriginName=s.Name,n.DestinationName=h.Name,n.From={Flag:2,title:s.Name,description:"",image:"",originalObject:{Name:s.Name,PopCity:s.PopCity,Type:s.Type,Value:s.Value},title:s.Name},n.To={Flag:2,title:h.Name,description:"",image:"",originalObject:{Name:h.Name,PopCity:h.PopCity,Type:h.Type,Value:h.Value},title:h.Name},PushEventMessage(2),n.Search();else if(w.toLowerCase().indexOf("research")>-1)if(rt=w.split("&"),n.Research=rt[rt.length-1].split("=")[1],localStorage.getItem("ChangeFlight_Request")!=""&&localStorage.getItem("ChangeFlight_Request")!=null&&localStorage.getItem("ChangeFlight_Request")!=undefined)if(n.Research=="1"){if(fnProgstart(),localStorage.getItem("SwiperArray")!="undefined"&&localStorage.getItem("SwiperArray")!=""&&localStorage.getItem("SwiperArray")!=null&&localStorage.getItem("SwiperArray")!=undefined&&(n.SwipeArrayDate=JSON.parse(localStorage.getItem("SwiperArray"))),i=JSON.parse(localStorage.getItem("ChangeFlight_Request")),d="",i.BookingType!="MULTICITY"){if(c=i.ChangeFlight,n.Adult_Count=c.AirlineSearchDetails.Adult_Count,n.Child_Count=c.AirlineSearchDetails.Child_Count,n.Infant_Count=c.AirlineSearchDetails.Infant_Count,n.TotalPax_Count=n.Adult_Count+n.Child_Count+n.Infant_Count,n.Travel_Class=c.AirlineSearchDetails.Class_Of_Travel,n.Travel_Class=="PREMIUM"&&(n.Travel_Class="PREMIUM_ECONOMY"),n.BookingType=c.AirlineSearchDetails.Booking_Type,n.RoundTrip_Fare=c.AirlineSearchDetails.Booking_Type=="SPECIALROUNDTRIP"?!0:!1,i.DealData==null&&(i.DealData=[]),n.OriginName=c.From.originalObject.Name,n.OriginID=c.From.originalObject.Name,n.DestinationName=c.To.originalObject.Name,n.DestinationID=c.To.originalObject.Name,n.From=c.From,n.To=c.To,n.Defence=c.Defence,n.OngoingDate=moment(c.AirlineSearchDetails.TripInfo[0].TravelDate,"MM/DD/YYYY").format("DD/MM/YYYY"),n.daynameMonth=getDayNameMonth(n.OngoingDate),r.ResultVisible=!0,e(function(){n.Adult_Count>0&&(n.adCharValue=n.Adult_Count+" ADT");n.Child_Count>0&&(n.cdCharValue=", "+n.Child_Count+" CHD");n.Infant_Count>0&&(n.itCharValue=", "+n.Infant_Count+" INF");(n.Child_Count==0||n.Child_Count==null)&&(n.cdCharValue="");(n.Infant_Count==0||n.Infant_Count==null)&&(n.itCharValue="");$("#ModuleName").html("<span >"+n.From.originalObject.Name.split("(")[0]+" - "+n.To.originalObject.Name.split("(")[0]+"<\/span><\/br><span class='lbl-small'> "+n.daynameMonth.split(" ")[1]+","+n.daynameMonth.split(" ")[2]+", "+n.adCharValue+n.cdCharValue+n.itCharValue+"<\/span>");r.ShowBack="Back";r.ModuleID=2},150),n.DirectFlight=c.DirectFlight,n.AirlineList=c.Airline_Name,n.SelectedDeal=i.DealData[0],r.DealData=i.DealData,n.ReturnDate="",n.MultiCity_Fare=!1,n.Travel_Type=n.GetTravelType(),n.BookingType=="ROUNDTRIP"?(n.ReturnContainerVisible=!0,n.RoundTripBarVisible=!1,n.ReturnBookButtonVisible=!1,n.daynameMonth=getDayNameMonth(n.OngoingDate),n.ReturnDate=moment(c.AirlineSearchDetails.TripInfo[1].TravelDate,"MM/DD/YYYY").format("DD/MM/YYYY"),n.daynameReturnMonth=getDayNameMonth(n.ReturnDate)):n.BookingType=="SPECIALROUNDTRIP"?(n.ReturnDate=n.ReturnDate=moment(c.AirlineSearchDetails.TripInfo[1].TravelDate,"MM/DD/YYYY").format("DD/MM/YYYY"),n.daynameReturnMonth=getDayNameMonth(n.ReturnDate),n.ReturnContainerVisible=!1,n.RoundTripBarVisible=!1,n.ReturnBookButtonVisible=!1):(n.ReturnContainerVisible=!1,n.RoundTripBarVisible=!1,n.ReturnBookButtonVisible=!1),n.GrossCommissionIsVisible=!0,n.NetFareIsVisible=!1,n.RefundableIsVisible=n.chkRefundable,n.daynameMonth=getDayNameMonth(n.OngoingDate),n.SelectedAirName=[],c.AirlineSearchDetails.Filtered_Airline!="")for(l=0;l<c.AirlineSearchDetails.Filtered_Airline.length;l++)n.SelectedAirName.push({Airline_Code:c.AirlineSearchDetails.Filtered_Airline[l].Airline_Code,Value:c.AirlineSearchDetails.Filtered_Airline[l].Airline_Code});var ut=new Date,ft=n.OngoingDate,k=ft.toString().split("/"),et=new Date(k[2]+"-"+k[1]+"-"+k[0]);for(n.DateDecrease=et>ut?!0:!1,v=sessionStorage.getItem("AirlineSearchResult"),v=LZString.decompress(v),(v==null||v==undefined||v=="")&&r.LoadPage("home"),y={},y!=null&&(ot=JSON.parse(v).length),g=0;g<ot;g++)y=JSON.parse(JSON.parse(v)[g].pstrSearchResponse),$("#hdnProcessID").val(y.Response_Header.Process_Id),n.ProcessID=y.Response_Header.Process_Id,d=JSON.parse(v)[g].pstrSearchResponse,n.OnwardVisible=!1,n.ReturnVisible=!1,n.SearchBoxIsVisible=!1,n.ShowTopPackageList=!1,n.SearchDummyIsVisible=!0,n.ResultHeaderVisible=!0,n.FilterHeaderVisible=!1,n.chkRefundable=!0,n.FilterCollapse=!1,n.SearchResult(d)}else{for(n.TripList=[],n.BookingType="MULTICITY",n.MultiCity_Fare=!1,i=JSON.parse(localStorage.getItem("ChangeFlight_Request")),n.BindMultiCity(i.ChangeFlight),n.Adult_Count=i.ChangeFlight[0].AdultCount,n.Child_Count=i.ChangeFlight[0].ChildCount,n.Infant_Count=i.ChangeFlight[0].InfantCount,n.TotalPax_Count=n.Adult_Count+n.Child_Count+n.Infant_Count,n.OriginID=i.ChangeFlight[0].Origin,n.OriginName=i.ChangeFlight[0].Origin,n.OriginCode=i.ChangeFlight[0].OriginCode,n.Origin_City=i.ChangeFlight[0].Origin,n.DestinationID=i.ChangeFlight[0].Destination,n.DestinationCode=i.ChangeFlight[0].DestinationCode,n.Destination_City=i.ChangeFlight[0].Destination,n.DestinationName=i.ChangeFlight[0].Destination,n.OngoingDate=i.ChangeFlight[0].OngoingDate,n.DirectFlight=i.ChangeFlight[0].ChangeFlight,n.Defence=i.ChangeFlight[0].Defence,n.AirlineList=i.Airline_Name,v=sessionStorage.getItem("AirlineSearchResult"),v=LZString.decompress(v),y=JSON.parse(v),n.MultiTrips=y,l=0;l<y.length;l++)y[l].ThreadIndex==0&&($("#hdnProcessID").val(JSON.parse(y[l].SearchResponse).Response_Header.Process_Id),n.ProcessID=JSON.parse(y[l].SearchResponse).Response_Header.Process_Id,d=y[l].SearchResponse),n.TripList.push({Index:l,Status:1,OriginID:i.ChangeFlight[l].Origin,DestinationID:i.ChangeFlight[l].Destination,OngoingDate:i.ChangeFlight[l].OngoingDate});n.OpenTrip(n.TripList);n.OnwardVisible=!1;n.ReturnVisible=!1;n.SearchBoxIsVisible=!1;n.ShowTopPackageList=!1;n.SearchDummyIsVisible=!0;n.ResultHeaderVisible=!0;n.FilterHeaderVisible=!1;n.chkRefundable=!0;n.FilterCollapse=!1;n.SearchResult(d)}e(function(){n.$broadcast("rzSliderForceRender")},1e3);fnProgstop()}else if(n.Research=="2"){if(a=JSON.parse(localStorage.getItem("ChangeFlight_Request")),n.OriginName=a.From.originalObject.Name,n.OriginID=a.From.originalObject.Name,n.DestinationName=a.To.originalObject.Name,n.DestinationID=a.To.originalObject.Name,n.From=a.From,n.To=a.To,n.DirectFlight=a.DirectFlight,n.AirlineList=a.Airline_Name,n.OngoingDate=moment(a.AirlineSearchDetails.TripInfo[0].TravelDate,"MM/DD/YYYY").format("DD/MM/YYYY"),n.ReturnDate="",n.MultiCity_Fare=!1,n.HostSearch=!0,n.Defence=a.Defence,n.Adult_Count=a.AirlineSearchDetails.Adult_Count,n.Child_Count=a.AirlineSearchDetails.Child_Count,n.Infant_Count=a.AirlineSearchDetails.Infant_Count,n.Travel_Class=a.AirlineSearchDetails.Class_Of_Travel,n.BookingType=a.AirlineSearchDetails.Booking_Type,n.Travel_Type=a.AirlineSearchDetails.Travel_Type,n.Travel_Type=n.GetTravelType(),n.BookingType=="ROUNDTRIP"?(n.ReturnContainerVisible=!0,n.RoundTripBarVisible=!1,n.ReturnBookButtonVisible=!1,n.daynameMonth=getDayNameMonth(n.OngoingDate),n.ReturnDate=moment(a.AirlineSearchDetails.TripInfo[1].TravelDate,"MM/DD/YYYY").format("DD/MM/YYYY"),n.daynameReturnMonth=getDayNameMonth(n.ReturnDate)):n.BookingType=="SPECIALROUNDTRIP"?(n.ReturnDate=n.ReturnDate=moment(a.AirlineSearchDetails.TripInfo[1].TravelDate,"MM/DD/YYYY").format("DD/MM/YYYY"),n.daynameReturnMonth=getDayNameMonth(n.ReturnDate),n.ReturnContainerVisible=!1,n.RoundTripBarVisible=!1,n.ReturnBookButtonVisible=!1):(n.ReturnContainerVisible=!1,n.RoundTripBarVisible=!1,n.ReturnBookButtonVisible=!1),n.GrossCommissionIsVisible=!0,n.NetFareIsVisible=!1,n.RefundableIsVisible=n.chkRefundable,n.daynameMonth=getDayNameMonth(n.OngoingDate),n.SelectedAirName=[],a.AirlineSearchDetails.Filtered_Airline!="")for(l=0;l<a.AirlineSearchDetails.Filtered_Airline.length;l++)n.SelectedAirName.push({Airline_Code:a.AirlineSearchDetails.Filtered_Airline[l].Airline_Code,Value:a.AirlineSearchDetails.Filtered_Airline[l].Airline_Code});var ut=new Date,ft=n.OngoingDate,k=ft.toString().split("/"),et=new Date(k[2]+"-"+k[1]+"-"+k[0]);n.DateDecrease=et>ut?!0:!1;n.OnwardVisible=!1;n.ReturnVisible=!1;n.SearchBoxIsVisible=!1;n.ShowTopPackageList=!1;n.SearchDummyIsVisible=!0;n.ResultHeaderVisible=!0;n.FilterHeaderVisible=!1;n.chkRefundable=!0;n.FilterCollapse=!1;n.FlightSearch()}else r.LoadPage("home");else r.LoadPage("home");else if(w.toLowerCase().indexOf("reschedule")>-1)w.split("=")[1]=="1"?localStorage.getItem("RescheduleFlightObject")!=""&&localStorage.getItem("RescheduleFlightObject")!="undefined"&&localStorage.getItem("RescheduleFlightObject")!=undefined&&localStorage.getItem("RescheduleFlightObject")!="null"&&localStorage.getItem("RescheduleFlightObject")!=null?n.RescheduleSearch():r.LoadPage("home"):w.split("=")[1]=="2"?(nt=localStorage.getItem("FlightRescheduleObject"),(nt==null||nt==""||nt==undefined)&&r.LoadPage("home"),n.ConfirmReschedulePGBooking()):r.LoadPage("home");else if(o=t.MetaSearch.split("-"),o.length<2&&r.LoadPage("home"),s=n.FilterAirport(o[0],2),h=n.FilterAirport(o[1],2),s==null||s==undefined&&h==null||h==undefined){var p=o[0],b=Config.Api+Config.FlightCitySearchURL+p,it=u.get(b);it.then(function(t){var s=t.data.Data,i,h;s.length==0&&r.LoadPage("home");i=s.filter(function(n){if(n.Name.toUpperCase().indexOf(p.toUpperCase())>-1)return n});i=i[0];n.OriginID=i.Name;n.OriginName=i.Name;n.From={Flag:2,title:i.Name,description:"",image:"",originalObject:{Name:i.Name,PopCity:i.PopCity,Type:i.Type,Value:i.Value},title:i.Name};p=o[1];b=Config.Api+Config.FlightCitySearchURL+p;h=u.get(b);h.then(function(t){var o=t.data.Data,u;o.length==0&&r.LoadPage("home");u=o.filter(function(n){if(n.Name.toUpperCase().indexOf(p.toUpperCase())>-1)return n});u=u[0];n.DestinationID=u.Name;n.DestinationName=u.Name;n.To={Flag:2,title:u.Name,description:"",image:"",originalObject:{Name:u.Name,PopCity:u.PopCity,Type:u.Type,Value:u.Value},title:u.Name};(i==null||i==undefined||i==""||u==null||u==undefined||u=="")&&r.LoadPage("home");e(function(){f.scrollTo(0,0);Config.ChannelId!=3?n.OpenModifySearch():n.DPOnFocus(0)},200)},function(){r.LoadPage("home")})},function(){r.LoadPage("home")})}else n.OriginID=s.Name,n.DestinationID=h.Name,n.OriginName=s.Name,n.DestinationName=h.Name,n.From={Flag:2,title:s.Name,description:"",image:"",originalObject:{Name:s.Name,PopCity:s.PopCity,Type:s.Type,Value:s.Value},title:s.Name},n.To={Flag:2,title:h.Name,description:"",image:"",originalObject:{Name:h.Name,PopCity:h.PopCity,Type:h.Type,Value:h.Value},title:h.Name},e(function(){f.scrollTo(0,0);var t=new Date;if(t.setDate(t.getDate()+4),n.OngoingDate=moment(t).format("DD/MM/YYYY"),n.SearchHeader="BOOK "+s.Name.split("(")[0]+" TO "+h.Name.split("(")[0]+" FLIGHTS",$("#ModuleName").html("<span>BOOK "+s.Name.split("(")[0]+" - "+h.Name.split("(")[0]+" FLIGHTS<\/span><\/br><span class='lbl-small'> "+n.FormatDate(n.OngoingDate,"DD/MM/YYYY","ddd, DD MMM YYYY")+", "+n.adCharValue+n.cdCharValue+n.itCharValue+"<\/span>"),o.length==4)return n.FooterOriginID=s.Name,n.FooterDestinationID=h.Name,n.FooterLinkSearch(s.Value,h.Value,n.OngoingDate,0),!1;n.Search()},200);n.CheckResponsive()}else r.LoadPage("home")}catch(ct){fnProgstop()}};n.FooterLinkSearch=function(t,i,u,f,e){if(f==0)n.FilterHeaderVisible=!1,n.FilterVisible=!1,n.OnwardVisible=!1,n.ReturnVisible=!1,n.ResultHeaderVisible=!1,n.FooterSearchBoxIsVisible=!0,n.ShowTopPackageList=!0,n.AirlineSearchIsVisible=!0,n.GetLowFare(t,i,u),r.ModuleID=1,n.IsBlogSearch=!1;else{var o=e.TravelDate.substring(2,4)+"-"+e.TravelDate.substring(0,2)+"-"+e.TravelDate.substring(4,8),s="origin="+t.split(" ")[1].split("(")[1].split(")")[0]+"&destination="+i.split(" ")[1].split("(")[1].split(")")[0]+"&onward="+o+"&return=&type=ONE_WAY&class=ECONOMY&adult=1&child=0&infant=0&direct=false&discount=false&nocache=false&defence=false&originName="+t.split("(")[0].toLowerCase()+"&destinationName="+i.split("(")[0].toLowerCase();r.LoadPage("flights/"+s)}};n.GetLowFare=function(t,i,r){var e=r.split("/")[1]+"/"+r.split("/")[0]+"/"+r.split("/")[2],f;n.PFCalendar={Header:n.GetHeader(n.ProcessID),Origin:t,Destination:i,TravelDate:e,Type:"",DoubleMonth:""};fnProgstart();f=u({method:"POST",url:Config.Api+"Trading/LowFareData",dataType:"json",data:n.PFCalendar,headers:{"Content-Type":"application/json"}});f.then(function(t){var i;try{if(fnProgstop(),i=t.data,i.Status=="1"){n.LowFare=i.Data.Table;var r=n.LowFare,u=FilterDate(r),f=u.sort(function(n,t){return n.Amount-t.Amount});n.LowFare=f}else return n.LowFare=[],!1}catch(e){}},function(n){ShowAlert(n)})};n.LoadDropList();n.Depart_time_Oneway=[{display_text:"00 - 06",text_time:"00 - 06",img_time:"brightness_4"},{display_text:"06 - 12",text_time:"06 - 12",img_time:"brightness_5"},{display_text:"12 - 18",text_time:"12 - 18",img_time:"filter_drama"},{display_text:"18 - 00",text_time:"18 - 25",img_time:"brightness_2"}];n.Arrival_time_Oneway=[{display_text:"00 - 06",text_time:"00 - 06",img_time:"brightness_4"},{display_text:"06 - 12",text_time:"06 - 12",img_time:"brightness_5"},{display_text:"12 - 18",text_time:"12 - 18",img_time:"filter_drama"},{display_text:"18 - 00",text_time:"18 - 25",img_time:"brightness_2"}];n.selection_Oneway=[];$("#MoreFilterShow").on("click",function(n){n.stopPropagation()});n.CloseFilter=function(){$("#MoreFilterShow").fadeOut("show")};n.OpenFilter=function(){$("#MoreFilterShow").fadeToggle("show");e(function(){n.$broadcast("rzSliderForceRender")},1e3)};n.toggle_Oneway=function(t,i){try{var r=n.selection_Oneway.indexOf(i);r==-1?n.selection_Oneway.push(i):n.selection_Oneway.splice(r,1);n.Filter()}catch(u){}};n.selection_Arrival=[];n.toggle_Arrival=function(t,i){try{var r=n.selection_Arrival.indexOf(i);r==-1?n.selection_Arrival.push(i):n.selection_Arrival.splice(r,1);n.Filter()}catch(u){}};n.Depart_time_Twoway=[{display_text:"00 - 06",text_time:"00 - 06",img_time:"brightness_4"},{display_text:"06 - 12",text_time:"06 - 12",img_time:"brightness_5"},{display_text:"12 - 18",text_time:"12 - 18",img_time:"filter_drama"},{display_text:"18 - 00",text_time:"18 - 25",img_time:"brightness_2"}];n.selection_Twoway=[];n.toggle_Twoway=function(t,i){try{var r=n.selection_Twoway.indexOf(i);r==-1?n.selection_Twoway.push(i):n.selection_Twoway.splice(r,1);n.Filter()}catch(u){}};n.CollapseDetail=function(t,i){try{i==1?(n.SelectedIndex=t,n.CollapseView=n.CollapseView==t?-1:t,n.CollapseView!=-1?(n["plus_"+t]=!0,n.CollapseViewDetails=!0):(n.CollapseViewDetails=!1,n["plus_"+t]=!1)):(n.SelectedIndex=t,n.CollapseViews=n.CollapseViews==t?-1:t,n.CollapseViews!=-1?(n.CollapseViewDetail=!0,n["plus_"+t]=!0):(n.CollapseViewDetail=!1,n["plus_"+t]=!1))}catch(r){}};n.LimitedValue=3;$(window).scroll(function(){$(this).scrollTop()>100?$(".Scrollcontrol").css({bottom:"30px"}):$(".Scrollcontrol").css({bottom:"-100px"})});$(".Scrollcontrol").click(function(){return $("html, body").animate({scrollTop:"0px"},800),!1});n.RouteReplace=function(t){try{var u="",i="",f="",r="";if(t=="0"){if(n.FirstFrom==""||n.FirstFrom=="undefined"||n.FirstFrom==null||n.FirstTo==""||n.FirstTo=="undefined"||n.FirstTo==null||n.FirstTo.originalObject.Value==n.FirstFrom.originalObject.Value)return!1;i=n.FirstTo.originalObject.Name;r=n.FirstFrom.originalObject.Name;u=n.FirstTo.originalObject.Value;FirstDestinationID=n.FirstFrom.originalObject.Value;n.FirstOriginID=i;n.FirstDestinationID=r;n.FirstOriginName=i;n.FirstDestinationName=r;n.FirstFrom.originalObject.Name=i;n.FirstFrom.originalObject.Value=u;n.FirstTo.originalObject.Name=r;n.FirstTo.originalObject.Value=FirstDestinationID;n.iconrotate0=!n.iconrotate0}else if(t=="1"){if(n.SecondFrom==""||n.SecondFrom=="undefined"||n.SecondFrom==null||n.SecondTo==""||n.SecondTo=="undefined"||n.SecondTo==null||n.SecondTo.originalObject.Value==n.SecondFrom.originalObject.Value)return!1;i=n.SecondTo.originalObject.Name;r=n.SecondFrom.originalObject.Name;u=n.SecondTo.originalObject.Value;SecondDestinationID=n.SecondFrom.originalObject.Value;n.SecondOriginID=i;n.SecondDestinationID=r;n.SecondOriginName=i;n.SecondDestinationName=r;n.SecondFrom.originalObject.Name=i;n.SecondFrom.originalObject.Value=u;n.SecondTo.originalObject.Name=r;n.SecondTo.originalObject.Value=SecondDestinationID;n.iconrotate1=!n.iconrotate1}else if(t=="2"){if(n.ThridFrom==""||n.ThridFrom=="undefined"||n.ThridFrom==null||n.ThridTo==""||n.ThridTo=="undefined"||n.ThridTo==null||n.ThridTo.originalObject.Value==n.ThridFrom.originalObject.Value)return!1;i=n.ThridTo.originalObject.Name;r=n.ThridFrom.originalObject.Name;u=n.ThridTo.originalObject.Value;ThridDestinationID=n.ThridFrom.originalObject.Value;n.ThridOriginID=i;n.ThridDestinationID=r;n.ThridOriginName=i;n.ThridDestinationName=r;n.ThridFrom.originalObject.Name=i;n.ThridFrom.originalObject.Value=u;n.ThridTo.originalObject.Name=r;n.ThridTo.originalObject.Value=ThridDestinationID;n.iconrotate2=!n.iconrotate2}else if(t=="3"){if(n.FourthFrom==""||n.FourthFrom=="undefined"||n.FourthFrom==null||n.FourthTo==""||n.FourthTo=="undefined"||n.FourthTo==null||n.FourthTo.originalObject.Value==n.FourthFrom.originalObject.Value)return!1;i=n.FourthTo.originalObject.Name;r=n.FourthFrom.originalObject.Name;u=n.FourthTo.originalObject.Value;FourthDestinationID=n.FourthFrom.originalObject.Value;n.FourthOriginID=i;n.FourthDestinationID=r;n.FourthOriginName=i;n.FourthDestinationName=r;n.FourthFrom.originalObject.Name=i;n.FourthFrom.originalObject.Value=u;n.FourthTo.originalObject.Name=r;n.FourthTo.originalObject.Value=FourthDestinationID;n.iconrotate3=!n.iconrotate3}else{if(n.From==""||n.From=="undefined"||n.From==null||n.To==""||n.To=="undefined"||n.To==null||n.To.originalObject.Value==n.From.originalObject.Value)return!1;i=n.To.originalObject.Name;r=n.From.originalObject.Name;u=n.To.originalObject.Value;f=n.From.originalObject.Value;n.OriginID=i;n.DestinationID=r;n.OriginName=i;n.DestinationName=r;n.From.originalObject.Name=i;n.From.originalObject.Value=u;n.To.originalObject.Name=r;n.To.originalObject.Value=f;n.iconrotate=!n.iconrotate}}catch(e){}};n.FareRule=function(t,i,r,f){var e,o;try{if($("#FareRuleDetailsVisible").modal("show"),n.FareRuleHtml="",r==1){for(n.FareRuleObject="",n.FareRuleFlights=t,e=0;e<t.Segments.length;e++)n["Showtick"+e]=!1;n.FareRule(t,0,2,0)}else{for(e=0;e<t.Segments.length;e++)n["Showtick"+e]=!1;n["Showtick"+i]=!0;f==0?i==0?(fnProgstart(),n.AirFareRuleRequest={Header:n.GetHeader(n.ProcessID),FareRuleRequest:{Search_Key:n.SearchKey,Flight_Key:t.Flight_Key,Fare_Key:t.SelectedFare.Fare_Key}},o=u({method:"POST",url:Config.Api+"FlightHistory/FareRule",dataType:"json",data:n.AirFareRuleRequest,headers:{"Content-Type":"application/json"}}),o.then(function(t){try{f=1;fnProgstop();t.data.Status=="1"?(n.FareRuleObject=t.data,n.FareRuleHtml=h.trustAsHtml(n.FareRuleObject.Data.FareRules[i].FareRuleDesc)):(fnProgstop(),alert(t.data.Data.Response_Header.Error_InnerException))}catch(r){fnProgstop()}},function(n){console.log(n.data.Data);ShowAlert("Something went wrong.. Pls Try again");fnProgstop()})):n.FareRuleHtml=h.trustAsHtml(n.FareRuleObject.Data.FareRules[i].FareRuleDesc):n.FareRuleHtml=h.trustAsHtml(n.FareRuleObject.Data.FareRules[i].FareRuleDesc)}}catch(c){}};n.Travel_Details=!1;n.TravellerDropdown=function(t){try{n.ClearResults();n.DateOnShow=!1;n.DateRetShow=!1;t==undefined?(n.Travel_Details=!n.Travel_Details,n.TravellerDetailsVisible=n.Travel_Details==!0?!0:!1):(n.Travel_Details=!n.Travel_Details,n["TravellerDetailsVisible_"+t]=n.Travel_Details==!0?!0:!1)}catch(i){}};r.TravellerDropClose=function(){try{n.TravellerDetailsVisible=!1;n.ResultHeaderVisible&&(Config.ChannelId=="3"&&(n.SearchBoxIsVisible=!0,n.ResultHeaderVisible=!1),n.ShowTopPackageList=!0)}catch(t){}};n.SelectedFlightID=[];n.InsertLowFare=function(t){var i,r,f,e,s;try{if(t==1){i=n.OriginID.split("(")[1].split(")")[0];r=n.DestinationID.split("(")[1].split(")")[0];Config.ChannelId!=3&&(i=n.OriginName.split("(")[1].split(")")[0],r=n.DestinationName.split("(")[1].split(")")[0]);var o=moment(n.OngoingDate,"DD/MM/YYYY").format("MM/DD/YYYY").replace("/","").replace("/",""),f=n.LowestPriceAirLine,e=n.LowestPrice}else t==2&&(i=n.DestinationID.split("(")[1].split(")")[0],r=n.OriginID.split("(")[1].split(")")[0],Config.ChannelId!=3&&(i=n.OriginName.split("(")[1].split(")")[0],r=n.DestinationName.split("(")[1].split(")")[0]),o=moment(n.ReturnDate,"DD/MM/YYYY").format("MM/DD/YYYY").replace("/","").replace("/",""),f=n.LowestPriceAirLine_Return,e=n.LowestPrice_Return);n.lobjLowFareRequest={Header:n.GetHeader(n.ProcessID),Origin:i,Destination:r,TravelDate:o,AirlineCode:f,Amount:e};s=u({method:"POST",url:Config.Api+"FlightSearch/PushLowFare",dataType:"json",data:n.lobjLowFareRequest,headers:{"Content-Type":"application/json"}});s.then(function(n){try{var t=n.data;t.Status=="1"||(t.Status=="100"||t.Status?fnSessionTimeOut():t.Status=="101"&&fnInvalidSession(t.StatusDesc))}catch(i){}},function(){})}catch(c){}};n.BindRecentSearch=function(t){var e,u,i,f,r;try{n.RecentSearch=JSON.parse($("#RecSearch_"+t).attr("data-recent"));n.RecentSearch[0].BookingType!="MULTICITY"?(n.SelectedRecentSearch=n.RecentSearch[0],n.Booking_Type=n.SelectedRecentSearch.BookingType,n.BookingType=n.SelectedRecentSearch.BookingType,n.SelectedRecentSearch.BookingType=="SPECIALROUNDTRIP"&&(n.RoundTrip_Fare=!0),n.RBL_BookingType(n.BookingType),n.OriginID=n.SelectedRecentSearch.Origin,n.OriginName=n.SelectedRecentSearch.Origin,n.OriginCode=n.SelectedRecentSearch.OriginCode,n.Origin_City=n.SelectedRecentSearch.Origin,n.DestinationID=n.SelectedRecentSearch.Destination,n.DestinationCode=n.SelectedRecentSearch.DestinationCode,n.Destination_City=n.SelectedRecentSearch.Destination,n.DestinationName=n.SelectedRecentSearch.Destination,e=moment(n.SelectedRecentSearch.OngoingDate,"DD/MM/YYYY").format("MM/DD/YYYY"),n.OngoingDate=moment(moment().format("MM/DD/YYYY")).isAfter(e)?moment().format("DD/MM/YYYY"):n.SelectedRecentSearch.OngoingDate,n.SelectedAirName=[],n.SelectedRecentSearch.Airline!=""&&n.SelectedAirName.push({Airline_Code:n.SelectedRecentSearch.Airline,Value:n.SelectedRecentSearch.Airline}),(n.BookingType=="ROUNDTRIP"||n.BookingType=="SPECIALROUNDTRIP")&&(n.ReturnDate=n.SelectedRecentSearch.ReturnDate),n.Travel_Type=n.SelectedRecentSearch.TravelType,n.From={},u={},i={},i.Name=n.SelectedRecentSearch.Origin,i.Value=n.SelectedRecentSearch.OriginCode,i.Type=n.SelectedRecentSearch.OriginType,u.originalObject=i,n.From=u,n.To={},f={},r={},r.Name=n.SelectedRecentSearch.Destination,r.Value=n.SelectedRecentSearch.DestinationCode,r.Type=n.SelectedRecentSearch.DestinationType,f.originalObject=r,n.To=f,n.Adult_Count=parseInt(n.SelectedRecentSearch.AdultCount),n.Child_Count=parseInt(n.SelectedRecentSearch.ChildCount),n.Infant_Count=parseInt(n.SelectedRecentSearch.InfantCount),n.FliterAirlineList(),setTimeout(function(){$(".orgin").find("input").focus();n.SelectedRecentSearch.BookingType=="ROUNDTRIP"&&(n.RoundTrip_Fare=!1)},500)):(n.RBL_BookingType(n.RecentSearch[0].BookingType),n.Adult_Count=parseInt(n.RecentSearch[0].AdultCount),n.Child_Count=parseInt(n.RecentSearch[0].ChildCount),n.Infant_Count=parseInt(n.RecentSearch[0].InfantCount),n.BindMultiCity(n.RecentSearch))}catch(o){}};n.DPOnFocus=function(t){var i;try{if(i="",t==0){if(i=n.OngoingDate,i.trim()==""){var r=new Date,u=r.getMonth()+1,f=r.getFullYear(),o=r.getDate();i=o+"/"+u+"/"+f}}else if(i=n.ReturnDate,i.trim()==""&&(i=n.OngoingDate,i.trim()=="")){var r=new Date,u=r.getMonth()+1,f=r.getYear(),o=r.getDate();i=o+"/"+u+"/"+f}var s=parseInt(i.split("/")[1])+1,h=parseInt(i.split("/")[1])+","+s,c=parseInt(i.split("/")[2]);n.DateClose(t,2);n.BuildEmptyCalender(i,t);n.From&&n.To&&n.From.originalObject.Value!=""&&n.From.originalObject.Value!=undefined&&n.To.originalObject.Value!=""&&n.To.originalObject.Value!=undefined&&e(function(){n.SearchLowFare(t,"","")},500);n.ResultHeaderVisible||n.ClearResults();Config.ChannelId!=3&&n.OpenAirDates(1,t);n.FliterAirlineList()}catch(l){}};n.MDPOnFocus=function(t){var i;try{if(i="",t==1?i=n.MultiCityOngoingDate:t==2?i=n.FirstOngoingDate:t==3?i=n.SecondOngoingDate:t==4?i=n.ThridOngoingDate:t==5&&(i=n.FourthOngoingDate),i.trim()==""){var r=new Date,u=r.getMonth()+1,f=r.getFullYear(),o=r.getDate();i=o+"/"+u+"/"+f}var s=parseInt(i.split("/")[1])+1,h=parseInt(i.split("/")[1])+","+s,c=parseInt(i.split("/")[2]);n.DateClose(0,2);n.BuildEmptyCalender(i,t);n.From.originalObject.Value!=""&&n.From.originalObject.Value!=undefined&&n.To.originalObject.Value!=""&&n.To.originalObject.Value!=undefined&&e(function(){n.SearchLowFare(2,"","",t)},250);n.ResultHeaderVisible||n.ClearResults()}catch(l){}};n.BuildEmptyCalender=function(t,i){var y,l,a,u,s,c;try{var f="",r="",v=2;for(Config.ChannelId!=3&&(v=1),n.DoubleMonthCheck="",r=t.split("/")[1],f=t.split("/")[2],y=r.length>1?r:"0"+r,n.DoubleMonthCheck+=y+"~"+f,l="",a=0;a<v;a++){var e=0,h="",p=new Date(f,r-1,1),o=fnGetDaybyText(p.getDay());for(o=="MONDAY"?e=0:o=="TUESDAY"?e=1:o=="WEDNESDAY"?e=2:o=="THURSDAY"?e=3:o=="FRIDAY"?e=4:o=="SATURDAY"?e=5:o=="SUNDAY"&&(e=6),u=31,r==1?u=31:r==2?u=leapYear(f)==!0?29:28:r==3?u=31:r==4?u=30:r==5?u=31:r==6?u=30:r==7?u=31:r==8?u=31:r==9?u=30:r==10?u=31:r==11?u=30:r==12&&(u=31),s=1,s=1;s<=u;s++)h+=r+"/"+s.toString()+"/"+f+"$$@";h="1|"+h;l+="1|"+e+"|"+u+"|"+o+h+"|!"+r+"!"+f+"!"+i+"~";r=="12"?(r="01",f=parseInt(f)+1,n.DoubleMonthCheck+=","+r+"~"+f):(r=parseInt(r)+1,r<10&&(r="0"+r.toString()),n.DoubleMonthCheck+=","+r+"~"+f)}c=n.DoubleMonthCheck.split(",");n.DoubleMonthCheck=c[0]+","+c[1];Config.ChannelId!=3&&(n.DoubleMonthCheck=c[0]);n.BuildCalender(l,i)}catch(w){console.log(w)}};n.BuildCalender=function(t,i){var lt,s,c,v,y,l,g,nt,et,ot,st;try{var r=t.split("~"),tt=r[0].split("|")[r[0].split("|").length-1].split("!")[1].length>1?r[0].split("|")[r[0].split("|").length-1].split("!")[1]:"0"+r[0].split("|")[r[0].split("|").length-1].split("!")[1],ht=tt+"~"+r[0].split("|")[r[0].split("|").length-1].split("!")[2];if(Config.ChannelId==3&&(tt=r[1].split("|")[r[1].split("|").length-1].split("!")[1].length>1?r[1].split("|")[r[1].split("|").length-1].split("!")[1]:"0"+r[1].split("|")[r[1].split("|").length-1].split("!")[1],ht+=","+tt+"~"+r[1].split("|")[r[1].split("|").length-1].split("!")[2]),n.DoubleMonthCheck!=ht)return!1;var h="",it="",rt="",ut="",ct=new Date,w=0;for(w=ct.getMonth(),w=w+1,lintYear=ct.getFullYear(),lt=parseInt(lintYear),s=0;s<r.length-1;s++)if(c="",c=r[s],v=r[s],v=v.split("!"),c=c.split("|"),y=c[4],c[0]=="1"){var p="",at=0,a=0,f=0,b=0;b=parseInt(c[1]);at=parseInt(c[2]);var u=v[1],o=v[2],e=v[3];for(l=0;l<at;l++)if(a==0&&(p+="<tr>"),a==7&&(p+="<\/tr>",a=0),b!=0)p+="<td><\/td>",b=b-1,a=a+1,l=l-1;else{f=f+1;var k="",vt=new Date(u+"/"+f+"/"+o),ft=new Date,yt=ft.getMonth()+1,d=new Date(yt+"/"+ft.getDate()+"/"+ft.getFullYear());n.BookingType!="MULTICITY"?e=="0"?(g=new Date,d=new Date(g.getMonth()+1+"/"+g.getDate()+"/"+g.getFullYear())):d=new Date(n.OngoingDate.split("/")[1]+"/"+n.OngoingDate.split("/")[0]+"/"+n.OngoingDate.split("/")[2]):(k=i==1?n.MultiCityOngoingDate.split("/"):i==2?n.FirstOngoingDate.split("/"):i==3?n.SecondOngoingDate.split("/"):i==4?n.ThridOngoingDate.split("/"):i==5?n.FourthOngoingDate.split("/"):n.ldateTempTwoTemp.split("/"),d=new Date(k[1]+"/"+k[0]+"/"+k[2]));nt=moment();nt.add("1","year");nt.subtract("6","day");et=nt.diff(vt,"days");p+=vt<d||et<0?"<td class='dis_Cells'><span class='spn_low_cell'>"+f+"<\/span><\/td>":y!=""?y.split("@")[l].split("$")[1]!=""&&y.split("@")[l].split("$")[1]!=0?"<td class='cnt_Cells' ng-click='SetDate(\""+f+'","'+e+'" ,"'+u+'" ,"'+o+'" ,"'+i+"\");'><table cellpadding='1' cellspacing='0' border='0' align='center' style='text-align:center;'><tbody><tr><td class='spMed spn_low_cell'>"+f+"<\/td><\/tr><tr><td  class='spSmall spgreen' ng-click='SetDate(\""+f+'","'+e+'","'+i+"\");'> &#8377;"+y.split("@")[l].split("$")[1].split(".")[0]+"<\/td><\/tr><\/tbody><\/table><\/td>":"<td valign='top' class='emp_Cells' ng-click='SetDate(\""+f+'","'+e+'","'+u+'" ,"'+o+'" ,"'+i+"\");'><span class='spn_low_cell'>"+f+"<\/span><\/td>":"<td valign='top' class='emp_Cells'  ng-click='SetDate(\""+f+'","'+e+'","'+u+'" ,"'+o+'" ,"'+i+"\");'><span class='spn_low_cell'>"+f+"<\/span><\/td>";a=a+1}ot="Departure";e==1&&(ot="Return");st="<div><table cellpadding='0' class='tblCalendar' cellspacing='3' border='0' align='center' style='width:100%;text-align:center;'><tr><th>Mon<\/th><th>Tue<\/th><th>Wed<\/th><th>Thu<\/th><th>Fri<\/th><th>Sat<\/th><th>Sun<\/th><\/tr>"+p+"<\/table><\/div>";s==0?(u!=parseInt(w)?rt+="<span class='left' id='ankPrev'ng-click='NavLinks(0,"+e+","+u+","+o+","+i+");' style='cursor: pointer;'> <i class='material-icons text-muted circle border-round pointer'>arrow_back<\/i> <\/span>":u!=lt&&(rt+="<span class='left' id='ankPrev'ng-click='NavLinks(0,"+e+","+u+","+o+","+i+");' style='cursor: pointer;'> <i class='material-icons text-muted circle border-round pointer'>arrow_back<\/i> <\/span>"),Config.ChannelId!=3&&(ut+="<span class='right' ng-click='NavLinks(1,"+e+","+u+","+o+","+i+");' style='cursor: pointer;'> <i class='material-icons text-muted circle border-round pointer'>arrow_forward<\/i><\/span>"),it+="<div id='divFareCalendar"+s+"' class='faretext' style='float: left;margin: 5px;width:auto;'><table cellpadding='3' cellspacing='3' style='width: 100%;'><td align='center'> <span id='spnMonth' class='spMed spn_low_cell'>"+fnGetMonthbyText(u)+" - "+o+"<\/span> <\/td><\/tr><\/table>"+st+" <\/div>"):(et>0&&(ut+="<span class='right' ng-click='NavLinks(1,"+e+","+u+","+o+","+i+");' style='cursor: pointer;'> <i class='material-icons text-muted circle border-round pointer'>arrow_forward<\/i><\/span>"),it+="<div id='divFareCalendar"+s+"' class='faretext' style='float: right;margin: 5px;width:auto;'><table cellpadding='3' cellspacing='3' style='width: 100%;'><td align='center'> <span id='spnMonth' class='spMed spn_low_cell'>"+fnGetMonthbyText(u)+" - "+o+"<\/span> <\/td><\/tr><\/table>"+st+" <\/div>");h="<div class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all modalDatePicker bar' scroll id='style-"+s+"' style='position: absolute; top: 45px; right: -50%; z-index: 1030 !important; display: block; overflow-y: hidden; overflow-x: hidden; height:380px;'><div class='dtePic-body text-center'> "+rt+"<span class='text-center' style='font-size:18px;' id='modalDateHeader'> Select "+ot+" Date<\/span> "+ut+"<\/div><div class='dtePic-body' style='margin-top: 0px !important; width: 750px; overflow:hidden;'>"+it+"<\/div><\/div>"}n.DateOnShow=!1;n.DateRetShow=!1;n.FirstDateOnShow=!1;n.SecondDateOnShow=!1;n.ThridDateOnShow=!1;n.FourthDateOnShow=!1;n.BookingType!="MULTICITY"?e=="0"?(n.ShowDateOnDetails=h,n.DateOnShow=!0):(n.ShowDateRetDetails=h,n.DateRetShow=!0):i==1?(n.ShowDateOnDetails=h,n.DateOnShow=!0):i==2?(n.FirstShowDateOnDetails=h,n.FirstDateOnShow=!0):i==3?(n.SecondShowDateOnDetails=h,n.SecondDateOnShow=!0):i==4?(n.ThridShowDateOnDetails=h,n.ThridDateOnShow=!0):i==5&&(n.FourthShowDateOnDetails=h,n.FourthDateOnShow=!0);$(".calender-box").show()}catch(pt){console.log(pt)}};n.DateClose=function(t,i){try{i==""?t==1?n.DateRetShow=!0:n.DateOnShow=!0:(n.DateRetShow=!1,n.DateOnShow=!1)}catch(r){}};n.SetLowFareLink=function(t){try{n.FilterPinnedFlights=[];n.SwipeArrayDate=[];n.OngoingDate=t;localStorage.setItem("OngoingDate",n.OngoingDate);Config.ChannelId!="3"&&n.SearchLowFareForDateLink("0","","");n.SelectedOngoingDate=t;e(function(){$("#viewContainer div").removeClass("activeDate text-white");n.FlightSearch();e(function(){$("#viewContainer").scrollCenter(".activeDate",300)},500)},500)}catch(i){}};n.SearchLowFare=function(t,i,f){var p,y,e,o,v,s,b,k;try{p=new Date;y=0;y=p.getMonth();y=y+1;var w=i,a=f,h="",c="MAA",l="";h=n.OngoingDate;i==""?n.BookingType!="MULTICITY"?t=="0"?(e=parseInt(n.OngoingDate.split("/")[2]),parseInt(n.OngoingDate.split("/")[1])!=12?o=parseInt(n.OngoingDate.split("/")[1])+1:(o=1,e=e+1),s=parseInt(n.OngoingDate.split("/")[1])+"~"+e+","+o+"~"+e,n.From!=undefined&&n.To!=undefined&&(h=n.OngoingDate,c=n.From.originalObject.Value,l=n.To.originalObject.Value)):(e=parseInt(n.ReturnDate.split("/")[2]),parseInt(n.ReturnDate.split("/")[1])!=12?o=parseInt(n.ReturnDate.split("/")[1])+1:(o=1,e=e+1),s=parseInt(n.ReturnDate.split("/")[1])+"~"+e+","+o+"~"+e,n.From!=undefined&&n.To!=undefined&&(h=n.ReturnDate,c=n.To.originalObject.Value,l=n.From.originalObject.Value)):t==1?(h=n.MultiCityOngoingDate,e=parseInt(n.MultiCityOngoingDate.split("/")[2]),parseInt(n.MultiCityOngoingDate.split("/")[1])!=12?o=parseInt(n.MultiCityOngoingDate.split("/")[1])+1:(o=1,e=e+1),s=parseInt(n.MultiCityOngoingDate.split("/")[1])+"~"+e+","+o+"~"+e,n.From!=undefined&&n.To!=undefined&&(c=n.From.originalObject.Value,l=n.To.originalObject.Value)):t==2?(e=parseInt(n.FirstOngoingDate.split("/")[2]),parseInt(n.FirstOngoingDate.split("/")[1])!=12?o=parseInt(n.FirstOngoingDate.split("/")[1])+1:(o=1,e=e+1),s=parseInt(n.FirstOngoingDate.split("/")[1])+"~"+e+","+o+"~"+e,n.FirstFrom!=undefined&&n.FirstTo!=undefined&&(h=n.MultiCityOngoingDate,c=n.FirstFrom.originalObject.Value,l=n.FirstTo.originalObject.Value)):t==3?(e=parseInt(n.SecondOngoingDate.split("/")[2]),parseInt(n.SecondOngoingDate.split("/")[1])!=12?o=parseInt(n.SecondOngoingDate.split("/")[1])+1:(o=1,e=e+1),s=parseInt(n.SecondOngoingDate.split("/")[1])+"~"+e+","+o+"~"+e,n.SecondFrom!=undefined&&n.SecondTo!=undefined&&(h=n.FirstOngoingDate,c=n.SecondFrom.originalObject.Value,l=n.SecondTo.originalObject.Value)):t==4?(e=parseInt(n.ThridOngoingDate.split("/")[2]),parseInt(n.ThridOngoingDate.split("/")[1])!=12?o=parseInt(n.ThridOngoingDate.split("/")[1])+1:(o=1,e=e+1),s=parseInt(n.ThridOngoingDate.split("/")[1])+"~"+e+","+o+"~"+e,n.ThridFrom!=undefined&&n.ThridTo!=undefined&&(h=n.SecondOngoingDate,c=n.ThridFrom.originalObject.Value,l=n.ThridTo.originalObject.Value)):t==5&&(e=parseInt(n.FourthOngoingDate.split("/")[2]),parseInt(n.FourthOngoingDate.split("/")[1])!=12?o=parseInt(n.FourthOngoingDate.split("/")[1])+1:(o=1,e=e+1),s=parseInt(n.FourthOngoingDate.split("/")[1])+"~"+e+","+o+"~"+e,n.FourthFrom!=undefined&&n.FourthTo!=undefined&&(h=n.ThridOngoingDate,c=n.FourthFrom.originalObject.Value,l=n.FourthTo.originalObject.Value)):(i!=12?(o=parseInt(i)+1,v=a):(o=1,v=a+1),s=i+"~"+v+","+o+"~"+v,n.From!=undefined&&n.To!=undefined&&(h=n.OngoingDate,c=n.From.originalObject.Value,l=n.To.originalObject.Value));t==0||t==2?i==""?(r.OnDatePickerMonth=w,r.OnDatePickerYear=a):(r.OnDatePickerMonth=i,r.OnDatePickerYear=a):i==""?(r.RetDatePickerMonth=w,r.RetDatePickerYear=a):(r.RetDatePickerMonth=i,r.RetDatePickerYear=a);Config.ChannelId!=3&&(s=s.split(",")[0]);b={Header:n.GetHeader(n.ProcessID),Origin:c,Destination:l,TravelDate:h,Type:t,DoubleMonth:s};k=u({method:"POST",url:Config.Api+"FlightSearch/LowFareDatePicker",dataType:"json",data:b,headers:{"Content-Type":"application/json"}});k.then(function(t){try{var i=t.data;i.Status=="1"&&n.BuildCalender(i.Data.Filler1,i.Data.Filler2)}catch(r){}},function(){})}catch(g){}};n.SetDate=function(t,i,r,u,f){var e,o;try{var v=new Date,l=0,l=String(r).padStart(2,"0"),a=0;if(a=u,e=l,o=parseInt(a),t.length==1&&(t="0"+t),i==0||i==2){if(f==0||f=="undefined"||f==undefined){n.OngoingDate=t+"/"+e+"/"+o;var h=new Date(e+"/"+t+"/"+o),s=n.ReturnDate.split("/"),c=new Date(s[1]+"/"+s[0]+"/"+s[2]);c<h&&(n.ReturnDate=t+"/"+e+"/"+o)}else f==1?(n.MultiCityOngoingDate=t+"/"+e+"/"+o,n.MultiDateFormat=getDayNameMonth(n.MultiCityOngoingDate),n.FirstOngoingDate=moment(n.MultiDateFormat).add(1,"days").format("DD/MM/YYYY"),n.SecondOngoingDate=moment(n.MultiDateFormat).add(2,"days").format("DD/MM/YYYY"),n.ThridOngoingDate=moment(n.MultiDateFormat).add(3,"days").format("DD/MM/YYYY"),n.FourthOngoingDate=moment(n.MultiDateFormat).add(4,"days").format("DD/MM/YYYY")):f==2?(n.FirstOngoingDate=t+"/"+e+"/"+o,n.MultiDateFormat=getDayNameMonth(n.FirstOngoingDate),n.SecondOngoingDate=moment(n.MultiDateFormat).add(1,"days").format("DD/MM/YYYY"),n.ThridOngoingDate=moment(n.MultiDateFormat).add(2,"days").format("DD/MM/YYYY"),n.FourthOngoingDate=moment(n.MultiDateFormat).add(3,"days").format("DD/MM/YYYY")):f==3?(n.SecondOngoingDate=t+"/"+e+"/"+o,n.MultiDateFormat=getDayNameMonth(n.SecondOngoingDate),n.ThridOngoingDate=moment(n.MultiDateFormat).add(1,"days").format("DD/MM/YYYY"),n.FourthOngoingDate=moment(n.MultiDateFormat).add(2,"days").format("DD/MM/YYYY")):f==4?(n.ThridOngoingDate=t+"/"+e+"/"+o,n.MultiDateFormat=getDayNameMonth(n.ThridOngoingDate),n.FourthOngoingDate=moment(n.MultiDateFormat).add(1,"days").format("DD/MM/YYYY")):f==5&&(n.FourthOngoingDate=t+"/"+e+"/"+o);var h=new Date(e+"/"+t+"/"+o),s=n.ReturnDate.split("/"),c=new Date(s[1]+"/"+s[0]+"/"+s[2]);c<h&&(n.ReturnDate=t+"/"+e+"/"+o);n.DateOnShow=!1;n.FirstDateOnShow=!1;n.SecondDateOnShow=!1;n.ThridDateOnShow=!1;n.FourthDateOnShow=!1}else n.ReturnDate=t+"/"+e+"/"+o,n.DateRetShow=!1;Config.ChannelId!=3&&($("#DateModal").modal("hide"),n.FliterAirlineList())}catch(y){}};n.NavLinks=function(t,i,u,f,o){var c,s,y,w;try{var k=new Date,h=0,p=0;h=k.getMonth();h=h+1;p=k.getFullYear();c="";s="";i==1?(c=u,s=f,y=n.OngoingDate.split("/"),w=new Date(y[1]+"/"+y[0]+"/"+y[2]),h=w.getMonth(),h=h+1,p=w.getFullYear()):(c=u,s=f);var b=c,d=s,l="",a="",v=!1;if(t==0){if(d==p&&b<=h)return;b==1?(r.RetDatePickerMonth=12,r.RetDatePickerYear=s-1,a=r.RetDatePickerYear,l=r.RetDatePickerMonth,v=!0):(r.RetDatePickerYear=String(c-1).padStart(2,"0"),l=r.RetDatePickerYear,a=s,v=!0)}else b==12?(r.OnDatePickerMonth=1,r.OnDatePickerYear=s+1,a=r.OnDatePickerYear,l=r.OnDatePickerMonth,v=!0):(r.OnDatePickerYear=String(c+1).padStart(2,"0"),l=r.OnDatePickerYear,a=s,v=!0);v==!0&&(n.BuildEmptyCalender("/"+l+"/"+a,o),e(function(){n.SearchLowFare(i,l,a)},250))}catch(g){}};n.FilterSegments=function(n,t){var r,i;try{for(r=[],i=0;i<n.Segments.length;i++)i+1<=n.Segments.length&&(t==1&&n.Segments[i].Return_Flight==!1&&r.push(n.Segments[i]),t==2&&n.Segments[i].Return_Flight==!0&&r.push(n.Segments[i]));return r}catch(u){}};n.FilterMultiFlights=function(n){var t;try{var f=[],r=[],u={},i=!1;for(t=0;t<n.Segments.length;t++)r.push(n.Segments[t]),t+1<n.Segments.length?n.Segments[t].Leg_Index!=n.Segments[t+1].Leg_Index&&(i=!0):t+1==n.Segments.length&&(i=!0),i==!0&&(u={},u.Segments=r,f.push(u),r=[],i=!1);return f}catch(e){}};n.ShowNoCacheMsg=function(){try{if(n.HostSearch==!0)ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide")},"SELECTING NO CACHE OPTION REQUIRES DIRECT COMMUNICATION WITH HOST AND MAY FURTHER DELAY YOUR RESPONSE TIME.DO YOU WANT TO CONTINUE WITH NO CACHE ?",function(){n.HostSearch=!1;$("#ConfirmationModal").modal("hide")}),n.ClearResults()}catch(t){}};n.DateOnShow=!1;n.DateRetShow=!1;n.toggleMenu=function(t){try{r.toggle_Flag=1;n.DateOnShow=!n.DateOnShow;n.DateRetShow=!n.DateRetShow;t.stopPropagation()}catch(i){}};n.PirceFilter=function(){try{var i=parseInt($(window).width()),t=parseInt($(window).height());t=t-120;document.getElementById("FareActionContent").style.height="0px";document.getElementById("FareActionModal").style.width=i>400?"15%":"75%";$("#PriceBoxSlider").show();n.ShowPirceFilter=!0}catch(r){}};n.FilterClose=function(){try{document.getElementById("FareActionModal").style.width="0";$("#PriceBoxSlider").hide()}catch(n){}};n.ShowXSShare=function(){try{var i=parseInt($(window).width()),t=parseInt($(window).height());t=t-120;document.getElementById("ShareOptionContent").style.height="0px";i>400?document.getElementById("ShareOptionModal").style.width="15%":(document.getElementById("ShareOptionModal").style.width="15%",document.getElementById("ShareOptionModal").style.height="45%");n.ShowShareOptions=!0;$("#ShareSlider").show()}catch(r){}};n.ShareClose=function(){try{document.getElementById("ShareOptionModal").style.width="0";$("#ShareSlider").hide()}catch(n){}};n.ShowXSFilter=function(){try{n.AirFilterHeaderVisible=n.AirFilterHeaderVisible==!0?!1:!0}catch(t){}};Array.prototype.getUnique=function(n){var t,i;try{if(n=n===!0?!0:!1,t=JSON.stringify(this),t=JSON.parse(t),n)return t.filter(function(n,i){return t.indexOf(n)==i}.bind(this));i=this.filter(function(n,t){return this.indexOf(n)==t}.bind(this));this.length=0;this.splice(0,0,i)}catch(r){}};n.AddMarkup={};n.GetLayOver=function(n){var t,i;try{for(t="",i=0;i<n.length-1;i++)t+=n[i].Destination_City+",";return t.substring(0,t.length-1)}catch(r){}};n.ArrivalDifference=function(n,t){try{var i=new Date(t),r=new Date(n),u=Math.abs(i.getTime()-r.getTime());return Math.ceil(u/864e5)}catch(f){}};n.MultiCityFill=function(t){var r,u,f,e,i;t==0?n.DestinationID!=""&&n.DestinationID!=undefined&&(n.FirstOriginID=n.DestinationID,n.FirstFrom={},r={},i={},i.Name=n.FirstOriginID,i.Value=n.FirstOriginID.split("(")[1].split(")")[0],n.Travel_Type=="DOMESTIC"?i.Type="H":n.Travel_Type=="INTERNATIONAL"&&(i.Type="I"),r.originalObject=i,n.FirstFrom=r):t==1?n.FirstDestinationID!=""&&n.FirstDestinationID!=undefined&&(n.SecondOriginID=n.FirstDestinationID,n.SecondFrom={},u={},i={},i.Name=n.SecondOriginID,i.Value=n.SecondOriginID.split("(")[1].split(")")[0],n.Travel_Type=="DOMESTIC"?i.Type="H":n.Travel_Type=="INTERNATIONAL"&&(i.Type="I"),u.originalObject=i,n.SecondFrom=u):t==2?n.SecondDestinationID!=""&&n.SecondDestinationID!=undefined&&(n.ThridOriginID=n.SecondDestinationID,n.ThridFrom={},f={},i={},i.Name=n.ThridOriginID,i.Value=n.ThridOriginID.split("(")[1].split(")")[0],n.Travel_Type=="DOMESTIC"?i.Type="H":n.Travel_Type=="INTERNATIONAL"&&(i.Type="I"),f.originalObject=i,n.ThridFrom=f):t==3&&n.ThridDestinationID!=""&&n.ThridDestinationID!=undefined&&(n.FourthOriginID=n.ThridDestinationID,n.FourthFrom={},e={},i={},i.Name=n.FourthOriginID,i.Value=n.FourthOriginID.split("(")[1].split(")")[0],n.Travel_Type=="DOMESTIC"?i.Type="H":n.Travel_Type=="INTERNATIONAL"&&(i.Type="I"),e.originalObject=i,n.FourthFrom=e)};n.MultiCityValidation=function(t){if(t==0)return n.FirstFrom==""||n.FirstFrom=="undefined"||n.FirstFrom==null?(ShowError("Please Enter Trip1 Origin"),!1):n.FirstOriginID==""||n.FirstOriginID=="undefined"||n.FirstOriginID==null?(ShowError("Please Enter Trip1 Origin"),!1):n.FirstTo==""||n.FirstTo=="undefined"||n.FirstTo==null?(ShowError("Please Enter Trip1 Destination"),!1):n.FirstDestinationID==""||n.FirstDestinationID=="undefined"||n.FirstDestinationID==null?(ShowError("Please Enter Trip1 Destination"),!1):n.FirstFrom.originalObject.Name==n.FirstTo.originalObject.Name?(ShowError("Trip1 Orign And Trip1 Destination Cities Are Same. Kindly Select Different Cities"),!1):n.FirstOngoingDate==""||n.FirstOngoingDate==undefined?(ShowError("Please select Trip1 onward date"),!1):!0;if(t==1)return n.SecondFrom==""||n.SecondFrom=="undefined"||n.SecondFrom==null?(ShowError("Please Enter Trip2 Origin"),!1):n.SecondOriginID==""||n.SecondOriginID=="undefined"||n.SecondOriginID==null?(ShowError("Please Enter Trip2 Origin"),!1):n.SecondTo==""||n.SecondTo=="undefined"||n.SecondTo==null?(ShowError("Please Enter Trip2 Destination"),!1):n.SecondDestinationID==""||n.SecondDestinationID=="undefined"||n.SecondDestinationID==null?(ShowError("Please Enter Trip2 Destination"),!1):n.SecondFrom.originalObject.Name==n.SecondTo.originalObject.Name?(ShowError("Trip2 Orign And Trip2 Destination Cities Are Same. Kindly Select Different Cities"),!1):n.SecondOngoingDate==""||n.SecondOngoingDate==undefined?(ShowError("Please select Trip2 onward date"),!1):!0;if(t==2)return n.ThridFrom==""||n.ThridFrom=="undefined"||n.ThridFrom==null?(ShowError("Please Enter Trip3 Origin"),!1):n.ThridOriginID==""||n.ThridOriginID=="undefined"||n.ThridOriginID==null?(ShowError("Please Enter Trip3 Origin"),!1):n.ThridTo==""||n.ThridTo=="undefined"||n.ThridTo==null?(ShowError("Please Enter Trip3 Destination"),!1):n.ThridDestinationID==""||n.ThridDestinationID=="undefined"||n.ThridDestinationID==null?(ShowError("Please Enter Trip3 Destination"),!1):n.ThridFrom.originalObject.Name==n.ThridTo.originalObject.Name?(ShowError("Trip3 Orign And Trip3 Destination Cities Are Same. Kindly Select Different Cities"),!1):n.ThridOngoingDate==""||n.ThridOngoingDate==undefined?(ShowError("Please select Trip3 onward date"),!1):!0;if(n.FirstFrom==""||n.FirstFrom=="undefined"||n.FirstFrom==null||n.FirstOriginID==""||n.FirstOriginID=="undefined"||n.FirstOriginID==null)return ShowError("Please Enter Trip1 Origin"),!1;if(n.FirstTo==""||n.FirstTo=="undefined"||n.FirstTo==null||n.FirstDestinationID==""||n.FirstDestinationID=="undefined"||n.FirstDestinationID==null)return ShowError("Please Enter Trip1 Destination"),!1;if(n.FirstFrom.originalObject.Name==n.FirstTo.originalObject.Name)return ShowError("Trip1 Orign And Trip1 Destination Cities Are Same. Kindly Select Different Cities"),!1;if(n.FirstOngoingDate==""||n.FirstOngoingDate==undefined)return ShowError("Please select Trip1 onward date"),!1;if(n.AddSecondCity==!0){if(n.SecondFrom==""||n.SecondFrom=="undefined"||n.SecondFrom==null||n.SecondOriginID==""||n.SecondOriginID=="undefined"||n.SecondOriginID==null)return ShowError("Please Enter Trip2 Origin"),!1;if(n.SecondTo==""||n.SecondTo=="undefined"||n.SecondTo==null||n.SecondDestinationID==""||n.SecondDestinationID=="undefined"||n.SecondDestinationID==null)return ShowError("Please Enter Trip2 Destination"),!1;if(n.SecondFrom.originalObject.Name==n.SecondTo.originalObject.Name)return ShowError("Trip2 Orign And Trip2 Destination Cities Are Same. Kindly Select Different Cities"),!1;if(n.SecondOngoingDate==""||n.SecondOngoingDate==undefined)return ShowError("Please select Trip2 onward date"),!1}if(n.AddThridCity==!0){if(n.ThridFrom==""||n.ThridFrom=="undefined"||n.ThridFrom==null||n.ThridOriginID==""||n.ThridOriginID=="undefined"||n.ThridOriginID==null)return ShowError("Please Enter Trip3 Origin"),!1;if(n.ThridTo==""||n.ThridTo=="undefined"||n.ThridTo==null||n.ThridDestinationID==""||n.ThridDestinationID=="undefined"||n.ThridDestinationID==null)return ShowError("Please Enter Trip3 Destination"),!1;if(n.ThridFrom.originalObject.Name==n.ThridTo.originalObject.Name)return ShowError("Trip3 Orign And Trip3 Destination Cities Are Same. Kindly Select Different Cities"),!1;if(n.ThridOngoingDate==""||n.ThridOngoingDate==undefined)return ShowError("Please select Trip3 onward date"),!1}if(n.AddFourthCity==!0){if(n.FourthFrom==""||n.FourthFrom=="undefined"||n.FourthFrom==null||n.OriginID==""||n.FourthOriginID=="undefined"||n.FourthOriginID==null)return ShowError("Please Enter Trip4 Origin"),!1;if(n.FourthTo==""||n.FourthTo=="undefined"||n.FourthTo==null||n.FourthDestinationID==""||n.FourthDestinationID=="undefined"||n.FourthDestinationID==null)return ShowError("Please Enter Trip4 Destination"),!1;if(n.FourthFrom.originalObject.Name==n.FourthTo.originalObject.Name)return ShowError("Trip4 Orign And Trip4 Destination Cities Are Same. Kindly Select Different Cities"),!1;if(n.FourthOngoingDate==""||n.FourthOngoingDate==undefined)return ShowError("Please select Trip4 onward date"),!1}return!0};n.AddAnotherCity=function(t){try{n.TripList=[];n.TravellerDropClose();var i=new Date,r=String(i.getDate()).padStart(2,"0"),u=String(i.getMonth()+1).padStart(2,"0"),f=i.getFullYear();t==0?n.MultiCityValidation(t)&&(n.FirstDateFormat=getDayNameMonth(n.FirstOngoingDate),n.SecondOngoingDate=moment(n.FirstDateFormat).add(1,"days").format("DD/MM/YYYY"),n.BtnAddFirstCity=!1,n.AddSecondCity=!0,n.BtnAddSecondCity=!0,n.BtnAddSecondCityClose=!0):t==1?n.MultiCityValidation(t)&&(n.SecondDateFormat=getDayNameMonth(n.SecondOngoingDate),n.ThridOngoingDate=moment(n.SecondDateFormat).add(1,"days").format("DD/MM/YYYY"),n.BtnAddFirstCity=!1,n.BtnAddSecondCity=!1,n.BtnAddSecondCityClose=!1,n.AddThridCity=!0,n.BtnAddThridCity=!0,n.BtnAddThridCityClose=!0):t==2&&n.MultiCityValidation(t)&&(n.ThridDateFormat=getDayNameMonth(n.ThridOngoingDate),n.FourthOngoingDate=moment(n.ThridDateFormat).add(1,"days").format("DD/MM/YYYY"),n.BtnAddFirstCity=!1,n.BtnAddSecondCity=!1,n.BtnAddSecondCityClose=!1,n.BtnAddThridCity=!1,n.BtnAddThridCityClose=!1,n.AddFourthCity=!0,n.BtnAddFourthCity=!1,n.BtnAddFourthCityClose=!0)}catch(e){}};n.RemoveAddCity=function(t){try{n.TripList=[];t==0?(n.BtnAddFirstCity=!0,n.AddSecondCity=!1,n.BtnAddSecondCity=!1,n.BtnAddSecondCityClose=!1,n.SecondOriginID="",n.SecondDestinationID=""):t==1?(n.BtnAddFirstCity=!1,n.AddSecondCity=!0,n.BtnAddSecondCity=!0,n.BtnAddSecondCityClose=!0,n.AddThridCity=!1,n.BtnAddThridCity=!1,n.BtnAddThridCityClose=!1,n.ThridOriginID="",n.ThridDestinationID=""):t==2&&(n.BtnAddFirstCity=!1,n.BtnAddSecondCity=!1,n.BtnAddSecondCityClose=!1,n.AddThridCity=!0,n.BtnAddThridCity=!0,n.BtnAddThridCityClose=!0,n.AddFourthCity=!1,n.BtnAddFourthCity=!1,n.BtnAddFourthCityClose=!1,n.FourthOriginID="",n.FourthDestinationID="")}catch(i){}};n.MultiCitySearch=function(){var r,t,i,e;try{n.SearchErrorVisible=!1;sessionStorage.setItem("AirlineSearchResult","");n.MultiTripVisible=!1;n.TripList=[];n.MultiTrips=[];n.BookingButtonValue="Select";n.Selected_Trip=0;n.Completed_Thread_Count=0;r="ONE_WAY";t=2;n.OriginID!=""&&n.DestinationID!=""&&n.OngoingDate!=""&&(n.TripList.push({Index:0,Status:0,OriginID:n.OriginID,DestinationID:n.DestinationID,OngoingDate:n.MultiCityOngoingDate}),n.MultiCity_Origin_DestinationName=n.OriginID.split("(")[1].split(")")[0]+"-->"+n.DestinationID.split("(")[1].split(")")[0]);n.FirstOriginID!=""&&n.FirstDestinationID!=""&&n.FirstOriginID!=undefined&&n.FirstDestinationID!=undefined&&n.FirstOngoingDate!=""&&(n.TripList.push({Index:1,Status:0,OriginID:n.FirstOriginID,DestinationID:n.FirstDestinationID,OngoingDate:n.FirstOngoingDate}),n.MultiCity_Origin_DestinationName=n.OriginID.split("(")[1].split(")")[0]+"-->"+n.DestinationID.split("(")[1].split(")")[0]+"-->"+n.FirstDestinationID.split("(")[1].split(")")[0],n.daynameReturnMonth=getDayNameMonth(n.FirstOngoingDate));n.SecondOriginID!=""&&n.SecondDestinationID!=""&&n.SecondOriginID!=undefined&&n.SecondDestinationID!=undefined&&n.SecondOngoingDate!=""&&(t++,n.TripList.push({Index:2,Status:0,OriginID:n.SecondOriginID,DestinationID:n.SecondDestinationID,OngoingDate:n.SecondOngoingDate}),n.MultiCity_Origin_DestinationName=n.OriginID.split("(")[1].split(")")[0]+"-->"+n.DestinationID.split("(")[1].split(")")[0]+"-->"+n.FirstDestinationID.split("(")[1].split(")")[0]+"-->"+n.SecondDestinationID.split("(")[1].split(")")[0],n.daynameReturnMonth=getDayNameMonth(n.SecondOngoingDate));n.ThridOriginID!=""&&n.ThridDestinationID!=""&&n.ThridOriginID!=undefined&&n.ThridDestinationID!=undefined&&n.ThridOngoingDate!=""&&(t++,n.TripList.push({Index:3,Status:0,OriginID:n.ThridOriginID,DestinationID:n.ThridDestinationID,OngoingDate:n.ThridOngoingDate}),n.MultiCity_Origin_DestinationName=n.OriginID.split("(")[1].split(")")[0]+"-->"+n.DestinationID.split("(")[1].split(")")[0]+"-->"+n.FirstDestinationID.split("(")[1].split(")")[0]+"-->"+n.SecondDestinationID.split("(")[1].split(")")[0]+"-->"+n.ThridDestinationID.split("(")[1].split(")")[0],n.daynameReturnMonth=getDayNameMonth(n.ThridOngoingDate));n.FourthOriginID!=""&&n.FourthDestinationID!=""&&n.FourthOriginID!=undefined&&n.FourthDestinationID!=undefined&&n.FourthOngoingDate!=""&&(t++,n.TripList.push({Index:4,Status:0,OriginID:n.FourthOriginID,DestinationID:n.FourthDestinationID,OngoingDate:n.FourthOngoingDate}),n.MultiCity_Origin_DestinationName=n.OriginID.split("(")[1].split(")")[0]+"-->"+n.DestinationID.split("(")[1].split(")")[0]+"-->"+n.FirstDestinationID.split("(")[1].split(")")[0]+"-->"+n.SecondDestinationID.split("(")[1].split(")")[0]+"-->"+n.ThridDestinationID.split("(")[1].split(")")[0]+"-->"+n.FourthDestinationID.split("(")[1].split(")")[0],n.daynameReturnMonth=getDayNameMonth(n.FourthOngoingDate));n.MultiCity_Fare==!0&&(t=1,r="MULTICITY");n.Thread_Count=t;n.PushRecentSearch();n.Thread_Count=0;n.Completed_Thread_Count=0;var o=Config.AirThreadList,s=n.GetTravelType(),f=o.B2C,h=f.International;for(s=="DOMESTIC"&&(h=f.Domestic),i=0;i<t;i++)n.AirSearchRequest={Header:n.GetHeader(n.ProcessID),ThreadIndex:i,Adult_Count:n.Adult_Count,Child_Count:n.Child_Count,Infant_Count:n.Infant_Count,Class_Of_Travel:n.Travel_Class,Excluded_Airline:[{Airline_Code:""}],Filtered_Airline:n.PushAirNameInfo(),Host_Search:n.HostSearch,Booking_Type:r,Travel_Type:n.Travel_Type,Resident_of_India:1,InventoryType:0,TripInfo:n.PushTripInfo(n.TripList,i)},e=u({method:"POST",url:Config.Api+"FlightSearch/Search",dataType:"json",data:n.AirSearchRequest,headers:{"Content-Type":"application/json"}}),e.then(function(t){var i,r;n.Completed_Thread_Count++;try{if(i=t.data,n.MultiCity_Fare==!1)if(i.Status=="1"||i.Status=="2"){var e=n.MultiTrips,u=parseInt(i.Data.Filler1),o=i.Data.Filler2,s=JSON.parse(i.Data.Filler2),f={};f.ThreadIndex=u;f.SearchResponse=o;e.push(f);n.MultiTrips=e;n.UpdateTrip(u);n.Completed_Thread_Count==n.TripList.length&&(sessionStorage.setItem("AirlineSearchResult",""),sessionStorage.setItem("AirlineSearchResult",JSON.stringify(n.MultiTrips)));u==0&&i.Status=="1"&&n.SearchResult(o)}else i.Status=="4"?fnSessionTimeOut():i.Status=="101"&&fnInvalidSession(i.StatusDesc);else i.Status=="1"?n.SearchResult(i.Data.Filler2):i.Status=="2"?(r=JSON.parse(i.Data.Filler2),ShowAlert(r.Error_Desc+". Request RefNo "+r.Request_Id,r.Error_InnerException)):i.Status=="4"?fnSessionTimeOut():i.Status=="101"&&fnInvalidSession(i.StatusDesc);n.SearchStatus()}catch(h){n.SearchStatus()}},function(){n.Completed_Thread_Count++;n.SearchStatus()})}catch(l){}};n.UpdateTrip=function(t){try{for(i=0;i<n.TripList.length;i++)n.TripList[i].Index==t&&(n.TripList[i].Status=1)}catch(r){}};n.OpenTrip=function(t){var r,i,u;try{for(r=n.MultiTrips,i=0;i<r.length;i++)r[i].ThreadIndex==t.Index&&(n.Selected_Trip=t.Index,n.OnwardTrips=[],u=JSON.parse(r[i].SearchResponse),u.Response_Header.Status_Id=="11"?(n.SearchResult(r[i].SearchResponse),n.ModifySearch=!1,n.CollapseView=-1,n.SearchDummyIsVisible=!1,n.ResultHeaderVisible=!0,n.SortingHeaderVisible=!0,n.FilterHeaderVisible=!1):(n.RequestErrorDesc=u.Response_Header.Error_Desc,n.RequestRefNo=u.Response_Header.Request_Id,n.RequestInnerException=u.Response_Header.Error_InnerException,n.SortingHeaderVisible=!1,n.FilterHeaderVisible=!1,n.ModifySearch=!1));n.ResetAll()}catch(f){}};n.BindMultiCity=function(t){var i,f,e,o,s,h,c,l,a,v,r,y,u;try{for(i=0;i<t.length;i++)i==0&&(n.From={},f={},r={},r.Name=t[i].Origin,r.Value=t[i].OriginCode,r.Type=t[i].OriginType,f.originalObject=r,n.From=f,e={},u={},u.Name=t[i].Destination,u.Value=t[i].DestinationCode,u.Type=t[i].DestinationType,e.originalObject=u,n.To=e,n.MultiCityOngoingDate=t[i].OngoingDate,n.OriginID=t[i].Origin,n.DestinationID=t[i].Destination,n.MultiCity_Origin_DestinationName=t[i].OriginCode+"-->"+t[i].DestinationCode,n.daynameReturnMonth=getDayNameMonth(t[i].OngoingDate),n.daynameMonth=getDayNameMonth(t[i].OngoingDate)),i==1&&(n.FirstFrom={},o={},r={},r.Name=t[i].Origin,r.Value=t[i].OriginCode,r.Type=t[i].OriginType,o.originalObject=r,n.FirstFrom=o,s={},u={},u.Name=t[i].Destination,u.Value=t[i].DestinationCode,u.Type=t[i].DestinationType,s.originalObject=u,n.FirstTo=s,n.FirstOngoingDate=t[i].OngoingDate,n.FirstOriginID=t[i].Origin,n.FirstDestinationID=t[i].Destination,n.SecondOriginID=t[i].Destination,n.MultiCity_Origin_DestinationName=t[0].OriginCode+"-->"+t[0].DestinationCode+"-->"+t[i].DestinationCode,n.daynameReturnMonth=getDayNameMonth(t[i].OngoingDate),n.BtnAddFirstCity=!0),t.length>2&&i==2&&(n.SecondFrom={},h={},r={},r.Name=t[i].Origin,r.Value=t[i].OriginCode,r.Type=t[i].OriginType,h.originalObject=r,n.SecondFrom=h,c={},u={},u.Name=t[i].Destination,u.Value=t[i].DestinationCode,u.Type=t[i].DestinationType,c.originalObject=u,n.SecondTo=c,n.SecondOngoingDate=t[i].OngoingDate,n.SecondOriginID=t[i].Origin,n.SecondDestinationID=t[i].Destination,n.ThridOriginID=n.SecondDestinationID,n.AddSecondCity=!0,n.MultiCity_Origin_DestinationName=t[0].OriginCode+"-->"+t[0].DestinationCode+"-->"+t[1].DestinationCode+"-->"+t[i].DestinationCode,n.daynameReturnMonth=getDayNameMonth(t[i].OngoingDate),n.BtnAddSecondCity=!0,n.BtnAddThirdCityClose=!0,n.BtnAddFirstCity=!1,n.BtnAddSecondCity=!0,n.BtnAddSecondCityClose=!0),t.length>3&&i==3&&(n.ThridFrom={},l={},r={},r.Name=t[i].Origin,r.Value=t[i].OriginCode,r.Type=t[i].OriginType,l.originalObject=r,n.ThridFrom=l,a={},u={},u.Name=t[i].Destination,u.Value=t[i].DestinationCode,u.Type=t[i].DestinationType,a.originalObject=u,n.ThridTo=a,n.ThridOngoingDate=t[i].OngoingDate,n.ThridOriginID=t[i].Origin,n.ThridDestinationID=t[i].Destination,n.FourthOriginID=n.ThridDestinationID,n.AddThridCity=!0,n.MultiCity_Origin_DestinationName=t[0].OriginCode+"-->"+t[0].DestinationCode+"-->"+t[1].DestinationCode+"-->"+t[2].DestinationCode+"-->"+t[i].DestinationCode,n.daynameReturnMonth=getDayNameMonth(t[i].OngoingDate),n.BtnAddThridCity=!0,n.BtnAddThridCity=!0,n.BtnAddSecondCity=!1,n.BtnAddSecondCityClose=!1,n.BtnAddThirdCityClose=!0),t.length>4&&i==4&&(n.FourthFrom={},v={},r={},r.Name=t[i].Origin,r.Value=t[i].OriginCode,r.Type=t[i].OriginType,v.originalObject=r,n.FourthFrom=v,y={},u={},u.Name=t[i].Destination,u.Value=t[i].DestinationCode,u.Type=t[i].DestinationType,y.originalObject=u,n.FourthTo=y,n.FourthOngoingDate=t[i].OngoingDate,n.FourthOriginID=t[i].Origin,n.FourthDestinationID=t[i].Destination,n.AddFourthCity=!0,n.MultiCity_Origin_DestinationName=t[0].OriginCode+"-->"+t[0].DestinationCode+"-->"+t[1].DestinationCode+"-->"+t[2].DestinationCode+"-->"+t[3].DestinationCode+"-->"+t[i].DestinationCode,n.daynameReturnMonth=getDayNameMonth(t[i].OngoingDate),n.BtnAddThridCity=!1,n.BtnAddFourthCity=!0,n.BtnAddThirdCityClose=!1,n.BtnAddFourthCityClose=!0,n.BtnAddFourthCity=!1)}catch(p){}};n.SelectAllClass=function(n){var i,t;try{for(i=n.FareClasses[0].ClassCodes,t=0;t<i.length;t++)i[t].Selected=n.FareClasses[0].SelectALL,i[t].ClassGroup=n.FareClasses[0].SelectALL==!0?t.toString():""}catch(r){}};n.SelectClass=function(t,i){var o,s,u,r;try{if(o=t.FareClasses,s=o.length,i.Selected==!0){if(u=n.CheckClassGroup(t,i),u!=""){var h=u.split("|"),f=parseInt(h[0]),l=parseInt(h[1]),e=n.GetClassGroup(t,f),c=0;if(e!=""){for(r=0;r<e.split("|").length;r++)if(e.split("|")[r]==i.SegmentID.toString()){i.Selected=!1;break}else c++;c==s&&(i.ClassGroup=f.toString())}else i.ClassGroup=f.toString()}}else i.ClassGroup=""}catch(a){}};n.CheckClassGroup=function(n){var t,i,r,e,u;try{var o="",f=n.FareClasses,s=f.length;for(t=0;t<15;t++){for(i=0,r=0;r<f.length;r++)for(e=f[r].ClassCodes,u=0;u<e.length;u++)if(t.toString()==e[u].ClassGroup.toString()){i++;break}if(i<s){o=t.toString()+"|"+i.toString();break}}return o}catch(h){}};n.GetClassGroup=function(n,t){var f,e,r,u,i;try{for(f=n.FareClasses,e="",r=0;r<f.length;r++)for(u=f[r].ClassCodes,i=0;i<u.length;i++)if(t.toString()==u[i].ClassGroup.toString()){e+=u[i].SegmentID+"|";break}return e}catch(o){}};n.GetClassFares=function(t,i,f){var h,a,o,c,v,s,l,e,y;try{for(h=t.FareClasses,a=[],o=0;o<h.length;o++){for(c={},v=[],c.Segment_Id=h[o].SegmentID,s=h[o].ClassCodes,l=0;l<15;l++)for(e=0;e<s.length;e++)s[e].ClassGroup==l.toString()&&s[e].Selected==!0&&v.push(s[e].ClassCode);c.ClassCodes=v;a.push(c)}n.FlightClassFareRequest={ProcessID:n.ProcessID,Trip_ID:i,Flight_Index:f,Flight_ID:t.Flight_Id,AirFlightClassFareRequest:{Search_Key:n.SearchKey,Flight_Key:t.Flight_Key,FlightClasses:a}};fnProgstart();y=u({method:"POST",url:GetPath()+"FlightSearch/ClassFare",dataType:"json",data:n.FlightClassFareRequest,headers:{"Content-Type":"application/json"}});y.then(function(t){var i,u;try{if(fnProgstop(),i=JSON.parse(t.data)[0],i.Status=="1"){var e=JSON.parse(i.Data.Filler1),o=i.Data.Filler2,s=i.Data.Filler3,h=i.Data.Filler4,f=[];for(f=o=="1"?n.OnwardTrips:n.ReturnTrips,u=0;u<f.length;u++)if(f[u].Flight_Id==s){e.FareClasses=f[u].FareClasses;f[u]=e;f[u].SelectedFare=e.Fares[0];o=="1"?n.OnwardTrips[u]=Object.assign({},f[u]):n.ReturnTrips[u]=Object.assign({},f[u]);break}}else i.Status=="2"?r.ShowProviderError(i.Data,"","Search"):i.Status=="4"?fnSessionTimeOut():i.Status=="101"?fnInvalidSession(i.StatusDesc):n.RequestErrorDesc=i.StatusDesc}catch(c){}},function(){})}catch(w){}};n.ProcessID=c.Get();n.CustomerMobileNumber="";n.GSTNumber="";n.EmailID="";n.UserInfo&&(n.CustomerMobileNumber=n.UserInfo.CustomerMobile,tempMobile=n.UserInfo.CustomerMobile,n.EmailID=n.UserInfo.EmailID,n.GSTNumber=n.UserInfo.GSTINNumber,n.HandlingChargesFlag=!1,n.UserInfo.B2BFlag&&(n.HandlingChargesFlag=!0,r.ShowRetailFare=!0,Config.TaxSplitupShow=!0,n.ShowNetFare=!0,n.ShowFullFare=!0));n.AddOn_Fees=0;r.Gateway_Charges=0;n.QuickBookClick=!1;n.QuickBooking=function(t,i,u){try{n.lstrPGMode="";n.PG_Mode=[];r.Gateway_Charges=0;n.TransType="B";r.Biller_Id=i.Biller_Id;r.SupplierId=i.Supplier_Id;r.SubbillerCode=i.Airline_Code;n.BookingType=="ROUNDTRIP"&&(r.Biller_Id=n.FlightBooking.Trips[0].Biller_Id,r.SupplierId=n.FlightBooking.Trips[0].Supplier_Id,r.SubbillerCode=n.FlightBooking.Trips[0].Airline_Code);n.InitPG();n.QuickBookClick=!0;n.TotalPax_Count==1&&(n.UserInfo&&(n.CustomerMobileNumber=n.UserInfo.CustomerMobile,n.PaxMobileNumber=n.UserInfo.CustomerMobile,n.EmailID=n.UserInfo.EmailID,n.HandlingChargesFlag=!1,n.UserInfo.B2BFlag&&(n.HandlingChargesFlag=!0,Config.TaxSplitupShow=!0,r.GetCostCenter())),(n.BookingType=="ONE_WAY"||n.BookingType=="SPECIALROUNDTRIP")&&n.SelectFlight(t,i,u,0),n.BookingType=="ROUNDTRIP"&&n.SelectRoundTrip(u),n.BookingType=="MULTICITY"&&n.SelectMultiTrip(u),e(function(){n.ApplyDeal(1)},500))}catch(f){}};n.$watch("UserInfo",function(t,i){t!==i&&(n.CustomerMobileNumber=n.UserInfo.CustomerMobile,n.EmailID=n.UserInfo.EmailID,n.GSTNumber=n.UserInfo.GSTINNumber,n.ShowNetFare=!1,n.UserInfo.B2BFlag?(n.ShowNetFare=!0,n.ShowFullFare=!0,r.ShowRetailFare=!0,n.HandlingChargesFlag=!0,n.FareDetails(),Config.TaxSplitupShow=!0):n.HandlingChargesFlag=!1)});n.PassengerDetail=[];n.ChkPromo=[];n.ChkPromo=[{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1}];n.SelectedPromoCode=[];n.ValidatePromoCode=function(){var i,t,u;i=n.BookingType=="ONE_WAY"?0:1;t=n.OngoingDate;t=t.indexOf(",")>-1?t:n.OngoingDate.split("/")[1]+"/"+n.OngoingDate.split("/")[0]+"/"+n.OngoingDate.split("/")[2];n.ongoing_AirlineCode=n.FlightBooking.Trips[0].Airline_Code;n.OngoingProductClass=n.FlightBooking.Trips[0].SelectedFare.ProductClass;n.FlightBooking.Trips[0];(n.OngoingProductClass==null||n.OngoingProductClass=="")&&(n.OngoingProductClass=0);u={ProductId:"1",BillerId:n.Travel_Type=="DOMESTIC"?"13":"14",Travel_Type:n.Travel_Type,Booking_Type:i,Class_Of_Travel:n.Travel_Class,No_Of_Adult:n.Adult_Count,No_Of_Child:n.Child_Count,No_Of_Infant:n.Infant_Count,No_Of_Rooms:"0",No_Of_Nights:"0",StarCategory:"",Operator_Code:"",Travel_Date:t,AdultFare:n.OnetimePromoAdultTotal,ChildFare:n.OnetimePromoChildTotal,InfantFare:n.OnetimePromoInfantTotal,PromoCode:n.TotalDealCode,AirlineCode:n.ongoing_AirlineCode,ClassCode:n.OngoingProductClass};r.GetPromoCode(u)};n.OneTimePromo=!1;n.ApplyDeal=function(t){try{if(n.SelectedPromoCode=[],t==1){if(n.SelectedPromoCode.length==0)if(n.BookingType!="ROUNDTRIP")n.FlightBooking.Trips[0].SelectedFare.DealDetails!=null?n.FlightBooking.Trips[0].SelectedFare.DealDetails.length>0?(n.FlightBooking.Trips[0].SelectedFare.DealDetails[0].DealValuePerTransaction>0?n.SelectedPromoCode.push(n.FlightBooking.Trips[0].SelectedFare.DealDetails[0]):(n.Promoinput=!0,n.TotalDealCode="",n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1)),n.FlightBooking.Trips[0].SelectedFare.DealDetails[0].DisplayInSearch?(n.ChkPromo[0].Selected=!0,n.Promoinput=!1,n.SelectedPromoCode.length>0&&(n.TotalDealCode=n.SelectedPromoCode[0].DealCode,n.TotalDealValue=n.SelectedPromoCode[0].DealValuePerTransaction),$("#DealOption").attr("ReadOnly",!0)):n.ChkPromo[0].Selected||(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1))):(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1)):(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1));else for(var i=0;i<n.FlightBooking.Trips.length;i++)n.FlightBooking.Trips[i].SelectedFare.DealDetails!=null?n.FlightBooking.Trips[i].SelectedFare.DealDetails.length>0?n.FlightBooking.Trips[i].SelectedFare.DealDetails[0].DealValuePerTransaction>0&&n.SelectedPromoCode.push(n.FlightBooking.Trips[i].SelectedFare.DealDetails[0]):(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1)):(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1))}else{if(n.TotalDealCode==""||n.TotalDealCode=="undefined"||n.TotalDealCode==null)return ShowError("Please Enter Valid Promo Code"),!1;n.SelectedPromoCode=[];angular.forEach(n.FlightBooking.Trips[0].SelectedFare.DealDetails,function(t,i){t.DealCode.toUpperCase()==n.TotalDealCode.toUpperCase()&&(n.Promoindex=i,t.DealValuePerTransaction>0&&n.SelectedPromoCode.push(t))});n.SelectedPromoCode.length==1?(n.ChkPromo[n.Promoindex].Selected=!0,n.TotalDealCode=n.SelectedPromoCode[0].DealCode,n.TotalDealValue=n.SelectedPromoCode[0].DealValuePerTransaction,n.Promoinput=!1):(n.ValidatePromoCode(),e(function(){r.DealData!=null&&r.DealData.length>0&&(n.SelectedPromoCode=r.DealData,n.Promoinput=!1,n.TotalDealCode=n.SelectedPromoCode[0].DealCode,n.TotalDealValue=n.SelectedPromoCode[0].DealValuePerTransaction,n.OneTimePromo=!0)},500))}}catch(u){}};n.SelectPromoCode=function(t,i){n.Promoindex=t;n.SelectedPromoCode=[];n.Promoinput=!1;n.SelectedPromoCode.push(i);n.TotalDealCode=i.DealCode;n.TotalDealValue=i.DealValuePerTransaction;for(var r=0;r<n.FlightBooking.Trips[0].SelectedFare.DealDetails.length;r++)n.ChkPromo[r].Selected=t!=r?!1:!0;$("#DealOption").attr("ReadOnly",!0)};n.ClosePromoCode=function(){$("#DealOption").attr("ReadOnly",!1);n.SelectedPromoCode=[];n.Promoinput=!0;n.TotalDealCode="";n.TotalDealValue=0;for(var t=0;t<n.FlightBooking.Trips[0].SelectedFare.DealDetails.length;t++)n.ChkPromo[t].Selected=!1};n.CGSTApply=!1;n.BlockingFlag=0;n.PG_Mode=[];n.PaymentMode="Payment_Gateway";n.DealApplied=!1;n.PushTripInfos=function(t,i){var r;try{var u=JSON.parse(localStorage.getItem("FlightObject")),e=[],f={};for(r=0;r<u.Trips.length;r++)n.BookingType=="MULTICITY"&&u.Discounted_Fare==!1?r==i&&u.Trips[r].Pushed==!0&&(f={},t==1?f.Fare_Key=u.Trips[r].SelectedFare.Fare_Key:t==2&&(f.Fare_Id=u.Trips[r].SelectedFare.Fare_Id),f.Flight_Key=u.Trips[r].Flight_Key,e.push(f)):(f={},t==1?f.Fare_Key=u.Trips[r].SelectedFare.Fare_Key:t==2&&(f.Fare_Id=u.Trips[r].SelectedFare.Fare_Id),f.Flight_Key=u.Trips[r].SelectedFare.Flight_Key!=undefined?u.Trips[r].SelectedFare.Flight_Key:u.Trips[r].Flight_Key,f.AirLowFareRequestDetails=[],u.Trips[r].SelectedFare.Swap_Allowed==!0&&(f.AirLowFareRequestDetails=n.GetAllFlightKey(u.Trips[r])),e.push(f));return e}catch(o){}};n.ShowHidePromo=!0;n.RePrice=function(){var i,r,t,f;try{if((n.CustomerMobileNumber==""||n.CustomerMobileNumber==undefined)&&(n.EmailID==""||n.EmailID==undefined))return n.OpenLoginModel(""),!1;if(n.Adult_Markup=0,n.Child_Markup=0,n.Infant_Markup=0,n.GrossCommission=0,i=JSON.parse(localStorage.getItem("FlightObject")),n.TRAVELLERDETAILSIsVisible=!0,n.PassengerDummyVisible=!0,n.SearchTotalCost=n.TotalTicketCost,n.PassengerDummyVisible=!0,n.FareDetailsVisible=!1,n.RepriceThread_Count=1,n.Thread_Completed=0,n.BookingType=="MULTICITY"&&i.Discounted_Fare==!1)for(r=0;r<n.FlightBooking.Trips.length;r++)i.Trips[r].Pushed==!0&&n.RepriceThread_Count++;for(t=0;t<n.RepriceThread_Count;t++)i.Trips[t].Pushed==!0&&(n.RePriceRequest={ProcessID:n.ProcessID,Trips:n.PushTripInfos(2,t),Search_Key:i.Trips[t].Search_Key,Customer_Mobile:n.CustomerMobileNumber,GST_Input:n.GSTMandatory,Header:n.GetHeader(n.ProcessID),B2BFlag:n.UserInfo?n.UserInfo.B2BFlag:1},fnProgstart(),f=u({method:"POST",url:Config.Api+"FlightBooking/RePrice",dataType:"json",data:n.RePriceRequest,headers:{"Content-Type":"application/json"}}),f.then(function(t){var s,o,f,i,a,u,h;try{if(fnProgstop(),s=t.data,s.Status=="1"){n.Thread_Completed++;var r=JSON.parse(s.Data.Filler1),v=s.Data.Filler2,l=JSON.parse(s.Data.Filler3),c=JSON.parse(localStorage.getItem("FlightObject"));for(o=0;o<c.Trips.length;o++)for(f=0;f<r.AirRepriceResponses.length;f++)i=r.AirRepriceResponses[f].Flight,c.Trips[o].Flight_Id==i.Flight_Id&&(i.Required_PAX_Details=r.AirRepriceResponses[f].Required_PAX_Details,i.Frequent_Flyer_Accepted=r.AirRepriceResponses[f].Frequent_Flyer_Accepted,i.FareChanged=r.AirRepriceResponses[f].FareChanged,i.TimeChanged=r.AirRepriceResponses[f].TimeChanged,i.Search_Key=v,i.Pushed=n.FlightBooking.Trips[o].Pushed,i.SelectedFare=r.AirRepriceResponses[f].Flight.Fares[0],i.BookingAlertIds=c.Trips[o].BookingAlertIds,i.SelectedFares=r.AirRepriceResponses[f].Flight.Fares,i.Flight_Key=r.AirRepriceResponses[f].Flight.Flight_Key,c.Trips[o]=i,n.Adult_Markup+=r.AirRepriceResponses[f].Flight.Fares[0].FareDetails[0].Trade_Markup_Amount,n.SearchTotalCost+=parseFloat(n.FlightBooking.Trips[o].Fares[0].FareDetails[0].Total_Amount)-parseFloat(r.AirRepriceResponses[f].Flight.Fares[0].FareDetails[0].Gross_Commission),n.GrossCommission+=r.AirRepriceResponses[f].Flight.Fares[0].FareDetails[0].Gross_Commission);if(n.BookingType=="ROUNDTRIP"&&r.AirRepriceResponses.length!=n.FlightBooking.Trips.length&&r.Response_Header.Error_InnerException!="")return ShowAlert(r.Response_Header.Error_InnerException),n.TRAVELLERDETAILSIsVisible=!1,n.PassengerDummyVisible=!1,!1;n.FlightBookingDetails=c;localStorage.setItem("FlightObject",JSON.stringify(c));n.CombineSegments(n.FlightBookingDetails.Trips);a="";a=n.BookingType=="MULTICITY"?"ONE_WAY":n.BookingType;e(function(){n.OneTimePromo||n.ApplyDeal(1)},500);u=n.UserInfo;n.AdultObject=i.Required_PAX_Details[0];i.Required_PAX_Details[0].Pax_type==0&&(n.PassengerDetail.Pax_type="ADT");i.Required_PAX_Details[0].Title==!0&&(n.PassengerDetail.Title=u.Title=="Mr"||u.Title=="Mrs"||u.Title=="Mstr"||u.Title=="Ms"?u.Title:"");i.Required_PAX_Details[0].First_Name==!0&&(n.PassengerDetail.First_Name=u.FirstName);i.Required_PAX_Details[0].Last_Name==!0&&(n.PassengerDetail.Last_Name=u.LastName);i.Required_PAX_Details[0].DOB==!0&&(n.PassengerDetail.DOB=u.DOB);i.Required_PAX_Details[0].Gender==!0?u.Title=="Mr."?n.PassengerDetail.Gender="Male":(u.Title=="Mrs."||u.Title=="Ms.")&&(n.PassengerDetail.Gender="Female"):u.Title=="Mr."?n.PassengerDetail.Gender="Male":(u.Title=="Mrs."||u.Title=="Ms.")&&(n.PassengerDetail.Gender="Female");l&&l.length>0&&(n.AppliedGST=l[0],n.AppliedGST.type=l[0],n.GSTDetails=l,n.GSTAvailable=!0,n.ChangeGSTMode(0),$("#GSTExist").prop("checked",!0));n.paxwisedetail=n.PassengerDetail;h="";n.OngoingDate!=null?(h+=n.FlightBooking.OriginCode+"-"+n.FlightBooking.DestinationCode+"  "+n.OngoingDate.split("/")[0]+"-"+fnGetMonthbyText(n.OngoingDate.split("/")[1])+"-"+n.OngoingDate.split("/")[2],n.BookingType=="ROUNDTRIP"&&(h+=" -  "+n.ReturnDate.split("/")[0]+"-"+fnGetMonthbyText(n.ReturnDate.split("/")[1])+"-"+n.ReturnDate.split("/")[2]),h+="  "+n.PassengerDetail.First_Name+" "+n.PassengerDetail.Last_Name):(h+=n.FlightBooking.OriginCode+"-"+n.FlightBooking.DestinationCode,h+="  "+n.PassengerDetail.First_Name+" "+n.PassengerDetail.Last_Name);e(function(){n.PassengerDetail.DOB="";n.PassengerDetail.Passport_Expiry=""},500);n.Remarks=h;n.QuickBookingshow=!0;n.QCancellationPolicy=!1;n.FareDetails();$("#BookingConfirmation").modal("show");n.ShowHidePromo=!0;localStorage.setItem("BookingRefNo","");n.RetryPayment=!1}else s.Status=="2"&&(ShowAlert(s.Data.Error_Desc),n.TRAVELLERDETAILSIsVisible=!1,n.PassengerDummyVisible=!1)}catch(y){ShowAlert("Error occured while processing your request. Please Search Again.","../Flight/Search","Search")}},function(){ShowAlert("Error occured while processing your request. Please Search Again.","../Flight/Search","Search")}))}catch(s){}};n.ChangeGSTMode=function(t){try{t==0?(n.SelectedGSTMode="GSTExist",n.GSTEntryName=n.GSTDetails[0].GSTINHolderName,n.GSTEntryNumber=n.GSTDetails[0].GSTINNumber,n.GSTEntryAddress=n.GSTDetails[0].GSTINAddress):(n.GSTEntryName="",n.GSTEntryNumber="",n.GSTEntryAddress="",n.SelectedGSTMode="GSTNew")}catch(i){}};n.TicketBookingValid=function(t){var i,r,u;try{var f=n.Adult_Count,e=n.Child_Count,o=n.Infant_Count;if(f>0){if(t[0].Title==!0&&(n.PassengerDetail.Title==undefined||n.PassengerDetail.Title==""||n.PassengerDetail.Title==null)&&(n.PassengerDetail.Title="Mr"),t[0].First_Name==!0&&(n.PassengerDetail.First_Name==undefined||n.PassengerDetail.First_Name==""||n.PassengerDetail.First_Name==null))return ShowError("Please Enter Pax Adult FirstName"),!1;if(t[0].Last_Name==!0){if(n.PassengerDetail.Last_Name==undefined||n.PassengerDetail.Last_Name==""||n.PassengerDetail.Last_Name==null)return ShowError("Please Enter Pax Adult LastName"),!1;if(n.PassengerDetail.Last_Name.length<2)return ShowError("Please Enter Pax Adult LastName Two Character"),!1}if(t[0].Gender==!0&&(n.PassengerDetail.Gender==undefined||n.PassengerDetail.Gender==""||n.PassengerDetail.Gender==null))return ShowError("Please Enter Pax Adult Gender"),!1;if(t[0].Age==!0&&n.PassengerDetail.Age=="")return ShowError("Please Enter Pax Adult Passport_Number"),!1;if(t[0].DOB){if(n.PassengerDetail.DOB==""||n.PassengerDetail.DOB==null||n.PassengerDetail.DOB==undefined)return ShowError("Please Select Pax Adult  Date Of Birth"),!1;if(i=moment(),i.add("years",-12),r=moment(n.PassengerDetail.DOB,"DD/MM/YYYY"),u=r.diff(i,"days"),u>0)return ShowError("Please Select Pax Adult valid Date Of Birth"),!1}if(t[0].Passport_Number==!0&&n.PassengerDetail.Passport_Number=="")return ShowError("Please Enter Pax Adult Passport_Number"),!1;if(t[0].Passport_Expiry==!0)if(n.PassengerDetail.Passport_Expiry!=undefined&&n.PassengerDetail.Passport_Expiry!=null&&n.PassengerDetail.Passport_Expiry!=""){if(n.Passport_Expiry=n.PassengerDetail.Passport_Expiry,n.BookingType=="ROUNDTRIP"){if(n.Passport_Expiry.split("/")[2]<n.ReturnDate.split("/")[2])return ShowError("Please Select Pax Adult Passport_Expiry Invalid Date"),!1;if(n.Passport_Expiry.split("/")[2]==n.ReturnDate.split("/")[2]){if(n.Passport_Expiry.split("/")[1]<n.ReturnDate.split("/")[1])return ShowError("Please Select Pax Adult  Passport_Expiry Invalid Date"),!1;if(n.Passport_Expiry.split("/")[1]==n.ReturnDate.split("/")[1]&&n.Passport_Expiry.split("/")[0]<=n.ReturnDate.split("/")[0])return ShowError("Please Select Pax Adult Passport_Expiry Invalid Date"),!1}}else if(n.Passport_Expiry.split("/")[2]<n.OngoingDate.split("/")[2]||n.Passport_Expiry.split("/")[2]==n.OngoingDate.split("/")[2]&&(n.Passport_Expiry.split("/")[1]<n.OngoingDate.split("/")[1]||n.Passport_Expiry.split("/")[1]==n.OngoingDate.split("/")[1]&&n.Passport_Expiry.split("/")[0]<=n.OngoingDate.split("/")[0]))return ShowError("Please Select Pax Adult Passport_Expiry Invalid Date"),!1}else if(t[0].Passport_Expiry&&(n.PassengerDetail.Passport_Expiry==""||n.PassengerDetail.Passport_Expiry==null||n.PassengerDetail.Passport_Expiry==undefined))return ShowError("Please Select Pax Adult  Passport Expiry Date"),!1;if(t[0].DefenceServiceId&&n.PassengerDetail.DefenceServiceId=="")return ShowError("Please Enter Pax Adult  Defence Service Id"),!1;if(t[0].Student_Id&&n.PassengerDetail.Student_Id=="")return ShowError("Please Enter Pax Adult  Student Id"),!1;if(n.PassengerDetail.DefenceExpiryDate!=undefined&&n.PassengerDetail.DefenceExpiryDate!=null&&n.PassengerDetail.DefenceExpiryDate!=""){if(n.DefenceExpiryDate=n.PassengerDetail.DefenceExpiryDate,n.BookingType=="ROUNDTRIP"){if(n.DefenceExpiryDate.split("/")[2]<n.ReturnDate.split("/")[2]||n.DefenceExpiryDate.split("/")[2]==n.ReturnDate.split("/")[2]&&(n.DefenceExpiryDate.split("/")[1]<n.ReturnDate.split("/")[1]||n.DefenceExpiryDate.split("/")[1]==n.ReturnDate.split("/")[1]&&n.DefenceExpiryDate.split("/")[0]<=n.ReturnDate.split("/")[0]))return ShowError("Please Select Pax Adult  Defence Expiry Invalid Date"),!1}else if(n.DefenceExpiryDate.split("/")[2]<n.OngoingDate.split("/")[2]||n.DefenceExpiryDate.split("/")[2]==n.OngoingDate.split("/")[2]&&(n.DefenceExpiryDate.split("/")[1]<n.OngoingDate.split("/")[1]||n.DefenceExpiryDate.split("/")[1]==n.OngoingDate.split("/")[1]&&n.DefenceExpiryDate.split("/")[0]<=n.OngoingDate.split("/")[0]))return ShowError("Please Select Pax Adult  Defence Expiry Invalid Date"),!1}else if(t[0].DefenceExpiryDate&&(n.PassengerDetail.DefenceExpiryDate==""||n.PassengerDetail.DefenceExpiryDate==null||n.PassengerDetail.DefenceExpiryDate==undefined))return ShowError("Please Select Pax Adult  Defence Expiry Date"),!1;if(t[0].DefenceIssueDate&&(n.PassengerDetail.DefenceIssueDate==""||n.PassengerDetail.DefenceIssueDate==null||n.PassengerDetail.DefenceIssueDate==undefined))return ShowError("Please Select Pax Adult  Defence Issue Date"),!1}if(n.ApplyGST==!0){if(n.GSTEntryName.trim()=="")return ShowError("Please Enter Valid GST Company Name"),!1;if(n.GSTEntryNumber.trim()=="")return ShowError("Please Enter Valid GST Number"),!1;if(n.GSTEntryAddress.trim()=="")return ShowError("Please Enter Valid GST Address"),!1;if(n.GSTEntryNumber.length!=15||(n.GSTEntryNumber=n.GSTEntryNumber.toUpperCase(),!GSTValidation(n.GSTEntryNumber)))return ShowError("Please Enter Valid GST Number"),!1}return(n.PG_Mode==null||n.PG_Mode.length<=0)&&n.PaymentMode=="Payment_Gateway"?(ShowError("Please Select Payment Mode"),!1):n.PaymentMode==""||n.PaymentMode==undefined?(ShowError("Please Enter PaymentMode"),!1):!0}catch(s){}};n.PushPassengerDetails=function(){var i;try{var r=[],t=n.Adult_Count,u=n.Child_Count,f=n.Infant_Count;if(t>0)for(i=0;i<t;i++)r.push({Title:n.PassengerDetail.Title,First_Name:n.PassengerDetail.First_Name,Last_Name:n.PassengerDetail.Last_Name,Gender:n.PassengerDetail.Gender,Pax_Id:t,Pax_Type:n.PassengerDetail.Pax_type,DOB:n.PassengerDetail.DOB,Passport_Issuing_Country:n.PassengerDetail.Passport_Issuing_Country,Passport_Number:n.PassengerDetail.Passport_Number,Passport_Expiry:n.PassengerDetail.Passport_Expiry});return r}catch(e){}};n.SetAge=function(){var n,i;try{var t=[];for(n=1;n<110;n++)i={id:n,name:n.toString()},t.push(i);return t}catch(r){}};n.users=n.SetAge();n.AddPaxDate=function(){var t,i;try{t=new Date;n.paxDOBMinDate=moment().subtract(100,"Y");n.paxDOBMaxDate=moment().add(0,"Y");i=new Date;n.paxPassminDate=moment().add(1,"Y");n.paxPassmaxDate=moment().add(10,"Y");n.BookingType=="ROUNDTRIP"?(n.ReturnDateFormat=getDayNameMonth(n.ReturnDate),n.Passport_ExpiryMIDate=moment(n.ReturnDateFormat).add(1,"days"),n.Passport_ExpiryMADate=moment(n.ReturnDateFormat).add(10,"Y")):(n.OngingDateFormat=getDayNameMonth(n.OngoingDate),n.Passport_ExpiryMIDate=moment(n.OngingDateFormat).add(1,"days"),n.Passport_ExpiryMADate=moment(n.OngingDateFormat).add(10,"Y"))}catch(r){}};n.AddPaxDate();n.InitDate=function(){var t,i;try{n.BookingType=="ROUNDTRIP"?(n.ReturnDateFormat=getDayNameMonth(n.ReturnDate),t=new Date,n.adFrom12Years=t.setFullYear(t.getFullYear()-12),n.adDOBMinDate=moment(n.ReturnDateFormat).subtract(100,"Y"),n.adDOBMaxDate=moment(n.ReturnDateFormat).subtract(12,"Y"),i=new Date,n.chFrom2Years=i.setFullYear(i.getFullYear()-2),n.chDOBMinDate=moment(n.ReturnDateFormat).subtract(12,"Y"),n.chDOBMaxDate=moment(n.ReturnDateFormat).subtract(2,"Y"),n.infDOBMinDate=moment(n.ReturnDateFormat).subtract(2,"Y").add(1,"days"),n.infDOBMaxDate=moment().subtract(1,"days")):(n.OngingDateFormat=getDayNameMonth(n.OngoingDate),t=new Date,n.adFrom12Years=t.setFullYear(t.getFullYear()-12),n.adDOBMinDate=moment(n.OngingDateFormat).subtract(100,"Y"),n.adDOBMaxDate=moment(n.OngingDateFormat).subtract(12,"Y"),i=new Date,n.chFrom2Years=i.setFullYear(i.getFullYear()-2),n.chDOBMinDate=moment(n.OngingDateFormat).subtract(12,"Y"),n.chDOBMaxDate=moment(n.OngingDateFormat).subtract(2,"Y"),n.infDOBMinDate=moment(n.OngingDateFormat).subtract(2,"Y").add(1,"days"),n.infDOBMaxDate=moment().subtract(1,"days"))}catch(r){}};n.InitDate();n.CombineSegments=function(t){var u,i,r;try{for(u=[],i=0;i<t.length;i++)if(t[i].Pushed==!0)for(r=0;r<t[i].Segments.length;r++)t[i].Segments[r].Flight_Index=i,t[i].Segments[r].Flight_Id=t[i].Flight_Id,n.BookingType=="ROUNDTRIP"&&i==1&&(t[i].Segments[r].Return_Flight=!0),u.push(t[i].Segments[r]);n.FlightSegments=u;n.FlightTrips=t}catch(f){}};n.ChangePrepaid=function(){n.PaymentMode="PrePaid_Money";n.lstrPGMode="PrePaid Money";n.PG_Mode="PrePaid_Money";r.Gateway_Charges=0};n.FlightObject={};n.RescheduleRetailerId="";n.RescheduleSubRetailerId="";n.ChangePGMode=function(t){var i,r,u;try{n.DealAmount=0;i=0;r=0;n.TransType=="R"?(localStorage.getItem("RescheduleFlightObject")!=""&&localStorage.getItem("RescheduleFlightObject")!="undefined"&&localStorage.getItem("RescheduleFlightObject")!=undefined&&localStorage.getItem("RescheduleFlightObject")!="null"&&localStorage.getItem("RescheduleFlightObject")!=null&&(u=JSON.parse(localStorage.getItem("RescheduleFlightObject")),n.BookingType="ONE_WAY"),n.BookingAmount=n.ChangeFee+n.ProcessingFee+n.ReschedulePenalty,n.PaxCount=n.Adult_Count+n.Infant_Count+n.Child_Count):(n.Trips=n.FlightBooking.Trips,n.PaxCount=n.Adult_Count+n.Infant_Count+n.Child_Count,n.Tripslength=n.FlightBooking.Trips.length,n.BookingAmount=n.TotalTicketCost+n.AddOn_Fees-n.GrossCommission,n.BookingType=="ROUNDTRIP"?(n.FlightObject.SelectedFares=n.FlightBooking.Trips[0].SelectedFare.FareDetails,n.FlightObject.RoundTripFares=n.FlightBooking.Trips[1].SelectedFare.FareDetails,i=n.OnwardTicketCost,r=n.ReturnTicketCost):(i=n.BookingAmount,n.FlightObject.SelectedFares=n.FlightBooking.Trips[0].SelectedFare.FareDetails));n.FlightObject.FlightCount=n.FlightBooking.Trips.length;n.FlightObject.Adult_Count=n.Adult_Count;n.FlightObject.Child_Count=n.Child_Count;n.FlightObject.Infant_Count=n.Infant_Count;n.FlightObject.SelectedFares=n.FlightBooking.Trips[0].SelectedFare.FareDetails;n.FlightObject.OngoingBookingAmount=i;n.FlightObject.ReturnBookingAmount=r;n.FlightObject.BookingAmount=n.BookingAmount;n.FlightObject.TransType=n.TransType;n.FlightObject.Channel=n.Config.ChannelId;n.FlightObject.PaymentTypeCode=t.PaymentTypeCode;n.FlightObject.BookingType=n.BookingType;n.FlightObject.Flights=n.FlightBooking.Trips;n.FlightObject.GatewayName=t.GatewayName;n.FlightObject.RescheduledDate=n.OngoingDate;n.PaymentMode="Payment_Gateway";n.lstrPGMode=t.PaymentType;n.SelectedPGMode=t.PaymentTypeCode;n.PG_Mode=t;n.CalculateGateWayCharges(n.FlightObject,n.RescheduleRetailerId,n.RescheduleSubRetailerId)}catch(f){}};n.PushFlightDetails=function(){var r,i,t;try{for(r=[],i=0;i<n.FlightBookingDetails.Trips.length;i++)t={},n.TotalDealValue!=undefined&&n.TotalDealValue!=""&&n.TotalDealValue!=0?n.BookingType!="ROUNDTRIP"?n.SelectedPromoCode.length>0&&(t.Deal_Key=n.SelectedPromoCode[0].Deal_Key):n.SelectedPromoCode.length>1?t.Deal_Key=n.SelectedPromoCode[0].DealValuePerTransaction>=n.SelectedPromoCode[1].DealValuePerTransaction&&i==0?n.SelectedPromoCode[0].Deal_Key:n.SelectedPromoCode[1].Deal_Key:i==0&&(t.Deal_Key=n.SelectedPromoCode[0].Deal_Key):t.Deal_Key="",t.Flight_Key=n.FlightBookingDetails.Trips[i].Flight_Key,t.Search_Key=n.FlightBookingDetails.Trips[i].Search_Key,n.AddONFound==!0&&(t.BookingSSRDetails=n.PushSSRDetails(i)),r.push(t);return r}catch(u){}};n.SelectedCostCenter="99";localStorage.setItem("BookingRefNo","");n.ShowHidePromo=!0;n.BookTicket=function(t){var i,f,e;try{n.Booking_RefNo=localStorage.getItem("BookingRefNo");localStorage.getItem("BookingRefNo")==""?(t==2&&(n.BlockingFlag=1),i=JSON.parse(localStorage.getItem("FlightObject")),f="",f=i.Trips[0].BookingAlertIds,n.BookingType=="ROUNDTRIP"&&(f+=","+i.Trips[1].BookingAlertIds),n.TicketBookingValid(n.FlightBookingDetails.Trips[0].Required_PAX_Details)&&(n.AdultObject.DOB&&(n.PassengerDetail.DOB=moment(n.PassengerDetail.DOB,"DD/MM/YYYY").format("MM/DD/YYYY")),n.AdultObject.Passport_Expiry&&(n.PassengerDetail.Passport_Expiry=moment(n.PassengerDetail.Passport_Expiry,"DD/MM/YYYY").format("MM/DD/YYYY")),n.AdultObject.DefenceExpiryDate&&(n.PassengerDetail.DefenceExpiryDate=moment(n.PassengerDetail.DefenceExpiryDate,"DD/MM/YYYY").format("MM/DD/YYYY")),n.AdultObject.DefenceIssueDate&&(n.PassengerDetail.DefenceIssueDate=moment(n.PassengerDetail.DefenceIssueDate,"DD/MM/YYYY").format("MM/DD/YYYY")),n.BlockingRequest={Header:n.GetHeader(n.ProcessID),Ticketing_Type:n.BlockingFlag,Payment_Mode:n.PaymentMode,JI_SubRetailerID:n.SelectedCostCenter,BlockingRequest:{BookingFlightDetails:n.PushFlightDetails(),BookingRemark:n.Remarks,Customer_Mobile:n.CustomerMobileNumber,GST:n.ApplyGST,GST_Number:n.ApplyGST?n.GSTEntryNumber:"",GST_HolderName:n.ApplyGST?n.GSTEntryName:"",GST_Address:n.ApplyGST?n.GSTEntryAddress:"",Passenger_Email:n.EmailID,Passenger_Mobile:n.CustomerMobileNumber,PAX_Details:n.PushPassengerDetails(1,3),CostCenterId:0,ProjectId:0,Booked_By_Operator_Id:0,BookingAlertIds:f},B2BFlag:n.UserInfo?n.UserInfo.B2BFlag:1},fnProgstart(),e=u({method:"POST",url:Config.Api+"FlightBooking/Blocking",dataType:"json",data:n.BlockingRequest,headers:{"Content-Type":"application/json"}})),e.then(function(t){var i,f,s,e,o;try{i=t.data;i.Status=="1"?(localStorage.setItem("BookingRefNo",i.Data),n.ShowHidePromo=!1,$("#BookingConfirmation").modal("hide"),f=JSON.parse(localStorage.getItem("FlightObject")),s=i.Data,n.Booking_RefNo=i.Data,e=!1,n.BookingType=="ROUNDTRIP"?f.Trips[0].Block_Ticket_Allowed==!0&&f.Trips[1].Block_Ticket_Allowed&&(e=!0):f.Trips[0].Block_Ticket_Allowed==!0&&(e=!0),e==!0?(n.AirBookingRequest={Header:n.GetHeader(n.ProcessID),Booking_RefNo:n.Booking_RefNo,Ticketing_Type:"1",Payment_Mode:n.PaymentMode,Payment_Gateway:n.PG_Mode,Payment_Data:""},o=u({method:"POST",url:Config.Api+"FlightBooking/BlockTicket",dataType:"json",data:n.AirBookingRequest,headers:{"Content-Type":"application/json"}}),o.then(function(t){var u=JSON.parse(localStorage.getItem("FlightObject")),e,f,i;try{e=[];f=t.data;f.Status=="1"?n.CallPayment():(i=t.data.Data,i.Error_Desc="The requested fare has been sold out...",i.Error_InnerException="The requested fare has been sold out...",Config.ChannelId=="4"&&(r.ShowProviderError(i,"flights","Search"),localStorage.setItem("ReSearch","2")),r.ShowProviderError(i,"flights","Search"),localStorage.setItem("ReSearch","2"))}catch(o){u.BookingDetails.Status=2;localStorage.setItem("FlightObject",JSON.stringify(u))}},function(){})):n.CallPayment()):i.Status=="5"?(fnProgstop(),n.ApplyGST==!0&&ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");setTimeout(function(){$("#AccountCreation").modal("show")},500)},"You haven't added the GST details to your profile. Do you want to update now?",function(){$("#ConfirmationModal").modal("hide");n.GSTMandatory||(n.ApplyGST=!1)})):i.Status=="5"?(fnProgstop(),n.ApplyGST==!0&&ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");setTimeout(function(){$("#AccountCreation").modal("show")},500)},"You haven't added the GST details to your profile. Do you want to update now?",function(){$("#ConfirmationModal").modal("hide");n.GSTMandatory||(n.ApplyGST=!1)})):(t.data.Data.Error_Code=="0041"?(t.data.Data.Error_Desc="<b>"+t.data.Data.Error_InnerException+"<b/>",t.data.Data.Error_InnerException="",Config.ChannelId=="4"&&ShowAlert(t.data.Data.Error_Desc),r.ShowProviderError(t.data.Data,"/","Home")):(Config.ChannelId=="4"&&ShowAlert(t.data.Data.Error_Desc),r.ShowProviderError(t.data.Data,"","")),fnProgstop(),$("#BookingConfirmation").modal("hide"),alert(t.data.Data.Error_InnerException))}catch(c){fnProgstop()}},function(){fnProgstop()})):n.LoadPage("flights/"+i.QueryString+"&ReSearch=2")}catch(s){}};n.CallPayment=function(){var u={},t={},i=JSON.parse(localStorage.getItem("FlightObject")),f,o,e;u.Booking_RefNo=n.Booking_RefNo;u.Status=0;u.BlockFlag=n.BlockingFlag;u.TicketData=[];t.PaymentMode=n.PaymentMode;t.PaymentStatus=0;t.PaymentData="";t.PaymentGateway=n.PG_Mode;t.TotalAmount=n.TotalDealValue!=undefined&&n.TotalDealValue!=""?n.TotalTicketCost+n.AddOn_Fees-(n.TotalDealValue+n.GrossCommission):n.TotalTicketCost+n.AddOn_Fees-+n.GrossCommission;i.DealDetails={};n.TotalDealValue!=undefined&&n.TotalDealValue!=""&&n.TotalDealValue!=0&&(i.DealDetails.DealCode=n.SelectedPromoCode[0].DealCode,i.DealDetails.DealValue=n.SelectedPromoCode[0].DealValuePerTransaction,i.DealDetails.DealKey=n.SelectedPromoCode[0].DealKey,i.DealDetails.DealRemark="");t.Gateway_Charges=r.Gateway_Charges;t.PaymentKey=r.PaymentKey;t.PaymentBiller=r.Biller_Id+"$"+r.SupplierId+"$"+r.SubbillerCode;t.Service_AddOn=n.AddOn_Fees;i.BookingDetails=u;t.isRedirect=n.PG_Mode.isRedirect;i.PaymentDetails=t;i.CustomerInfo={};i.CustomerInfo.MobileNo=n.CustomerMobileNumber;i.CustomerInfo.EmailID=n.EmailID;localStorage.setItem("FlightObject",JSON.stringify(i));n.FilterClose();n.PaymentMode=="PrePaid_Money"?window.location.href="FlightConfirmation":n.PaymentMode=="Payment_Gateway"&&(f=GetPath()+"FlightConfirmation",Config.ChannelId=="4"&&(f="#FlightConfirmation"),o=n.PG_Mode,e={Header:n.GetHeader(n.ProcessID),CustomerMobile:n.CustomerMobileNumber,CustomerName:n.PassengerDetail.Title+" "+n.PassengerDetail.First_Name+" "+n.PassengerDetail.Last_Name,CustomerEmail:n.EmailID,ModuleID:1,TotalAmount:t.TotalAmount,Gateway_Charges:r.Gateway_Charges,BookRefNo:u.Booking_RefNo,PGInfo:o,PostURL:Config.PGURL,ReturnURL:f,TransactionType:0,PaymentKey:r.PaymentKey,PaymentBiller:r.Biller_Id+"$"+r.SupplierId+"$"+r.SubbillerCode},t.PaymentBase=e,i.PaymentDetails=t,localStorage.setItem("FlightObject",JSON.stringify(i)),r.InitiatePayment(e))};n.HeaderTripFlights=[];n.CalculatemoreFareAmount=function(t,i,r){try{(i==null||i=="")&&(i=0);n.BookingType=="ROUNDTRIP"&&(i=0);var u=t.Gross_Commission+parseFloat(i);return n.UserInfo?n.UserInfo.B2BFlag&&(u=parseFloat(i)):r&&(u=parseFloat(i)),parseFloat(t.Total_Amount-u)}catch(f){}};Array.prototype.min=function(){return Math.min.apply(null,this)};n.ChkMoreOnward=[];n.ChkMoreReturn=[];n.ClassFareBaggage=function(n){var i,t;try{for(i="",t=0;t<n.length;t++)i+="<div class='d-flex justify-content-start mb-1'> <div class='mr-2' style='color: green;'>&#x2713;<\/div> <div> "+n[t]+"<\/div> <\/div>";return h.trustAsHtml(i)}catch(r){}};n.MoreClassFare={};n.ChkMore=[];n.ChkMore=[{Selected:!0},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1}];n.ChkMoreOnward=[{Selected:!0},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1}];n.ChkMoreReturn=[{Selected:!0},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1}];n.TripInfo=[];n.QuickBookEditPax=function(t){try{if(t==0)$("#PaxDetails").modal("show");else{n.UserInfo.Title=n.PassengerDetail.Title;n.UserInfo.LastName=n.PassengerDetail.Last_Name;n.UserInfo.FirstName=n.PassengerDetail.First_Name;n.UpdateUserInfo(!0,n.UserInfo);var i=n.PushPassengerDetails(1,3);i!=""&&$("#PaxDetails").modal("hide")}}catch(r){}};n.CalculateNetAmount=function(t,i){try{if(!t)return 0;if(t.SelectedFare!=null){var r=t.SelectedFare.FareDetails[0].Gross_Commission+i;return n.UserInfo&&n.UserInfo.B2BFlag&&(r=i),parseFloat(t.SelectedFare.FareDetails[0].Total_Amount-r)}}catch(u){}};n.ResClick=!1;ft=[];n.ClassFare=function(t,i,r){var u;try{if(n.ResClick=!0,n.onCancellationPolicy=!1,n.reCancellationPolicy=!1,n.CancellationPolicy=!1,n.SelectedFareTab=t,$("#carouVal1").removeClass("active"),$("#carouVal").addClass("active"),n.BookingType=="ONE_WAY"||n.BookingType=="SPECIALROUNDTRIP"){for(u=0;u<10;u++)n.ChkMore[u].Selected=!1;n.TripFlights=i;r==0&&(n.HeaderTripFlights=[],n.HeaderTripFlights[0]=i,n.HeaderTripFlights[0].FilterShowFare=n.HeaderTripFlights[0].Fares.filter(function(n){return n.Hide_Fare!=!0}),n.ChangeClassRefundable=i.SelectedFare.Refundable,n.HeaderTripFlights.SelectedFare=i.SelectedFare,n.TravelClass_Desc=i.SelectedFare.FareDetails[0].FareClasses[0].Class_Desc.split("-")[0],n.SelectedPromoAmount=i.SelectedFare.FareDetails[0].PromoAmount,n.FarePolicyContent=n.GetFarePolicyContent(i.SelectedFare.FareDetails[0]),n.MoreFareAmount=n.CalculatemoreFareAmount(i.SelectedFare.FareDetails[0],n.SelectedPromoAmount),n.SelectedFareTotal=i.SelectedFare.FareDetails[0].Total_Amount,n.ChkMore[n.GetSelectedIndex(i)].Selected=!0)}if(n.BookingType=="ROUNDTRIP"&&r==0){for(n.FarePolicyContent="",u=0;u<5;u++)n.ChkMoreOnward[u].Selected=!1,n.ChkMoreReturn[u].Selected=!1;n.HeaderTripFlights=[];n.HeaderTripFlights=i;n.HeaderTripFlights[0].FilterShowFare=n.HeaderTripFlights[0].Fares.filter(function(n){return n.Hide_Fare!=!0});n.HeaderTripFlights[1].FilterShowFare=n.HeaderTripFlights[1].Fares.filter(function(n){return n.Hide_Fare!=!0});n.ChangeClassRefundable=i[0].SelectedFare.Refundable;n.HeaderTripFlights[0].SelectedFare=i[0].SelectedFare;n.HeaderTripFlights[1].SelectedFare=i[1].SelectedFare;n.TravelClass_Desc=i[0].SelectedFare.FareDetails[0].FareClasses[0].Class_Desc.split("-")[0];n.FarePolicyContent="";n.onwardTotalAmount=n.CalculatemoreFareAmount(i[0].SelectedFare.FareDetails[0],0);n.returnTotalAmount=n.CalculatemoreFareAmount(i[1].SelectedFare.FareDetails[0],0);n.FarePolicyContent=n.GetFarePolicyContent(i[0].SelectedFare.FareDetails[0]);n.ReturnFarePolicyContent=n.GetFarePolicyContent(i[1].SelectedFare.FareDetails[0]);n.MoreFareAmount=n.onwardTotalAmount+n.returnTotalAmount;n.ReturnWithoutcommission=i[0].SelectedFare.FareDetails[0].Total_Amount+i[1].SelectedFare.FareDetails[0].Total_Amount;n.ongoingTotalAmount=i[0].SelectedFare.FareDetails[0].Total_Amount;n.ReturnFlightTotalAmount=i[1].SelectedFare.FareDetails[0].Total_Amount;n.ReturnTravelClass_Desc=i[1].SelectedFare.FareDetails[0].FareClasses[0].Class_Desc.split("-")[0];n.ChkMoreOnward[n.GetSelectedIndex(i[0])].Selected=!0;n.ChkMoreReturn[n.GetSelectedIndex(i[1])].Selected=!0}$("#TravelClassDetails").modal("show")}catch(f){}};n.GetSelectedIndex=function(n){try{for(var t=0;t<n.FilterShowFare.length;t++)if(n.FilterShowFare[t].Fare_Id==n.SelectedFare.Fare_Id)return t}catch(i){}};n.CloseFareClass=function(t){var i;if(n.BookingType!="ROUNDTRIP")for(n.HeaderTripFlights[0]=t,n.HeaderTripFlights[0].SelectedFare=t.SelectedFare,$("#TravelClassDetails").modal("hide"),i=0;i<n.ChkMore.length;i++)n.ChkMore[i].Selected=!1;else{for(n.HeaderTripFlights[0]=t[0],n.HeaderTripFlights[0].SelectedFare=t[0].SelectedFare,n.HeaderTripFlights[1]=t[1],n.HeaderTripFlights[1].SelectedFare=t[1].SelectedFare,$("#TravelClassDetails").modal("hide"),i=0;i<n.ChkMoreOnward.length;i++)n.ChkMoreOnward[i].Selected=!1;for(i=0;i<n.ChkMoreReturn.length;i++)n.ChkMoreReturn[i].Selected=!1}};n.ChangeClassFare=function(t,i,r,u){try{n.ChkMore[t].Selected&&(n.ChangeClassRefundable=i.Refundable,n.HeaderTripFlights[0].SelectedFare=i,n.SelectedFareTotal=r[0].Total_Amount,n.TravelClass_Desc=r[0].FareClasses[0].Class_Desc.split("-")[0],n.SelectedPromoAmount=u,n.FarePolicyContent=n.GetFarePolicyContent(r[0]));n.MoreFareAmount=n.CalculatemoreFareAmount(r[0],u);n.TravelClass_Desc=r[0].FareClasses[0].Class_Desc.split("-")[0];n.ReturnTravelClass_Desc=r[0].FareClasses[0].Class_Desc.split("-")[0];for(var f=0;f<n.ChkMore.length;f++)t!=f&&(n.ChkMore[f].Selected=!1)}catch(e){}};n.ChangePolicyContent=function(t,i,r){n.onCancellationPolicy=!1;n.reCancellationPolicy=!1;r?i?(n.reCancellationPolicy=!0,n.ReSelectedFareRule=t,Config.ChannelId!=3&&$("#ShowFareRule").modal("show")):(n.onCancellationPolicy=!0,n.SelectedFareRule=t,Config.ChannelId!=3&&$("#ShowFareRule").modal("show")):config.ChannelId!=3&&$("#ShowFareRule").modal("hide")};n.ChangeRoundTripClassFare=function(t,i,r,u,f,e,o){var s;try{if(t)if(n.ChkMoreReturn[r].Selected)n.HeaderTripFlights[1].SelectedFare=o,n.ReturnTravelClass_Desc=f.FareClasses[0].Class_Desc.split("-")[0],n.ReturnFarePolicyContent=n.GetFarePolicyContent(f),n.returnTotalAmount=n.CalculatemoreFareAmount(f,0),n.ReturnFlightTotalAmount=f.Total_Amount;else return n.ChkMoreReturn[0].Selected=!0,!0;else if(n.ChkMoreOnward[r].Selected)n.ChangeClassRefundable=o.Refundable,n.HeaderTripFlights[0].SelectedFare=o,n.TravelClass_Desc=f.FareClasses[0].Class_Desc.split("-")[0],n.FarePolicyContent=n.GetFarePolicyContent(f),n.onwardTotalAmount=n.CalculatemoreFareAmount(f,0),n.ongoingTotalAmount=f.Total_Amount;else return n.ChkMoreOnward[0].Selected=!0,!0;if(n.MoreFareAmount=n.onwardTotalAmount+n.returnTotalAmount,n.ReturnWithoutcommission=n.ongoingTotalAmount+n.ReturnFlightTotalAmount,!t)for(s=0;s<10;s++)r!=s&&(n.ChkMoreOnward[s].Selected=!1);if(t)for(s=0;s<10;s++)r!=s&&(n.ChkMoreReturn[s].Selected=!1)}catch(h){}};Config.ChannelId!=3&&(n.OriginName="",n.DestinationName="",n.$on("$routeChangeSuccess",function(){n.slide="slide-left"}),n.$on("FlightBackFunction",function(){var t=r.Backoption;t=="";n.fnBackFlight()}),r.OpenModifySearch=function(){n.isvisible=!1;n.isDvisible=!1;n.OriginName!=""&&n.OriginName!=undefined&&(n.isvisible=!0);n.DestinationName!=""&&n.DestinationName!=undefined&&(n.isDvisible=!0);$("#SearchFlightModal").modal("show")},n.openOfferModal=function(){$("#TopOffers").modal("show")},n.fnBackFlight=function(){try{if(n.SearchBoxIsVisible==!0)return r.ModuleID=1,r.LoadPage("home"),!1;if(n.QuickBookingshow)return n.QuickBookingshow=!1,fncloseModal("BookingConfirmation"),!1;if(n.Fitershow)return n.Fitershow=!1,fncloseModal("AirlineFilter"),!1;r.LoadPage("home");n.SearchBoxIsVisible=!0;n.SearchDummyIsVisible=!1;n.ResultHeaderVisible=!1;n.ResultHeaderVisible_Return=!1;n.ReturnBookButtonVisible=!1;n.OnwardVisible=!1;n.ReturnVisible=!1}catch(t){}},n.isvisible=!1,n.isDvisible=!1,n.OpenAirCities=function(t,i){try{n.MultiCityOption=i;var r="";r=t=="0"?"Origin":"Destination";n.FocusControl=r;n.FocusCity=t;n.CitySelector="";document.getElementById("CityModal").style.width="100%";$("#CityModal").modal("show");e(function(){$("#anguScroll_value").focus();$("#anguScroll_value").focus()},500)}catch(u){}},n.OpenAirDates=function(t,i){try{var r="";r=i=="0"?"Departure":"Return";n.FocusControl=r;document.getElementById("DateModal").style.width="100%";$("#DateModal").modal("show")}catch(u){}},n.CitySelected=function(t){try{t.originalObject!="undefined"&&($("#CityModal").modal("hide"),$("#CityModalDest").modal("hide"));n.FocusCity==0?(n.OriginID=t.originalObject,n.OriginName=t.originalObject.Name,n.From=t,n.isvisible=!0):n.FocusControl=="Destination"&&(n.DestinationID=t.originalObject,n.DestinationName=t.originalObject.Name,n.To=t,n.isDvisible=!0);setTimeout(function(){fnInitiateText()},150)}catch(i){}},n.fnFlightFilterSidebar=function(){n.TotalPax_Count=n.Adult_Count+n.Child_Count+n.Infant_Count;document.getElementById("AirlineFilter").style.width="100%";n.Fitershow=!0;$("#AirlineFilter").modal("show");n.BigSection=!0;n.SmallSection=!1;n.PriceRange={options:{floor:n.minimumPrice,ceil:n.maximumPrice,onStart:function(){},onChange:function(){},onEnd:function(){n.Filter()}}};e(function(){n.$broadcast("rzSliderForceRender")},1e3)},$(document).ready(function(){r.initSwiper()}),n.LoadOffers=function(n){$("#TopOffers").modal("hide");r.LoadPage("Offers/"+n)});n.Cheapest=!0;n.highest=!1;n.Earliest=!1;n.Latest=!1;n.AEarliest=!1;n.ALatest=!1;n.Shortest=!1;n.Longer=!1;n.RCheapest=!0;n.Rhighest=!1;n.REarliest=!1;n.RLatest=!1;n.AREarliest=!1;n.ARLatest=!1;n.RShortest=!1;n.RLonger=!1;n.fnFilterOption=function(t){$("#AirlineFilter").modal("show");n.BigSection=!1;n.SmallSection=!0;t==1?(n.ViewAirlines=!0,n.ViewTime=!1,n.ViewSort=!1):t==2?(n.ViewTime=!0,n.ViewAirlines=!1,n.ViewSort=!1):t==3&&(n.ViewTime=!1,n.ViewAirlines=!1,n.ViewSort=!0)};n.ShowMoreStops=function(t,i){var o="",s="",r="",e="",u,f,h;if(!i)for(u=1;u<t.length;u++)Config.ChannelId=="3"?(r+="@"+t[u].Origin_City,f=u,f+1<=t.length&&(h=f-1,e=n.CalculateLayOver(t[f-1].Arrival_DateTime,t[f].Departure_DateTime)),r+=f+1<t.length?" , Layover-"+e+",":" , Layover-"+e):r+="@"+t[u].Origin;return i&&angular.forEach(t,function(t){s+=t+", ";r=n.AirportDetails;r=r.filter(function(n){return n.Value==t});o+=r[0].Name+", ";r=o.replace(/,\s*$/,"");n.morestopsHind=s.replace(/,\s*$/,"")}),r};n.CancellationPolicy=!1;n.FareDetails=function(){var i,t,h,s,c,wt,bt,u;try{var f=n.Adult_Count,e=n.Child_Count,o=n.Infant_Count,b=0,k=0,d=0,g=0,nt=0,y=0,tt=0,l=0,it=0,rt=0,ut=0,ft=0,et=0,p=0,ot=0,a=0,st=0,ht=0,ct=0,lt=0,at=0,w=0,vt=0,v=0,yt=0,pt=0,kt=0,dt=0,gt=0,r;for(n.APTArray=[],n.CurrentFares=[],u=0;u<n.FlightBooking.Trips.length;u++)if(n.FlightBooking.Trips[u].Pushed==!0){for(r=n.FlightBooking.Trips[u].SelectedFare,n.CurrentFares.push(r),i=r.FareDetails,n.BookingType=="ROUNDTRIP"?n.GSTMandatory||(n.GSTMandatory=r.GSTMandatory!=null?r.GSTMandatory:r[0].GSTMandatory,n.ApplyGST=r.GSTMandatory!=null?r.GSTMandatory:r[0].GSTMandatory):n.GSTMandatory||(n.GSTMandatory=r.GSTMandatory!=null?r.GSTMandatory:r[0].GSTMandatory,n.ApplyGST=r.GSTMandatory!=null?r.GSTMandatory:r[0].GSTMandatory),n.FlightBooking.Trips[u].TravelDate=n.OngoingDate,t=0;t<i.length;t++)for(i[t].PAX_Type==0?(l+=i[t].Total_Amount,b+=i[t].Basic_Amount,k+=i[t].AirportTax_Amount,d+=i[t].YQ_Amount,g+=i[t].Trade_Markup_Amount,nt+=i[t].Service_Fee_Amount,y+=i[t].Gross_Commission,tt+=i[t].Net_Commission):i[t].PAX_Type==1?(a+=i[t].Total_Amount,it+=i[t].Basic_Amount,rt+=i[t].AirportTax_Amount,ut+=i[t].YQ_Amount,ft+=i[t].Trade_Markup_Amount,et+=i[t].Service_Fee_Amount,p+=i[t].Gross_Commission,ot+=i[t].Net_Commission):(v+=i[t].Total_Amount,st+=i[t].Basic_Amount,ht+=i[t].AirportTax_Amount,ct+=i[t].YQ_Amount,lt+=i[t].Trade_Markup_Amount,at+=i[t].Service_Fee_Amount,w+=i[t].Gross_Commission,vt+=i[t].Net_Commission),h=i[t].AirportTaxes,s=0;s<h.length;s++)i[t].PAX_Type==0?n.APTArray.push({FlightID:r.Flight_Id,TaxCode:h[s].Tax_Code,TaxAmount:h[s].Tax_Amount*f}):i[t].PAX_Type==1?n.APTArray.push({FlightID:r.Flight_Id,TaxCode:h[s].Tax_Code,TaxAmount:h[s].Tax_Amount*e}):n.APTArray.push({FlightID:r.Flight_Id,TaxCode:h[s].Tax_Code,TaxAmount:h[s].Tax_Amount*o});u==0&&(kt=l*f,dt=a*e,gt=v*o,pt=kt+dt+gt,n.OnetimePromoAdultTotal=l,n.OnetimePromoChildTotal=a,n.OnetimePromoInfantTotal=v)}l=l*f;a=a*e;v=v*o;b=b*f;it=it*e;st=st*o;k=k*f;rt=rt*e;ht=ht*o;d=d*f;ut=ut*e;ct=ct*o;g=g*f;ft=ft*e;lt=lt*o;nt=nt*f;et=et*e;at=at*o;y=y*f;p=p*e;w=w*o;tt=tt*f;ot=ot*e;vt=vt*o;yt=l+a+v;n.APTDetails=n.APTArray;n.APT_FilterUniqueCodes=[];c={};n.APTDetails.forEach(function(n){c[n.TaxCode]=c.hasOwnProperty(n.TaxCode)?c[n.TaxCode]+n.TaxAmount:n.TaxAmount});wt=[];for(bt in c)wt.push({TaxCode:bt,TaxAmount:c[bt]});if(n.APT_FilterUniqueCodes=wt,n.Adult_BaseFare=b,n.Adult_Taxes=k,n.Adult_YQ=d,n.Adult_Markup=g,n.Adult_ServiceFee=nt,n.Child_BaseFare=it,n.Child_Taxes=rt,n.Child_YQ=ut,n.Child_Markup=ft,n.Child_ServiceFee=et,n.Infant_BaseFare=st,n.Infant_Taxes=ht,n.Infant_YQ=ct,n.Infant_Markup=lt,n.Infant_ServiceFee=at,n.TotalTicketCost=yt,n.OnwardTicketCost=pt,n.ReturnTicketCost=yt-pt,n.AdultGrossCommission=y,n.ChildGrossCommission=p,n.InfantGrossCommission=w,n.GrossCommission=y+p+w,n.NetCommission=tt+ot+vt,Config.TaxSplitupShow||(n.BasefareDiscount=n.GrossCommission,n.TaxDiscount=0,n.GrossCommission<=n.Adult_Taxes+n.Adult_Markup+n.Child_Taxes+n.Child_Markup+n.Infant_Taxes+n.Infant_Markup+n.Adult_ServiceFee+n.Child_ServiceFee+n.Infant_ServiceFee&&(n.BasefareDiscount=0,n.TaxDiscount=n.GrossCommission,n.AdultGrossCommission=0,n.ChildGrossCommission=0,n.InfantGrossCommission=0),n.UserInfo&&n.UserInfo.B2BFlag&&(n.BasefareDiscount=0,n.TaxDiscount=0)),n.BookingType=="SPECIALROUNDTRIP")for(n.SpecialRoundtrip_Oneway=[],n.SpecialRoundtrip_Return=[],u=0;u<n.FlightBooking.Trips[0].Segments.length;u++)n.FlightBooking.Trips[0].Segments[u].Return_Flight!=!0?n.SpecialRoundtrip_Oneway.push(n.FlightBooking.Trips[0].Segments[u]):n.SpecialRoundtrip_Return.push(n.FlightBooking.Trips[0].Segments[u]);n.RePriceStatus==!0&&(localStorage.setItem("TotalTicketCost",n.TotalTicketCost),n.SearchTotalCost!=n.TotalTicketCost&&ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide")},"<div class='col-12 d-flex justify-content-center'><img src='Content/Images/cost_increase.png' style='width:40%;' /><\/div><br/><div style='text-align: center;'>Oops, the fare you selected has changed. Old Fare - <b style='font-size: larger;'> &#8377;"+n.SearchTotalCost+"<\/b style='font-size: larger;'> New Fare - <b> &#8377;"+n.TotalTicketCost+"<\/b>.Please Press OK to Proceed with the New fare. Cancel to go back and search another Flight.<\/div>",function(){$("#ConfirmationModal").modal("hide");n.ChangeFlight(!0)}))}catch(ni){}};n.CityResponseFormatter=function(t){var i=t.data;if(i.Status=="1")return n.CitySource=i.Data,i};n.ShowFareRule=function(){$("#ShowFareRule").modal("show")};n.HideFarRuleModal=function(){$("#ShowFareRule").modal("hide")};n.RadioAction=function(t){t==1&&n.Cheapest&&(n.highest=!1);t==2&&(n.Cheapest=n.highest?!1:!0);t==3&&n.Earliest&&(n.Latest=!1);t==4&&n.Latest&&(n.Earliest=!1);t==5&&n.AEarliest&&(n.ALatest=!1);t==6&&n.ALatest&&(n.AEarliest=!1);t==7&&n.Shortest&&(n.Longer=!1);t==8&&n.Longer&&(n.Shortest=!1)};n.RadioActionRoundTrip=function(t){t==1&&n.RCheapest&&(n.Rhighest=!1);t==2&&(n.RCheapest=n.Rhighest?!1:!0);t==3&&n.REarliest&&(n.RLatest=!1);t==4&&n.RLatest&&(n.REarliest=!1);t==5&&n.RAEarliest&&(n.RALatest=!1);t==6&&n.RALatest&&(n.RAEarliest=!1);t==7&&n.RShortest&&(n.RLonger=!1);t==8&&n.RLonger&&(n.RShortest=!1)};n.ShowDefenceMsg=function(){try{if(n.Defence==!0)ShowConfirmationModal(function(){n.ResultHeaderVisible&&(n.SearchBoxIsVisible=!0,n.ResultHeaderVisible=!1,n.ShowTopPackageList=!0);$("#ConfirmationModal").modal("hide")},"Use this option if you are, a serving/retired personnel of the Indian Armed Forces or Indian Paramilitary Forces. You may also select this option if you are valid Dependent (Spouse/Child/Parent) of a serving/retired Indian Armed Forces and Indian Paramilitary Forces Personnel.<b> Please note valid military ID will be required for all passengers at Airline's check-in counter for tickets booked using this option.<\/b>",function(){n.Defence=!1;$("#ConfirmationModal").modal("hide")});else n.DefenceTrack={},n.Category="Indian Army",n.ServiceNumber="",n.DefenceContinueFlag=!1,localStorage.setItem("DefenceTrack",JSON.stringify(n.DefenceTrack)),n.ResultHeaderVisible&&(n.SearchBoxIsVisible=!0,n.ResultHeaderVisible=!1,n.ShowTopPackageList=!0)}catch(t){}};n.DefenceContinue=function(){try{n.DefenceContinueFlag=!0;n.DefenceTrack={};n.DefenceTrack.Category=n.Category;n.DefenceTrack.ServiceNumber=n.ServiceNumber;localStorage.setItem("DefenceTrack",JSON.stringify(n.DefenceTrack));e(function(){$("#DefenceModel").modal("hide");e(function(){n.Search()},500)},500)}catch(t){}};n.changepaxType=function(){try{n.PassengerDetail.Title=="Mr"?n.PassengerDetail.Gender="Male":n.PassengerDetail.Title=="Mstr"?n.PassengerDetail.Gender="Male":n.PassengerDetail.Title=="Mrs"?n.PassengerDetail.Gender="Female":n.PassengerDetail.Title=="Ms"&&(n.PassengerDetail.Gender="Female")}catch(t){}};n.GetOriginalTrips=function(n){var t=[],u,i,r;try{for(u=JSON.parse(LZString.decompress(sessionStorage.getItem("AirlineSearchResult"))),i=0;i<u.length;i++)r=JSON.parse(u[i].pstrSearchResponse).TripDetails[n].Flights,r.length>0&&(t.length>0?Array.prototype.push.apply(t,r):t=r.slice(0))}catch(f){}return t};n.OpenViewFlights=function(t){n.ViewTripFlights=n.GetTripSettings(t);n.DetailClick=!0;n.BookingType=="SPECIALROUNDTRIP"&&Config.ChannelId!="3"&&(n.OnwardSegmentsDetails=n.GetSegmentSettings(n.ViewTripFlights,1),n.ReturnSegmentsDetails=n.GetSegmentSettings(n.ViewTripFlights,2));$("#ViewDetails").modal("show")};n.GetGSTMode=function(){n.GSTAvailable?(n.SelectedGSTMode="GSTExist",n.ChangeGSTMode(0),$("#GSTExist").prop("checked",!0)):n.ChangeGSTMode(1)};n.activetime=moment();d=moment(n.activetime).add(Config.SearchMaxTime,"minutes");g=d;b=setInterval(function(){var i=(new Date).getTime(),t=g-i,r=Math.floor(t/864e5),u=Math.floor(t%864e5/36e5),f=Math.floor(t%36e5/6e4),e=Math.floor(t%6e4/1e3);t<0&&(clearInterval(b),n.ShowSessionconfirmation())},1e3);n.activetime==""&&(n.activetime=moment(localStorage.getItem("ActiveTime")),clearInterval(b));n.GetCauroselIndexDynamic=function(n,t){if(n%4==0&&n!=0)return t?n:n+3}}]);app.controller("FlightBookingCtrl",["$scope","$http","$window","$timeout","$q","$rootScope","Data","UUID","Session","$sce",function(n,t,r,u,f,e,o,s,h,c){function y(){var t,n;Config.ChannelId=="3"?(t=parseInt($(window).width()),n=parseInt($(window).height()),n=n-160,document.getElementById("complaint-box-content").style.height=n+"px",document.getElementById("complaint-box").style.width=t>400?"40%":"75%",$("#SidePushBox-modal").show()):(t=parseInt($(window).width()),n=parseInt($(window).height()),n=n-120,$("#FrequentPassanger").modal("show"))}var v,g,a,p,k,d,w,l,b;if(n.BasefareDiscount=0,u(function(){e.ModuleID=4},500),n.TaxDiscount=0,n.Iswhatsapp=!0,n.RetryPayment=!1,n.MetaBooking=!1,n.MetaRequestID="",n.MetaFlightID="",n.ShowPrePaid=!0,n.IsMetaDetailshow=!1,v=window.location.search.toString().toLowerCase(),v.indexOf("request")<=-1&&v.indexOf("flightid")<=-1){if(localStorage.getItem("PreviousCtrl")=="paymentgateway"){e.LoadPage("FlightConfirmation");return}if(localStorage.getItem("PreviousCtrl")!="search"){e.LoadPage("home");return}n.IsMetaDetailshow=!0}else n.ShowPrePaid=!1;n.Remarks="";n.AddNewPassengers=[];n.AddNewPassengersList=[];n.PassengerGrid=[];n.Promoinput=!0;n.PromoOutput=!1;n.ProcessID=s.Get();n.CustomerMobileNumber="";n.SelectedCostCenter="99";n.EmailID="";n.ProductCommissionFlag=!1;n.HandlingChargesFlag=!1;n.GSTEntryName="";n.GSTEntryNumber="";n.GSTEntryAddress="";n.ApplyGST=!1;n.ShowGST=!1;n.SelectedGSTMode="GSTNew";n.UserInfo&&(n.CustomerMobileNumber=n.UserInfo.CustomerMobile,n.PaxMobileNumber=n.UserInfo.CustomerMobile,n.EmailID=n.UserInfo.EmailID,n.HandlingChargesFlag=!1,n.UserInfo.B2BFlag&&(e.GetCostCenter(),n.HandlingChargesFlag=!0,Config.TaxSplitupShow=!0,e.ShowRetailFare=!0,Config.TaxSplitupShow=!0,n.ShowNetFare=!0,n.ShowFullFare=!0));g=[];n.ClassFare=function(t,i,r){var u;try{if(n.ResClick=!0,n.onCancellationPolicy=!1,n.reCancellationPolicy=!1,n.CancellationPolicy=!1,n.SelectedFareTab=t,$("#carouVal1").removeClass("active"),$("#carouVal").addClass("active"),n.BookingType=="ONE_WAY"||n.BookingType=="SPECIALROUNDTRIP"){for(u=0;u<10;u++)n.ChkMore[u].Selected=!1;n.TripFlights=i;r==0&&(n.HeaderTripFlights=[],n.HeaderTripFlights[0]=i[0],n.FlightBooking.Trips[0].FilterShowFare=n.HeaderTripFlights[0].Fares.filter(function(n){return n.Hide_Fare!=!0}),n.ChangeClassRefundable=i.SelectedFare.Refundable,n.HeaderTripFlights.SelectedFare=i.SelectedFare,n.TravelClass_Desc=i.SelectedFare.FareDetails[0].FareClasses[0].Class_Desc.split("-")[0],n.SelectedPromoAmount=i.SelectedFare.FareDetails[0].PromoAmount,n.FarePolicyContent=n.GetFarePolicyContent(i.SelectedFare.FareDetails[0]),n.MoreFareAmount=n.CalculatemoreFareAmount(i.SelectedFare.FareDetails[0],n.SelectedPromoAmount),n.SelectedFareTotal=i.SelectedFare.FareDetails[0].Total_Amount,n.ChkMore[n.GetSelectedIndex(i)].Selected=!0)}if(n.BookingType=="ROUNDTRIP"&&r==0){for(n.FarePolicyContent="",u=0;u<5;u++)n.ChkMoreOnward[u].Selected=!1,n.ChkMoreReturn[u].Selected=!1;n.HeaderTripFlights=[];n.HeaderTripFlights=i;n.FlightBooking.Trips[0].FilterShowFare=n.HeaderTripFlights[0].Fares.filter(function(n){return n.Hide_Fare!=!0});n.FlightBooking.Trips[1].FilterShowFare=n.HeaderTripFlights[1].Fares.filter(function(n){return n.Hide_Fare!=!0});n.ChangeClassRefundable=i[0].SelectedFare.Refundable;n.HeaderTripFlights[0].SelectedFare=i[0].SelectedFare;n.HeaderTripFlights[1].SelectedFare=i[1].SelectedFare;n.TravelClass_Desc=i[0].SelectedFare.FareDetails[0].FareClasses[0].Class_Desc.split("-")[0];n.FarePolicyContent="";n.onwardTotalAmount=n.CalculatemoreFareAmount(i[0].SelectedFare.FareDetails[0],0);n.returnTotalAmount=n.CalculatemoreFareAmount(i[1].SelectedFare.FareDetails[0],0);n.FarePolicyContent=n.GetFarePolicyContent(i[0].SelectedFare.FareDetails[0]);n.ReturnFarePolicyContent=n.GetFarePolicyContent(i[1].SelectedFare.FareDetails[0]);n.MoreFareAmount=n.onwardTotalAmount+n.returnTotalAmount;n.ReturnWithoutcommission=i[0].SelectedFare.FareDetails[0].Total_Amount+i[1].SelectedFare.FareDetails[0].Total_Amount;n.ongoingTotalAmount=i[0].SelectedFare.FareDetails[0].Total_Amount;n.ReturnFlightTotalAmount=i[1].SelectedFare.FareDetails[0].Total_Amount;n.ReturnTravelClass_Desc=i[1].SelectedFare.FareDetails[0].FareClasses[0].Class_Desc.split("-")[0];n.ChkMoreOnward[n.GetSelectedIndex(i[0])].Selected=!0;n.ChkMoreReturn[n.GetSelectedIndex(i[1])].Selected=!0}$("#TravelClassDetails").modal("show")}catch(f){}};n.GetSelectedIndex=function(n){try{for(var t=0;t<n.FilterShowFare.length;t++)if(n.FilterShowFare[t].Fare_Id==n.SelectedFare.Fare_Id)return t}catch(i){}};n.CloseFareClass=function(t){var i;if(n.BookingType!="ROUNDTRIP")for(n.HeaderTripFlights[0]=t,n.HeaderTripFlights[0].SelectedFare=t.SelectedFare,$("#TravelClassDetails").modal("hide"),i=0;i<n.ChkMore.length;i++)n.ChkMore[i].Selected=!1;else{for(n.HeaderTripFlights[0]=t[0],n.HeaderTripFlights[0].SelectedFare=t[0].SelectedFare,n.HeaderTripFlights[1]=t[1],n.HeaderTripFlights[1].SelectedFare=t[1].SelectedFare,$("#TravelClassDetails").modal("hide"),i=0;i<n.ChkMoreOnward.length;i++)n.ChkMoreOnward[i].Selected=!1;for(i=0;i<n.ChkMoreReturn.length;i++)n.ChkMoreReturn[i].Selected=!1}};n.ChangeClassFare=function(t,i,r,u){try{n.SelectedClassIndex=t;n.ChangeClassRefundable=i.Refundable;n.FlightBooking.Trips[0].SelectedFare=i;n.SelectedFareTotal=r[0].Total_Amount;n.TravelClass_Desc=r[0].FareClasses[0].Class_Desc.split("-")[0];n.SelectedPromoAmount=u;n.FarePolicyContent=n.GetFarePolicyContent(r[0]);n.MoreFareAmount=n.CalculatemoreFareAmount(r[0],u);n.TravelClass_Desc=r[0].FareClasses[0].Class_Desc.split("-")[0];n.ReturnTravelClass_Desc=r[0].FareClasses[0].Class_Desc.split("-")[0];for(var f=0;f<n.ChkMore.length;f++)t!=f&&(n.ChkMore[f].Selected=!1);n.FareDetails()}catch(e){}};n.ChangePolicyContent=function(t,i,r){n.onCancellationPolicy=!1;n.reCancellationPolicy=!1;r?i?(n.reCancellationPolicy=!0,n.ReSelectedFareRule=t,Config.ChannelId!=3&&$("#ShowFareRule").modal("show")):(n.onCancellationPolicy=!0,n.SelectedFareRule=t,Config.ChannelId!=3&&$("#ShowFareRule").modal("show")):config.ChannelId!=3&&$("#ShowFareRule").modal("hide")};n.ChangeRoundTripClassFare=function(t,i,r,u,f,e,o){try{t?(n.SelectedRClassIndex=r,n.FlightBooking.Trips[1].SelectedFare=o,n.ReturnTravelClass_Desc=f.FareClasses[0].Class_Desc.split("-")[0],n.ReturnFarePolicyContent=n.GetFarePolicyContent(f),n.returnTotalAmount=n.CalculatemoreFareAmount(f,0),n.ReturnFlightTotalAmount=f.Total_Amount):(n.SelectedOClassIndex=r,n.ChangeClassRefundable=o.Refundable,n.FlightBooking.Trips[0].SelectedFare=o,n.TravelClass_Desc=f.FareClasses[0].Class_Desc.split("-")[0],n.FarePolicyContent=n.GetFarePolicyContent(f),n.onwardTotalAmount=n.CalculatemoreFareAmount(f,0),n.ongoingTotalAmount=f.Total_Amount);n.MoreFareAmount=n.onwardTotalAmount+n.returnTotalAmount;n.ReturnWithoutcommission=n.ongoingTotalAmount+n.ReturnFlightTotalAmount;n.FareDetails("",!0)}catch(s){}};n.ChkMoreOnward=[];n.ChkMoreReturn=[];n.ClassFareBaggage=function(n){var i,t;try{for(i="",t=0;t<n.length;t++)i+="<div class='d-flex justify-content-start mb-1'> <div class='mr-2' style='color: green;'>&#x2713;<\/div> <div> "+n[t]+"<\/div> <\/div>";return c.trustAsHtml(i)}catch(r){}};n.MoreClassFare={};n.ChkMore=[];n.ChkMore=[{Selected:!0},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1}];n.ChkMoreOnward=[{Selected:!0},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1}];n.ChkMoreReturn=[{Selected:!0},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1}];n.CalculatemoreFareAmount=function(t,i,r){try{(i==null||i=="")&&(i=0);n.BookingType=="ROUNDTRIP"&&(i=0);var u=t.Gross_Commission+parseFloat(i);return n.UserInfo?n.UserInfo.B2BFlag&&(u=parseFloat(i)):r&&(u=parseFloat(i)),parseFloat(t.Total_Amount-u)}catch(f){}};n.CreateTrips=function(){var r,u,t,i;try{for(r=[],u=0,u=n.BookingType=="ONE_WAY"||n.BookingType=="SPECIALROUNDTRIP"||n.MultiCity_Fare==!0?1:n.BookingType=="ROUNDTRIP"?2:n.TripList.length,t=0;t<u;t++)i={},i.TripIndex=t,i.Pushed=!1,r.push(i);return r}catch(f){}};n.PushTrips=function(t,i){var f,u,r;try{if(f=n.BookingType,u=!1,t.length>0)for(r=0;r<t.length;r++)t[r].TripIndex==i.TripIndex&&(t[r]=i,t[r].SelectedFare=i.Fares[0],u=!0);u==!1&&t.push(i)}catch(e){}return t};n.ClassCodeVaildate=function(){var t,i;try{for(n.FlightBooking=JSON.parse(localStorage.getItem("FlightObject")),t=n.FlightBooking.Trips[0].SelectedFare,i=0;i<t.length;i++)if(t.GSTMandatory==!0)return!1;if(n.BookingType=="ROUNDTRIP")for(t=n.FlightBooking.Trips[0].SelectedFare,i=0;i<t.length;i++)if(t.GSTMandatory==!0)return!1;return!0}catch(r){}};n.ShowFareRule=function(){$("#ShowFareRule").modal("show")};n.ClassCodeVaildate();n.FrequentFlyer={};n.FareDetailsVisible=!0;n.CustomerDetailsIsVisible=!1;n.FlightOriginIsVisible=!0;n.CustomerFetchIsVisible=!0;n.PassengerDummyVisible=!1;n.AddONVisible=!1;n.GSTAvailable=!1;n.ReturnVisible=!1;n.AdultDetails=!1;n.ChildDetails=!1;n.InfantDetails=!1;n.FlightBooking={};n.RePriceStatus=!1;n.SSRStatus=!1;n.SeatMapStatus=!1;n.FLIGHTDETAILSIsVisible=!0;n.TRAVELLERDETAILSIsVisible=!1;n.PAYMENTMODEIsVisible=!1;n.FareSummaryIsVisible=!0;n.PassengerDetail=[];n.SelectedSSR=[];n.Travel_Type="DOMESTIC";n.TotalSeatAmount=0;n.Addon_Meals_Fees=0;n.AddOn_Fees_WOSeats=0;n.AddOn_Fees=0;n.Addon_Seat_Fees=0;n.Addon_Baggage_Fees=0;e.Gateway_Charges=0;n.BlockAvailable=!1;n.BlockingFlag=0;n.AddNewPaxSuccess=!1;n.PG_Mode=[];n.DealDetailsVisible=!1;n.PassengerList=function(n){return new Array(n)};n.GSTMandatory=!1;n.SetAge=function(){var n,i;try{var t=[];for(n=1;n<110;n++)i={id:n,name:n.toString()},t.push(i);return t}catch(r){}};n.users=n.SetAge();n.InitDate=function(){var t,i;try{n.OngingDate=getDayNameMonth(n.OngoingDate);t=new Date;n.adFrom12Years=t.setFullYear(t.getFullYear()-12);n.adDOBMinDate=moment().subtract(100,"Y").format("x");n.adDOBMaxDate=moment(n.OngingDate).subtract(12,"Y").format("x");i=new Date;n.chFrom2Years=i.setFullYear(i.getFullYear()-2);n.chDOBMinDate=moment().subtract(14,"Y").format("x");n.chDOBMaxDate=moment().subtract(2,"Y").format("x");n.infDOBMinDate=moment().subtract(2,"Y").format("x");n.infDOBMaxDate=moment().subtract(0,"days").format("x")}catch(r){}};n.InitDate();n.CGSTApply=!1;n.CodeNotValid=!1;n.BookingType="ONE_WAY";n.GetAirlineList=function(){try{u(function(){n.AirlineList=lobjAirlineList;angular.forEach(n.AirlineList,function(t){t.AirlineType=="FSC"&&n.FSCAirlineList.push(t)})},1e3)}catch(t){}};n.GetAirlineList();n.FilterAirport=function(n,i){var r;try{if(r=lobjAirportList.filter(function(t){return i==1?t.Value.toUpperCase()==n.toUpperCase():t.Name.toUpperCase().indexOf(n.toUpperCase())>-1?t:void 0}),r.length>0)return r[0];var u=n,f=Config.Api+Config.FlightCitySearchURL+u,o=t.get(f);o.then(function(n){var i=n.data.Data,t=i.filter(function(n){return n.Value==u});return t.length<=0&&e.LoadPage("home"),r=t,r.length>0?r[0]:void 0})}catch(h){}};n.CombineSegments=function(t){var u,i,r;try{for(u=[],i=0;i<t.length;i++)if(t[i].Pushed==!0)for(r=0;r<t[i].Segments.length;r++)t[i].Segments[r].Flight_Index=i,t[i].Segments[r].Flight_Id=t[i].Flight_Id,n.BookingType=="ROUNDTRIP"&&i==1&&(t[i].Segments[r].Return_Flight=!0),u.push(t[i].Segments[r]);n.FlightSegments=u;n.FlightTrips=t}catch(f){}};n.getUnique=function(n){var t=[];for(i=0;i<n.length;i++)t.indexOf(n[i])===-1&&t.push(n[i]);return t};n.TripDetails=function(){try{var t=JSON.parse(localStorage.getItem("FlightObject"));e.AirBookingType=t.BookingType;n.FlightBooking=t;n.ProcessID=t.ProcessID;n.AdultCount=t.Adult_Count;n.ChildCount=t.Child_Count;n.InfantCount=t.Infant_Count;n.OngoingDate=t.OngoingDate;n.ReturnDate=t.ReturnDate;n.OriginCode=t.OriginCode;n.DestinationCode=t.DestinationCode;n.Refundable=t.Refundable;n.BookingType=t.BookingType;n.Travel_Type=t.Travel_Type;n.Travel_Class=t.Travel_Class;n.OriginName=t.OriginName;n.DestinationName=t.DestinationName;e.OName=n.OriginName;e.DName=n.DestinationName;n.CombineSegments(t.Trips);n.ongoing_AirlineCode=t.Trips[0].Airline_Code;n.OngoingProductClass=t.Trips[0].SelectedFare.ProductClass;n.From=t.From;n.To=t.To;n.RoundTrip_Fare=t.RoundTrip_Fare;n.DirectFlight=t.DirectFlight;n.Travel_Class=t.Travel_Class;n.HostSearch=t.HostSearch;e.Biller_Id=t.Trips[0].Biller_Id;e.SupplierId=t.Trips[0].Supplier_Id;e.SubbillerCode=t.Trips[0].Airline_Code;n.BookingType=="ROUNDTRIP"&&(n.ReturnVisible=!0,n.Return_AirlineCode=t.Trips[1].Airline_Code,n.ReturnProductClass=t.Trips[1].SelectedFare.ProductClass);n.Adult_Count=t.Adult_Count;n.Child_Count=t.Child_Count;n.Infant_Count=t.Infant_Count;n.FSCAirlineList=[];u(function(){e.GetCountryList()},900);n.GetAirlineList()}catch(i){}};n.GetAirlineList=function(){try{u(function(){n.AirlineList=lobjAirlineList;angular.forEach(n.AirlineList,function(t){t.AirlineType=="FSC"&&n.FSCAirlineList.push(t)})},1e3)}catch(t){}};n.GetAirlineList();n.CombineSegments=function(t){var u,i,r;try{for(u=[],i=0;i<t.length;i++)if(t[i].Pushed==!0)for(r=0;r<t[i].Segments.length;r++)t[i].Segments[r].Flight_Index=i,t[i].Segments[r].Flight_Id=t[i].Flight_Id,n.BookingType=="ROUNDTRIP"&&i==1&&(t[i].Segments[r].Return_Flight=!0),u.push(t[i].Segments[r]);n.FlightSegments=u;n.FlightTrips=t}catch(f){}};n.getUnique=function(n){var t=[];for(i=0;i<n.length;i++)t.indexOf(n[i])===-1&&t.push(n[i]);return t};n.FareDetails=function(t,i){var f,r,a,l,v,dt,gt,o;try{var s=n.Adult_Count,h=n.Child_Count,c=n.Infant_Count,g=0,nt=0,tt=0,it=0,rt=0,b=0,ut=0,y=0,ft=0,et=0,ot=0,st=0,ht=0,k=0,ct=0,p=0,lt=0,at=0,vt=0,yt=0,pt=0,d=0,wt=0,w=0,bt=0,kt=0,ni=0,ti=0,ii=0,e;for(n.APTArray=[],n.CurrentFares=[],o=0;o<n.FlightBooking.Trips.length;o++)if(n.FlightBooking.Trips[o].Pushed==!0){for(e=n.FlightBooking.Trips[o].SelectedFare,n.CurrentFares.push(e),f=e.FareDetails,n.BookingType=="ROUNDTRIP"?n.GSTMandatory||(n.GSTMandatory=e.GSTMandatory!=null?e.GSTMandatory:e[0].GSTMandatory,n.ApplyGST=e.GSTMandatory!=null?e.GSTMandatory:e[0].GSTMandatory,n.ShowGST=e.GST_Allowed!=null?e.GST_Allowed:e[0].GST_Allowed):n.GSTMandatory||(n.GSTMandatory=e.GSTMandatory!=null?e.GSTMandatory:e[0].GSTMandatory,n.ApplyGST=e.GSTMandatory!=null?e.GSTMandatory:e[0].GSTMandatory,n.ShowGST=e.GST_Allowed!=null?e.GST_Allowed:e[0].GST_Allowed),n.FlightBooking.Trips[o].TravelDate=n.OngoingDate,r=0;r<f.length;r++)for(f[r].PAX_Type==0?(y+=f[r].Total_Amount,g+=f[r].Basic_Amount,nt+=f[r].AirportTax_Amount,tt+=f[r].YQ_Amount,it+=f[r].Trade_Markup_Amount,rt+=f[r].Service_Fee_Amount,b+=f[r].Gross_Commission,ut+=f[r].Net_Commission):f[r].PAX_Type==1?(p+=f[r].Total_Amount,ft+=f[r].Basic_Amount,et+=f[r].AirportTax_Amount,ot+=f[r].YQ_Amount,st+=f[r].Trade_Markup_Amount,ht+=f[r].Service_Fee_Amount,k+=f[r].Gross_Commission,ct+=f[r].Net_Commission):(w+=f[r].Total_Amount,lt+=f[r].Basic_Amount,at+=f[r].AirportTax_Amount,vt+=f[r].YQ_Amount,yt+=f[r].Trade_Markup_Amount,pt+=f[r].Service_Fee_Amount,d+=f[r].Gross_Commission,wt+=f[r].Net_Commission),a=f[r].AirportTaxes,l=0;l<a.length;l++)f[r].PAX_Type==0?n.APTArray.push({FlightID:e.Flight_Id,TaxCode:a[l].Tax_Code,TaxAmount:a[l].Tax_Amount*s}):f[r].PAX_Type==1?n.APTArray.push({FlightID:e.Flight_Id,TaxCode:a[l].Tax_Code,TaxAmount:a[l].Tax_Amount*h}):n.APTArray.push({FlightID:e.Flight_Id,TaxCode:a[l].Tax_Code,TaxAmount:a[l].Tax_Amount*c});o==0&&(ni=y*s,ti=p*h,ii=w*c,kt=ni+ti+ii,n.OnetimePromoAdultTotal=y,n.OnetimePromoChildTotal=p,n.OnetimePromoInfantTotal=w)}y=y*s;p=p*h;w=w*c;g=g*s;ft=ft*h;lt=lt*c;nt=nt*s;et=et*h;at=at*c;tt=tt*s;ot=ot*h;vt=vt*c;it=it*s;st=st*h;yt=yt*c;rt=rt*s;ht=ht*h;pt=pt*c;b=b*s;k=k*h;d=d*c;ut=ut*s;ct=ct*h;wt=wt*c;bt=y+p+w;n.APTDetails=n.APTArray;n.APT_FilterUniqueCodes=[];v={};n.APTDetails.forEach(function(n){v[n.TaxCode]=v.hasOwnProperty(n.TaxCode)?v[n.TaxCode]+n.TaxAmount:n.TaxAmount});dt=[];for(gt in v)dt.push({TaxCode:gt,TaxAmount:v[gt]});if(n.APT_FilterUniqueCodes=dt,n.Adult_BaseFare=g,n.Adult_Taxes=nt,n.Adult_YQ=tt,n.Adult_Markup=it,n.Adult_ServiceFee=rt,n.Child_BaseFare=ft,n.Child_Taxes=et,n.Child_YQ=ot,n.Child_Markup=st,n.Child_ServiceFee=ht,n.Infant_BaseFare=lt,n.Infant_Taxes=at,n.Infant_YQ=vt,n.Infant_Markup=yt,n.Infant_ServiceFee=pt,n.TotalTicketCost=bt,n.OnwardTicketCost=kt,n.ReturnTicketCost=bt-kt,n.AdultGrossCommission=b,n.ChildGrossCommission=k,n.InfantGrossCommission=d,n.GrossCommission=b+k+d,n.NetCommission=ut+ct+wt,Config.TaxSplitupShow||(n.BasefareDiscount=n.GrossCommission,n.TaxDiscount=0,n.GrossCommission<=n.Adult_Taxes+n.Adult_Markup+n.Child_Taxes+n.Child_Markup+n.Infant_Taxes+n.Infant_Markup+n.Adult_ServiceFee+n.Child_ServiceFee+n.Infant_ServiceFee&&(n.BasefareDiscount=0,n.TaxDiscount=n.GrossCommission,n.AdultGrossCommission=0,n.ChildGrossCommission=0,n.InfantGrossCommission=0),n.UserInfo&&n.UserInfo.B2BFlag&&(n.BasefareDiscount=0,n.TaxDiscount=0)),n.BookingType=="SPECIALROUNDTRIP")for(n.SpecialRoundtrip_Oneway=[],n.SpecialRoundtrip_Return=[],o=0;o<n.FlightBooking.Trips[0].Segments.length;o++)n.FlightBooking.Trips[0].Segments[o].Return_Flight!=!0?n.SpecialRoundtrip_Oneway.push(n.FlightBooking.Trips[0].Segments[o]):n.SpecialRoundtrip_Return.push(n.FlightBooking.Trips[0].Segments[o]);n.RePriceStatus==!0&&(localStorage.setItem("TotalTicketCost",n.TotalTicketCost),n.SearchTotalCost!=n.TotalTicketCost&&ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide")},"<div class='col-12 d-flex justify-content-center'><img src='Content/Images/cost_increase.png' style='width:40%;' /><\/div><br/><div style='text-align: center;'>Oops, the fare you selected has changed. Old Fare - <b style='font-size: larger;'> &#8377;"+n.SearchTotalCost+"<\/b style='font-size: larger;'> New Fare - <b> &#8377;"+n.TotalTicketCost+"<\/b>.Please Press OK to Proceed with the New fare. Cancel to go back and search another Flight.<\/div>",function(){$("#ConfirmationModal").modal("hide");n.ChangeFlight(!0)}));u(function(){if(n.ApplyDeal(1),i)return!1;try{var t,r;n.BookingType!="ROUNDTRIP"?(n.FlightBooking.Trips[0].FilterShowFare.filter(function(i,r){if(i.Fare_Id==n.FlightBooking.Trips[0].SelectedFare.Fare_Id)return t=r}),n.SelectedClassIndex=t):(n.FlightBooking.Trips[0].FilterShowFare.filter(function(i,r){if(i.Fare_Id==n.FlightBooking.Trips[0].SelectedFare.Fare_Id)return t=r}),n.SelectedOClassIndex=t,n.FlightBooking.Trips[1].FilterShowFare.filter(function(t,i){if(t.Fare_Id==n.FlightBooking.Trips[1].SelectedFare.Fare_Id)return r=i}),n.SelectedRClassIndex=r)}catch(u){}},1e3)}catch(ri){}};n.MetaDetails=function(){var i,r;try{i=window.location.search.toString().toLowerCase();i.indexOf("request")>-1&&i.indexOf("flightid")>-1?(n.MetaFltId=GetURLParameter("flightid"),n.MetaFlightID=n.MetaFltId.split(","),i.indexOf("wego_click_id")>-1&&(n.wego_click_id=GetURLParameter("wego_click_id")),n.ProcessID=s.Get(),n.MetaDetailRequest={Header:n.GetHeader(n.ProcessID),Request_Id:GetURLParameter("request"),Flight_id:n.MetaFlightID},fnProgstart(),r=t({method:"POST",url:Config.Api+"FlightBooking/MetaDetail",dataType:"json",data:n.MetaDetailRequest,headers:{"Content-Type":"application/json"}}),r.then(function(t){var u,s,f,l,a,o;try{if(u=t.data,u.Status=="1"){s=u.Data.Flight;f=u.Data.SearchRequest;n.Adult_Count=f.Adult_Count;n.Child_Count=f.Child_Count;n.Infant_Count=f.Infant_Count;n.Travel_Type=f.Travel_Type==0?"DOMESTIC":"INTERNATIONAL";n.OngoingDate=f.TripInfo[0].TravelDate;n.MetasearchRetailer=u.Data.Retailer_Id;n.Metasearchsubretailerid=u.Data.SubRetailer_Id;Config.B2CRetailer.RetailerID=u.Data.Retailer_Id;Config.B2CRetailer.SubRetailerID=u.Data.SubRetailer_Id;n.UserInfo&&(n.UserInfo.RetailerId=u.Data.Retailer_Id,n.UserInfo.SubRetailerId=u.Data.SubRetailer_Id);n.HostSearch=!0;f.Booking_Type==0?n.BookingType="ONE_WAY":(n.BookingType="ROUNDTRIP",n.ReturnDate=f.TripInfo[1].TravelDate);l=n.GetCities(f.TripInfo[0].Origin,!0);a=n.GetCities(f.TripInfo[0].Destination,!1);localStorage.setItem("MetaSearchDetails",JSON.stringify(f));n.Travel_Class="";n.lobjFlight_Refundable="";n.RoundTrip_Fare="";n.DirectFlight="";var r={},h=[],c={};for(h=n.CreateTrips(),o=0;o<s.length;o++)lobjFlightDetails=s[o],lobjFlightDetails.TripIndex=o,lobjFlightDetails.Search_Key=u.Data.Search_Key,lobjFlightDetails.Pushed=!0,c=lobjFlightDetails,r.Trips=n.PushTrips(h,c,o);r.ProcessID=n.ProcessID;r.Adult_Count=n.Adult_Count;r.Child_Count=n.Child_Count;r.Infant_Count=n.Infant_Count;r.Travel_Type=n.Travel_Type;r.BookingType=n.BookingType;r.Travel_Class=f.Class_Of_Travel=="0"?"ECONOMY":f.Class_Of_Travel=="1"?"BUSINESS":f.Class_Of_Travel=="2"?"FIRST":"PREMIUM_ECONOMY";r.OngoingDate=moment(n.OngoingDate,"MM/DD/YYYY").format("DD/MM/YYYY");r.ReturnDate=n.BookingType=="ROUNDTRIP"?moment(n.ReturnDate,"MM/DD/YYYY").format("DD/MM/YYYY"):n.ReturnDate;r.Refundable=n.lobjFlight_Refundable;r.OriginName=n.OriginName;r.DestinationName=n.DestinationName;r.Discounted_Fare=!1;r.RoundTrip_Fare=n.RoundTrip_Fare;r.DirectFlight=n.DirectFlight;r.HostSearch=!1;r.From=n.From;r.To=n.To;r.PreFilledPassengers=[];r.MetaSearchFlag=1;r.MetaSearchRetailer_Id=u.Data.Retailer_Id;r.MetaSearchSubRetailer_Id=u.Data.SubRetailer_Id;r.wego_click_id=i.indexOf("wego_click_id")>-1?n.wego_click_id:"";r.WegoIMGStr=i.indexOf("wego_click_id")>-1?"https://srv.wego.com/analytics/v2/conversions?conversion_id=c-wego-happyfares.in&click_id="+n.wego_click_id+"&comm_currency_code=INR&bv_currency_code=INR&transaction_id=^transaction_ID^&commission=0&total_booking_value=^Book_Value^&status=^status^'":"";n.DirectFlight=!1;n.RoundTrip_Fare=!1;n.HostSearch=!1;n.Defence=!1;n.FlightBooking=r;localStorage.setItem("FlightObject",JSON.stringify(r));n.TripDetails();n.FareDetails();n.InitPG();n.IsMetaDetailshow=!0;fnProgstop()}else fnProgstop(),ShowAlert(u.Data.Error_Desc),n.TRAVELLERDETAILSIsVisible=!1,n.PassengerDummyVisible=!1,e.LoadPage("home")}catch(v){fnProgstop();e.LoadPage("home");ShowAlert("Error occured while processing your request. Please Search Again.","flights/"+lobjFlightBook.QueryString+"&Research=2","Search")}},function(){fnProgstop();e.LoadPage("home");ShowAlert("Error occured while processing your request. Please Search Again.","flights/"+lobjFlightBook.QueryString+"&Research=2","Search")})):(n.TripDetails(),n.FareDetails())}catch(f){}};n.GetCities=function(i,r){var u;try{if(u=lobjAirportList.filter(function(n){return n.Value.toUpperCase()==i.toUpperCase()}),u.length>0)lobjOrigin=u[0],r?(n.OriginID=lobjOrigin.Name,n.OriginName=lobjOrigin.Name,n.From={Flag:2,title:lobjOrigin.Name,description:"",image:"",originalObject:{Name:lobjOrigin.Name,PopCity:lobjOrigin.PopCity,Type:lobjOrigin.Type,Value:lobjOrigin.Value},title:lobjOrigin.Name}):(n.DestinationID=lobjOrigin.Name,n.DestinationName=lobjOrigin.Name,n.To={Flag:2,title:lobjOrigin.Name,description:"",image:"",originalObject:{Name:lobjOrigin.Name,PopCity:lobjOrigin.PopCity,Type:lobjOrigin.Type,Value:lobjOrigin.Value},title:lobjOrigin.Name});else{var f=i,o=Config.Api+Config.FlightCitySearchURL+f,s=t.get(o);s.then(function(t){var o=t.data.Data,i=o.filter(function(n){return n.Value==f});i.length<=0&&e.LoadPage("home");u=i;u.length>0&&(i=i[0],r?(n.OriginID=i.Name,n.OriginName=i.Name,n.From={Flag:2,title:i.Name,description:"",image:"",originalObject:{Name:i.Name,PopCity:i.PopCity,Type:i.Type,Value:i.Value},title:i.Name}):(n.DestinationID=i.Name,n.DestinationName=i.Name,n.To={Flag:2,title:i.Name,description:"",image:"",originalObject:{Name:i.Name,PopCity:i.PopCity,Type:i.Type,Value:i.Value},title:i.Name}))})}}catch(c){}};n.MetaDetails();n.InitPG();n.PushTripInfo=function(t,i){var f,r,u;try{for(f=[],r={},u=0;u<n.FlightBooking.Trips.length;u++)n.BookingType=="MULTICITY"&&n.FlightBooking.Discounted_Fare==!1?u==i&&n.FlightBooking.Trips[u].Pushed==!0&&(r={},t==1?r.Fare_Key=n.FlightBooking.Trips[u].SelectedFare.Fare_Key:t==2&&(r.Fare_Id=n.FlightBooking.Trips[u].SelectedFare.Fare_Id),r.Flight_Key=n.FlightBooking.Trips[u].Flight_Key,f.push(r)):(r={},t==1?r.Fare_Key=n.FlightBooking.Trips[u].SelectedFare.Fare_Key:t==2&&(r.Fare_Id=n.FlightBooking.Trips[u].SelectedFare.Fare_Id),r.Flight_Key=n.FlightBooking.Trips[u].Flight_Key,r.Flight_Numbers=n.FlightBooking.Trips[u].Flight_Numbers,r.ProductClass=n.FlightBooking.Trips[u].SelectedFare.ProductClass,r.Total_Amount=n.FlightBooking.Trips[u].SelectedFare.FareDetails[0].Total_Amount,f.push(r));return f}catch(e){}};n.EnableCount=0;n.PushFlightInfo=function(){var i,t;try{return i=[],n.BookingType=="ROUNDTRIP"||n.BookingType=="SPECIALROUNDTRIP"?(t={},t.Origin=n.To.originalObject.Value,t.Destination=n.From.originalObject.Value,t.TravelDate=moment(n.ReturnDate,"DD/MM/YYYY").format("MM/DD/YYYY"),t.Trip_Id=2,i.push(t)):(t={},t.Origin=n.From.originalObject.Value,t.Destination=n.To.originalObject.Value,t.TravelDate=moment(n.OngoingDate,"DD/MM/YYYY").format("MM/DD/YYYY"),t.Trip_Id=1,i.push(t)),i}catch(r){}};n.ShowHideClassFareDetails=!1;n.RePrice=function(i){var f,o,r,s;try{if(window.scrollTo(0,0),(n.CustomerMobileNumber==null||n.CustomerMobileNumber==""&&n.PaxMobileNumber!="")&&(n.CustomerMobileNumber=n.PaxMobileNumber),n.MobileNumberValidate(n.PaxMobileNumber))return $("#txtMobileNo").focus(),!1;if(n.EmailValidate(n.EmailID))return $("#txtEmail").focus(),!1;if(f=JSON.parse(localStorage.getItem("FlightObject")),n.EnableCount=1,n.SearchTotalCost=n.TotalTicketCost,i==1&&(n.RepriceTicketCost=n.TotalTicketCost),n.PassengerDummyVisible=!0,n.FareDetailsVisible=!1,n.Thread_Count=1,n.Thread_Completed=0,n.BookingType=="MULTICITY"&&n.FlightBooking.Discounted_Fare==!1)for(o=0;o<n.FlightBooking.Trips.length;o++)n.FlightBooking.Trips[o].Pushed==!0&&n.Thread_Count++;for(r=0;r<n.Thread_Count;r++)n.FlightBooking.Trips[r].Pushed==!0&&(n.RePriceRequest={ProcessID:n.ProcessID,Trips:n.PushTripInfo(2,r),Search_Key:n.FlightBooking.Trips[r].Search_Key,Customer_Mobile:n.UserInfo?n.UserInfo.B2BFlag==0?n.UserInfo.CustomerMobile:n.PaxMobileNumber:n.PaxMobileNumber,GST_Input:n.GSTMandatory,Header:n.GetHeader(n.ProcessID),Customer_Email:n.EmailID,B2BFlag:n.UserInfo?n.UserInfo.B2BFlag:1,AirSearchRequest:{ThreadIndex:n.FlightBooking.Trips[0].InventoryType,Adult_Count:n.Adult_Count,Child_Count:n.Child_Count,Infant_Count:n.Infant_Count,Class_Of_Travel:n.Travel_Class,Excluded_Airline:[{Airline_Code:""}],Filtered_Airline:[{Airline_Code:n.FlightBooking.Trips[0].Airline_Code}],Host_Search:n.HostSearch,Booking_Type:n.BookingType,Travel_Type:n.Travel_Type,Resident_of_India:1,InventoryType:n.FlightBooking.Trips[0].InventoryType,TripInfo:n.PushFlightInfo()}},fnProgstart(),s=t({method:"POST",url:Config.Api+"FlightBooking/RePrice",dataType:"json",data:n.RePriceRequest,headers:{"Content-Type":"application/json"}}),s.then(function(t){var r,s,l,c,p,w,b,k,y;try{if(n.GetAirlineList(),i!=1&&fnProgstop(),n.UpdUserInfos.GSTINNumber="",r=t.data,r.Status=="1"){n.ShowHideClassFareDetails=!1;n.Thread_Completed++;var o=JSON.parse(r.Data.Filler1),d=r.Data.Filler2,a=JSON.parse(r.Data.Filler3),h=JSON.parse(localStorage.getItem("FlightObject"));for(s=0;s<n.FlightBooking.Trips.length;s++)for(l=0;l<o.AirRepriceResponses.length;l++)c=o.AirRepriceResponses[l].Flight,n.FlightBooking.Trips[s].Flight_Id==c.Flight_Id&&(c.Required_PAX_Details=o.AirRepriceResponses[l].Required_PAX_Details,c.Frequent_Flyer_Accepted=o.AirRepriceResponses[l].Frequent_Flyer_Accepted,c.FareChanged=o.AirRepriceResponses[l].FareChanged,c.TimeChanged=o.AirRepriceResponses[l].TimeChanged,c.Search_Key=d,c.Pushed=n.FlightBooking.Trips[s].Pushed,c.SelectedFare=o.AirRepriceResponses[l].Flight.Fares[0],n.BookingType!="SPECIALROUNDTRIP"?p=h.Trips[s].Segments_Stops:(w=h.Trips[s].OSegments_Stops,b=h.Trips[s].RSegments_Stops),c.BookingAlertIds=h.Trips[s].BookingAlertIds,c.Flight_Key=o.AirRepriceResponses[l].Flight.Flight_Key,h.Trips[s]=c,n.BookingType!="SPECIALROUNDTRIP"?h.Trips[s].Segments_Stops=p:(h.Trips[s].OSegments_Stops=w,h.Trips[s].RSegments_Stops=b));if(n.BookingType=="ROUNDTRIP")if(r.Data.Error_InnerException!=""){if(o.AirRepriceResponses.length!=n.FlightBooking.Trips.length&&o.Response_Header.Error_InnerException!="")return ShowAlert(o.Response_Header.Error_InnerException),n.TRAVELLERDETAILSIsVisible=!1,n.PassengerDummyVisible=!1,!1}else ShowAlert(r.Data.Error_Desc);n.FlightBooking=h;v.indexOf("wego_click_id")>-1&&(k=n.TotalTicketCost-n.GrossCommission,h.WegoIMGStr=h.WegoIMGStr.replace("^Book_Value^",k));localStorage.setItem("FlightObject",JSON.stringify(h));n.BookingType=="MULTICITY"&&n.FlightBooking.Discounted_Fare==!1?n.Thread_Completed==n.Thread_Count-1&&(n.BindReprice(i),n.BuildPassengerDetails(o)):(n.BindReprice(i),n.BuildPassengerDetails(o));a&&a.length>0&&(n.AppliedGST=a[0],n.AppliedGST.type=a[0],n.GSTDetails=a,n.GSTAvailable=!0,u(function(){n.ChangeGSTMode(0);$("#GSTExist").prop("checked",!0)},200));n.CustomerData=!1;Config.ChannelId!="3"&&(n.TRAVELLERDETAILSIsVisible=!0,n.PassengerDetailsVisible=!0);n.RetryPayment=!1;localStorage.setItem("BookingRefNo","");n.ShowHidePromo=!0;u(function(){n.OneTimePromo||n.ApplyDeal(1)},500)}else r.Status=="2"?(fnProgstop(),y=r.Data,r.Data.Error_Code=="0028"?e.ShowProviderError(y,"flights/"+f.QueryString+"&ReSearch=2","Search"):(Config.ChannelId!="3"&&ShowAlert(r.Data.Error_Desc),y=r.Data,e.ShowProviderError(y,"flights/"+f.QueryString+"&ReSearch=2","Search")),n.TRAVELLERDETAILSIsVisible=!1,n.PassengerDummyVisible=!1):r.Status=="5"?n.ApplyGST==!0&&ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");setTimeout(function(){$("#AccountCreation").modal("show")},500)},"You haven't added the GST details to your profile. Do you want to update now?",function(){$("#ConfirmationModal").modal("hide");n.GSTMandatory||(n.ApplyGST=!1)}):(fnProgstop(),ShowAlert(r.Data.Error_Desc),n.TRAVELLERDETAILSIsVisible=!1,n.PassengerDummyVisible=!1)}catch(g){ShowAlert("Error occured while processing your request. Please Search Again.","flights/"+f.QueryString+"&Research=2","Search")}},function(){ShowAlert("Error occured while processing your request. Please Search Again.","flights/"+f.QueryString+"&Research=2","Search")}))}catch(c){}};n.BindReprice=function(t){var i;try{n.BlockAvailable=!1;n.FFAvailable=!1;n.PassengerDummyVisible=!1;n.TravelBookingCount="1";n.PassengerDetailsVisible=!0;n.FareDetailsVisible=!0;t==1?n.CheckRePriceStatus=!0:n.RePriceStatus=!0;var r=0,u=0,f=n.FlightBooking.Trips.length;for(i=0;i<f;i++)n.FlightBooking.Trips[i].Pushed==!0&&(n.FlightBooking.Trips[i].Block_Ticket_Allowed==!0&&(r=r+1),n.FlightBooking.Trips[i].Frequent_Flyer_Accepted==!0&&(u=u+1));r==f&&(n.BlockAvailable=!0);u<0&&(n.FFAvailable=!0);n.BookingType!="MULTICITY"&&n.FetchSSR();n.CombineSegments(n.FlightBooking.Trips);n.FareDetails();n.GetPassenger(1);e.ClosePassenger();n.FlighttitleIsVisible=!0;Config.ChannelId=="3"&&(n.PaymentdetailsIsVisible=!0,n.PassengerDetailsVisible=!0,n.TRAVELLERDETAILSIsVisible=!0);n.FLIGHTDETAILSIsVisible=!1;n.PAYMENTMODEIsVisible=!1}catch(o){}};n.ShowSSR=function(t){var i;try{if(n.SeatMapPassengersList=[],n.selectedTab=t.SSR_Type,t.SSR_TypeName!="SEAT")t.SSR_TypeName!="FREQUENT FLYER"?(n.FetchSSR(),n.ShowSeat=!1,n.FFAvailable=!1):(n.FFAvailable=!0,n.FetchFFN(1));else{n.ShowSeat=!0;var u=n.Adult_Count,f=n.Child_Count,e=n.Infant_Count,r=0;if(u>0)for(i=0;i<u;i++)if(n.PassengerDetail.Adult!=undefined)if(n.PassengerDetail.Adult[i].First_Name!=""&&n.PassengerDetail.Adult[i].First_Name!=undefined)r++,n.SeatMapPassengersList.push({PassengerID:r,PaxType:"ADULT",Title:n.PassengerDetail.Adult[i].Title,FirstName:n.PassengerDetail.Adult[i].First_Name,LastName:n.PassengerDetail.Adult[i].Last_Name,Gender:n.PassengerDetail.Adult[i].Gender,SeatNumber:"",SeatAmount:""});else return ShowError("Please Enter Pax Adult "+(i+1)+" First Name"),!1;else return ShowError("Please Enter Pax Adult "+(i+1)+" Title"),!1;if(f>0)for(i=0;i<f;i++)if(n.PassengerDetail.Child!=undefined)if(n.PassengerDetail.Child[i].First_Name!=""&&n.PassengerDetail.Child[i].First_Name!=undefined)r++,n.SeatMapPassengersList.push({PassengerID:r,PaxType:"CHILD",Title:n.PassengerDetail.Child[i].Title,FirstName:n.PassengerDetail.Child[i].First_Name,LastName:n.PassengerDetail.Child[i].Last_Name,Gender:n.PassengerDetail.Child[i].Gender,SeatNumber:"",SeatAmount:""});else return ShowError("Please Enter Pax Child "+(i+1)+" First Name"),!1;else return ShowError("Please Enter Pax Child "+(i+1)+" Title"),!1;n.Selected_Passenger=1;n.SeatMapStatus==!0?($("#dvSeatViewer").css("max-height",window.innerHeight-250),$("#SeatMapModal").modal("show")):n.SeatMap()}}catch(o){}};n.FFNFields={};a=[];n.FetchFFN=function(t){var i,f,r,o,e,u;try{for(t==0&&(i={},n.FFNPaxList=[],i.SSR_TypeName="FREQUENTFLYER",i.SSR_Type=99,i.SSR_TypeDesc="FREQUENTFLYER",i.Trip_Index=0,a.push(i),n.selectedTab=99),n.SSRDetails=a,n.AvailableSSRDetails=a,n.SSRStatus=!0,f=[],r=0;r<n.Adult_Count;r++)f.push({name:"Adult"+(r+1),id:r,type:"ADULT"});for(o=n.Adult_Count,e=0;e<n.Child_Count;e++)f.push({name:"Child"+(e+1),id:o,type:"CHILD"}),o++;for(n.FFNPaxList=f,n.FFNAirlineName=[],u=0;u<n.FlightTrips[0].length;u++)n.FFNAirlineName.push({Airline_Code:n.FlightTrips[0][u].Airline_Code,Airline_Name:n.FlightTrips[0][u].Airline_Name})}catch(s){}};n.FetchSSR=function(){try{if(n.SSRStatusLoad=!0,n.SSRStatus==!0)return n.SSRStatusLoad=!1,fnProgstop(),!1;n.AirSSRRequest={Header:n.GetHeader(n.ProcessID),Search_Key:n.FlightBooking.Trips[0].Search_Key,AirSSRRequestDetails:n.PushTripInfo(3)};fnProgstart();var i=t({method:"POST",url:Config.Api+"FlightBooking/GetSSR",dataType:"json",data:n.AirSSRRequest,headers:{"Content-Type":"application/json"}});i.then(function(t){var i,r,f,u,e;try{if(fnProgstop(),n.SSRStatusLoad=!1,i=t.data,i.Status=="1")for(n.SSRStatus=!0,n.ProcessSSRDetails(i.Data.SSRFlightDetails),n.AddOn_Fees=0,n.Addon_Meals_Fees=0,n.Addon_Baggage_Fees=0,n.ShowSeat=!1,n.SSRFareList=[],r=0;r<n.AvailableSSRDetails.length;r++){for(f=!1,u=0;u<n.SSRFareList.length;u++)n.SSRFareList[u].SSRTYPE_NAME==n.AvailableSSRDetails[r].SSR_TypeName&&(f=!0);f==!1&&n.SSRFareList.push({SSRTYPE_ID:n.AvailableSSRDetails[r].SSR_Type,SSRTYPE_NAME:n.AvailableSSRDetails[r].SSR_TypeName,Amount:0})}else i.Status=="100"?fnSessionTimeOut():i.Status=="101"?fnInvalidSession(i.StatusDesc):(n.SSRStatus=!0,e=[],n.FFAvailable==!0&&n.FetchFFN(0))}catch(o){n.SSRStatus=!1}},function(){n.SSRStatus=!1})}catch(u){}};n.ProcessSSRDetails=function(t){var i,r;try{for(i=0;i<t.length;i++)for(r=0;r<t[i].SSRDetails.length;r++)lobjTempSSR=t[i].SSRDetails[r],lobjTempSSR.Flight_Index=i,a.push(lobjTempSSR);n.SSRDetails=a;n.AvailableSSRDetails=a;u(function(){try{componentHandler.upgradeAllRegistered()}catch(n){}},300)}catch(f){}};n.GetFlightDetails=function(t,i){var u,r;try{for(u=n.FlightSegments,r=0;r<u.length;r++)if(u[r].Flight_Id==t&&u[r].Segment_Id==i)return u[r]}catch(f){}};n.PushSeatMapFlightKey=function(){var i,t;try{for(i=[],t=0;t<n.FlightBooking.Trips.length;t++)i.push(n.FlightBooking.Trips[t].Flight_Key);return i}catch(r){}};n.selectFlightMap=function(t){try{for(var i=0;i<2;i++)n["showMap_"+i]=!1;n.SeatmapActivetab=t;n.ShowSeatDetails=!1;t==12?n.ShowSeatDetails=!0:n["showMap_"+t]=!0}catch(r){}};n.SeatMap=function(){var i,r;try{n.AirSeatMapRequest={Header:n.GetHeader(n.ProcessID),SeatMapRequest:{Flight_Keys:n.PushSeatMapFlightKey(),Search_Key:n.FlightBooking.Trips[0].Search_Key,PAX_Details:n.PushPassengerDetails(2,3)}};i=JSON.parse(localStorage.getItem("FlightObject"));fnProgstart();r=t({method:"POST",url:Config.Api+"FlightBooking/SeatMap",dataType:"json",data:n.AirSeatMapRequest,headers:{"Content-Type":"application/json"}});r.then(function(t){try{fnProgstop();var r=t.data.Data;t.data.Status=="1"?(r.AirSeatMaps[0].Seat_Segments[0].Seat_Row,n.SeatMapStatus=!0,n.AirSeatMaps=r.AirSeatMaps,$("#dvSeatViewer").css("max-height",window.innerHeight-250),$("#SeatMapModal").modal("show"),n.selectFlightMap(0)):t.data.Status=="2"?(e.ShowProviderError(r.Response_Header,"",""),Config.ChannelId!="3"&&ShowAlert(r.Response_Header.Error_InnerException)):(e.ShowProviderError(r.Response_Header,"flights/"+i.QueryString+"&Research=2","Search"),Config.ChannelId!="3"&&ShowAlert(r.Response_Header.Error_InnerException))}catch(u){fnProgstop();Config.ChannelId!="3"&&ShowAlert(r.Response_Header.Error_InnerException);e.ShowProviderError(r.Response_Header,"flights/"+i.QueryString+"&Research=2","Search")}},function(){fnProgstop();e.ShowProviderError(lobjResponse.Response_Header,"flights/"+i.QueryString+"&Research=2","Search")})}catch(f){fnProgstop()}};n.BuildPassengerDetails=function(t){var o,r,i,s,h,c;try{t=t.AirRepriceResponses;var w=n.Adult_Count,l=n.Child_Count,a=n.Infant_Count,v=[],y=[],p=[],u=[],f=[],e=[];for(o=0;o<t.length;o++){for(r=t[o].Required_PAX_Details,u=[],f=[],e=[],i=0;i<r.length;i++){if(r[i].Pax_type==0)for(s=0;s<w;s++)u.push(r[i]);if(r[i].Pax_type==1)for(h=0;h<l;h++)f.push(r[i]);if(r[i].Pax_type==2)for(c=0;c<a;c++)e.push(r[i])}v.push(u);y.push(f);p.push(e)}n.BookingType=="ROUNDTRIP"&&(u=n.MergePassengerDetails(v),l>0&&(f=n.MergePassengerDetails(y)),a>0&&(e=n.MergePassengerDetails(p)));n.AdultPassengerFields=u;n.ChildPassengerFields=f;n.InfantPassengerFields=e;setTimeout(function(){var t;try{for(t=0;t<n.AdultPassengerFields.length;t++)n.AdultPassengerFields[t].DOB&&(n.PassengerDetail.Adult[t].DOB=""),n.AdultPassengerFields[t].Passport_Expiry&&(n.PassengerDetail.Adult[t].Passport_Expiry=""),n.AdultPassengerFields[t].DefenceExpiryDate&&(n.PassengerDetail.Adult[t].DefenceExpiryDate=""),n.AdultPassengerFields[t].DefenceIssueDate&&(n.PassengerDetail.Adult[t].DefenceIssueDate="");for(t=0;t<n.ChildPassengerFields.length;t++)n.ChildPassengerFields[t].DOB&&(n.PassengerDetail.Child[t].DOB=""),n.ChildPassengerFields[t].Passport_Expiry&&(n.PassengerDetail.Child[t].Passport_Expiry=""),n.ChildPassengerFields[t].DefenceExpiryDate&&(n.PassengerDetail.Child[t].DefenceExpiryDate=""),n.ChildPassengerFields[t].DefenceIssueDate&&(n.PassengerDetail.Child[t].DefenceIssueDate="");for(t=0;t<n.InfantPassengerFields.length;t++)n.InfantPassengerFields[t].DOB&&(n.PassengerDetail.Infant[t].DOB=""),n.InfantPassengerFields[t].Passport_Expiry&&(n.PassengerDetail.Infant[t].Passport_Expiry=""),n.InfantPassengerFields[t].DefenceExpiryDate&&(n.PassengerDetail.Infant[t].DefenceExpiryDate=""),n.InfantPassengerFields[t].DefenceIssueDate&&(n.PassengerDetail.Infant[t].DefenceIssueDate="");componentHandler.upgradeAllRegistered()}catch(i){}},300)}catch(b){}};n.MergePassengerDetails=function(n){var r,i,f,e,u,t;try{if(r=[],r=n[0],r.length>0)for(i=Object.keys(n[0][0]),f=1;f<n.length;f++)for(e=n[f],u=0;u<e.length;u++)for(t=0;t<i.length;t++)i[t].indexOf("ExtensionData")==-1&&i[t]!="Mandatory_SSRs"&&e[u][i[t]]==!0&&(r[u][i[t]]=!0);return r}catch(o){}};n.PushPassengerDetails=function(t){var u,r,i;try{var f=[],e=n.Adult_Count,o=n.Child_Count,s=n.Infant_Count;if(e>0)for(i=0;i<e;i++){for(n.PassengerDetail.Adult[i].Pax_type="ADT",n.PassengerDetail.Adult[i].Pax_Id=i+1,u=[],r=0;r<n.FFNList.length;r++)n.FFNList[r].PaxID==i&&n.FFNList[r].Paxtype=="ADT"&&u.push({AirLine_Code:n.FFNList[r].AirlineID,FrequentFlyerNumber:n.FFNList[r].FFN});n.PassengerDetail.Adult[i].FrequentFlyerDetails=u;f.push(n.PassengerDetail.Adult[i])}if(o>0)for(i=0;i<o;i++){for(n.PassengerDetail.Child[i].Pax_type="CHD",n.PassengerDetail.Child[i].Pax_Id=e+i+1,u=[],r=0;r<n.FFNList.length;r++)n.FFNList[r].PaxID==i&&n.FFNList[r].Paxtype=="CHD"&&u.push({AirLine_Code:n.FFNList[r].AirlineID,FrequentFlyerNumber:n.FFNList[r].FFN});n.PassengerDetail.Child[i].FrequentFlyerDetails=u;f.push(n.PassengerDetail.Child[i])}if(t!=2&&s>0)for(i=0;i<s;i++)n.PassengerDetail.Infant[i].Pax_type="INF",n.PassengerDetail.Infant[i].Pax_Id=e+o+i+1,f.push(n.PassengerDetail.Infant[i]);return f}catch(h){}};n.PushFlightDetails=function(){var r,i,t;try{for(r=[],i=0;i<n.FlightBooking.Trips.length;i++)t={},n.TotalDealValue!=undefined&&n.TotalDealValue!=""&&n.TotalDealValue!=0?n.BookingType!="ROUNDTRIP"?n.SelectedPromoCode.length>0&&(t.Deal_Key=n.SelectedPromoCode[0].Deal_Key):n.SelectedPromoCode.length>1?t.Deal_Key=n.SelectedPromoCode[0].DealValuePerTransaction>=n.SelectedPromoCode[1].DealValuePerTransaction&&i==0?n.SelectedPromoCode[0].Deal_Key:n.SelectedPromoCode[1].Deal_Key:i==0&&(t.Deal_Key=n.SelectedPromoCode[0].Deal_Key):t.Deal_Key="",t.Flight_Key=n.FlightBooking.Trips[i].Flight_Key,t.Search_Key=n.FlightBooking.Trips[i].Search_Key,n.AddONFound==!0&&(t.BookingSSRDetails=n.PushSSRDetails(i)),r.push(t);return r}catch(u){}};n.PushSSRDetails=function(t){var k=[],f,l,a,e,v,o,i,y,s,r,h,p,w,c,b,u;try{var nt=n.Adult_Count,tt=n.Child_Count,d=n.SelectedSSR.Flight[t],g=Object.keys(d);for(f=0;f<g.length;f++)for(l=d[g[f]],a=Object.keys(l),e=0;e<a.length;e++)for(v=l[a[e]],o=Object.keys(v),i=0;i<o.length;i++)for(y=v[o[i]],s=Object.keys(y),r=0;r<s.length;r++)for(h=parseInt(s[r])+1,o[i]=="Child"&&(h=nt+h),p=y[s[r]].SSRDetails,w=Object.keys(p),c=0;c<w.length;c++)b=p[w[c]],u={},u.Pax_Id=h,u.SSR_Key=b.SSR_Key,u.Total_Amount=b.Total_Amount,k.push(u)}catch(it){}return n.PushSeatDetails(t,k)};n.PushSeatDetails=function(t,i){var r,u,f;try{if(r=n.SelectedSeats,r!=undefined&&r!=""&&r!=null)for(u=0;u<r.length;u++)t==r[u].FlightId&&(f={},f.Pax_Id=r[u].PassengerID,f.SSR_Key=r[u].SSR_Key,i.push(f))}catch(e){}return i};localStorage.setItem("BookingRefNo","");n.BookTicketconfirmation=function(){try{if(n.TicketBookingValid(2)){try{var t=n.TotalTicketCost+n.AddOn_Fees+n.Gateway_Charges-(n.TotalDealValue+n.GrossCommission);PushEventMessage(4,t)}catch(i){}n.BlockingFlag=0;n.paxwisedetail=n.PushPassengerDetails(1,3);n.Int_BookingMsg=!1;n.Review_Booking=!0;n.Travel_Type=="INTERNATIONAL"&&(n.Int_BookingMsg=!0);n.FilterClose();u(function(){n.RCancellationPolicy=!1;$("#BookingConfirmation").modal("show")},500)}}catch(i){}};n.ShowHidePromo=!0;n.BookTicket=function(i){var o,f,u,r,l,a;try{if(n.RetryPayment==!1){try{o=n.TotalTicketCost+n.AddOn_Fees+n.Gateway_Charges-(n.TotalDealValue+n.GrossCommission);PushEventMessage(5,o)}catch(v){}if(localStorage.getItem("BookingRefNo")==""){try{n.AddNewPassengers.length>0&&n.AddPassengerDetails(3)}catch(v){}if(i==2&&(n.BlockingFlag=1),n.WhatsAPP_Mobile=n.PaxMobileNumber,n.Iswhatsapp||(n.WhatsAPP_Mobile=""),n.TicketBookingValid(2)){f=JSON.parse(localStorage.getItem("FlightObject"));u="";u=f.Trips[0].BookingAlertIds;n.BookingType=="ROUNDTRIP"&&(u+=","+f.Trips[1].BookingAlertIds);var s=n.Adult_Count,h=n.Child_Count,c=n.Infant_Count;if(s>0)for(r=0;r<s;r++)n.AdultPassengerFields[0].DOB&&(n.PassengerDetail.Adult[r].DOB=moment(n.PassengerDetail.Adult[r].DOB,"DD/MM/YYYY").format("MM/DD/YYYY")),n.AdultPassengerFields[0].Passport_Expiry&&(n.PassengerDetail.Adult[r].Passport_Expiry=moment(n.PassengerDetail.Adult[r].Passport_Expiry,"DD/MM/YYYY").format("MM/DD/YYYY")),n.AdultPassengerFields[0].DefenceExpiryDate&&(n.PassengerDetail.Adult[r].DefenceExpiryDate=moment(n.PassengerDetail.Adult[r].DefenceExpiryDate,"DD/MM/YYYY").format("MM/DD/YYYY")),n.AdultPassengerFields[0].DefenceIssueDate&&(n.PassengerDetail.Adult[r].DefenceIssueDate=moment(n.PassengerDetail.Adult[r].DefenceIssueDate,"DD/MM/YYYY").format("MM/DD/YYYY"));if(h>0)for(r=0;r<h;r++)n.ChildPassengerFields[0].DOB&&(n.PassengerDetail.Child[r].DOB=moment(n.PassengerDetail.Child[r].DOB,"DD/MM/YYYY").format("MM/DD/YYYY")),n.ChildPassengerFields[0].Passport_Expiry&&(n.PassengerDetail.Child[r].Passport_Expiry=moment(n.PassengerDetail.Child[r].Passport_Expiry,"DD/MM/YYYY").format("MM/DD/YYYY")),n.ChildPassengerFields[0].DefenceExpiryDate&&(n.PassengerDetail.Child[r].DefenceExpiryDate=moment(n.PassengerDetail.Child[r].DefenceExpiryDate,"DD/MM/YYYY").format("MM/DD/YYYY")),n.ChildPassengerFields[0].DefenceIssueDate&&(n.PassengerDetail.Child[r].DefenceIssueDate=moment(n.PassengerDetail.Child[r].DefenceIssueDate,"DD/MM/YYYY").format("MM/DD/YYYY"));if(c>0)for(r=0;r<c;r++)n.InfantPassengerFields[0].DOB&&(n.PassengerDetail.Infant[r].DOB=moment(n.PassengerDetail.Infant[r].DOB,"DD/MM/YYYY").format("MM/DD/YYYY")),n.InfantPassengerFields[0].Passport_Expiry&&(n.PassengerDetail.Infant[r].Passport_Expiry=moment(n.PassengerDetail.Infant[r].Passport_Expiry,"DD/MM/YYYY").format("MM/DD/YYYY")),n.InfantPassengerFields[0].DefenceExpiryDate&&(n.PassengerDetail.Infant[r].DefenceExpiryDate=moment(n.PassengerDetail.Infant[r].DefenceExpiryDate,"DD/MM/YYYY").format("MM/DD/YYYY")),n.InfantPassengerFields[0].DefenceIssueDate&&(n.PassengerDetail.Infant[r].DefenceIssueDate=moment(n.PassengerDetail.Infant[r].DefenceIssueDate,"DD/MM/YYYY").format("MM/DD/YYYY"));n.BlockingRequest={Header:n.GetHeader(n.ProcessID),Ticketing_Type:n.BlockingFlag,Payment_Mode:n.PaymentMode,JI_SubRetailerID:n.SelectedCostCenter,BlockingRequest:{BookingFlightDetails:n.PushFlightDetails(),BookingRemark:n.Remarks,Customer_Mobile:n.CustomerMobileNumber,Passenger_Email:n.EmailID,Passenger_Mobile:n.PaxMobileNumber,PAX_Details:n.PushPassengerDetails(1,3),CostCenterId:0,ProjectId:0,Booked_By_Operator_Id:0,GST_Input:n.ApplyGST,GST:n.ApplyGST,GST_Number:n.ApplyGST?n.GSTEntryNumber:"",GST_HolderName:n.ApplyGST?n.GSTEntryName:"",GST_Address:n.ApplyGST?n.GSTEntryAddress:"",B2BFlag:n.UserInfo?n.UserInfo.B2BFlag:1,WhatsAPP_Mobile:n.WhatsAPP_Mobile,BookingAlertIds:u}};fnProgstart();l=t({method:"POST",url:Config.Api+"FlightBooking/Blocking",dataType:"json",data:n.BlockingRequest,headers:{"Content-Type":"application/json"}})}l.then(function(i){var f,u,o,s,r;try{f=i.data;f.Status=="1"?(localStorage.setItem("BookingRefNo",f.Data),n.ShowHidePromo=!1,u=JSON.parse(localStorage.getItem("FlightObject")),n.Booking_RefNo=f.Data,o=!1,n.BookingType=="ROUNDTRIP"?u.Trips[0].Block_Ticket_Allowed==!0&&u.Trips[1].Block_Ticket_Allowed&&(o=!0):u.Trips[0].Block_Ticket_Allowed==!0&&(o=!0),o==!0?(n.AirBookingRequest={Header:n.GetHeader(n.ProcessID),Booking_RefNo:n.Booking_RefNo,Ticketing_Type:"1",Payment_Mode:n.PaymentMode,Payment_Gateway:n.PG_Mode,Payment_Data:""},s=t({method:"POST",url:Config.Api+"FlightBooking/BlockTicket",dataType:"json",data:n.AirBookingRequest,headers:{"Content-Type":"application/json"}}),s.then(function(t){var r=JSON.parse(localStorage.getItem("FlightObject")),o,f,i;try{o=[];f=t.data;f.Status=="1"?n.CallPayment():(fnProgstop(),i=t.data.Data,i.Error_Desc="The requested fare has been sold out...",i.Error_InnerException="The requested fare has been sold out...",Config.ChannelId=="4"&&e.ShowProviderError(i,"flights/"+u.QueryString+"&Research=2","Search"),e.ShowProviderError(i,"flights/"+u.QueryString+"&Research=2","Search"))}catch(s){fnProgstop();r.BookingDetails.Status=2;localStorage.setItem("FlightObject",JSON.stringify(r))}},function(){})):n.CallPayment()):f.Status=="5"?(fnProgstop(),n.ApplyGST==!0&&ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");setTimeout(function(){$("#AccountCreation").modal("show")},500)},"You haven't added the GST details to your profile. Do you want to update now?",function(){$("#ConfirmationModal").modal("hide");n.GSTMandatory||(n.ApplyGST=!1)})):(fnProgstop(),r=i.data.Data,r.Error_Code=="0041"?(r.Error_Desc="<b>"+r.Error_InnerException+"<b/>",r.Error_InnerException="",Config.ChannelId=="4"&&ShowAlert(r.Error_Desc),e.ShowProviderError(r,"/","Home")):(Config.ChannelId=="4"&&ShowAlert(r.Error_Desc),e.ShowProviderError(r,"","")))}catch(c){fnProgstop()}},function(){});$("#BookingConfirmation").modal("hide")}else n.ReongoingDate=n.FormatDate(n.OngoingDate,"DD/MM/YYYY","DD-MM-YYYY"),n.RereturnDate=n.FormatDate(n.ReturnDate,"DD/MM/YYYY","DD-MM-YYYY"),a="origin="+n.From.originalObject.Value+"&destination="+n.To.originalObject.Value+"&onward="+n.ReongoingDate+"&return="+n.RereturnDate+"&type="+n.Travel_Type+"&class="+n.Travel_Class+"&adult="+n.Adult_Count+"&child="+n.Child_Count+"&infant="+n.Infant_Count+"&direct="+n.DirectFlight+"&discount="+n.RoundTrip_Fare+"&nocache="+n.HostSearch+"&defence="+n.Defence+"&originName="+n.From.originalObject.Name.split("(")[0]+"&destinationName="+n.To.originalObject.Name.split("(")[0],n.LoadPage("flights/"+a)}else n.CallPayment(),$("#BookingConfirmation").modal("hide")}catch(v){}};n.CallPayment=function(){var o,u,f;try{var i=JSON.parse(localStorage.getItem("FlightObject")),r={},t={};r.Booking_RefNo=n.Booking_RefNo;r.Status=0;r.BlockFlag=n.BlockingFlag;r.TicketData=[];t.PaymentMode=n.PaymentMode;t.PaymentStatus=0;t.PaymentData="";t.isRedirect=n.PG_Mode.isRedirect;t.PaymentGateway=n.PG_Mode;n.TotalDealValue!=undefined&&n.TotalDealValue!=""?(t.TotalAmount=n.TotalTicketCost+n.AddOn_Fees-(n.TotalDealValue+n.GrossCommission),n.UserInfo&&n.UserInfo.B2BFlag&&(t.TotalAmount=n.TotalTicketCost+n.AddOn_Fees-(n.TotalDealValue+n.Adult_Markup+n.Child_Markup+n.Infant_Markup))):(t.TotalAmount=n.TotalTicketCost+n.AddOn_Fees-n.GrossCommission,n.UserInfo&&n.UserInfo.B2BFlag&&(t.TotalAmount=n.TotalTicketCost+n.AddOn_Fees-(n.Adult_Markup+n.Child_Markup+n.Infant_Markup)));i.DealDetails={};n.TotalDealValue!=undefined&&n.TotalDealValue!=""&&n.TotalDealValue!=0&&(i.DealDetails.DealCode=n.SelectedPromoCode[0].DealCode,i.DealDetails.DealValue=n.SelectedPromoCode[0].DealValuePerTransaction,i.DealDetails.DealKey=n.SelectedPromoCode[0].Deal_Key,i.DealDetails.DealRemark="");t.Gateway_Charges=e.Gateway_Charges;t.PaymentKey=e.PaymentKey;t.PaymentBiller=e.Biller_Id+"$"+e.SupplierId+"$"+e.SubbillerCode;t.Service_AddOn=n.AddOn_Fees;i.BookingDetails=r;i.PaymentDetails=t;i.CustomerInfo={};i.CustomerInfo.MobileNo=n.CustomerMobileNumber;i.CustomerInfo.EmailID=n.EmailID;localStorage.setItem("FlightObject",JSON.stringify(i));n.FilterClose();n.PaymentMode=="PrePaid_Money"?(t.PaymentGateway={},t.PaymentGateway.GatewayID="",t.PaymentGateway.GatewayName="",t.PaymentGateway.PaymentType="",t.PaymentGateway.PaymentTypeCode="",t.PaymentGateway.ChargesConversion="",t.PaymentGateway.GatewayCharges="",t.PaymentGateway.GatewayChargesMin="0.00",t.PaymentGateway.GatewayChargesMax="0.00",i.PaymentDetails=t,localStorage.setItem("FlightObject",JSON.stringify(i)),e.LoadPage("FlightConfirmation")):n.PaymentMode=="Payment_Gateway"&&(localStorage.setItem("PreviousCtrl","paymentgateway"),o=n.PG_Mode,u=GetPath()+"FlightConfirmation",Config.ChannelId=="4"&&(u="#FlightConfirmation"),f={Header:n.GetHeader(n.ProcessID),CustomerMobile:n.CustomerMobileNumber,CustomerName:n.PassengerDetail.Adult[0].Title+" "+n.PassengerDetail.Adult[0].First_Name+" "+n.PassengerDetail.Adult[0].Last_Name,CustomerEmail:n.EmailID,ModuleID:1,TotalAmount:t.TotalAmount,Gateway_Charges:e.Gateway_Charges,BookRefNo:r.Booking_RefNo,PGInfo:o,PostURL:Config.PGURL,ReturnURL:u,SSRFlag:"0",TransactionType:0,PaymentKey:e.PaymentKey,PaymentBiller:e.Biller_Id+"$"+e.SupplierId+"$"+e.SubbillerCode},t.PaymentBase=f,i.PaymentDetails=t,localStorage.setItem("FlightObject",JSON.stringify(i)),n.RetryPayment=!0,e.InitiatePayment(f))}catch(s){}};n.OnwardPGCharges=[];n.OnwardPGCharges=n.PGCharges;n.TicketBookingValid=function(t){var i,u,f,e,o,s,r,h;try{n.AddNewPassengersList=[];var c=n.Adult_Count,l=n.Child_Count,a=n.Infant_Count;if(c>0)for(i=0;i<c;i++)if(n.PassengerDetail.Adult!=undefined){if(n.PassengerDetail.Adult[i]==undefined||n.PassengerDetail.Adult[i]==""||n.PassengerDetail.Adult[i]==null||n.PassengerDetail.Adult[i].Title==undefined||n.PassengerDetail.Adult[i].Title==""||n.PassengerDetail.Adult[i].Title==null)return ShowError("Please Enter Pax Adult "+(i+1)+" Title"),!1;if(n.PassengerDetail.Adult[i].First_Name==undefined||n.PassengerDetail.Adult[i].First_Name==""||n.PassengerDetail.Adult[i].First_Name==null)return ShowError("Please Enter Pax Adult "+(i+1)+" FirstName"),!1;if(i!=0)for(u=0;u<i;u++){if(n.PassengerDetail.Adult[i].First_Name.toUpperCase()==n.PassengerDetail.Adult[u].First_Name.toUpperCase()&&n.PassengerDetail.Adult[i].Last_Name.toUpperCase()==n.PassengerDetail.Adult[u].Last_Name.toUpperCase())return f="<span>Two Names Can not be Similar in a Single Booking, Airlines does not permit the same.<\/span><br/>",f+="<span>You can either-<\/span><br/>",f+="<span>1- Book a Separate ticket (Another transaction) for Pax with Similar Name.<br/><\/span>",f+="<span>2- If Your Name is "+n.PassengerDetail.Adult[i].Title+" "+n.PassengerDetail.Adult[i].First_Name+" "+n.PassengerDetail.Adult[i].Last_Name+", You can book one pax as "+n.PassengerDetail.Adult[i].Title+" "+n.PassengerDetail.Adult[i].Last_Name+" "+n.PassengerDetail.Adult[i].First_Name+".<\/span>",ShowError(f),!1;if(n.PassengerDetail.Adult[i].Last_Name==undefined||n.PassengerDetail.Adult[i].Last_Name==""||n.PassengerDetail.Adult[i].Last_Name==null)return ShowError("Please Enter Pax Adult "+(i+1)+" LastName"),!1;if(n.PassengerDetail.Adult[i].Last_Name.length<2)return ShowError("Please Enter Pax Adult "+(i+1)+" LastName Two Character"),!1}else{if(n.PassengerDetail.Adult[i].Last_Name==undefined||n.PassengerDetail.Adult[i].Last_Name==""||n.PassengerDetail.Adult[i].Last_Name==null)return ShowError("Please Enter Pax Adult "+(i+1)+" LastName"),!1;if(n.PassengerDetail.Adult[i].Last_Name.length<2)return ShowError("Please Enter Pax Adult "+(i+1)+" LastName Two Character"),!1;if(n.PassengerDetail.Adult[i].Gender==undefined||n.PassengerDetail.Adult[i].Gender==""||n.PassengerDetail.Adult[i].Gender==null)return ShowError("Please Enter Pax Adult "+(i+1)+" Gender"),!1;if(n.PassengerDetail.Adult[i]!=undefined&&n.PassengerDetail.Adult[i]!=""&&n.PassengerDetail.Adult[i]!=null&&n.PassengerDetail.Adult[i].Title!=undefined&&n.PassengerDetail.Adult[i].Title!=""&&n.PassengerDetail.Adult[i].Title!=null&&n.PassengerDetail.Adult[i].Gender!=undefined&&n.PassengerDetail.Adult[i].Gender!=""&&n.PassengerDetail.Adult[i].Gender!=null&&(n.PassengerDetail.Adult[i].Title=="Mr"&&n.PassengerDetail.Adult[i].Gender!="Male"||(n.PassengerDetail.Adult[i].Title=="Ms"||n.PassengerDetail.Adult[i].Title=="Mrs")&&n.PassengerDetail.Adult[i].Gender!="Female"))return ShowError("Please Check Title and Gender for Pax Adult "+(i+1)+""),!1}if(n.AdultPassengerFields[0].DOB)for(r=0;r<n.AdultPassengerFields.length;r++){if(n.PassengerDetail.Adult[r].DOB==""||n.PassengerDetail.Adult[r].DOB==null||n.PassengerDetail.Adult[r].DOB==undefined)return ShowError("Please Select Pax Adult "+(r+1)+" Date Of Birth"),!1;if(e=moment(),e.add("years",-12),o=moment(n.PassengerDetail.Adult[r].DOB,"DD/MM/YYYY"),s=o.diff(e,"days"),s>0)return ShowError("Please Select Pax Adult "+(r+1)+"valid Date Of Birth"),!1}if(n.PassengerDetail.Adult[i].Passport_Number=="")return ShowError("Please Enter Pax Adult "+(i+1)+" Passport_Number"),!1;if(n.AdultPassengerFields[0].DefenceServiceId&&n.PassengerDetail.Adult[i].DefenceServiceId=="")return ShowError("Please Enter Pax Adult "+(i+1)+" Defence Service Id"),!1;if(n.AdultPassengerFields[0].Student_Id&&n.PassengerDetail.Adult[i].Student_Id=="")return ShowError("Please Enter Pax Adult "+(i+1)+" student Id"),!1;if(n.PassengerDetail.Adult[i].DefenceExpiryDate!=undefined&&n.PassengerDetail.Adult[i].DefenceExpiryDate!=null&&n.PassengerDetail.Adult[i].DefenceExpiryDate!=""){if(n.DefenceExpiryDate=n.PassengerDetail.Adult[i].DefenceExpiryDate,n.BookingType=="ROUNDTRIP"){if(n.DefenceExpiryDate.split("/")[2]<n.ReturnDate.split("/")[2]||n.DefenceExpiryDate.split("/")[2]==n.ReturnDate.split("/")[2]&&(n.DefenceExpiryDate.split("/")[1]<n.ReturnDate.split("/")[1]||n.DefenceExpiryDate.split("/")[1]==n.ReturnDate.split("/")[1]&&n.DefenceExpiryDate.split("/")[0]<=n.ReturnDate.split("/")[0]))return ShowError("Please Select Pax Adult "+(i+1)+" Defence Expiry Invalid Date"),!1}else if(n.DefenceExpiryDate.split("/")[2]<n.OngoingDate.split("/")[2]||n.DefenceExpiryDate.split("/")[2]==n.OngoingDate.split("/")[2]&&(n.DefenceExpiryDate.split("/")[1]<n.OngoingDate.split("/")[1]||n.DefenceExpiryDate.split("/")[1]==n.OngoingDate.split("/")[1]&&n.DefenceExpiryDate.split("/")[0]<=n.OngoingDate.split("/")[0]))return ShowError("Please Select Pax Adult "+(i+1)+" Defence Expiry Invalid Date"),!1}else if(n.AdultPassengerFields[0].DefenceExpiryDate)for(r=0;r<n.AdultPassengerFields.length;r++)if(n.PassengerDetail.Adult[r].DefenceExpiryDate==""||n.PassengerDetail.Adult[r].DefenceExpiryDate==null||n.PassengerDetail.Adult[r].DefenceExpiryDate==undefined)return ShowError("Please Select Pax Adult "+(r+1)+" Defence Expiry Date"),!1;if(n.AdultPassengerFields[0].DefenceIssueDate)for(r=0;r<n.AdultPassengerFields.length;r++)if(n.PassengerDetail.Adult[r].DefenceIssueDate==""||n.PassengerDetail.Adult[r].DefenceIssueDate==null||n.PassengerDetail.Adult[r].DefenceIssueDate==undefined)return ShowError("Please Select Pax Adult "+(r+1)+" Defence Issue Date"),!1;if(n.PassengerDetail.Adult[i].Passport_Expiry!=undefined&&n.PassengerDetail.Adult[i].Passport_Expiry!=null&&n.PassengerDetail.Adult[i].Passport_Expiry!=""){if(n.Passport_Expiry=n.PassengerDetail.Adult[i].Passport_Expiry,n.BookingType=="ROUNDTRIP"){if(n.Passport_Expiry.split("/")[2]<n.ReturnDate.split("/")[2]||n.Passport_Expiry.split("/")[2]==n.ReturnDate.split("/")[2]&&(n.Passport_Expiry.split("/")[1]<n.ReturnDate.split("/")[1]||n.Passport_Expiry.split("/")[1]==n.ReturnDate.split("/")[1]&&n.Passport_Expiry.split("/")[0]<=n.ReturnDate.split("/")[0]))return ShowError("Please Select Pax Adult "+(i+1)+" Passport_Expiry Invalid Date"),!1}else if(n.Passport_Expiry.split("/")[2]<n.OngoingDate.split("/")[2]||n.Passport_Expiry.split("/")[2]==n.OngoingDate.split("/")[2]&&(n.Passport_Expiry.split("/")[1]<n.OngoingDate.split("/")[1]||n.Passport_Expiry.split("/")[1]==n.OngoingDate.split("/")[1]&&n.Passport_Expiry.split("/")[0]<=n.OngoingDate.split("/")[0]))return ShowError("Please Select Pax Adult "+(i+1)+" Passport_Expiry Invalid Date"),!1}else if(n.AdultPassengerFields[0].Passport_Expiry)for(r=0;r<n.AdultPassengerFields.length;r++)if(n.PassengerDetail.Adult[r].Passport_Expiry==""||n.PassengerDetail.Adult[r].Passport_Expiry==null||n.PassengerDetail.Adult[r].Passport_Expiry==undefined)return ShowError("Please Select Pax Adult "+(r+1)+" Passport Expiry Date"),!1;n.checkfrequentPassenger(i,"Adult",1)}else return ShowError("Please Enter Pax Adult "+(i+1)+" Title"),!1;if(l>0)for(i=0;i<l;i++)if(n.PassengerDetail.Child!=undefined){if(n.PassengerDetail.Child[i]==undefined||n.PassengerDetail.Child[i]==""||n.PassengerDetail.Child[i]==null||n.PassengerDetail.Child[i].Title==undefined||n.PassengerDetail.Child[i].Title==""||n.PassengerDetail.Child[i].Title==null)return ShowError("Please Enter Pax Child "+(i+1)+" Title"),!1;if(n.PassengerDetail.Child[i].First_Name==undefined||n.PassengerDetail.Child[i].First_Name==""||n.PassengerDetail.Child[i].First_Name==null)return ShowError("Please Enter Pax Child "+(i+1)+" FirstName"),!1;if(i!=0)for(u=0;u<i;u++){if(n.PassengerDetail.Child[i].First_Name==n.PassengerDetail.Child[u].First_Name&&n.PassengerDetail.Child[i].Last_Name==n.PassengerDetail.Child[u].Last_Name)return f="<span>Two Names Can not be Similar in a Single Booking, Airlines does not permit the same.<\/span><br/>",f+="<span>You can either-<\/span><br/>",f+="<span>1- Book a Separate ticket (Another transaction) for Pax with Similar Name.<br/><\/span>",f+="<span>2- If Your Name is "+n.PassengerDetail.Child[i].Title+" "+n.PassengerDetail.Child[i].First_Name+" "+n.PassengerDetail.Child[i].Last_Name+", You can book one pax as "+n.PassengerDetail.Child[i].Title+" "+n.PassengerDetail.Child[i].Last_Name+" "+n.PassengerDetail.Child[i].First_Name+".<\/span>",ShowError(f),!1;if(n.PassengerDetail.Child[i].Last_Name==undefined||n.PassengerDetail.Child[i].Last_Name==""||n.PassengerDetail.Child[i].Last_Name==null)return ShowError("Please Enter Pax Child "+(i+1)+" LastName"),!1;if(n.PassengerDetail.Child[i].Last_Name.length<2)return ShowError("Please Enter Pax Child "+(i+1)+" LastName Two Character"),!1}else{if(n.PassengerDetail.Child[i].Last_Name==undefined||n.PassengerDetail.Child[i].Last_Name==""||n.PassengerDetail.Child[i].Last_Name==null)return ShowError("Please Enter Pax Child "+(i+1)+" LastName"),!1;if(n.PassengerDetail.Child[i].Last_Name.length<2)return ShowError("Please Enter Pax Child "+(i+1)+" LastName Two Character"),!1;if(n.PassengerDetail.Child[i].Gender==undefined||n.PassengerDetail.Child[i].Gender==""||n.PassengerDetail.Child[i].Gender==null)return ShowError("Please Enter Pax Child "+(i+1)+" Gender"),!1;if(n.PassengerDetail.Child[i]!=undefined&&n.PassengerDetail.Child[i]!=""&&n.PassengerDetail.Child[i]!=null&&n.PassengerDetail.Child[i].Title!=undefined&&n.PassengerDetail.Child[i].Title!=""&&n.PassengerDetail.Child[i].Title!=null&&n.PassengerDetail.Child[i].Gender!=undefined&&n.PassengerDetail.Child[i].Gender!=""&&n.PassengerDetail.Child[i].Gender!=null&&(n.PassengerDetail.Child[i].Title=="Mstr"&&n.PassengerDetail.Child[i].Gender!="Male"||(n.PassengerDetail.Child[i].Title=="Ms"||n.PassengerDetail.Child[i].Title=="Mrs")&&n.PassengerDetail.Child[i].Gender!="Female"))return ShowError("Please Check Title and Gender for Pax Child "+(i+1)+""),!1}if(n.ChildPassengerFields[0].DOB)for(r=0;r<n.ChildPassengerFields.length;r++){if(n.PassengerDetail.Child[r].DOB==""||n.PassengerDetail.Child[r].DOB==null||n.PassengerDetail.Child[r].DOB==undefined)return ShowError("Please Select Pax Child "+(r+1)+" Date Of Birth"),!1;if(e=moment(),e.add("years",-2),o=moment(n.PassengerDetail.Child[r].DOB,"DD/MM/YYYY"),s=o.diff(e,"days"),s>0)return ShowError("Please Select Pax Child "+(r+1)+"valid Date Of Birth"),!1}if(n.PassengerDetail.Child[i].DOB!=undefined&&n.PassengerDetail.Child[i].DOB!=null&&n.PassengerDetail.Child[i].DOB!="")if(n.DOB=n.PassengerDetail.Child[i].DOB,n.BookingType=="ROUNDTRIP"){if(parseInt(n.DOB.split("/")[2])+2==n.ReturnDate.split("/")[2]&&n.DOB.split("/")[1]==n.ReturnDate.split("/")[1]&&n.DOB.split("/")[0]<=n.ReturnDate.split("/")[0])return ShowError("Please Select Pax Child "+(i+1)+" Date of Birth Invalid Date"),!1}else if(parseInt(n.DOB.split("/")[2])+2==n.OngoingDate.split("/")[2]&&n.DOB.split("/")[1]==n.OngoingDate.split("/")[1]&&n.DOB.split("/")[0]<=n.OngoingDate.split("/")[0])return ShowError("Please Select Pax Child "+(i+1)+" Date of Birth Invalid Date"),!1;if(n.PassengerDetail.Child[i].Passport_Number=="")return ShowError("Please Enter Pax Child "+(i+1)+" Passport_Number"),!1;if(n.PassengerDetail.Child[i].Passport_Expiry!=undefined&&n.PassengerDetail.Child[i].Passport_Expiry!=null&&n.PassengerDetail.Child[i].Passport_Expiry!=""){if(n.Passport_Expiry=n.PassengerDetail.Child[i].Passport_Expiry,n.BookingType=="ROUNDTRIP"){if(n.Passport_Expiry.split("/")[2]<n.ReturnDate.split("/")[2]||n.Passport_Expiry.split("/")[2]==n.ReturnDate.split("/")[2]&&(n.Passport_Expiry.split("/")[1]<n.ReturnDate.split("/")[1]||n.Passport_Expiry.split("/")[1]==n.ReturnDate.split("/")[1]&&n.Passport_Expiry.split("/")[0]<=n.ReturnDate.split("/")[0]))return ShowError("Please Select Pax Child "+(i+1)+" Passport_Expiry Invalid Date"),!1}else if(n.Passport_Expiry.split("/")[2]<n.OngoingDate.split("/")[2]||n.Passport_Expiry.split("/")[2]==n.OngoingDate.split("/")[2]&&(n.Passport_Expiry.split("/")[1]<n.OngoingDate.split("/")[1]||n.Passport_Expiry.split("/")[1]==n.OngoingDate.split("/")[1]&&n.Passport_Expiry.split("/")[0]<=n.OngoingDate.split("/")[0]))return ShowError("Please Select Pax Child "+(i+1)+" Passport_Expiry Invalid Date"),!1}else if(n.ChildPassengerFields[0].Passport_Expiry)for(r=0;r<n.ChildPassengerFields.length;r++)if(n.PassengerDetail.Child[r].Passport_Expiry==""||n.PassengerDetail.Child[r].Passport_Expiry==null||n.PassengerDetail.Child[r].Passport_Expiry==undefined)return ShowError("Please Select Pax Child "+(r+1)+" Passport Expiry Date"),!1;if(n.ChildPassengerFields[0].DefenceServiceId&&n.PassengerDetail.Child[i].DefenceServiceId=="")return ShowError("Please Enter Pax Child "+(i+1)+" Defence Service Id"),!1;if(n.ChildPassengerFields[0].Student_Id&&n.PassengerDetail.Child[i].Student_Id=="")return ShowError("Please Enter Pax Child "+(i+1)+" student Id"),!1;if(n.PassengerDetail.Child[i].DefenceExpiryDate!=undefined&&n.PassengerDetail.Child[i].DefenceExpiryDate!=null&&n.PassengerDetail.Child[i].DefenceExpiryDate!=""){if(n.DefenceExpiryDate=n.PassengerDetail.Child[i].DefenceExpiryDate,n.BookingType=="ROUNDTRIP"){if(n.DefenceExpiryDate.split("/")[2]<n.ReturnDate.split("/")[2]||n.DefenceExpiryDate.split("/")[2]==n.ReturnDate.split("/")[2]&&(n.DefenceExpiryDate.split("/")[1]<n.ReturnDate.split("/")[1]||n.DefenceExpiryDate.split("/")[1]==n.ReturnDate.split("/")[1]&&n.DefenceExpiryDate.split("/")[0]<=n.ReturnDate.split("/")[0]))return ShowError("Please Select Pax Child "+(i+1)+" Defence Expiry Invalid Date"),!1}else if(n.DefenceExpiryDate.split("/")[2]<n.OngoingDate.split("/")[2]||n.DefenceExpiryDate.split("/")[2]==n.OngoingDate.split("/")[2]&&(n.DefenceExpiryDate.split("/")[1]<n.OngoingDate.split("/")[1]||n.DefenceExpiryDate.split("/")[1]==n.OngoingDate.split("/")[1]&&n.DefenceExpiryDate.split("/")[0]<=n.OngoingDate.split("/")[0]))return ShowError("Please Select Pax Child "+(i+1)+" Defence Expiry Invalid Date"),!1}else if(n.ChildPassengerFields[0].DefenceExpiryDate)for(r=0;r<n.ChildPassengerFields.length;r++)if(n.PassengerDetail.Child[r].DefenceExpiryDate==""||n.PassengerDetail.Child[r].DefenceExpiryDate==null||n.PassengerDetail.Child[r].DefenceExpiryDate==undefined)return ShowError("Please Select Pax Child "+(r+1)+" Defence Expiry Date"),!1;if(n.ChildPassengerFields[0].DefenceIssueDate)for(r=0;r<n.ChildPassengerFields.length;r++)if(n.PassengerDetail.Child[r].DefenceIssueDate==""||n.PassengerDetail.Child[r].DefenceIssueDate==null||n.PassengerDetail.Child[r].DefenceIssueDate==undefined)return ShowError("Please Select Pax Child "+(r+1)+" Defence Issue Date"),!1;n.checkfrequentPassenger(i,"Child",1)}else return ShowError("Please Enter Pax Child "+(i+1)+" Title"),!1;if(a>0)for(i=0;i<a;i++){if(n.PassengerDetail.Infant[i]==undefined||n.PassengerDetail.Infant[i]==""||n.PassengerDetail.Infant[i]==null||n.PassengerDetail.Infant[i].Title==undefined||n.PassengerDetail.Infant[i].Title==""||n.PassengerDetail.Infant[i].Title==null)return ShowError("Please Enter Pax Infant "+(i+1)+" Title"),!1;if(n.PassengerDetail.Infant[i].First_Name==undefined||n.PassengerDetail.Infant[i].First_Name==""||n.PassengerDetail.Infant[i].Title==null)return ShowError("Please Enter Pax Infant"+(i+1)+" FirstName"),!1;if(i!=0)for(u=0;u<i;u++){if(n.PassengerDetail.Infant[i].First_Name==n.PassengerDetail.Infant[u].First_Name&&n.PassengerDetail.Infant[i].Last_Name==n.PassengerDetail.Infant[u].Last_Name)return f="<span>Two Names Can not be Similar in a Single Booking, Airlines does not permit the same.<\/span><br/>",f+="<span>You can either-<\/span><br/>",f+="<span>1- Book a Separate ticket (Another transaction) for Pax with Similar Name.<br/><\/span>",f+="<span>2- If Your Name is "+n.PassengerDetail.Infant[i].Title+" "+n.PassengerDetail.Infant[i].First_Name+" "+n.PassengerDetail.Infant[i].Last_Name+", You can book one pax as "+n.PassengerDetail.Infant[i].Title+" "+n.PassengerDetail.Infant[i].Last_Name+" "+n.PassengerDetail.Infant[i].First_Name+".<\/span>",ShowError(f),!1;if(n.PassengerDetail.Infant[i].Last_Name==undefined||n.PassengerDetail.Infant[i].Last_Name==""||n.PassengerDetail.Infant[i].Last_Name==null)return ShowError("Please Enter Pax Infant"+(i+1)+" LastName"),!1;if(n.PassengerDetail.Infant[i].Last_Name.length<2)return ShowError("Please Enter Pax Infant "+(i+1)+" LastName Two Character"),!1}else{if(n.PassengerDetail.Infant[i].Last_Name==undefined||n.PassengerDetail.Infant[i].Last_Name==""||n.PassengerDetail.Infant[i].Last_Name==null)return ShowError("Please Enter Pax Infant"+(i+1)+" LastName"),!1;if(n.PassengerDetail.Infant[i].Last_Name.length<2)return ShowError("Please Enter Pax Infant "+(i+1)+" LastName Two Character"),!1;if(n.PassengerDetail.Infant[i].Gender==undefined||n.PassengerDetail.Infant[i].Gender==""||n.PassengerDetail.Infant[i].Gender==null)return ShowError("Please Enter Pax Infant "+(i+1)+" Gender"),!1;if(n.PassengerDetail.Infant[i]!=undefined&&n.PassengerDetail.Infant[i]!=""&&n.PassengerDetail.Infant[i]!=null&&n.PassengerDetail.Infant[i].Title!=undefined&&n.PassengerDetail.Infant[i].Title!=""&&n.PassengerDetail.Infant[i].Title!=null&&n.PassengerDetail.Infant[i].Gender!=undefined&&n.PassengerDetail.Infant[i].Gender!=""&&n.PassengerDetail.Infant[i].Gender!=null&&(n.PassengerDetail.Infant[i].Title=="Mstr"&&n.PassengerDetail.Infant[i].Gender!="Male"||(n.PassengerDetail.Infant[i].Title=="Ms"||n.PassengerDetail.Infant[i].Title=="Mrs")&&n.PassengerDetail.Infant[i].Gender!="Female"))return ShowError("Please Check Title and Gender for Pax Infant "+(i+1)+""),!1}if(n.InfantPassengerFields[0].DOB)for(r=0;r<n.InfantPassengerFields.length;r++){if(n.PassengerDetail.Infant[r].DOB==""||n.PassengerDetail.Infant[r].DOB==null||n.PassengerDetail.Infant[r].DOB==undefined)return ShowError("Please Select Pax Infant "+(r+1)+" Date Of Birth"),!1;if(e=moment(),e.add("days",-1),o=moment(n.PassengerDetail.Infant[r].DOB,"DD/MM/YYYY"),s=o.diff(e,"days"),s>0)return ShowError("Please Select Pax Infant "+(r+1)+"valid Date Of Birth"),!1}if(n.PassengerDetail.Infant[i].DOB!=undefined&&n.PassengerDetail.Infant[i].DOB!=null&&n.PassengerDetail.Infant[i].DOB!="")if(n.DOB=n.PassengerDetail.Infant[i].DOB,n.BookingType=="ROUNDTRIP"){if(parseInt(n.DOB.split("/")[2])+2==n.ReturnDate.split("/")[2]&&n.DOB.split("/")[1]==n.ReturnDate.split("/")[1]&&n.DOB.split("/")[0]<=n.ReturnDate.split("/")[0])return ShowError("Please Select Pax Infant "+(i+1)+" Date of Birth Invalid Date"),!1}else if(parseInt(n.DOB.split("/")[2])+2==n.OngoingDate.split("/")[2]&&n.DOB.split("/")[1]==n.OngoingDate.split("/")[1]&&n.DOB.split("/")[0]<=n.OngoingDate.split("/")[0])return ShowError("Please Select Pax Infant "+(i+1)+" Date of Birth Invalid Date"),!1;if(n.PassengerDetail.Infant[i].Passport_Number=="")return ShowError("Please Enter Pax Infant "+(i+1)+" Passport_Number"),!1;if(n.PassengerDetail.Infant[i].Passport_Expiry!=undefined&&n.PassengerDetail.Infant[i].Passport_Expiry!=null&&n.PassengerDetail.Infant[i].Passport_Expiry!=""){if(n.Passport_Expiry=n.PassengerDetail.Infant[i].Passport_Expiry,n.BookingType=="ROUNDTRIP"){if(n.Passport_Expiry.split("/")[2]<n.ReturnDate.split("/")[2]||n.Passport_Expiry.split("/")[2]==n.ReturnDate.split("/")[2]&&(n.Passport_Expiry.split("/")[1]<n.ReturnDate.split("/")[1]||n.Passport_Expiry.split("/")[1]==n.ReturnDate.split("/")[1]&&n.Passport_Expiry.split("/")[0]<=n.ReturnDate.split("/")[0]))return ShowError("Please Select Pax Infant "+(i+1)+" Passport_Expiry Invalid Date"),!1}else if(n.Passport_Expiry.split("/")[2]<n.OngoingDate.split("/")[2]||n.Passport_Expiry.split("/")[2]==n.OngoingDate.split("/")[2]&&(n.Passport_Expiry.split("/")[1]<n.OngoingDate.split("/")[1]||n.Passport_Expiry.split("/")[1]==n.OngoingDate.split("/")[1]&&n.Passport_Expiry.split("/")[0]<=n.OngoingDate.split("/")[0]))return ShowError("Please Select Pax Infant "+(i+1)+" Passport_Expiry Invalid Date"),!1}else if(n.InfantPassengerFields[0].Passport_Expiry)for(r=0;r<n.InfantPassengerFields.length;r++)if(n.PassengerDetail.Infant[r].Passport_Expiry==""||n.PassengerDetail.Infant[r].Passport_Expiry==null||n.PassengerDetail.Infant[r].Passport_Expiry==undefined)return ShowError("Please Select Pax Infant"+(r+1)+" Passport Expiry Date"),!1;if(n.InfantPassengerFields[0].DefenceServiceId&&n.PassengerDetail.Infant[i].DefenceServiceId=="")return ShowError("Please Enter Pax Infant "+(i+1)+" Defence Service Id"),!1;if(n.InfantPassengerFields[0].Student_Id&&n.PassengerDetail.Infant[i].Student_Id=="")return ShowError("Please Enter Pax Infant "+(i+1)+" student Id"),!1;if(n.PassengerDetail.Infant[i].DefenceExpiryDate!=undefined&&n.PassengerDetail.Infant[i].DefenceExpiryDate!=null&&n.PassengerDetail.Infant[i].DefenceExpiryDate!=""){if(n.DefenceExpiryDate=n.PassengerDetail.Infant[i].DefenceExpiryDate,n.BookingType=="ROUNDTRIP"){if(n.DefenceExpiryDate.split("/")[2]<n.ReturnDate.split("/")[2]||n.DefenceExpiryDate.split("/")[2]==n.ReturnDate.split("/")[2]&&(n.DefenceExpiryDate.split("/")[1]<n.ReturnDate.split("/")[1]||n.DefenceExpiryDate.split("/")[1]==n.ReturnDate.split("/")[1]&&n.DefenceExpiryDate.split("/")[0]<=n.ReturnDate.split("/")[0]))return ShowError("Please Select Pax Infant "+(i+1)+" Defence Expiry Invalid Date"),!1}else if(n.DefenceExpiryDate.split("/")[2]<n.OngoingDate.split("/")[2]||n.DefenceExpiryDate.split("/")[2]==n.OngoingDate.split("/")[2]&&(n.DefenceExpiryDate.split("/")[1]<n.OngoingDate.split("/")[1]||n.DefenceExpiryDate.split("/")[1]==n.OngoingDate.split("/")[1]&&n.DefenceExpiryDate.split("/")[0]<=n.OngoingDate.split("/")[0]))return ShowError("Please Select Pax Infant "+(i+1)+" Defence Expiry Invalid Date"),!1}else if(n.InfantPassengerFields[0].DefenceExpiryDate)for(r=0;r<n.InfantPassengerFields.length;r++)if(n.PassengerDetail.Infant[r].DefenceExpiryDate==""||n.PassengerDetail.Infant[r].DefenceExpiryDate==null||n.PassengerDetail.Infant[r].DefenceExpiryDate==undefined)return ShowError("Please Select Pax Infant "+(r+1)+" Defence Expiry Date"),!1;if(n.InfantPassengerFields[0].DefenceIssueDate)for(r=0;r<n.InfantPassengerFields.length;r++)if(n.PassengerDetail.Infant[r].DefenceIssueDate==""||n.PassengerDetail.Infant[r].DefenceIssueDate==null||n.PassengerDetail.Infant[r].DefenceIssueDate==undefined)return ShowError("Please Select Pax Infant "+(r+1)+" Defence Issue Date"),!1;n.checkfrequentPassenger(i,"Infant",1)}if(n.AdultPassengerFields[0].Mandatory_SSRs&&!n.CheckMandatorySSR(0)||n.ChildPassengerFields.length>0&&n.ChildPassengerFields[0].Mandatory_SSRs&&!n.CheckMandatorySSR(1)||n.InfantPassengerFields.length>0&&n.InfantPassengerFields[0].Mandatory_SSRs&&!n.CheckMandatorySSR(2))return!1;if(n.EnableCount=2,h="",n.OngoingDate!=null?(h+=n.OriginCode+"-"+n.DestinationCode+"  "+n.OngoingDate.split("/")[0]+"-"+fnGetMonthbyText(n.OngoingDate.split("/")[1])+"-"+n.OngoingDate.split("/")[2],n.BookingType=="ROUNDTRIP"&&(h+=" -  "+n.ReturnDate.split("/")[0]+"-"+fnGetMonthbyText(n.ReturnDate.split("/")[1])+"-"+n.ReturnDate.split("/")[2]),h+="  "+n.PassengerDetail.Adult[0].First_Name+" "+n.PassengerDetail.Adult[0].Last_Name):(h+=n.OriginCode+"-"+n.DestinationCode,h+="  "+n.PassengerDetail.Adult[0].First_Name+" "+n.PassengerDetail.Adult[0].Last_Name),n.Remarks=h,t==1){if(n.MobileNumberValidate(n.PaxMobileNumber))return $("#txtMobileNo").focus(),!1;if(n.EmailValidate(n.EmailID))return $("#txtEmail").focus(),!1;if(n.ApplyGST==!0){if(n.GSTEntryName.trim()=="")return ShowError("Please Enter Valid GST Company Name"),!1;if(n.GSTEntryNumber.trim()=="")return ShowError("Please Enter Valid GST Number"),!1;if(n.GSTEntryAddress.trim()=="")return ShowError("Please Enter Valid GST Address"),!1;if(n.GSTEntryNumber.length!=15||(n.GSTEntryNumber=n.GSTEntryNumber.toUpperCase(),!GSTValidation(n.GSTEntryNumber)))return ShowError("Please Enter Valid GST Number"),!1}return n.TRAVELLERDETAILSIsVisible=!1,n.FLIGHTDETAILSIsVisible=!1,n.PAYMENTMODEIsVisible=!0,n.PaymentdetailsIsVisible=!0,n.PreSelectedGatewayMode!=null&&n.ChangePGMode(n.PreSelectedGatewayMode),!0}if(t==2){if(n.MobileNumberValidate(n.PaxMobileNumber))return $("#txtMobileNo").focus(),!1;if(n.EmailValidate(n.EmailID))return $("#txtEmail").focus(),!1}return(n.PG_Mode==null||n.PG_Mode.length<=0)&&n.PaymentMode=="Payment_Gateway"?(ShowError("Please Select Payment Mode"),!1):n.PaymentMode==""||n.PaymentMode==undefined?(ShowError("Please Enter PaymentMode"),!1):!0}catch(v){}};n.CheckMandatorySSR=function(t){var e,c,o,a,s,y,i,v,p,r,u;var h=[],l=0,f="";if(t==0?(h=n.AdultPassengerFields[0].Mandatory_SSRs,l=n.AdultCount,f="Adult"):t==1?(h=n.ChildPassengerFields[0].Mandatory_SSRs,l=n.ChildCount,f="Child"):(h=n.InfantPassengerFields[0].Mandatory_SSRs,l=n.InfantCount,f="Infant"),h.length>0){for(e=0;e<n.FlightBooking.Trips.length;e++){for(c=SSRDetailsBasedOnSegment_Leg(n.SSRDetails,"Segment_Id","Leg_Index"),c=FilterObject(c,"Leg_Index",e),o=[],a=0;a<c.length;a++)o.push(c[a].Segment_Id);for(s=0;s<o.length;s++){for(y=SSRDetailsUniqueType_Segment(n.SSRDetails,"SSR_Type","Segment_Id",o[s]),i=[],v=0;v<h.length;v++)p=y.filter(function(n){if(n.SSR_Type==h[v])return i.push(n)});if(i.length>0)for(r=0;r<i.length;r++)if(i[r].ApplicablePaxTypes.indexOf(0)>-1)for(u=0;u<l;u++)if(n.SelectedSSR)if(n.SelectedSSR.Flight)if(n.SelectedSSR.Flight[e])if(n.SelectedSSR.Flight[e].Segment[o[s]])if(t==0)if(n.SelectedSSR.Flight[e].Segment[o[s]].Adult){if(!n.SelectedSSR.Flight[e].Segment[o[s]].Adult[u].SSRDetails[i[r].SSR_Type])return n.CallSSRErrorMessage(i[r].SSR_TypeName,f,u),!1}else return n.CallSSRErrorMessage(i[r].SSR_TypeName,f,u),!1;else if(t==1)if(n.SelectedSSR.Flight[e].Segment[o[s]].Child){if(!n.SelectedSSR.Flight[e].Segment[o[s]].Child[u].SSRDetails[i[r].SSR_Type])return n.CallSSRErrorMessage(i[r].SSR_TypeName,f,u),!1}else return n.CallSSRErrorMessage(i[r].SSR_TypeName,f,u),!1;else if(n.SelectedSSR.Flight[e].Segment[o[s]].Infant){if(!n.SelectedSSR.Flight[e].Segment[o[s]].Infant[u].SSRDetails[i[r].SSR_Type])return n.CallSSRErrorMessage(i[r].SSR_TypeName,f,u),!1}else return n.CallSSRErrorMessage(i[r].SSR_TypeName,f,u),!1;else return n.CallSSRErrorMessage(i[r].SSR_TypeName,f,u),!1;else return n.CallSSRErrorMessage(i[r].SSR_TypeName,f,u),!1;else return n.CallSSRErrorMessage(i[r].SSR_TypeName,f,u),!1;else return n.CallSSRErrorMessage(i[r].SSR_TypeName,f,u),!1}}return!0}};n.CallSSRErrorMessage=function(n,t,i){ShowAlert(n+" selection Required for "+t+" "+i)};n.SSRChange=function(){var s,h,d,g,nt,c,tt,it,l,rt,ut,a,u,f,r,i,t,ct;try{var ft=!1,et=0,e=0,o=0,lt=n.Addon_Seat_Fees,v=0,y=0,p=0,w=0,b=0,st=0,k=0,ht=n.FlightTrips,ot=!1;for(s=0;s<ht.length;s++)if(h=n.SelectedSSR.Flight[s],h!=undefined)for(d=Object.keys(h),t=0;t<d.length;t++)for(g=h[d[t]],nt=Object.keys(g),c=0;c<nt.length;c++)for(tt=g[nt[c]],it=Object.keys(tt),l=0;l<it.length;l++)for(rt=tt[it[l]],ut=Object.keys(rt),a=0;a<ut.length;a++)for(u=rt[ut[a]].SSRDetails,f=Object.keys(u),r=0;r<f.length;r++)u[f[r]]!=undefined&&u[f[r]]!="undefined"&&(ft=!0,ot=!0,i=u[f[r]],i.SSR_TypeName=="BAGGAGE"?o+=i.Total_Amount:i.SSR_TypeName=="MEALS"?e+=i.Total_Amount:i.SSR_TypeName=="BAGOUT FIRST"?v+=i.Total_Amount:i.SSR_TypeName=="CARRY MORE"?w+=i.Total_Amount:i.SSR_TypeName=="CELEBRATION"?y+=i.Total_Amount:i.SSR_TypeName=="LOUNGE"?p+=i.Total_Amount:i.SSR_TypeName=="FASTFORWARD"?b+=i.Total_Amount:i.SSR_TypeName=="SEAT"?st=n.TotalSeatAmount:k+=i.Total_Amount);for(et=e+o+v+w+y+p+k+b,n.AddOn_Fees_WOSeats=et,n.Addon_Meals_Fees=e,n.Addon_Baggage_Fees=o,n.AddOn_Fees=n.AddOn_Fees_WOSeats+n.TotalSeatAmount,n.AddONFound=ot,n.AddONVisible=n.AddOn_Fees>0||ft==!0?!0:!1,t=0;t<n.SSRFareList.length;t++)ct=0,n.SSRFareList[t].Amount=n.SSRFareList[t].SSRTYPE_NAME=="BAGGAGE"?o:n.SSRFareList[t].SSRTYPE_NAME=="MEALS"?e:n.SSRFareList[t].SSRTYPE_NAME=="BAGOUT FIRST"?v:n.SSRFareList[t].SSRTYPE_NAME=="CARRY MORE"?w:n.SSRFareList[t].SSRTYPE_NAME=="CELEBRATION"?y:n.SSRFareList[t].SSRTYPE_NAME=="LOUNGE"?p:n.SSRFareList[t].SSRTYPE_NAME=="FASTFORWARD"?b:n.SSRFareList[t].SSRTYPE_NAME=="SEAT"?n.TotalSeatAmount:k}catch(at){}};n.SSRDelete=function(t){var i,u,r;try{if(n.AddOn_Fees=t,n.AddOn_Fees>0)n.AddONVisible=!0;else for(n.AddONVisible=!1,n.AddONDetailsVisible=!1,n.SSRDetails=[],n.SelectedSSR=[],n.SSRDetails=n.AvailableSSRDetails,n.TotalSeatAmount=0,n.Selected_SeatMapPassanger=[],n.SSRFareList=[],n.SelectedSeats=[],i=0;i<n.AvailableSSRDetails.length;i++){for(u=!1,r=0;r<n.SSRFareList.length;r++)n.SSRFareList[r].SSRTYPE_NAME==n.AvailableSSRDetails[i].SSR_TypeName&&(u=!0);u==!1&&n.SSRFareList.push({SSRTYPE_ID:n.AvailableSSRDetails[i].SSR_Type,SSRTYPE_NAME:n.AvailableSSRDetails[i].SSR_TypeName,Amount:0})}}catch(f){}};n.Air_TotalFees=!1;n.FareSummaryDetails=!1;n.FareSummary=function(t){try{t==1?(n.Air_TotalFees=!n.Air_TotalFees,n.TaxesFeesOnVisible=n.Air_TotalFees==!0?!0:!1):t==3?n.AddONDetailsVisible=n.AddONDetailsVisible==!0?!1:!0:(n.FareSummaryDetails=!n.FareSummaryDetails,n.FareSummaryDetails==!0?(n.Adult_BaseFare>0&&(n.AdultDetails=!0),n.Child_BaseFare>0&&(n.ChildDetails=!0),n.Infant_BaseFare>0&&(n.InfantDetails=!0)):(n.AdultDetails=!1,n.ChildDetails=!1,n.InfantDetails=!1))}catch(i){}};n.ChangeFlight=function(t){var i,r;try{Config.ChannelId!="4"||t?localStorage.getItem("BookingRefNo")==""&&v.indexOf("request")<=-1&&v.indexOf("flightid")<=-1?(localStorage.setItem("ReSearch","1"),i=JSON.parse(localStorage.getItem("FlightObject")),e.LoadPage("flights/"+i.QueryString+"&ReSearch=1")):(n.ReongoingDate=n.FormatDate(n.OngoingDate,"DD/MM/YYYY","DD-MM-YYYY"),n.RereturnDate=n.FormatDate(n.ReturnDate,"DD/MM/YYYY","DD-MM-YYYY"),r="origin="+n.From.originalObject.Value+"&destination="+n.To.originalObject.Value+"&onward="+n.ReongoingDate+"&return="+n.RereturnDate+"&type="+n.Travel_Type+"&class="+n.Travel_Class+"&adult="+n.Adult_Count+"&child="+n.Child_Count+"&infant="+n.Infant_Count+"&direct="+n.DirectFlight+"&discount="+n.RoundTrip_Fare+"&nocache="+n.HostSearch+"&defence="+n.Defence+"&originName="+n.From.originalObject.Name.split("(")[0]+"&destinationName="+n.To.originalObject.Name.split("(")[0],n.LoadPage("flights/"+r)):ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");n.ChangeFlight(!0)},"Are you sure want change your selected flight?",function(){$("#ConfirmationModal").modal("hide")})}catch(u){}};n.FlightDetailsCol=!1;n.TravellerDetailsCol=!1;n.PaymentDetailsCol=!1;n.Flightcollapse=function(t){try{t==1&&(localStorage.getItem("BookingRefNo")==""?n.FLIGHTDETAILSIsVisible||(n.FLIGHTDETAILSIsVisible=!n.FLIGHTDETAILSIsVisible,n.TRAVELLERDETAILSIsVisible=!1,n.PAYMENTMODEIsVisible=!1):n.PAYMENTMODEIsVisible&&(n.FLIGHTDETAILSIsVisible=!1));t==2&&(localStorage.getItem("BookingRefNo")==""?n.TRAVELLERDETAILSIsVisible||n.FLIGHTDETAILSIsVisible||(n.TRAVELLERDETAILSIsVisible=!n.TRAVELLERDETAILSIsVisible,n.PAYMENTMODEIsVisible=!1):n.PAYMENTMODEIsVisible&&(n.TRAVELLERDETAILSIsVisible=!1));t==3&&(n.PAYMENTMODEIsVisible=localStorage.getItem("BookingRefNo")==""?!1:!n.PAYMENTMODEIsVisible);(n.PaxMobileNumber==""||n.PaxMobileNumber==null||n.EmailID==""||n.EmailID==null)&&(n.PAYMENTMODEIsVisible=!1,n.TRAVELLERDETAILSIsVisible=!1)}catch(i){}};n.CloseBookingConfirmation=function(){try{localStorage.getItem("BookingRefNo")==""&&(n.TRAVELLERDETAILSIsVisible=!n.TRAVELLERDETAILSIsVisible)}catch(t){}};n.TravelBookingCount=0;n.PayBookingCount=0;n.fnfrequentVaildate=function(){var t,i;try{t="";n.Selected_AdultFreqPax!=undefined&&n.AdultCount<n.Selected_AdultFreqPax.length&&(t+="Adult"+n.Selected_AdultFreqPax.length);n.Selected_ChildFreqPax!=undefined&&n.ChildCount<n.Selected_ChildFreqPax.length&&(t+=",",t+="Child"+n.Selected_ChildFreqPax.length);n.Selected_InfantFreqPax!=undefined&&n.InfantCount<n.Selected_InfantFreqPax.length&&(t+=",",t+="Infant"+n.Selected_InfantFreqPax.length);t!=""?(i="Selected Pax Count Seems More than Traveller Count for  "+t,ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");e.ClosePassenger()},i,function(){e.ClosePassenger();$("#ConfirmationModal").modal("hide")})):e.ClosePassenger()}catch(r){}};n.FrequentPassengers=function(t){try{n.Adultchecked=0;n.Childchecked=0;n.Infantchecked=0;n.model.SelectPassenger_Details=[];n.GetPassenger();y();n.SelectPassengerDetails=!0;n.freq_index=t}catch(i){}};n.model={SelectPassenger_Details:[]};n.Adultlimit=n.AdultCount;n.Childlimit=n.ChildCount;n.Infantlimit=n.InfantCount;n.ChkBox=function(t,i,r){try{n.Adultchecked=0;n.Childchecked=0;n.Infantchecked=0;n.Selected_AdultFreqPax=[];n.Selected_ChildFreqPax=[];n.Selected_InfantFreqPax=[];angular.forEach(n.lobjPassengerData_Adult,function(t){t.Selected&&(n.Selected_AdultFreqPax.length<=n.AdultCount&&n.Selected_AdultFreqPax.push(t),n.Adultchecked++)});i||r!="A"||n.Adultchecked--;angular.forEach(n.lobjPassengerData_Child,function(t){t.Selected&&n.Selected_ChildFreqPax.length<=n.ChildCount&&(n.Selected_ChildFreqPax.push(t),n.Childchecked++)});i||r!="C"||n.Childchecked--;angular.forEach(n.lobjPassengerData_Infant,function(t){t.Selected&&n.Selected_InfantFreqPax.length<=n.InfantCount&&(n.Selected_InfantFreqPax.push(t),n.Infantchecked++)});i||r!="I"||n.Infantchecked--;n.SelectPassenger()}catch(u){}};n.ChangeChkState=function(t,i,r){i=="A"?r?(t.Selected=!1,n.Adultchecked>0?n.Adultchecked=n.Adultchecked-1:0):t.Selected=!0:i=="C"?r?(t.Selected=!1,n.Childchecked>0?n.Childchecked=n.Childchecked-1:0):t.Selected=!0:i=="I"&&(r?(t.Selected=!1,n.Infantchecked>0?n.Infantchecked=n.Infantchecked-1:0):t.Selected=!0)};n.SelectPassenger=function(){var r,i,t;try{for(r=[],t=0;t<n.Adult_Count;t++)if(n.Selected_AdultFreqPax[t]!=undefined){if(n.PassengerDetail.Adult[t].Title=n.Selected_AdultFreqPax[t].Title,n.PassengerDetail.Adult[t].Gender=n.Selected_AdultFreqPax[t].Gender,n.PassengerDetail.Adult[t].First_Name=n.Selected_AdultFreqPax[t].Firstname,n.PassengerDetail.Adult[t].Last_Name=n.Selected_AdultFreqPax[t].Lastname,n.PassengerDetail.Adult[t].DOB!=undefined&&n.PassengerDetail.Adult[t].DOB!=null&&(n.PassengerDetail.Adult[t].DOB=n.Selected_AdultFreqPax[t].Dob),n.PassengerDetail.Adult[t].Age!=undefined&&n.PassengerDetail.Adult[t].Age!=null&&(n.PassengerDetail.Adult[t].Age=n.Selected_AdultFreqPax[t].Age),n.PassengerDetail.Adult[t].Nationality!=undefined&&n.PassengerDetail.Adult[t].Nationality!=null&&(n.PassengerDetail.Adult[t].Nationality=n.Selected_AdultFreqPax[t].Nationality),n.PassengerDetail.Adult[t].Passport_Issuing_Country!=undefined&&n.PassengerDetail.Adult[t].Passport_Issuing_Country!=null&&(n.PassengerDetail.Adult[t].Passport_Issuing_Country=n.Selected_AdultFreqPax[t].Passportissuedby),n.PassengerDetail.Adult[t].Passport_Number!=undefined&&n.PassengerDetail.Adult[t].Passport_Number!=null&&(n.PassengerDetail.Adult[t].Passport_Number=n.Selected_AdultFreqPax[t].Passportno),n.PassengerDetail.Adult[t].Passport_Expiry!=undefined&&n.PassengerDetail.Adult[t].Passport_Expiry!=null&&(n.PassengerDetail.Adult[t].Passport_Expiry=n.Selected_AdultFreqPax[t].Passportexpiry),n.FrequentPaxlist.length!=0)for(i=0;i<n.FrequentPaxlist.length;i++)n.FrequentPaxlist[i].Passengerid==n.Selected_AdultFreqPax[t].Passengerid&&n.ongoing_AirlineCode==n.FrequentPaxlist[i].AirlineCode&&r.push({PaxName:"Adult"+(t+1),Airline:n.FrequentPaxlist[i].AirlinesName,FFN:n.FrequentPaxlist[i].FFNumber})}else n.PassengerDetail.Adult[t].Title="Mr",n.PassengerDetail.Adult[t].Gender="Male",n.PassengerDetail.Adult[t].First_Name="",n.PassengerDetail.Adult[t].Last_Name="",n.PassengerDetail.Adult[t].DOB!=undefined&&n.PassengerDetail.Adult[t].DOB!=null&&n.PassengerDetail.Adult[t].DOB!=""&&(n.PassengerDetail.Adult[t].DOB=""),n.PassengerDetail.Adult[t].Age!=undefined&&n.PassengerDetail.Adult[t].Age!=null&&n.PassengerDetail.Adult[t].Age!=""&&(n.PassengerDetail.Adult[t].Age=""),n.PassengerDetail.Adult[t].Nationality!=undefined&&n.PassengerDetail.Adult[t].Nationality!=null&&n.PassengerDetail.Adult[t].Nationality!=""&&(n.PassengerDetail.Adult[t].Nationality="INDIA"),n.PassengerDetail.Adult[t].Passport_Issuing_Country!=undefined&&n.PassengerDetail.Adult[t].Passport_Issuing_Country!=null&&n.PassengerDetail.Adult[t].Passport_Issuing_Country!=""&&(n.PassengerDetail.Adult[t].Passport_Issuing_Country="INDIA"),n.PassengerDetail.Adult[t].Passport_Number!=undefined&&n.PassengerDetail.Adult[t].Passport_Number!=null&&n.PassengerDetail.Adult[t].Passport_Number!=""&&(n.PassengerDetail.Adult[t].Passport_Number=""),n.PassengerDetail.Adult[t].Passport_Expiry!=undefined&&n.PassengerDetail.Adult[t].Passport_Expiry!=null&&n.PassengerDetail.Adult[t].Passport_Expiry!=""&&(n.PassengerDetail.Adult[t].Passport_Expiry="");for(t=0;t<n.Child_Count;t++)if(n.Selected_ChildFreqPax[t]!=undefined){if(n.Selected_ChildFreqPax[t].Title=="Mr"?n.PassengerDetail.Child[t].Title="Mstr":n.Selected_ChildFreqPax[t].Title=="Ms"?n.PassengerDetail.Child[t].Title="Miss":n.Selected_ChildFreqPax[t].Title=="Mrs"&&(n.PassengerDetail.Child[t].Title="Miss"),n.PassengerDetail.Child[t].Gender=n.Selected_ChildFreqPax[t].Gender,n.PassengerDetail.Child[t].First_Name=n.Selected_ChildFreqPax[t].Firstname,n.PassengerDetail.Child[t].Last_Name=n.Selected_ChildFreqPax[t].Lastname,n.PassengerDetail.Child[t].DOB!=undefined&&n.PassengerDetail.Child[t].DOB!=null&&(n.PassengerDetail.Child[t].DOB=n.Selected_ChildFreqPax[t].Dob),n.PassengerDetail.Child[t].Age!=undefined&&n.PassengerDetail.Child[t].Age!=null&&(n.PassengerDetail.Child[t].Age=n.Selected_ChildFreqPax[t].Age),n.PassengerDetail.Child[t].Nationality!=undefined&&n.PassengerDetail.Child[t].Nationality!=null&&(n.PassengerDetail.Child[t].Nationality=n.Selected_ChildFreqPax[t].Nationality),n.PassengerDetail.Child[t].Passport_Issuing_Country!=undefined&&n.PassengerDetail.Child[t].Passport_Issuing_Country!=null&&(n.PassengerDetail.Child[t].Passport_Issuing_Country=n.Selected_ChildFreqPax[t].Passportissuedby),n.PassengerDetail.Child[t].Passport_Number!=undefined&&n.PassengerDetail.Child[t].Passport_Number!=null&&(n.PassengerDetail.Child[t].Passport_Number=n.Selected_ChildFreqPax[t].Passportno),n.PassengerDetail.Child[t].Passport_Expiry!=undefined&&n.PassengerDetail.Child[t].Passport_Expiry!=null&&(n.PassengerDetail.Child[t].Passport_Expiry=n.Selected_ChildFreqPax[t].Passportexpiry),n.FrequentPaxlist.length!=0)for(i=0;i<n.FrequentPaxlist.length;i++)n.FrequentPaxlist[i].Passengerid==n.Selected_ChildFreqPax[t].Passengerid&&r.push({PaxName:"Child"+(t+1),Airline:n.FrequentPaxlist[i].AirlinesName,FFN:n.FrequentPaxlist[i].FFNumber})}else n.PassengerDetail.Child[t].Title="Mstr",n.PassengerDetail.Child[t].Gender="Male",n.PassengerDetail.Child[t].First_Name="",n.PassengerDetail.Child[t].Last_Name="",n.PassengerDetail.Child[t].DOB!=undefined&&n.PassengerDetail.Child[t].DOB!=null&&n.PassengerDetail.Child[t].DOB!=""&&(n.PassengerDetail.Child[t].DOB=""),n.PassengerDetail.Child[t].Age!=undefined&&n.PassengerDetail.Child[t].Age!=null&&n.PassengerDetail.Child[t].Age!=""&&(n.PassengerDetail.Child[t].Age=""),n.PassengerDetail.Child[t].Nationality!=undefined&&n.PassengerDetail.Child[t].Nationality!=null&&n.PassengerDetail.Child[t].Nationality!=""&&(n.PassengerDetail.Child[t].Nationality="INDIA"),n.PassengerDetail.Child[t].Passport_Issuing_Country!=undefined&&n.PassengerDetail.Child[t].Passport_Issuing_Country!=null&&n.PassengerDetail.Child[t].Passport_Issuing_Country!=""&&(n.PassengerDetail.Child[t].Passport_Issuing_Country="INDIA"),n.PassengerDetail.Child[t].Passport_Number!=undefined&&n.PassengerDetail.Child[t].Passport_Number!=null&&n.PassengerDetail.Child[t].Passport_Number!=""&&(n.PassengerDetail.Child[t].Passport_Number=""),n.PassengerDetail.Child[t].Passport_Expiry!=undefined&&n.PassengerDetail.Child[t].Passport_Expiry!=null&&n.PassengerDetail.Child[t].Passport_Expiry!=""&&(n.PassengerDetail.Child[t].Passport_Expiry="");for(t=0;t<n.Infant_Count;t++)n.Selected_InfantFreqPax[t]!=undefined?(n.Selected_InfantFreqPax[t].Title=="Mr"?n.PassengerDetail.Infant[t].Title="Mstr":n.Selected_InfantFreqPax[t].Title=="Ms"&&(n.PassengerDetail.Infant[t].Title="Miss"),n.PassengerDetail.Infant[t].Gender=n.Selected_InfantFreqPax[t].Gender,n.PassengerDetail.Infant[t].First_Name=n.Selected_InfantFreqPax[t].Firstname,n.PassengerDetail.Infant[t].Last_Name=n.Selected_InfantFreqPax[t].Lastname,n.PassengerDetail.Infant[t].DOB!=undefined&&n.PassengerDetail.Infant[t].DOB!=null&&(n.PassengerDetail.Infant[t].DOB=n.Selected_InfantFreqPax[t].Dob),n.PassengerDetail.Infant[t].Age!=undefined&&n.PassengerDetail.Infant[t].Age!=null&&(n.PassengerDetail.Infant[t].Age=n.Selected_InfantFreqPax[t].Age),n.PassengerDetail.Infant[t].Nationality!=undefined&&n.PassengerDetail.Infant[t].Nationality!=null&&(n.PassengerDetail.Infant[t].Nationality=n.Selected_InfantFreqPax[t].Nationality),n.PassengerDetail.Infant[t].Passport_Issuing_Country!=undefined&&n.PassengerDetail.Infant[t].Passport_Issuing_Country!=null&&(n.PassengerDetail.Infant[t].Passport_Issuing_Country=n.Selected_InfantFreqPax[t].Passportissuedby),n.PassengerDetail.Infant[t].Passport_Number!=undefined&&n.PassengerDetail.Infant[t].Passport_Number!=null&&(n.PassengerDetail.Infant[t].Passport_Number=n.Selected_InfantFreqPax[t].Passportno),n.PassengerDetail.Infant[t].Passport_Expiry!=undefined&&n.PassengerDetail.Infant[t].Passport_Expiry!=null&&(n.PassengerDetail.Infant[t].Passport_Expiry=n.Selected_InfantFreqPax[t].Passportexpiry)):(n.PassengerDetail.Infant[t].Title="Mstr",n.PassengerDetail.Infant[t].Gender="Male",n.PassengerDetail.Infant[t].First_Name="",n.PassengerDetail.Infant[t].Last_Name="",n.PassengerDetail.Infant[t].DOB!=undefined&&n.PassengerDetail.Infant[t].DOB!=null&&n.PassengerDetail.Infant[t].DOB!=""&&(n.PassengerDetail.Infant[t].DOB=""),n.PassengerDetail.Infant[t].Age!=undefined&&n.PassengerDetail.Infant[t].Age!=null&&n.PassengerDetail.Infant[t].Age!=""&&(n.PassengerDetail.Infant[t].Age=""),n.PassengerDetail.Infant[t].Nationality!=undefined&&n.PassengerDetail.Infant[t].Nationality!=null&&n.PassengerDetail.Infant[t].Nationality!=""&&(n.PassengerDetail.Infant[t].Nationality="INDIA"),n.PassengerDetail.Infant[t].Passport_Issuing_Country!=undefined&&n.PassengerDetail.Infant[t].Passport_Issuing_Country!=null&&n.PassengerDetail.Infant[t].Passport_Issuing_Country!=""&&(n.PassengerDetail.Infant[t].Passport_Issuing_Country="INDIA"),n.PassengerDetail.Infant[t].Passport_Number!=undefined&&n.PassengerDetail.Infant[t].Passport_Number!=null&&n.PassengerDetail.Infant[t].Passport_Number!=""&&(n.PassengerDetail.Infant[t].Passport_Number=""),n.PassengerDetail.Infant[t].Passport_Expiry!=undefined&&n.PassengerDetail.Infant[t].Passport_Expiry!=null&&n.PassengerDetail.Infant[t].Passport_Expiry!=""&&(n.PassengerDetail.Infant[t].Passport_Expiry=""));n.FFNList=r;$("#AddPassengerDetails").modal("hide")}catch(u){}};n.AddPaxDate=function(){var t,i;try{t=new Date;n.paxDOBMinDate=moment().subtract(100,"Y");n.paxDOBMaxDate=moment().add(0,"Y");i=new Date;n.paxPassminDate=moment().add(1,"Y");n.paxPassmaxDate=moment().add(10,"Y");n.BookingType=="ROUNDTRIP"?(n.ReturnDateFormat=getDayNameMonth(n.ReturnDate),n.Passport_ExpiryMIDate=moment(n.ReturnDateFormat).add(1,"days"),n.Passport_ExpiryMADate=moment(n.ReturnDateFormat).add(10,"Y")):(n.OngingDateFormat=getDayNameMonth(n.OngoingDate),n.Passport_ExpiryMIDate=moment(n.OngingDateFormat).add(1,"days"),n.Passport_ExpiryMADate=moment(n.OngingDateFormat).add(10,"Y"))}catch(r){}};n.AddPaxDate();n.InitDate=function(){var t,i;try{n.BookingType=="ROUNDTRIP"?(n.ReturnDateFormat=getDayNameMonth(n.ReturnDate),t=new Date,n.adFrom12Years=t.setFullYear(t.getFullYear()-12),n.adDOBMinDate=moment(n.ReturnDateFormat).subtract(100,"Y"),n.adDOBMaxDate=moment(n.ReturnDateFormat).subtract(12,"Y"),i=new Date,n.chFrom2Years=i.setFullYear(i.getFullYear()-2),n.chDOBMinDate=moment(n.ReturnDateFormat).subtract(12,"Y"),n.chDOBMaxDate=moment(n.ReturnDateFormat).subtract(2,"Y"),n.infDOBMinDate=moment(n.ReturnDateFormat).subtract(2,"Y").add(1,"days"),n.infDOBMaxDate=moment().subtract(1,"days")):(n.OngingDateFormat=getDayNameMonth(n.OngoingDate),t=new Date,n.adFrom12Years=t.setFullYear(t.getFullYear()-12),n.adDOBMinDate=moment(n.OngingDateFormat).subtract(100,"Y"),n.adDOBMaxDate=moment(n.OngingDateFormat).subtract(12,"Y"),i=new Date,n.chFrom2Years=i.setFullYear(i.getFullYear()-2),n.chDOBMinDate=moment(n.OngingDateFormat).subtract(12,"Y"),n.chDOBMaxDate=moment(n.OngingDateFormat).subtract(2,"Y"),n.infDOBMinDate=moment(n.OngingDateFormat).subtract(2,"Y").add(1,"days"),n.infDOBMaxDate=moment().subtract(1,"days"))}catch(r){}};n.InitDate();n.GetPassenger=function(i){n.lobjPassengerRequest={Productid:1,CustomerMobile:n.CustomerMobileNumber};fnProgstart();var r=t({method:"POST",url:Config.Api+"Trading/GetPassengerDetails",dataType:"json",data:n.lobjPassengerRequest,headers:{"Content-Type":"application/json"}});r.then(function(t){var f,e,r,u;try{if(i!=1&&fnProgstop(),n.SSRStatus==!0&&fnProgstop(),f=t.data.Data,t.data.Status=="1")if(e=[],r=f.Table,n.FrequentPaxlist=f.Table1,r.length>0){for(n.lobjPassengerData_Adult=[],n.lobjPassengerData_Child=[],n.lobjPassengerData_Infant=[],u=0;u<r.length;u++)r[u].PassengerType=="Adult"&&n.lobjPassengerData_Adult.push(r[u]),r[u].PassengerType=="Child"&&n.ChildCount!=0&&n.lobjPassengerData_Child.push(r[u]),r[u].PassengerType=="Infant"&&n.InfantCount!=0&&n.lobjPassengerData_Infant.push(r[u]);n.lobjPassengerData_Adult.length!=0&&(n.PassengerGrid_Adult=!0);n.lobjPassengerData_Child.length!=0&&(n.PassengerGrid_Child=!0);n.lobjPassengerData_Infant.length!=0&&(n.PassengerGrid_infant=!0);n.PassengerData=r;n.PassengerDetailsGrid=!0;n.FrequentPaxGrid=!0}else n.PassengerData="",n.PassengerDetailsGrid=!1,n.NODATAISVISIBLE=!0,n.FrequentPaxGrid=!1,n.PassengerGrid_Adult=!1,n.PassengerGrid_Child=!1,n.PassengerGrid_infant=!1,n.NoRecordFound=f.StatusDesc;else n.PassengerData="",n.PassengerDetailsGrid=!1,n.NODATAISVISIBLE=!0,n.FrequentPaxGrid=!1,n.PassengerGrid_Adult=!1,n.PassengerGrid_Child=!1,n.PassengerGrid_infant=!1,n.NoRecordFound=f.StatusDesc,fnProgstop()}catch(o){}},function(n){alert(n)})};n.EditPassengerDetails=function(i,r){var u,f,e,o;try{r==1?confirm("Are you sure want to Edit?")&&(n.PaxInsertIsVisible=!1,n.PaxUpdateIsVisible=!0,u=n.PassengerData[i],n.PaxTitle=u.Title,n.PaxFirstName=u.Firstname,n.PaxLastName=u.Lastname,n.PaxGender=u.Gender,n.PaxDOB=u.Dob,n.PaxNationality=u.Nationality,n.PaxPassport_Number=u.Passportno,n.PaxPassport_Expiry=u.Passportexpiry,n.PaxPassport_Issuing_Country=u.Passportissuedby,n.PassengerID=u.Passengerid,n.Flag=2):r==2&&confirm("Are you sure want to Delete?")&&(n.PaxInsertIsVisible=!0,n.PaxUpdateIsVisible=!1,u=n.PassengerData[i],f=u.Dob.split("/"),u.Passportexpiry!=null&&(e=u.Passportexpiry.split("/"),e=e[1]+"/"+e[0]+"/"+e[2]),f=f[1]+"/"+f[0]+"/"+f[2],n.lobjPassengerRequest={Productid:1,CustomerMobile:n.CustomerMobileNumber,PaxTitle:u.Title,PaxFirstName:u.Firstname,PaxLastName:u.Lastname,PaxGender:u.Gender,PaxDOB:f,PaxNationality:u.Nationality,PaxPassport_Number:u.Passportno,PaxPassport_Expiry:e,Paxpassport_Issu:u.Passportissuedby,Pax_Flag:3,PassengerId:u.Passengerid,PassType:""},fnProgstart(),o=t({method:"POST",url:Config.Api+"Trading/AddPassengerDetails",dataType:"json",data:n.lobjPassengerRequest,headers:{"Content-Type":"application/json"}}),o.then(function(t){var i,r;try{fnProgstop();i=t.data.Data;t.data.Status=="1"?(r=i.Table1[0].Column1,ShowAlert("Passenger Deleted"),n.GetPassenger()):ShowAlert(i.data.StatusDesc)}catch(u){}},function(n){alert(n)}))}catch(h){}};n.AddPassengerDetails=function(i){var s,r,f,u,o;try{if(n.Adultchecked=0,n.Childchecked=0,n.Infantchecked=0,$("#AddPassengerDetails").css("max-height",window.innerHeight),$("#AddPassengerDetails").css("min-height",window.innerHeight),$("#AddPassengerDetails").css("z-index","200000  !important"),i==0)n.PassengerID=0,n.Flag=1,n.Adultvisible=!1,n.Childvisible=!1,n.Infantvisible=!1,n.ADDPAXvisible=!0,n.FFNPaxwiseList=[],n.Contrylist=e.CountryList,n.PaxFirstName="",n.PaxLastName="",n.PaxDOB=="",n.PaxPassport_Number="",n.PaxPassport_Expiry="",n.PaxTitle="",n.PaxInsertIsVisible=!0,n.PaxUpdateIsVisible=!1,n.Passport_ExpiryMIDate=moment(n.ReturnDateFormat).add(1,"days"),n.Passport_ExpiryMADate=moment(n.ReturnDateFormat).add(10,"Y"),e.ClosePassenger(),$("#AddPassengerDetails").modal("show");else if(i==2)n.PaxPassport_Number="",n.PaxInsertIsVisible=!0,n.PaxUpdateIsVisible=!1,n.PaxPassport_Expiry="",$("#AddPassengerDetails").modal("show");else if(i==3){for(s=[],r=0;r<n.AddNewPassengers.length;r++)s.push({PaxTitle:n.AddNewPassengers[r].PaxTitle,PaxFirstName:n.AddNewPassengers[r].PaxFName,PaxLastName:n.AddNewPassengers[r].PaxLName,PaxGender:n.AddNewPassengers[r].PaxGender,PaxDOB:"",PaxNationality:"",PaxPassport_Number:"",PaxPassport_Expiry:"",Paxpassport_Issu:"",PassType:n.AddNewPassengers[r].PaxType.substring(0,1)});n.lobjPassengerRequest={Productid:1,CustomerMobile:n.CustomerMobileNumber,PassengerDetails:s,Pax_Flag:1,PassengerId:n.PassengerID,FRequentFlyerDetail:n.PushFFNPaxwiseList()};o=t({method:"POST",url:Config.Api+"Trading/AddPassengerDetails",dataType:"json",data:n.lobjPassengerRequest,headers:{"Content-Type":"application/json"}});o.then(function(t){var r,f,u;try{r=t.data.Data;t.data.Status=="1"?(y(),n.AddNewPaxSuccess=!0,n.AddNewPassengersList=[],f=r.Table[0].Column1,u=r.Table1[0].Column1,f==1?(n.AddPaxDate(),n.GetPassenger()):i==2?ShowAlert("Error on adding Frequent Passenger :"+u):ShowAlert("Error on adding Frequent Passenger :"+u)):ShowAlert("Error on adding Frequent Passenger :"+r.StatusDesc)}catch(e){fnProgstop()}},function(){})}else{if(n.Adultvisible==!0?n.PaxDOB=n.PaxDOB_ADUlt:n.Childvisible==!0?n.PaxDOB=n.PaxDOB_Child:n.Infantvisible==!0&&(n.PaxDOB=n.PaxDOB_Infant),n.PaxTitle==""||n.PaxTitle==undefined)return ShowError("Please Select Title"),!1;if(n.PaxFirstName==""||n.PaxFirstName==undefined)return ShowError("Please Enter FirstName"),!1;if(n.PaxLastName==""||n.PaxLastName==undefined)return ShowError("Please Enter LastName"),!1;if(n.PaxGender==""||n.PaxGender==undefined)return ShowError("Please Select Gender"),!1;if(n.PaxDOB==""||n.PaxDOB==undefined)return ShowError("Please Select DOB"),!1;if((n.PaxNationality==undefined&&(n.PaxNationality=""),n.PaxPassport_Number==undefined&&(n.PaxPassport_Number=""),n.PaxPassport_Expiry==undefined&&(n.PaxPassport_Expiry=""),n.Flag==1&&(n.PassengerID=0),(n.PaxTitle=="Mr"||n.PaxTitle=="Mstr")&&n.PaxGender!="Male")||(n.PaxTitle=="Ms"||n.PaxTitle=="Mrs")&&n.PaxGender!="Female")return ShowError("Please Check Title and Gender for Pax Invalid"),!1;f=n.PaxDOB.split("/");f=f[1]+"/"+f[0]+"/"+f[2];n.PaxPassport_Expiry!=""?(u=n.PaxPassport_Expiry.split("/"),u=u[1]+"/"+u[0]+"/"+u[2]):u="";n.lobjPassengerRequest={Productid:1,CustomerMobile:n.CustomerMobileNumber,PassengerDetails:[{PaxTitle:n.PaxTitle,PaxFirstName:n.PaxFirstName,PaxLastName:n.PaxLastName,PaxGender:n.PaxGender,PaxDOB:f,PaxNationality:n.NationalityCode,PaxPassport_Number:n.PaxPassport_Number,PaxPassport_Expiry:u,Paxpassport_Issu:n.PassportIssuingCode,PassType:""}],Pax_Flag:n.Flag,PassengerId:n.PassengerID,FRequentFlyerDetail:n.PushFFNPaxwiseList()};fnProgstart();o=t({method:"POST",url:Config.Api+"Trading/AddPassengerDetails",dataType:"json",data:n.lobjPassengerRequest,headers:{"Content-Type":"application/json"}});o.then(function(t){var r,f,u;try{fnProgstop();r=t.data.Data;t.data.Status=="1"?(f=r.Table[0].Column1,u=r.Table1[0].Column1,f==1?n.AddPaxtype!=""&&(n.BindNewPaxDetail(n.AddPaxindex,n.AddPaxtype),$("#AddPassengerDetails").modal("hide"),y()):i==2?(n.PaxInsertIsVisible=!0,n.PaxUpdateIsVisible=!1,ShowAlert(u)):ShowAlert(u),n.PaxFirstName="",n.PaxLastName="",n.PaxPassport_Number="",n.PaxTitle="Mr",n.PaxGender="Male",n.PaxNationality="INDIA",n.AddPaxDate(),n.GetPassenger()):ShowAlert(t.data.StatusDesc)}catch(e){fnProgstop()}},function(){})}}catch(c){}};n.Costregister={};n.SelectedSeats=[];n.TSeatAmount=0;n.SelectSeat=function(t,i,r,u){var c,w,l,o,f;try{if(c=t.currentTarget.className,c!="air-seat-selected"){var s=0,y=$("input[name=Selected_Passenger]:checked").val(),h=n.SeatMapPassengersList,e=n.SelectedSeats;for(f=0;f<h.length;f++)if(w=!1,y==h[f].PassengerID){for(o=0;o<e.length;o++)y==e[o].PassengerID&&r==e[o].SegmentId&&e[o].FlightId==u&&e.splice(o,1);s=s+parseFloat(i.Total_Amount);e.push({SegmentId:r,FlightId:u,PassengerID:h[f].PassengerID,PaxType:h[f].PaxType,Title:h[f].Title,FirstName:h[f].FirstName,LastName:h[f].LastName,Gender:h[f].Gender,SeatNumber:i.SSR_TypeName,SeatAmount:i.Total_Amount,SSR_Key:i.SSR_Key})}for(l=n.AddOn_Fees+s,n.SelectedSeats=e,n.SeatSelectedLenght=n.SelectedSeats.length,n.TSeatAmount=0,o=0;o<n.SelectedSeats.length;o++)n.TSeatAmount+=parseFloat(n.SelectedSeats[o].SeatAmount);n.Addon_Seat_Fees=s;n.AddOn_Fees=l;l>0?(n.AddONVisible=!0,n.AddONFound=!0):n.AddONVisible=!1}else if(c=="air-seat-selected"){var e=n.SelectedSeats,p=n.SelectedSeats,s=0,a=n.AddOn_Fees,v=n.Addon_Seat_Fees,b=parseInt($("input[name=Selected_Passenger]:checked").val());for(f=0;f<e.length;f++)b==e[f].PassengerID&&e[f].SegmentId==r&&e[f].FlightId==u&&(p.pop(e[f]),s=e[f].SeatAmount);v=v-s;a=a-s;n.Addon_Seat_Fees=v;n.AddOn_Fees=a;n.SelectedSeats=p}}catch(k){}};n.SubmitSeat=function(t){var r,i;try{if((t==null||t==undefined)&&(t=!0),t&&!n.ValidateSeat())return!1;for(n.TotalSeatAmount=0,$("#SeatMapModal").modal("hide"),n.ShowSeat=!0,r=0;r<n.SelectedSeats.length;r++)n.TotalSeatAmount+=parseFloat(n.SelectedSeats[r].SeatAmount);for(i=0;i<n.SSRFareList.length;i++)n.SSRFareList[i].SSRTYPE_NAME=="SEAT"&&(n.SSRFareList[i].Amount=n.TotalSeatAmount);n.AddOn_Fees=n.AddOn_Fees_WOSeats+n.TotalSeatAmount;n.SelectedSeats.length>0&&(n.AddONVisible=!0,n.AddONFound=!0)}catch(u){}};n.CloseSeatMap=function(){try{$("#SeatMapModal").modal("hide");n.SelectedSeats=[];n.SubmitSeat(!1)}catch(t){}};n.GetSeatMapPassengerHeightStyle=function(n){return n<=2?"height:30px":n>2&&n<=4?"height:60px":n>4&&n<=6?"height:90px":n>6&&n<=8?"height:120px":"height:120px"};n.GetSeatMapSeatStyle=function(n){return n<=2?"height:55vh":n>2&&n<=4?"height:50vh":n>4&&n<=6?"height:45vh":n>6&&n<=8?"height:40vh":"height:40vh"};n.ValidateSeat=function(){try{var t=n.FlightBooking.Trips[0].Segments.length;if(n.BookingType=="ROUNDTRIP")if(n.FlightBooking.Trips[0].Segments.length==2&&(n.OnwardSelectedSeat=n.SelectedSeats.filter(function(n){return n.FlightId==0}),n.OnwardSelectedSeat.length==1&&ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");n.SubmitSeat(!1)},"You have selected seat only for one sector, would you like to continue with only one sector seat selection ?",function(){$("#ConfirmationModal").modal("hide");n.SubmitSeat(!0)})),n.ReturnSelectedSeat=n.SelectedSeats.filter(function(n){return n.FlightId==1}),n.ReturnSelectedSeat.length==0&&ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");n.SubmitSeat(!1)},"You have selected seat only for onward journey, would you like to continue without return journey ?",function(){$("#ConfirmationModal").modal("hide");n.SubmitSeat(!0)}),n.FlightBooking.Trips[1].Segments.length==2){if(n.ReturnSelectedSeat.length==1)ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");n.SubmitSeat(!1)},"You have selected seat only for one sector, would you like to continue with only one sector seat selection ?",function(){$("#ConfirmationModal").modal("hide");n.SubmitSeat(!0)});else if(n.ReturnSelectedSeat.length>=2)return!0}else return!0;else if(n.BookingType=="ONE_WAY")if(n.FlightBooking.Trips[0].Segments.length==2){if(n.OnwardSelectedSeat=n.SelectedSeats.filter(function(n){return n.FlightId==0}),n.OnwardSelectedSeat.length==1)ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");n.SubmitSeat(!1)},"You have selected seat only for one sector, would you like to continue with only one sector seat selection ?",function(){$("#ConfirmationModal").modal("hide");n.SubmitSeat(!0)});else if(n.OnwardSelectedSeat.length>=2)return!0}else return!0;else if(n.BookingType=="SPECIALROUNDTRIP")if(n.OnwardSelectedSeat=n.SelectedSeats.filter(function(n){return n.FlightId==0}),n.OnwardSelectedSeat.length<n.FlightBooking.Trips[0].Segments.length)ShowConfirmationModal(function(){$("#ConfirmationModal").modal("hide");n.SubmitSeat(!1)},"You have selected seat only for "+n.OnwardSelectedSeat.length+" sector, would you like to continue with only "+n.OnwardSelectedSeat.length+" sector seat selection ?",function(){$("#ConfirmationModal").modal("hide");n.SubmitSeat(!0)});else if(n.OnwardSelectedSeat.length>=2)return!0}catch(i){}};n.fnSelectTrip=function(t){var i;try{for(n.Ongoing_Trip=!1,n.Return_Trip=!1,$("#Farerule").html(""),i=0;i<n.FlightBooking.OnwardTrip.Segments.length;i++)n["Showtick"+i]=!1;for(i=0;i<n.FlightBooking.ReturnTrip.Segments.length;i++)n["Showtick_Rtn"+i]=!1;t==0&&(n.Ongoing_Trip=!0);t==1&&(n.Return_Trip=!0)}catch(r){}};n.Duration=function(t,i){var r,e;try{var o=new Date(t),s=new Date(i),u=Math.abs(o-s),f=Math.floor(u/36e5);return f<10&&(f="0"+f),u-=f*36e5,r=Math.floor(u/6e4),r<10&&(r="0"+r),u-=r*6e4,e=Math.floor(u/1e3),e<10&&(e="0"+e),n.durationhrs=f+"hrs, "+r+"mins ",n.durationhrs}catch(h){}};n.changepaxType=function(t,i,r){try{r==1?t=="Mr"?n.PassengerDetail.Adult[i].Gender="Male":(t=="Ms"||t=="Mrs")&&(n.PassengerDetail.Adult[i].Gender="Female"):r==2?t=="Mstr"?n.PassengerDetail.Child[i].Gender="Male":t=="Miss"&&(n.PassengerDetail.Child[i].Gender="Female"):r==3?t=="Mstr"?n.PassengerDetail.Infant[i].Gender="Male":t=="Miss"&&(n.PassengerDetail.Infant[i].Gender="Female"):r==4&&(n.PaxTitle=="Mr"?n.PaxGender="Male":n.PaxTitle=="Mstr"?n.PaxGender="Male":n.PaxTitle=="Mrs"?n.PaxGender="Female":n.PaxTitle=="Ms"&&(n.PaxGender="Female"))}catch(u){}};n.FFNList=[];n.AddNewFFN=function(){var t,r,e,i,h,u;try{if(n.FFNFields.FFNAirLineId==""||n.FFNFields.FFNAirLineId=="undefined"||n.FFNFields.FFNAirLineId==undefined||n.FFNFields.FFNAirLineId=="null"||n.FFNFields.FFNAirLineId==null)return ShowError("Please Select Airline"),!1;if(n.FFNFields.FFN==""||n.FFNFields.FFN=="undefined"||n.FFNFields.FFN==undefined||n.FFNFields.FFN=="null"||n.FFNFields.FFN==null)return ShowError("Please Enter FFN"),!1;var f=n.FFNFields.FFNPaxId,o="",s="";for(t=0;t<n.FFNPaxList.length;t++)n.FFNPaxList[t].id==f&&(f=n.FFNPaxList[t].id,o=n.FFNPaxList[t].name,s=n.FFNPaxList[t].type);for(r=n.FFNFields.FFNAirLineId,e="",i=0;i<n.FSCAirlineList.length;i++)n.FSCAirlineList[i].Value==r&&(r=n.FSCAirlineList[i].Value,e=n.FSCAirlineList[i].Name);if(n.FFNList==""||n.FFNList=="undefined"||n.FFNList==undefined||n.FFNList==null||n.FFNList=="null")n.FFNList.push({FFNID:0,PaxID:f,PaxName:o,AirlineID:r,Airline:e,FFN:n.FFNFields.FFN,Paxtype:s}),n.FFNFields.FFNPaxId="",n.FFNFields.FFNAirLineId="",n.FFNFields.FFN="";else{for(h=!1,u=0;u<n.FFNList.length;u++)n.FFNFields.FFNPaxId==n.FFNList[u].PaxID&&n.FFNFields.FFNAirLineId==n.FFNList[u].AirlineID&&(h=!0);if(h==!1)n.FFNList.push({FFNID:n.FFNList.length,PaxID:f,PaxName:o,AirlineID:r,Airline:e,FFN:n.FFNFields.FFN,Paxtype:s}),n.FFNFields.FFNPaxId="",n.FFNFields.FFNAirLineId="",n.FFNFields.FFN="";else return ShowError("Details Already Exist"),!1}}catch(c){}};n.removeFFN=function(t){var r,i;try{for($("#tr_"+t).remove(),r=[],i=0;i<n.FFNList.length;i++)n.FFNList[i].FFNID!=t&&r.push(n.FFNList[i]);n.FFNList=r}catch(u){}};n.PirceFilter=function(){try{var i=parseInt($(window).width()),t=parseInt($(window).height());t=t-120;document.getElementById("complaint-box-content1").style.height="0px";document.getElementById("complaint-box1").style.width=i>400?"15%":"75%";$("#PriceBoxSlider").show();n.ShowPirceFilter=!0}catch(r){}};n.FilterClose=function(){try{document.getElementById("complaint-box1").style.width="0";$("#PriceBoxSlider").hide()}catch(n){}};n.EnableAddNewPax=!1;n.AddNewPassengersList=[];n.checkfrequentPassenger=function(t,i,r){var f,u;try{n.AddPaxindex="";n.AddPaxtype="";n.Adultvisible=!1;n.Childvisible=!1;n.Infantvisible=!1;n.ADDPAXvisible=!1;var e="",o="",s="",h="",f=[];if(i=="Adult"){if(n.PassengerDetail.Adult[t].First_Name==""||n.PassengerDetail.Adult[t].First_Name==undefined)return ShowError("Please Enter Adult"+(t+1)+" First Name"),!1;if(n.PassengerDetail.Adult[t].Last_Name==""||n.PassengerDetail.Adult[t].Last_Name==undefined)return ShowError("Please Enter Adult"+(t+1)+" Last Name"),!1;if(n.lobjPassengerData_Adult!=undefined)for(f=[],u=0;u<n.lobjPassengerData_Adult.length;u++)f=n.lobjPassengerData_Adult.filter(function(i){console.log(i);var r=i.Firstname+" "+i.Lastname,u=n.PassengerDetail.Adult[t].First_Name+" "+n.PassengerDetail.Adult[t].Last_Name;return r==u});n.AddpaxMindate=n.adDOBMinDate;n.AddpaxMaxdate=n.adDOBMaxDate;e=n.PassengerDetail.Adult[t].First_Name;o=n.PassengerDetail.Adult[t].Last_Name;s=n.PassengerDetail.Adult[t].Title;h=n.PassengerDetail.Adult[t].Gender;n.Adultvisible=!0}if(i=="Child"){if(n.PassengerDetail.Child[t].First_Name==""||n.PassengerDetail.Child[t].First_Name==undefined)return ShowError("Please Enter Child"+(t+1)+" First Name"),!1;if(n.PassengerDetail.Child[t].Last_Name==""||n.PassengerDetail.Child[t].Last_Name==undefined)return ShowError("Please Enter Child"+(t+1)+" Last Name"),!1;if(n.lobjPassengerData_Child!=undefined)for(f=[],u=0;u<n.lobjPassengerData_Child.length;u++)f=n.lobjPassengerData_Child.filter(function(i){console.log(i);var r=i.Firstname+" "+i.Lastname,u=n.PassengerDetail.Child[t].First_Name+" "+n.PassengerDetail.Child[t].Last_Name;return r==u});n.AddpaxMindate=n.chDOBMinDate;n.AddpaxMaxdate=n.chDOBMaxDate;e=n.PassengerDetail.Child[t].First_Name;o=n.PassengerDetail.Child[t].Last_Name;s=n.PassengerDetail.Child[t].Title;h=n.PassengerDetail.Child[t].Gender;n.Childvisible=!0}if(i=="Infant"){if(n.PassengerDetail.Infant[t].First_Name==""||n.PassengerDetail.Infant[t].First_Name==undefined)return ShowError("Please Enter Infant"+(t+1)+" First Name"),!1;if(n.PassengerDetail.Infant[t].Last_Name==""||n.PassengerDetail.Infant[t].Last_Name==undefined)return ShowError("Please Enter Infant"+(t+1)+" Last Name"),!1;if(n.lobjPassengerData_Infant!=undefined)for(f=[],u=0;u<n.lobjPassengerData_Infant.length;u++)f=n.lobjPassengerData_Infant.filter(function(i){var r=i.Firstname+" "+i.Lastname,u=n.PassengerDetail.Infant[t].First_Name+" "+n.PassengerDetail.Infant[t].Last_Name;return r==u});n.AddpaxMindate=n.infDOBMinDate;n.AddpaxMaxdate=n.infDOBMaxDate;e=n.PassengerDetail.Infant[t].First_Name;o=n.PassengerDetail.Infant[t].Last_Name;s=n.PassengerDetail.Infant[t].Title;h=n.PassengerDetail.Infant[t].Gender;n.Infantvisible=!0}f.length==0&&(n.PaxFirstName=e,n.PaxLastName=o,n.PaxTitle=s,n.PaxGender=h,r==0?n.EnableAddNewPax=!0:n.AddNewPassengersList.push({PaxFName:n.PaxFirstName,PaxLName:n.PaxLastName,PaxTitle:n.PaxTitle,PaxGender:n.PaxGender,PaxType:i}))}catch(c){}};n.BindNewPaxDetail=function(t,i){var u,r;try{if(i=="Adult"&&(n.PassengerDetail.Adult[t].Title=n.PaxTitle,n.PassengerDetail.Adult[t].First_Name=n.PaxFirstName,n.PassengerDetail.Adult[t].Last_Name=n.PaxLastName,n.PassengerDetail.Adult[t].Gender=n.PaxGender,n.PassengerDetail.Adult[t].DOB=n.PaxDOB,n.PassengerDetail.Adult[t].Nationality=n.PaxNationality,n.PassengerDetail.Adult[t].Passport_Issuing_Country=n.PaxPassport_Issuing_Country,n.PassengerDetail.Adult[t].Passport_Number=n.PaxPassport_Number,n.PassengerDetail.Adult[t].Passport_Expiry=n.PaxPassport_Expiry),i=="Child"&&(n.PassengerDetail.Child[t].Title=n.PaxTitle,n.PassengerDetail.Child[t].First_Name=n.PaxFirstName,n.PassengerDetail.Child[t].Last_Name=n.PaxLastName,n.PassengerDetail.Child[t].Gender=n.PaxGender,n.PassengerDetail.Child[t].DOB=n.PaxDOB,n.PassengerDetail.Child[t].Nationality=n.PaxNationality,n.PassengerDetail.Child[t].Passport_Issuing_Country=n.PaxPassport_Issuing_Country,n.PassengerDetail.Child[t].Passport_Number=n.PaxPassport_Number,n.PassengerDetail.Child[t].Passport_Expiry=n.PaxPassport_Expiry),i=="Infant"&&(n.PassengerDetail.Infant[t].Title=n.PaxTitle,n.PassengerDetail.Infant[t].First_Name=n.PaxFirstName,n.PassengerDetail.Infant[t].Last_Name=n.PaxLastName,n.PassengerDetail.Infant[t].Gender=n.PaxGender,n.PassengerDetail.Infant[t].DOB=n.PaxDOB,n.PassengerDetail.Infant[t].Nationality=n.PaxNationality,n.PassengerDetail.Infant[t].Passport_Issuing_Country=n.PaxPassport_Issuing_Country,n.PassengerDetail.Infant[t].Passport_Number=n.PaxPassport_Number,n.PassengerDetail.Infant[t].Passport_Expiry=n.PaxPassport_Expiry),u=[],n.FFNPaxwiseList!=0)for(r=0;r<n.FFNPaxwiseList.length;r++)n.ongoing_AirlineCode==n.FFNPaxwiseList[r].AirlineID&&u.push({PaxName:i+(r+1),Airline:n.FFNPaxwiseList[r].AirlineName,FFN:n.FFNPaxwiseList[r].FFN}),n.BookingType=="ROUNDTRIP"&&n.Return_AirlineCode==n.FFNPaxwiseList[r].AirlineID&&u.push({PaxName:i+(r+1),Airline:n.FFNPaxwiseList[r].AirlineName,FFN:n.FFNPaxwiseList[r].FFN})}catch(f){}};n.FFNPaxwiseList=[];n.AddNewFFNPaxwise=function(){var t,i,u,r;try{if(n.FrequentFlyer.FSCAirlineID==""||n.FrequentFlyer.FSCAirlineID=="undefined"||n.FrequentFlyer.FSCAirlineID==undefined||n.FrequentFlyer.FSCAirlineID=="null"||n.FrequentFlyer.FSCAirlineID==null)return ShowError("Please Select Airline"),!1;if(n.FrequentFlyer.Paxwise_FFNNumber==""||n.FrequentFlyer.Paxwise_FFNNumber=="undefined"||n.FrequentFlyer.Paxwise_FFNNumber==undefined||n.FrequentFlyer.Paxwise_FFNNumber=="null"||n.FrequentFlyer.Paxwise_FFNNumber==null)return ShowError("Please Enter FFN"),!1;if(n.FFNPaxwiseList!=0)for(t=0;t<n.FFNPaxwiseList.length;t++)if(n.FFNPaxwiseList[t].AirlineID==n.FrequentFlyer.FSCAirlineID)return ShowError("Details Already Exist"),!1;i="";angular.forEach(n.FSCAirlineList,function(t){t.Value==n.FrequentFlyer.FSCAirlineID&&(i=t.Name)});u=0;r="Adult";n.FFNPaxwiseList.push({AirlineID:n.FrequentFlyer.FSCAirlineID,FFN:n.FrequentFlyer.Paxwise_FFNNumber,Paxtype:r,AirlineName:i});n.FrequentFlyer.FSCAirlineID="";n.FrequentFlyer.Paxwise_FFNNumber="";n.FrequentFlyer.FSCAirlineName=""}catch(f){}};n.RemoveNewFFNPaxwise=function(t){var r,i;try{for($("#tr_"+t).remove(),r=[],i=0;i<n.FFNPaxwiseList.length;i++)i!=t&&r.push(n.FFNPaxwiseList[i]);n.FFNPaxwiseList=[];n.FFNPaxwiseList=r}catch(u){}};n.PushFFNPaxwiseList=function(){var i,r,t;try{if(i=[],n.FFNPaxwiseList.length!=0)for(r={},t=0;t<n.FFNPaxwiseList.length;t++)i.push({AirlineCode:n.FFNPaxwiseList[t].AirlineID,FFNumber:n.FFNPaxwiseList[t].FFN});else i=[];return i}catch(u){}};n.SelectedNationality=function(t){try{n.NationalityCode=t.originalObject.CountryCode}catch(i){}};n.SelectedPassportIssuing=function(t){try{n.PassportIssuingCode=t.originalObject.CountryCode}catch(i){}};n.SelectedFrequentAirline=function(t){try{n.FrequentFlyer.FSCAirlineID=t.originalObject.Value;n.FrequentFlyer.FSCAirlineName=t.originalObject.Name}catch(i){}};n.AddNewPassengers=[];n.AddPaxList=function(t,i){var u,r;try{for(u=!1,r=0;r<n.AddNewPassengers.length;r++)n.AddNewPassengers[r].PaxFName==n.AddNewPassengersList[t].PaxFName&&n.AddNewPassengers[r].PaxLName==n.AddNewPassengersList[t].PaxLName&&(u=!0);u==!1&&n.AddNewPassengers.push(n.AddNewPassengersList[t]);$("#ShowAddPax_"+i+"_"+t).hide()}catch(f){}};n.ChangePaymentMode=function(){try{var t=n.PaymentMode;t=="Payment_Gateway"?n.ChangePGMode(n.AvailablePGMode[0]):e.Gateway_Charges=0}catch(i){}};n.ChangePrepaid=function(){n.PaymentMode="PrePaid_Money";n.lstrPGMode="PrePaid Money";n.PG_Mode="PrePaid_Money";e.Gateway_Charges=0};n.FlightObject={};n.ChangePGMode=function(t){var i,f,r,u;try{for(n.PreSelectedGatewayMode=t,n.BookingAmount=n.TotalTicketCost+n.AddOn_Fees-n.GrossCommission,i=0,f=0,n.BookingType=="ROUNDTRIP"?(n.FlightObject.SelectedFares=n.FlightBooking.Trips[0].SelectedFare.FareDetails,n.FlightObject.RoundTripFares=n.FlightBooking.Trips[1].SelectedFare.FareDetails,i=n.OnwardTicketCost,f=n.ReturnTicketCost):(i=n.BookingAmount,n.FlightObject.SelectedFares=n.FlightBooking.Trips[0].SelectedFare.FareDetails),n.FlightObject.FlightCount=n.FlightBooking.Trips.length,n.FlightObject.Adult_Count=n.Adult_Count,n.FlightObject.Child_Count=n.Child_Count,n.FlightObject.Infant_Count=n.Infant_Count,n.FlightObject.OngoingBookingAmount=i,n.FlightObject.ReturnBookingAmount=f,n.FlightObject.TransType="B",n.FlightObject.Channel=n.Config.ChannelId,n.FlightObject.PaymentTypeCode=t.PaymentTypeCode,n.FlightObject.BookingType=n.BookingType,n.FlightObject.Flights=n.FlightBooking.Trips,n.FlightObject.GatewayName=t.GatewayName,n.FlightObject.PaymentType=t.PaymentType,n.FlightObject.PaymentTypeCode=t.PaymentTypeCode,n.FlightObject.GatewayName=t.GatewayName,n.PaymentMode="Payment_Gateway",n.lstrPGMode=t.PaymentType,n.SelectedPGMode=t.PaymentTypeCode,n.PG_Mode=t,n.FlightObject.PGSSRDetails=[],r=0;r<n.FlightBooking.Trips.length;r++)u={},u.PaymentSSRDetails=[],n.AddONFound==!0&&(u.PaymentSSRDetails=n.PushSSRDetails(r)),n.FlightObject.PGSSRDetails.push(u);n.CalculateGateWayCharges(n.FlightObject)}catch(e){}};$("#hdnPaymentResponseData").val()!=""&&(p=$("#hdnPaymentResponseData").val(),p.split("~")[2]=="1"?e.LoadPage("FlightConfirmation"):ShowAlert(p.split("~")[3],"","Search"));n.$watch("UserInfo",function(t,i){t!==i&&t!==null&&(n.CustomerMobileNumber=n.UserInfo.CustomerMobile,n.PaxMobileNumber=n.UserInfo.CustomerMobile,n.EmailID=n.UserInfo.EmailID,n.GSTNumber=n.UserInfo.GSTINNumber,n.UserInfo.B2BFlag?(e.GetCostCenter(),n.HandlingChargesFlag=!0,n.FareDetails(),Config.TaxSplitupShow=!0):n.HandlingChargesFlag=!1)});Config.ChannelId!="3"&&(n.CustomerData=!0,n.$on("FlightBookingBackFunction",function(){var i=JSON.parse(localStorage.getItem("FlightObject")),t=e.Backoption;if(t=="SearchDetails")e.LoadPage("flights/"+i.QueryString+"&ReSearch=1");else if(t=="FareDetails")e.LoadPage("FlightBooking");else{if((t==""||t==null||t==undefined)&&n.TRAVELLERDETAILSIsVisible)return n.TRAVELLERDETAILSIsVisible=!1,n.CustomerData=!0,!1;if((t==""||t==null||t==undefined)&&n.PaymentdetailsIsVisible)return n.PaymentdetailsIsVisible=!1,n.TRAVELLERDETAILSIsVisible=!0,!1;e.LoadPage("flights/"+i.QueryString+"&ReSearch=1")}}),n.ViewFareSummary=function(){try{document.getElementById("FareSummary").style.width="100%";$("#FareSummary").modal("show")}catch(n){}},n.ChangeContact=function(){n.FlighttitleIsVisible=!0;n.FLIGHTDETAILSIsVisible=!0;n.BookingDetailsIsVisible=!0;n.CustomerData=!0;n.TraveltitleIsVisible=!1;n.TRAVELLERDETAILSIsVisible=!1;n.FareSummaryIsVisible=!1;n.PassengerDetailsVisible=!1;n.SSRStatusLoad=!1});n.$watch("UserInfo",function(t,i){t!==i&&(n.CustomerMobileNumber=n.UserInfo.CustomerMobile,n.EmailID=n.UserInfo.EmailID,n.GSTNumber=n.UserInfo.GSTINNumber,n.ShowNetFare=!1,n.UserInfo.B2BFlag?(n.ShowNetFare=!0,n.ShowFullFare=!0,e.ShowRetailFare=!0,n.HandlingChargesFlag=!0,n.FareDetails(),Config.TaxSplitupShow=!0):n.HandlingChargesFlag=!1)});Config.ChannelId!="3"&&(n.ViewFareSummary=function(){try{document.getElementById("FareSummary").style.width="100%";$("#FareSummary").modal("show")}catch(n){}},n.ChangeContact=function(){n.FlighttitleIsVisible=!0;n.FLIGHTDETAILSIsVisible=!0;n.BookingDetailsIsVisible=!0;n.CustomerData=!0;n.TraveltitleIsVisible=!1;n.TRAVELLERDETAILSIsVisible=!1;n.FareSummaryIsVisible=!1;n.PassengerDetailsVisible=!1;n.SSRStatusLoad=!1},$(document).ready(function(){e.initSwiper()}),n.ChangePane=function(t){n.showonward=t;$("#ModuleName").html("<span class=''> FLIGHT ITINERARY DETAILS <\/span>");e.FlightDetail=!0},u(function(){n.ChangePane(!0)},500));n.FilterSegments=function(n,t){var r,i;try{for(r=[],i=0;i<n.Segments.length;i++)i+1<=n.Segments.length&&(t==1&&n.Segments[i].Return_Flight==!1&&r.push(n.Segments[i]),t==2&&n.Segments[i].Return_Flight==!0&&r.push(n.Segments[i]));return r}catch(u){}};n.AirportDetails=lobjAirportList;n.ShowMoreStops=function(t,i){var o="",s="",r="",e="",u,f,h;if(!i)for(u=1;u<t.length;u++)Config.ChannelId=="3"?(r+="@"+t[u].Origin_City,f=u,f+1<=t.length&&(h=f-1,e=n.CalculateLayOver(t[f-1].Arrival_DateTime,t[f].Departure_DateTime)),r+=f+1<t.length?" , Layover-"+e+",":" , Layover-"+e):r+="@"+t[u].Origin;return i&&angular.forEach(t,function(t){s+=t+", ";r=n.AirportDetails;r=r.filter(function(n){return n.Value==t});o+=r[0].Name+", ";r=o.replace(/,\s*$/,"");n.morestopsHind=s.replace(/,\s*$/,"")}),r};n.ChkPromo=[];n.ChkPromo=[{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1},{Selected:!1}];n.SelectedPromoCode=[];n.ValidatePromoCode=function(){var i,t,r;i=n.BookingType=="ONE_WAY"?0:1;t=n.OngoingDate;t=t.indexOf(",")>-1?t:n.OngoingDate.split("/")[1]+"/"+n.OngoingDate.split("/")[0]+"/"+n.OngoingDate.split("/")[2];(n.OngoingProductClass==null||n.OngoingProductClass=="")&&(n.OngoingProductClass=0);r={ProductId:"1",BillerId:n.Travel_Type=="DOMESTIC"?"13":"14",Travel_Type:n.Travel_Type,Booking_Type:i,Class_Of_Travel:n.Travel_Class,No_Of_Adult:n.Adult_Count,No_Of_Child:n.Child_Count,No_Of_Infant:n.Infant_Count,No_Of_Rooms:"0",No_Of_Nights:"0",StarCategory:"",Operator_Code:"",Travel_Date:t,AdultFare:n.OnetimePromoAdultTotal,ChildFare:n.OnetimePromoChildTotal,InfantFare:n.OnetimePromoInfantTotal,PromoCode:n.TotalDealCode,AirlineCode:n.ongoing_AirlineCode,ClassCode:n.OngoingProductClass};e.GetPromoCode(r)};n.OneTimePromo=!1;n.SelectedPromoCode=[];n.ApplyDeal=function(t){try{if(t==1){if(n.SelectedPromoCode.length==0)if(n.BookingType!="ROUNDTRIP")n.FlightBooking.Trips[0].SelectedFare.DealDetails!=null?n.FlightBooking.Trips[0].SelectedFare.DealDetails.length>0?(n.FlightBooking.Trips[0].SelectedFare.DealDetails[0].DealValuePerTransaction>0?n.SelectedPromoCode.push(n.FlightBooking.Trips[0].SelectedFare.DealDetails[0]):(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1)),n.FlightBooking.Trips[0].SelectedFare.DealDetails[0].DisplayInSearch?(n.ChkPromo[0].Selected=!0,n.Promoinput=!1,n.TotalDealCode=n.SelectedPromoCode[0].DealCode,n.TotalDealValue=n.SelectedPromoCode[0].DealValuePerTransaction,$("#DealOption").attr("ReadOnly",!0)):n.ChkPromo[0].Selected||(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1))):(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1)):(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1));else for(var i=0;i<n.FlightBooking.Trips.length;i++)n.FlightBooking.Trips[i].SelectedFare.DealDetails!=null?n.FlightBooking.Trips[i].SelectedFare.DealDetails.length>0?n.FlightBooking.Trips[i].SelectedFare.DealDetails[0].DealValuePerTransaction>0&&n.SelectedPromoCode.push(n.FlightBooking.Trips[i].SelectedFare.DealDetails[0]):(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1)):(n.TotalDealCode="",n.Promoinput=!0,n.TotalDealValue=0,$("#DealOption").attr("ReadOnly",!1))}else{if(n.TotalDealCode==""||n.TotalDealCode=="undefined"||n.TotalDealCode==null)return ShowError("Please Enter Valid Promo Code"),!1;n.SelectedPromoCode=[];angular.forEach(n.FlightBooking.Trips[0].SelectedFare.DealDetails,function(t,i){t.DealCode.toUpperCase()==n.TotalDealCode.toUpperCase()&&(n.Promoindex=i,t.DealValuePerTransaction>0&&n.SelectedPromoCode.push(t))});n.SelectedPromoCode.length==1?(n.ChkPromo[n.Promoindex].Selected=!0,n.TotalDealCode=n.SelectedPromoCode[0].DealCode,n.TotalDealValue=n.SelectedPromoCode[0].DealValuePerTransaction,n.Promoinput=!1):(n.ValidatePromoCode(),u(function(){e.DealData!=null&&e.DealData.length>0&&(n.SelectedPromoCode=e.DealData,n.Promoinput=!1,n.TotalDealCode=n.SelectedPromoCode[0].DealCode,n.TotalDealValue=n.SelectedPromoCode[0].DealValuePerTransaction,n.OneTimePromo=!0)},500))}}catch(r){}};n.SelectPromoCode=function(t,i){n.Promoindex=t;n.SelectedPromoCode=[];n.Promoinput=!1;n.SelectedPromoCode.push(i);n.TotalDealCode=i.DealCode;n.TotalDealValue=i.DealValuePerTransaction;for(var r=0;r<n.FlightBooking.Trips[0].SelectedFare.DealDetails.length;r++)n.ChkPromo[r].Selected=t!=r?!1:!0;$("#DealOption").attr("ReadOnly",!0)};n.ClosePromoCode=function(){$("#DealOption").attr("ReadOnly",!1);n.SelectedPromoCode=[];n.Promoinput=!0;n.TotalDealCode="";n.TotalDealValue="";for(var t=0;t<n.FlightBooking.Trips[0].SelectedFare.DealDetails.length;t++)n.ChkPromo[t].Selected=!1};n.AdultChanges=!1;n.SetDateForAdult=function(t){n.AdultChanges=!0;n.PassengerDetail.Adult[t].DOB=n.adFrom12Years};n.ChangeGSTMode=function(t){try{t==0?(n.SelectedGSTMode="GSTExist",n.GSTEntryName=n.GSTDetails[0].GSTINHolderName,n.GSTEntryNumber=n.GSTDetails[0].GSTINNumber,n.GSTEntryAddress=n.GSTDetails[0].GSTINAddress):(n.GSTEntryName="",n.GSTEntryNumber="",n.GSTEntryAddress="",n.SelectedGSTMode="GSTNew")}catch(i){}};n.GetGSTMode=function(){n.GSTAvailable?(n.SelectedGSTMode="GSTExist",n.ChangeGSTMode(0),$("#GSTExist").prop("checked",!0)):n.ChangeGSTMode(1)};n.ChangeGST=function(){try{n.GSTEntryName=n.AppliedGST.type.GSTINHolderName;n.GSTEntryNumber=n.AppliedGST.type.GSTINNumber;n.GSTEntryAddress=n.AppliedGST.type.GSTINAddress}catch(t){}};n.activetime==""&&(n.activetime=moment(localStorage.getItem("ActiveTime")),clearInterval(w));n.activetime=moment();k=moment(n.activetime).add(Config.MaximumTime,"minutes");d=k;w=setInterval(function(){var i=(new Date).getTime(),t=d-i,f=Math.floor(t/864e5),e=Math.floor(t%864e5/36e5),r=Math.floor(t%36e5/6e4),u=Math.floor(t%6e4/1e3);document.getElementById("SessionTime").innerHTML=r+"m "+u+"s ";t<0&&(document.getElementById("SessionTime").innerHTML="0m 0s ",clearInterval(w),n.ShowSessionconfirmation())},1e3);l=this;b=["PQ","QZ","XT","XJ","AK","D7","FD","I5","DJ"];lintAdultYears=12;(b.indexOf(n.Onward_AirlineCode)>-1||b.indexOf(n.Return_AirlineCode)>-1)&&(n.Child_Count>0||n.Infant_Count>0)&&(lintAdultYears=17);l.AdultDateInfo={altTarget:$("#calendarIcon"),renderDate:function(t){return{enabled:n.BookingType=="ROUNDTRIP"?t.date>moment(n.ReturnDate,"DD/MM/YYYY").subtract(100,"year")&&t.date<moment(n.ReturnDate,"DD/MM/YYYY").subtract(lintAdultYears,"year").add(1,"days"):t.date>moment(n.OngoingDate,"DD/MM/YYYY").subtract(100,"year")&&t.date<moment(n.OngoingDate,"DD/MM/YYYY").subtract(lintAdultYears,"year").add(1,"days")}},minDate:n.BookingType=="ROUNDTRIP"?n.ReturnDate?moment(n.ReturnDate,"DD/MM/YYYY").subtract(100,"years"):moment().subtract(100,"years"):n.OngoingDate?moment(n.OngoingDate,"DD/MM/YYYY").subtract(100,"years"):moment().subtract(100,"years"),maxDate:n.BookingType=="ROUNDTRIP"?n.ReturnDate?moment(n.ReturnDate,"DD/MM/YYYY").subtract(lintAdultYears,"years"):moment().subtract(lintAdultYears,"years"):n.OngoingDate?moment(n.OngoingDate,"DD/MM/YYYY").subtract(lintAdultYears,"years"):moment().subtract(lintAdultYears,"years"),defaultDate:n.BookingType=="ROUNDTRIP"?moment(n.ReturnDate,"DD/MM/YYYY").subtract(lintAdultYears,"years"):moment(n.OngoingDate,"DD/MM/YYYY").subtract(lintAdultYears,"years"),IsDepends:!1};l.ChildDateInfo={altTarget:$("#calendarIcon1"),renderDate:function(t){return{enabled:n.BookingType=="ROUNDTRIP"?t.date<moment(n.ReturnDate,"DD/MM/YYYY").subtract(2,"year").subtract(1,"month").add(1,"days")&&t.date>moment(n.ReturnDate,"DD/MM/YYYY").subtract(12,"year"):t.date<moment(n.OngoingDate,"DD/MM/YYYY").subtract(2,"year").subtract(1,"month").add(1,"days")&&t.date>moment(n.OngoingDate,"DD/MM/YYYY").subtract(12,"year")}},minDate:n.BookingType=="ROUNDTRIP"?n.ReturnDate?moment(n.ReturnDate,"DD/MM/YYYY").subtract(12,"years"):moment().subtract(12,"years"):n.OngoingDate?moment(n.OngoingDate,"DD/MM/YYYY").subtract(12,"years"):moment().subtract(12,"years"),maxDate:n.BookingType=="ROUNDTRIP"?n.ReturnDate?moment(n.ReturnDate,"DD/MM/YYYY").subtract(2,"years"):moment().subtract(2,"years"):n.OngoingDate?moment(n.OngoingDate,"DD/MM/YYYY").subtract(2,"years"):moment().subtract(2,"years"),defaultDate:n.BookingType=="ROUNDTRIP"?moment(n.ReturnDate,"DD/MM/YYYY").subtract(2,"years").subtract(1,"month"):moment(n.OngoingDate,"DD/MM/YYYY").subtract(2,"years").subtract(1,"month"),IsDepends:!0};l.InfantDateInfo={altTarget:$("#calendarIcon2"),renderDate:function(t){return{enabled:n.BookingType=="ROUNDTRIP"?t.date<moment(n.ReturnDate,"DD/MM/YYYY").subtract(10,"days")&&t.date>moment(n.ReturnDate,"DD/MM/YYYY").subtract(2,"year"):t.date<moment(n.OngoingDate,"DD/MM/YYYY").subtract(10,"days")&&t.date>moment(n.OngoingDate,"DD/MM/YYYY").subtract(2,"year")}},maxDate:n.BookingType=="ROUNDTRIP"?n.ReturnDate?moment(n.ReturnDate,"DD/MM/YYYY").subtract(10,"days"):moment().subtract(10,"days"):n.OngoingDate?moment(n.OngoingDate,"DD/MM/YYYY").subtract(10,"days"):moment().subtract(10,"days"),minDate:n.BookingType=="ROUNDTRIP"?n.ReturnDate?moment(n.ReturnDate,"DD/MM/YYYY").subtract(2,"year").add(1,"days"):moment().subtract(2,"year").add(1,"days"):n.OngoingDate?moment(n.OngoingDate,"DD/MM/YYYY").subtract(2,"year").add(1,"days"):moment().subtract(2,"year").add(1,"days"),defaultDate:n.BookingType=="ROUNDTRIP"?moment(n.ReturnDate,"DD/MM/YYYY").subtract(10,"days"):moment(n.OngoingDate,"DD/MM/YYYY").subtract(10,"days"),IsDepends:!0};l.AdtPassportExpDateInfo={altTarget:$("#calendarIconAdt"),renderDate:function(t){return{enabled:n.BookingType=="ROUNDTRIP"?t.date<moment(n.ReturnDate,"DD/MM/YYYY").add(10,"year")&&t.date>moment(n.ReturnDate,"DD/MM/YYYY").add(6,"month").add(1,"days"):t.date<moment(n.OngoingDate,"DD/MM/YYYY").add(10,"year")&&t.date>moment(n.OngoingDate,"DD/MM/YYYY").add(6,"month")}},minDate:n.BookingType=="ROUNDTRIP"?n.ReturnDate?moment(n.ReturnDate,"DD/MM/YYYY").add(6,"month").add(1,"days"):moment().add(6,"month").add(1,"days"):n.OngoingDate?moment(n.OngoingDate,"DD/MM/YYYY").add(6,"month").add(1,"days"):moment().add(6,"month").add(1,"days"),maxDate:n.BookingType=="ROUNDTRIP"?n.ReturnDate?moment(n.ReturnDate,"DD/MM/YYYY").add(10,"years"):moment().add(10,"years"):n.OngoingDate?moment(n.OngoingDate,"DD/MM/YYYY").add(10,"years"):moment().add(10,"years"),defaultDate:n.BookingType=="ROUNDTRIP"?moment(n.ReturnDate,"DD/MM/YYYY").add(6,"month").subtract(1,"days"):moment(n.OngoingDate,"DD/MM/YYYY").add(6,"month").subtract(1,"days"),IsDepends:!1};l.PassportExpDateInfo={altTarget:$("#calendarIconAdt"),renderDate:function(n){return{enabled:n.date<moment().add(10,"year")&&n.date>moment().add(6,"month").subtract(1,"days")}},minDate:moment().add(6,"month"),maxDate:moment().add(10,"years"),defaultDate:moment(),IsDepends:!1};l.PaxDateInfo={altTarget:$("#calendarIcon"),renderDate:function(n){return{enabled:n.date<moment().add(0,"days")&&n.date>moment().subtract(100,"year")}},minDate:moment().subtract(100,"years"),maxDate:moment().add(0,"days"),defaultDate:moment().add(0,"days"),IsDepends:!1};l.DefenceIssDt={altTarget:$("#calendarIcon"),renderDate:function(n){return{enabled:n.date<moment().add(0,"days")&&n.date>moment().subtract(100,"year")}},minDate:moment().subtract(100,"years"),maxDate:moment().add(0,"days"),defaultDate:moment().add(0,"days"),IsDepends:!1};n.GetCauroselIndexDynamic=function(t){t%3==0&&t!=0&&(n.MinimumCaurosel=t,n.MaximumCaurosel=t+3)}}]);app.controller("FlightConfirmationCtrl",["$scope","$http","$window","$timeout","$q","$sce","$rootScope","Data","UUID","Session","$location","PDFMaker",function(n,t,r,u,f,e,o,s,h,c,l,a){var v,y;if(n.BasefareDiscount=0,u(function(){o.ModuleID=4},500),localStorage.setItem("ChangeFlight_Request",""),n.TaxDiscount=0,n.ShareModel={},n.MasterHeading=!0,n.HandlingChargesFlag=!1,n.UserInfo&&(n.HandlingChargesFlag=!1,n.UserInfo.B2BFlag&&(o.GetCostCenter(),n.HandlingChargesFlag=!0,Config.TaxSplitupShow=!0)),(localStorage.getItem("FlightObject")==""||localStorage.getItem("FlightObject")==null||localStorage.getItem("FlightObject")==undefined)&&o.LoadPage("Home"),n.FareDetails=function(){var b,i,t,yt;try{var u=n.Adult_Count,f=n.Child_Count,e=n.Infant_Count,l=0,k=0,d=0,g=0,nt=0,a=0,tt=0,s=0,v=0,it=0,rt=0,ut=0,ft=0,y=0,et=0,h=0,p=0,ot=0,st=0,ht=0,ct=0,w=0,lt=0,c=0,at=0,vt=0,pt=0,wt=0,bt=0,r=JSON.parse(localStorage.getItem("FlightObject"));for(n.FlightDetails=r.Trips,b=0;b<r.Trips.length;b++){for(i=r.Trips[b].SelectedFare.FareDetails,t=0;t<i.length;t++)i[t].PAX_Type==0?(s+=i[t].Total_Amount,l+=i[t].Basic_Amount,k+=i[t].AirportTax_Amount,d+=i[t].YQ_Amount,g+=i[t].Trade_Markup_Amount,nt+=i[t].Service_Fee_Amount,a+=i[t].Gross_Commission,tt+=i[t].Net_Commission):i[t].PAX_Type==1?(h+=i[t].Total_Amount,v+=i[t].Basic_Amount,it+=i[t].AirportTax_Amount,rt+=i[t].YQ_Amount,ut+=i[t].Trade_Markup_Amount,ft+=i[t].Service_Fee_Amount,y+=i[t].Gross_Commission,et+=i[t].Net_Commission):(c+=i[t].Total_Amount,p+=i[t].Basic_Amount,ot+=i[t].AirportTax_Amount,st+=i[t].YQ_Amount,ht+=i[t].Trade_Markup_Amount,ct+=i[t].Service_Fee_Amount,w+=i[t].Gross_Commission,lt+=i[t].Net_Commission);b==0&&(pt=s*u,wt=h*f,bt=c*e,vt=pt+wt+bt,n.OnetimePromoAdultTotal=s,n.OnetimePromoChildTotal=h,n.OnetimePromoInfantTotal=c)}s=s*u;h=h*f;c=c*e;l=l*u;v=v*f;p=p*e;k=k*u;it=it*f;ot=ot*e;d=d*u;rt=rt*f;st=st*e;g=g*u;ut=ut*f;ht=ht*e;nt=nt*u;ft=ft*f;ct=ct*e;a=a*u;y=y*f;w=w*e;tt=tt*u;et=et*f;lt=lt*e;yt=0;r.DealDetails.DealValue&&(yt=r.DealDetails.DealValue);at=s+h+c+r.PaymentDetails.Service_AddOn+r.PaymentDetails.Gateway_Charges-yt;n.Adult_BaseFare=l;n.Adult_Taxes=k;n.Adult_YQ=d;n.Adult_Markup=g;n.Adult_ServiceFee=nt;n.Child_BaseFare=v;n.Child_Taxes=it;n.Child_YQ=rt;n.Child_Markup=ut;n.Child_ServiceFee=ft;n.Infant_BaseFare=p;n.Infant_Taxes=ot;n.Infant_YQ=st;n.Infant_Markup=ht;n.Infant_ServiceFee=ct;n.TotalTicketCost=at;n.OnwardTicketCost=vt;n.ReturnTicketCost=at-vt;o.Gateway_Charges=r.PaymentDetails.Gateway_Charges;n.AddOn_Fees=r.PaymentDetails.Service_AddOn;n.AdultGrossCommission=a;n.ChildGrossCommission=y;n.InfantGrossCommission=w;n.GrossCommission=a+y+w;n.NetCommission=tt+et+lt;n.BookRefNo=r.BookingDetails.Booking_RefNo;Config.TaxSplitupShow||(n.BasefareDiscount=n.GrossCommission,n.TaxDiscount=0,n.GrossCommission<=n.Adult_Taxes+n.Adult_Markup+n.Child_Taxes+n.Child_Markup+n.Infant_Taxes+n.Infant_Markup+n.Adult_ServiceFee+n.Child_ServiceFee+n.Infant_ServiceFee&&(n.BasefareDiscount=0,n.TaxDiscount=n.GrossCommission,n.AdultGrossCommission=0,n.ChildGrossCommission=0,n.InfantGrossCommission=0),n.UserInfo&&n.UserInfo.B2BFlag&&(n.BasefareDiscount=0,n.TaxDiscount=0));l>0&&(n.AdultDetails=!0);v>0&&(n.ChildDetails=!0);p>0&&(n.InfantDetails=!0)}catch(kt){}},v=JSON.parse(localStorage.getItem("FlightObject")),v.MetaSearchFlag==1&&(Config.B2CRetailer.RetailerID=v.MetaSearchRetailer_Id,Config.B2CRetailer.SubRetailerID=v.MetaSearchSubRetailer_Id,n.UserInfo&&(n.UserInfo.RetailerId=v.MetaSearchRetailer_Id,n.UserInfo.SubRetailerId=v.MetaSearchSubRetailer_Id)),y=o.AddOn_Service,n.ProcessID=h.Get(),n.FlightBooking={},n.AdultDetails=!1,n.ChildDetails=!1,n.InfantDetails=!1,n.BookingBlock=!0,n.BookingDetailsIsVisible=!0,o.Gateway_Charges=0,n.BookingConfirmation=!1,n.FullSuccess=!0,n.PartialSuccess=!1,n.RetryPaymentVisible=!1,n.BookingMessage="Booking",n.RequestStatus="Pending",n.ViewInnerExceptionVisible=!1,localStorage.getItem("PreviousCtrl")=="payment"){o.LoadPage("home");return}v.PaymentDetails.PaymentMode=="Payment_Gateway"&&v.PaymentDetails.isRedirect==!0&&l.search().PAYMENTDATA==null&&(localStorage.setItem("PreviousCtrl","payment"),n.BookingMessage="Payment",n.RequestStatus="Failed",n.RequestErrorDesc="Unable to Get Payment Status",n.BookingPending=!0,n.BookingBlock=!1,n.RetryPaymentVisible=!0);n.PassengerDetail=[];n.AirlinePNR="";n.AirlineConfirmationPNR="";n.TripDetails=function(){try{var t=JSON.parse(localStorage.getItem("FlightObject"));n.ProcessID=t.ProcessID;n.FlightBooking=t;n.CustomerInfo=t.CustomerInfo;n.SearchKey=t.SearchKey;n.AdultCount=t.Adult_Count;n.ChildCount=t.Child_Count;n.InfantCount=t.Infant_Count;n.OngoingDate=t.OngoingDate;n.ReturnDate=t.ReturnDate;n.OriginCode=t.OriginCode;n.DestinationCode=t.DestinationCode;n.Refundable=t.Refundable;n.BookingType=t.BookingType;n.Travel_Type=t.Travel_Type;n.Travel_Type==0?n.Travel_Type="DOMESTIC":n.Travel_Type==1&&(n.Travel_Type="INTERNATIONAL");n.OriginName=t.OriginName;n.HostSearch=t.HostSearch;o.Biller_Id=t.Trips[0].Biller_Id;o.SupplierId=t.Trips[0].Supplier_Id;o.SubbillerCode=t.Trips[0].Airline_Code;n.DestinationName=t.DestinationName;n.CombineSegments(t.Trips);n.BookingType=="ROUNDTRIP"&&(n.ReturnVisible=!0);n.Adult_Count=t.Adult_Count;n.Child_Count=t.Child_Count;n.Infant_Count=t.Infant_Count;n.ShareModel.MobileNumber=n.CustomerInfo.MobileNo;n.ShareModel.WhatsAppNumber=n.CustomerInfo.MobileNo;n.ShareModel.EmailID=n.CustomerInfo.EmailID;n.CompanyName=fnGetRetailerData(53);n.PaymentMode=v.PaymentDetails.PaymentMode;n.DealDetail=t.DealDetails;n.BookingMessage=t.BookingDetails.BlockFlag=="1"?"Blocking":"Your booking is in progress"}catch(i){}};n.InitPG();n.CombineSegments=function(t){var u,i,r;try{for(u=[],i=0;i<t.length;i++)for(r=0;r<t[i].Segments.length;r++)t[i].Segments[r].Flight_Index=i,t[i].Segments[r].Flight_Id=t[i].Flight_Id,n.BookingType=="ROUNDTRIP"&&i==1&&(t[i].Segments[r].Return_Flight=!0),u.push(t[i].Segments[r]);n.FlightSegments=u;n.FlightTrips=t}catch(f){}};n.TripDetails();n.FareDetails(1);n.ConfirmBooking=function(){var i,r,o,u,f;try{if(i=JSON.parse(localStorage.getItem("FlightObject")),i.PaymentDetails.PaymentMode=="Payment_Gateway"?i.PaymentDetails.isRedirect==!0&&(r=JSON.parse(atob(l.search().PAYMENTDATA)),i.PaymentDetails.PaymentStatus=r.Status,i.PaymentDetails.PaymentData=JSON.stringify(r.PayUResponse)):i.PaymentDetails.PaymentGateway="",o="",i.BookingDetails.Status==0){if(i.PaymentDetails.PaymentMode=="Payment_Gateway"&&i.PaymentDetails.PaymentStatus!=1)return n.RequestErrorDesc=i.PaymentDetails.PaymentData,n.BookingBlock=!1,n.BookingPending=!0,n.BookingMessage="Payment",n.RequestStatus="Failed",n.RequestErrorDesc="Your payment is not successful. In case if you haven't received the SMS from your banker, please try again.",n.ViewInnerExceptionVisible=!0,n.RetryPaymentVisible=!0,!1;i.BookingDetails.Status=2;localStorage.setItem("FlightObject",JSON.stringify(i));n.AirBookingRequest={Header:n.GetHeader(n.ProcessID),Booking_RefNo:i.BookingDetails.Booking_RefNo,Ticketing_Type:i.BookingDetails.BlockFlag,Payment_Mode:i.PaymentDetails.PaymentMode,Payment_Gateway:i.PaymentDetails.PaymentGateway,Payment_Data:i.PaymentDetails.PaymentData};u=t({method:"POST",url:Config.Api+"FlightConfirmation/Booking",dataType:"json",data:n.AirBookingRequest,headers:{"Content-Type":"application/json"}});u.then(function(t){var i=JSON.parse(localStorage.getItem("FlightObject")),o,u,f,r;try{PushEventMessage(6,i);o=[];u=t.data;localStorage.setItem("lobjTicketingResponse",JSON.stringify(u));u.Status=="1"?(f=u.Data,i.BookingDetails.Status=1,i.BookingDetails.TicketData=f,i.BookingDetails.Error_Code=f.Response_Header.Error_Code,i.BookingDetails.Error_Desc=f.Response_Header.Error_Desc,localStorage.setItem("FlightObject",JSON.stringify(i)),n.RetryPaymentVisible=!1,n.ProcessBooking(),i.MetaSearchFlag==1&&i.wego_click_id!=""&&(i.WegoIMGStr=i.WegoIMGStr.replace("^status^","confirmed"),i.WegoIMGStr=i.WegoIMGStr.replace("^transaction_ID^",i.BookingDetails.Booking_RefNo),n.AppendPixelTracking(i.WegoIMGStr))):u.Status=="99"?(i.BookingDetails.Status=2,localStorage.setItem("FlightObject",JSON.stringify(i)),n.BookingBlock=!1,n.BookingPending=!0,r="<span class='lbl-medium'>"+u.StatusDesc+"<\/span>",n.RequestErrorDesc=e.trustAsHtml(r),n.ViewInnerExceptionVisible=!1,n.RetryPaymentVisible=!1):(i.BookingDetails.Status=2,localStorage.setItem("FlightObject",JSON.stringify(i)),n.BookingBlock=!1,n.BookingPending=!0,u.Data.Error_Code=="0009"||u.Data.Error_Code=="0011"||u.Data.Error_Code=="0010"?(r="<p>Oops, Your Booking didn't go through,<b> Your Payment has been received by us, Our Backend team will try to confirm the booking offline and send an Email Confirmation to you within 20 minutes. <\/b><\/p><p><b>PLS DO NOT TRY TO BOOK THE TICKET AGAIN, IN CASE OF ANY DISCREPANCY IN FARE WE WILL CALL YOU BACK WITHIN 20 MINUTES.<\/b><\/p><p>This could be because of below reasons.<\/p><span style='display:block'>- The Fare you selected is sold out during the booking process.<\/span><span style='display:block'>- Connection Error with the Airline System.<\/span><span style='display:block'>You can reach us by Email at help@happyfares.in<\/span>",n.RequestErrorDesc=e.trustAsHtml(r),n.ViewInnerExceptionVisible=!1,n.RetryPaymentVisible=!1):u.Data.Error_Code=="0008"?(r="<p>Oops, Your Booking didn't go through,<b> Your Payment has been received by us, Our Backend team will try to confirm the booking offline and send an Email Confirmation to you within 20 minutes. <\/b><\/p><p><b>PLS DO NOT TRY TO BOOK THE TICKET AGAIN, IN CASE OF ANY DISCREPANCY IN FARE WE WILL CALL YOU BACK WITHIN 20 MINUTES.<\/b><\/p><p>This could be because of below reasons.<\/p><span style='display:block'>- The Fare you selected is sold out during the booking process.<\/span><span style='display:block'>- Connection Error with the Airline System.<\/span><span style='display:block'>You can reach us by Email at help@happyfares.in<\/span>",n.RequestErrorDesc=e.trustAsHtml(r),n.ViewInnerExceptionVisible=!1,n.RetryPaymentVisible=!1):(r="<p>Oops, Your Booking didn't go through,<b> Your Payment has been received by us, Our Backend team will try to confirm the booking offline and send an Email Confirmation to you within 20 minutes. <\/b><\/p><p><b>PLS DO NOT TRY TO BOOK THE TICKET AGAIN, IN CASE OF ANY DISCREPANCY IN FARE WE WILL CALL YOU BACK WITHIN 20 MINUTES.<\/b><\/p><p>This could be because of below reasons.<\/p><span style='display:block'>- The Fare you selected is sold out during the booking process.<\/span><span style='display:block'>- Connection Error with the Airline System.<\/span><span style='display:block'>You can reach us by Email at help@happyfares.in<\/span>",n.RequestErrorDesc=e.trustAsHtml(r),n.ViewInnerExceptionVisible=!1,n.RetryPaymentVisible=!1),n.BookingMessage="Booking",n.RequestStatus="Pending")}catch(s){i.BookingDetails.Status=2;localStorage.setItem("FlightObject",JSON.stringify(i))}},function(){})}else i.BookingDetails.Status==1?n.ProcessBooking():i.BookingDetails.Status==2&&(n.BookingBlock=!1,n.BookingPending=!0,n.BookingMessage="Booking",n.RequestStatus="Pending",n.RequestStatus="Pending",f="<p>\t\tOops, Your Booking didn't go through,<b> Your Payment has been received by us, Our Backend team will try to confirm the booking offline and send an Email Confirmation to you within 20 minutes. <\/b><\/p><p><b>PLS DO NOT TRY TO BOOK THE TICKET AGAIN, IN CASE OF ANY DISCREPANCY IN FARE WE WILL CALL YOU BACK WITHIN 20 MINUTES.<\/b><\/p><p>This could be because of below reasons.<\/p><span style='display:block'>- The Fare you selected is sold out during the booking process.<\/span><span style='display:block'>- Connection Error with the Airline System.<\/span><span style='display:block'>You can reach us by Email at help@happyfares.in<\/span>",n.RequestErrorDesc=e.trustAsHtml(f),n.ViewInnerExceptionVisible=!1)}catch(h){}};n.AppendPixelTracking=function(n){try{var t=document.createElement("img");t.src=n;t.width="1";t.height="1";t.border="0";t.alt="";document.getElementById("PixelTracking").appendChild(t)}catch(i){}};n.ProcessBooking=function(){var f,e,t,u;try{n.BookingBlock=!1;var o=JSON.parse(localStorage.getItem("FlightObject")),r=o.BookingDetails.TicketData,s=JSON.stringify(r),i=r.AirlinePNRDetails;for(n.AirlinePNRDetail=i,f="",e=0,t=0;t<i.length;t++)if(n.BookingMessage=i[t].Status_Id=="33"?"Blocking":"Booking",i[t].AirlinePNRs!=undefined||i[t].AirlinePNRs!=null)for(u=0;u<i[t].AirlinePNRs.length;u++)i[t].AirlinePNRs[u].Airline_PNR!=undefined||i[t].AirlinePNRs[u].Airline_PNR!=null?(f.indexOf(i[t].AirlinePNRs[u].Airline_PNR)<0&&(n.BookingType=="ROUNDTRIP"||n.BookingType=="MULTICITY"?(f+=i[t].AirlinePNRs[u].Airline_PNR,t!=1&&(f+=",")):f+=i[t].AirlinePNRs[u].Airline_PNR),e=e+1):n.BookingPending=!0;else n.BookingPending=!0,n.RequestErrorDesc="OMG ! Your ticket status is pending , Our specialists already know this and they will fix this . Please don't rebook the ticket until the status is updated.";e>0&&r.Booking_RefNo!=null?(n.AirlinePNR=f.trim(","),n.AirlineConfirmationPNR=f,n.FareDetails(2),n.BookingConfirmation=!0,n.BookingPending=!1,n.ManualTicket=!1,r.Response_Header.Error_Desc.trim()==""||r.Response_Header.Error_Desc.trim()=="SUCCESS"?(n.FullSuccess=!0,n.PartialSuccess=!1):r.Response_Header.Error_Code=="0040"?(n.RequestErrorDesc=r.Response_Header.Error_Desc.trim(),n.FullSuccess=!0,n.PartialSuccess=!1,n.ManualTicket=!0):(n.RequestErrorDesc=r.Response_Header.Error_Desc.trim(),n.FullSuccess=!1,n.PartialSuccess=!0)):(n.RequestErrorDesc=r.AirlinePNRDetails[0].Failure_Remark,n.BookingPending=!0)}catch(h){}};n.ConfirmBooking();n.FlightObject={};n.RetryPayment=function(){var t,i;try{t=JSON.parse(localStorage.getItem("FlightObject"));n.FlightDetails=t.Trips;n.BookingAmount=n.TotalDealValue!=undefined?n.TotalTicketCost+n.AddOn_Fees-(n.TotalDealValue+n.GrossCommission):n.TotalTicketCost+n.AddOn_Fees-n.GrossCommission;localStorage.setItem("PreviousCtrl","paymentgateway");t=JSON.parse(localStorage.getItem("FlightObject"));i=t.PaymentDetails;i.PaymentStatus=0;t.PaymentDetails=i;n.FlightObject.PaymentTypeCode=i.PaymentBase.PGInfo.PaymentTypeCode;i.PaymentBase.PaymentBiller=o.Biller_Id+"$"+o.SupplierId+"$"+o.SubbillerCode;localStorage.setItem("FlightObject",JSON.stringify(t));o.InitiatePayment(i.PaymentBase)}catch(r){}};n.OpenTicket=function(i,r,u){try{n.BookRefNo=i;r==0&&(n.ShowViewer=!1);n.lobjInput={Header:n.GetHeader(n.ProcessID),Booking_RefNo:i,FlightId:"",TicketOption:r,AirlinePNR:u};fnProgstart();var f=t({method:"POST",url:Config.Api+"FlightHistory/Ticket",dataType:"json",data:n.lobjInput,headers:{Authorization:n.GetBearerToken(),"Content-Type":"application/json"}});f.then(function(t){var i,r,f,o,u;try{if(fnProgstop(),i=t.data,i.Status=="1"){var s=JSON.parse(i.Data.Filler2),c=i.Data.Filler1,h=i.Data.Filler3;if(c==0){for(n.AirlineTicketData=s.AirPNRDetails,n.GrossAmount=0,r=0;r<n.AirlineTicketData[0].PAXTicketDetails.length;r++)n.GrossAmount+=parseFloat(n.AirlineTicketData[0].PAXTicketDetails[r].Fares[0].FareDetails[0].Total_Amount)-(parseFloat(n.AirlineTicketData[0].PAXTicketDetails[r].Fares[0].FareDetails[0].Promo_Discount)+parseFloat(n.AirlineTicketData[0].PAXTicketDetails[r].Fares[0].FareDetails[0].Gross_Commission));n.GrossAmount+=s.BookingPaymentDetail[0].Gateway_Charges;n.AirlineTicketString=JSON.parse(h);n.ViewerOption=1;$("#TicketActionModal").modal("show");n.SelectedIndex=0;n.Singlepax=!1;n.Multiplepax=!1;n.Singlepax=n.Adult_Count==1?!0:n.UserInfo.B2BFlag?!0:!0}else{for(f="",o=JSON.parse(h),u=0;u<o.length;u++)f+=o[u].Ticket_Content;n.AirlineEachTicketContainer=e.trustAsHtml(f);n.ShowViewer=!0}}else return ShowAlert(i.StatusDesc),!1}catch(l){}})}catch(s){}};n.SelectTrip=function(t,r,u){try{for(i=0;i<n.AirlineTicketData.length;i++)$("#Btn_"+i+"").addClass("btn btn-small btn-secondary");$("#Btn_"+u+"").removeClass("btn btn-small btn-secondary");$("#Btn_"+u+"").addClass("btn btn-small btn-primary");n.SelectedIndex=u}catch(f){}};n.TicketAction=function(t){var o,i,s,c,y;try{if($("#ticket-viewer").css("max-height",window.innerHeight-250),$("#ticket-viewer").css("min-height",window.innerHeight-250),t==0)n.ShowViewer=!1,$("#TicketActionModal").modal("show");else{if((n.ViewerOption=t,n.SelectedIndex==="")||n.SelectedIndex===undefined)return ShowError("Please Select Your Ticket"),!1;var u=n.SelectedIndex,f=n.AirlineTicketData,r=n.AirlineTicketString;if(n.AirlinePNR=r[u].Airline_PNR,t==1)n.Fee_Amount=f[u].Post_Markup,n.ShowViewer=!0;else{if(t==2){for(i=0;i<r.length;i++)f[u].Airline_PNR==r[i].Airline_PNR&&(n.AirlineTicketContainer=e.trustAsHtml(r[i].Ticket_Content));var h=n.OriginCode+"-"+n.DestinationCode,p="text/html",l=n.AirlineTicketContainer,v={Filename:h,URL:"",HtmlString:btoa(unescape(encodeURIComponent(l))),HeadLeftText:"",HeadCenterText:"",HeadRightText:"",HeadHtmlString:"",FootLeftText:"",FootCenterText:"",FootRightText:"",FootHtmlString:""};return fnProgstart(),a.GetPDF(v).then(function(t){try{fnProgstop();n.fnOpenLink(h,t.data,"application/pdf");$("#TicketActionModal").modal("hide")}catch(i){fnProgstop();$("#TicketActionModal").modal("hide")}},function(){fnProgstop();$("#TicketActionModal").modal("hide")}),$("#TicketActionModal").modal("hide"),!1}if(t==3)for(i=0;i<r.length;i++)f[u].Airline_PNR==r[i].Airline_PNR&&(n.AirlineTicketContainer=e.trustAsHtml(r[i].Ticket_Content),n.ShowViewer=!0);else if(t==4){for(i=0;i<r.length;i++)f[u].Airline_PNR==r[i].Airline_PNR&&(n.AirlineTicketContainer=r[i].Ticket_Content);n.ShowViewer=!0}else if(t==5)n.ShowViewer=!0;else if(t==12)n.ShowViewer=!0;else if(t==13)n.ShowViewer=!0;else if(t==6)for(i=0;i<r.length;i++)f[u].Airline_PNR==r[i].Airline_PNR&&n.OpenTicket(n.BookRefNo,1,f[u].Airline_PNR);else if(t==7){if(Config.ChannelId==4){for(i=0;i<r.length;i++)f[u].Airline_PNR==r[i].Airline_PNR&&(n.AirlineTicketContainer=e.trustAsHtml(r[i].Ticket_Content));var h=n.OriginCode+"-"+n.DestinationCode,p="text/html",l=n.AirlineTicketContainer,v={Filename:h,URL:"",HtmlString:btoa(unescape(encodeURIComponent(l))),HeadLeftText:"",HeadCenterText:"",HeadRightText:"",HeadHtmlString:"",FootLeftText:"",FootCenterText:"",FootRightText:"",FootHtmlString:""};return fnProgstart(),a.GetPDF(v).then(function(t){try{fnProgstop();window.plugins.socialsharing.share(null,h,t.data,null)}catch(i){fnProgstop();n.DowloadFlight=!1;$("#TicketActionModal").modal("hide")}},function(){fnProgstop();n.DowloadFlight=!1;$("#TicketActionModal").modal("hide")}),!1}for(o="",i=0;i<r.length;i++)f[u].Airline_PNR==r[i].Airline_PNR&&(s=f[u].Flights[0],c=s.TravelDate.split("/"),o+="Hi "+f[u].PAXTicketDetails[0].First_Name+", Your onward flight "+f[u].Airline_Name+" Airline ",o+=s.Origin.split("(")[0]+"-"+s.Destination.split("(")[0],o+="DepartureDate "+c[1]+" "+fnGetMonthbyText(c[0])+" "+c[2]+" Time"+s.Segments[0].Departure_DateTime.split(" ")[1].split(":")[0],o+=":"+s.Segments[0].Departure_DateTime.split(" ")[1].split(":")[1]+" Fare"+f[u].Gross_Amount);y="https://web.whatsapp.com/send?text="+o;window.open(y,"_blank")}}}}catch(k){}};n.BacktoFlight=function(){try{Config.ChannelId!=3&&localStorage.setItem("ChangeFlight_Request","");localStorage.setItem("PreviousCtrl","search");o.LoadPage("home")}catch(n){}};n.Duration=function(t,i){var r,e;try{var o=new Date(t),s=new Date(i),u=Math.abs(o-s),f=Math.floor(u/36e5);return f<10&&(f="0"+f),u-=f*36e5,r=Math.floor(u/6e4),r<10&&(r="0"+r),u-=r*6e4,e=Math.floor(u/1e3),e<10&&(e="0"+e),n.durationhrs=f+"hrs, "+r+"mins ",n.durationhrs}catch(h){}};n.PushMarkUpdetails=function(t){try{var r=[],i={};return i.MarkupAmount=n.Fee_Amount,i.Supplier_RefNo=t,r.push(i),r}catch(u){}};n.AddServiceCharge=function(t){try{if(n.Fee_Amount==""||n.Fee_Amount==undefined)return alert("Please Enter Your Fee Amount"),!1;o.BookRefNo=n.BookRefNo;o.ProductID=1;o.Fee_Detail=n.PushMarkUpdetails(t);o.Feeupdate()}catch(i){}};n.fnSendmail=function(){try{o.BookRefNo=n.BookRefNo;o.ProductID=1;o.TicketContainer=n.AirlineTicketContainer;o.EmailID=n.ShareModel.EmailID;o.Subject=n.OriginCode+" - "+n.DestinationCode+" | "+n.FormatDate(n.OngoingDate,"DD/MM/YYYY","DD, MMM, YYYY");o.Flag="0";o.Sendmail()}catch(t){}};o.SendmailResult=function(){try{n.ShareModel.EmailID="";ShowAlert("Email Sent Successfully !")}catch(t){}};n.fnSendSMS=function(){try{o.ProductID=1;o.SubModuleID=1;o.BookRefNo=n.BookRefNo;o.SupplierPNR=n.AirlinePNR;o.MobileNumber=n.ShareModel.MobileNumber;o.SendSMS()}catch(t){}};n.fnSendWhatsApp=function(){try{o.BookRefNo=n.BookRefNo;o.SupplierPNR=n.AirlinePNR;o.MobileNumber=n.ShareModel.WhatsAppNumber;o.ProductID=1;o.WhatsAppsms();$("#TicketActionModal").modal("hide")}catch(t){}};o.whasappResult=function(){ShowAlert("WhatsApp Message sent successfully.")};o.SendSMSResult=function(){try{n.ShareModel.MobileNumber="";ShowAlert("SMS Sent Successfully !")}catch(t){}};o.FeeUpdateResult=function(){try{n.Fee_Amount="";$("#TicketActionModal").modal("hide")}catch(t){}};n.ShowInnerException=function(){try{n.RequestInnerExceptionVisible=n.RequestInnerExceptionVisible==!0?!1:!0}catch(t){}};n.$on("FlightConfirmBackFunction",function(){n.BacktoFlight()});n.GetTravelType=function(){try{return n.AirlineFlag="",n.From.originalObject.Type=="H"&&n.To.originalObject.Type=="H"?(n.AirlineFlag=1,"DOMESTIC"):(n.AirlineFlag=0,"INTERNATIONAL")}catch(t){}};n.LoadDropList=function(){try{u(function(){n.AirportDetails=lobjAirportList;n.Origin=lobjAirportList;n.Destination=lobjAirportList;var t=n.GetTravelType();n.AirlineList=lobjAirlineList;t==undefined&&(t="DOMESTIC",n.AirlineFlag=1);n.SelectedAirlineName=[];n.AirlineRestriction=fnGetRetailerData(52);angular.forEach(lobjAirlineList,function(i){var r=!1;for(j=0;j<n.AirlineRestriction.split(",").length-1;j++)n.AirlineRestrictTravelType=n.AirlineRestriction.split(",")[j].split("~")[1]==13?"DOMESTIC":"INTERNATIONAL",i.Value==n.AirlineRestriction.split(",")[j].split("~")[0]&&n.AirlineRestrictTravelType==t&&(r=!0);i.Type==t&&r==!1&&n.SelectedAirlineName.push(i)});n.AirlineName=n.SelectedAirlineName},1500)}catch(t){}};n.LoadDropList();n.ShowMoreStops=function(t,i){var u,f,h;try{var o="",s="",r="",e="";if(!i)for(u=1;u<t.length;u++)Config.ChannelId=="3"?(r+="@"+t[u].Origin_City,f=u,f+1<=t.length&&(h=f-1,e=n.CalculateLayOver(t[f-1].Arrival_DateTime,t[f].Departure_DateTime)),r+=f+1<t.length?" , Layover-"+e+",":" , Layover-"+e):r+="@"+t[u].Origin;return i&&angular.forEach(t,function(t){s+=t+", ";n.AirportDetails=lobjAirportList;r=n.AirportDetails;r=r.filter(function(n){return n.Value==t});o+=r[0].Name+", ";r=o.replace(/,\s*$/,"");n.morestopsHind=s.replace(/,\s*$/,"")}),r}catch(c){}};n.$watch("RetryReceived",function(t){if(t=="1"){n.BookingBlock=!1;n.BookingPending=!0;n.BookingMessage="Booking";n.RequestStatus="Pending";n.RequestStatus="Pending";n.RequestErrorDesc=e.trustAsHtml("<p>\t\tOops, Your Booking didn't go through,<b> Your Payment has been received by us, Our Backend team will try to confirm the booking offline and send an Email Confirmation to you within 20 minutes. <\/b><\/p><p><b>PLS DO NOT TRY TO BOOK THE TICKET AGAIN, IN CASE OF ANY DISCREPANCY IN FARE WE WILL CALL YOU BACK WITHIN 20 MINUTES.<\/b><\/p><p>This could be because of below reasons.<\/p><span style='display:block'>- The Fare you selected is sold out during the booking process.<\/span><span style='display:block'>- Connection Error with the Airline System.<\/span><span style='display:block'>You can reach us by Email at help@happyfares.in<\/span>");n.ViewInnerExceptionVisible=!1;n.RetryPaymentVisible=!1}})}]);$(document).mouseup(function(n){try{if(n.target.classList.contains("search-date")==!1&&n.target.classList.contains("calender-trigger")==!1){var t=$(".calender-box");t.is(n.target)||t.hide()}}catch(n){}})